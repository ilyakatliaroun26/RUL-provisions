{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.0b2", "generated_at": "2025-11-03T16:33:31.914440Z", "invocation_id": "91c76915-0029-46e0-8c3b-e86eecc7c8a3", "invocation_started_at": "2025-11-03T16:32:21.232450Z", "env": {}}, "results": [{"status": "error", "timing": [{"name": "compile", "started_at": "2025-11-03T16:32:23.739979Z", "completed_at": "2025-11-03T16:32:23.757569Z"}, {"name": "execute", "started_at": "2025-11-03T16:32:23.757978Z", "completed_at": "2025-11-03T16:33:31.531511Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 67.80365633964539, "adapter_response": {}, "message": "Database Error in model bp_retail_provisions_m (models/Provisions/v4/bp_retail_provisions_m.sql)\n  permission denied for relation bp_retail_provisions_m", "failures": null, "unique_id": "model.credit_risk_playground.bp_retail_provisions_m", "compiled": true, "compiled_code": "\n\n/*\nModels to run\n\nbp_portfolio_balance_aud_m_v2 +\nbp_overdraft_limit_periods_v2   (first drop then create again) +\nbp_portfolio_customers_aud_m_v2 + \nbp_overdue_amt_aud_m  (is not used anymore) +\nbp_arrears_reg_aud  (use dbt.bp_arrears_reg_aud instead) \nbp_overdraft_split_m_v2 +\nbp_monitoring_pd_supermodel_v2_m_v2 \nbp_credit_bureau_rating_m_v2  \nbp_default_dunning_m_v2 \nbp_default_internal_insolvency_v2_m_v2\nbp_default_credit_bureau_insolvency_max_date_v2 (first drop) +\nbp_default_credit_bureau_insolvency_rmd_v2 (first drop) +\nbp_default_credit_bureau_insolvency_me_v2 (first drop) +\nbp_default_credit_bureau_insolvency_v3_m_v2 +\nbp_repayment_plan_ph1_m_v2 +\nbp_loan_contract_information_m_v2 +\nbp_p_accounts_v2 (first drop) +\nbp_hrc_m_v2 +\nbp_social_benefits_v2_m_v2 +\nbp_garnishment_m_v2\nbp_application_pd_supermodel_m_v2 +\nbp_application_pd_supermodel_m_ad_v2 +\nbp_retail_provisions_stg_v5_pre_updated_v2 +\nbp_forbearance_m_v2_v2\nbp_retail_provisions_stg_v5_v4_updated_v2 +\nbp_retail_provisions_m\n*/\n\n-- dbt run --full-refresh --select bp_retail_provisions_m_v3 (first time)\n-- dbt run --select bp_retail_provisions_m_v3 (other runs)\n\nwith \n\ntotal as (\nselect distinct\n\n-- 1. Customers base\n\nuser_id \n,  Instrument_ID\n,  Country\n,  LegalEntity\n,  IS_IFRS -- \"No\" for TSY bonds and \"Yes\" for other instruments\n,  ReportDate\n,  CalcDate -- for retail same as eom, for mortgage 1-month lag\n,  Script_calculation_date\n\n\n\n-- 2. Product flag\n\n, product_flag\n\n, Instrument_Type\n\n, Instrument \n\n\n-- 3. Creation date \n\n, credit_creation_date\n\n-- 4. DPD\n\n, start_in_arrears\n, dpd\n-- , coalesce(datediff('day', start_in_arrears::date, ReportDate::date) + 1,0) as dpd\n\n\n\n-- 5. Default\n\n, insolvency \n, dunning \n, schufa_insolvency\n, rep_plan_user\n\n, is_default\n\n\n-- 6. Credit Bureau flags\n\n, schufa_rating \n, provider\n, schufa_rating_date\n\n-- 7. Limit\n\n, \"Limit\"\n\n, last_limit_eur\n\n, last_limit_date\n\n-- 8. Exposures\n\n, TBIL_exposures\n\n, CC_exposures\n\n, RP_2_exposures\n\n, OD_exposures\n\n-- , coalesce(lo.exposures_loan,0) as loan_exposures\n\n-- 9. PD\n\n-- Available Lisbon 2 PD\n\n\n, logit\n\n-- , (logit - 0.09089766913677097) / 0.9897750804490338 as logit_porto_corr\n\n, pd_pit_calibrated_scen_weighted as pd_pit\n\n\n, pd_pit_calibrated_scen_weighted as pd_od\n\n\n-- Calibration PD\n\n, pd_pit_calibrated_scen_weighted as pd_pit_calibrated\n\n, rating_class_pit_calibrated_scen_weighted as rating_class_pit_calibrated\n\n-- Final PD and rating (PIT)\n\n\n, PD_scen_weighted as  PD\n\n, CurrentRating_scen_weighted as CurrentRating\n\n, CurrentRating_date\n\n\n\n -- 10. CCF\n\n, utilization_pct\n, usage\n\n\n, ccf\n\n, off_balance_exposure\n\n-- 11. EAD\n\n, OffBalance_EAD -- only for off-balance exposures by finance request\n\n, OnBalance_EAD\n\n, IsOffBalance\n\n\n\n-- 12. LGD \n\n, case --when dxaud::date < date_add('year', -3, reportdate)::date then 1.0::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 500.22 then 0.461767::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 2751.38 then 0.521929::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 5992.30 then 0.552278::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 5992.30 then 0.71094::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 102.50 then 0.287018::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 240.50 then 0.368662::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 526.00 then 0.443474::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 526.00 then 0.520718::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 43.50 then 0.840663::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 83.50 then 0.846696::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 123.50 then 0.878149::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 123.50 then 0.924742::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 61.50 then 0.865395::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 124.00 then 0.90235::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 124.00 then 0.941614::float\n     when product_flag = 'CC' then 0.678207::float\n     when product_flag = 'TBIL' then 0.287018::float\n     when product_flag in ('Unarranged Overdraft') and country in ('AUT') then 0.81860::float\n     when product_flag in ('Unarranged Overdraft') and country in ('BEL') then 0.84210::float\n     when product_flag in ('Unarranged Overdraft') and country in ('DEU') then 0.77610::float\n     when product_flag in ('Unarranged Overdraft') and country in ('ESP') then 0.93170::float\n     when product_flag in ('Unarranged Overdraft') and country in ('FRA') then 0.87090::float\n     when product_flag in ('Unarranged Overdraft') and country in ('IRL') then 0.70410::float\n     when product_flag in ('Unarranged Overdraft') and country in ('ITA') then 0.84320::float\n     when product_flag in ('Unarranged Overdraft') and country in ('NLD') then 0.77300::float\n     when product_flag in ('Unarranged Overdraft') and country in ('POL') then 0.92630::float\n     when product_flag in ('Unarranged Overdraft') and country in ('PRT') then 0.83770::float\n     when product_flag in ('Unarranged Overdraft') then 0.9048::float\n     else 0.80000::float end as LGD\n\n-- 13. Finance\n\n, overdraft_interest_accrued\n-- , mi.interest_rate as interest_rate_overdraft\n, interest_rate_loan\n, accrued_interest_loan\n\n, first_repayment\n, last_repayment\n\n, loan_amount \n, loan_name\n, repayment_installments\n, repayment_period_count\n, principal_repayment_interval\n\n-- 14. Maturity\n\n, MaturityDate\n\n, Maturity\n\n\n-- 15. Stages \n\n-- for stage 2 reasons in https://docs.google.com/document/d/1xnfIHGd-4GTxUJ2QiZ04ImMk8yYe2EfBctrk3dW-Bjc/edit# : Section 5, only with Intensified Management\n --flag\n --and +200% PD increase as significat risk increase measure\n \n\n-- application_date\n, InitialPD_date\n\n, InitialPD\n\n, InitialPD_lifetime\n\n, PD_lifetime_scenarios as PD_lifetime\n\n, Stage_scenarios as Stage \n\n\n, Stage_scenarios_description as stage_description \n\n\n-- 16. SLLP \n\n, SLLP\n\n-- per product\n\n, SLLP_OD\n, SLLP_CC\n, SLLP_TBIL\n, SLLP_RP_2\n\n\n-- 17. GLLP\n\n, GLLP_OD_scen_weighted as GLLP_OD\n\n, GLLP_RP_2_scen_weighted as GLLP_RP_2\n\n, GLLP_CC_scen_weighted as GLLP_CC\n\n, GLLP_TBIL_scen_weighted as GLLP_TBIL\n\n-- GLLP new \n, CASE \n    WHEN GLLP_scen_weighted < 0 THEN 0 \n    ELSE GLLP_scen_weighted end as GLLP\n-- ECL split \n\n, CASE \n    WHEN ECL_On_scen_weighted < 0 THEN 0 \n    ELSE ECL_On_scen_weighted end as ECL_On\n\n, ECL_Off_scen_weighted as ECL_Off\n\n\nfrom \"n26\".\"credit_risk_playground\".\"bp_retail_provisions_stg_v5_v4_updated_v2\" \nwhere ReportDate::date = last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n\t\t\t\t\t\t\t\t\t)\n    and not (\n        (coalesce(onbalance_ead, 0) = 0 and coalesce(\"limit\", 0) = 0)\n        or\n        (product_flag is null and coalesce(onbalance_ead, 0) + coalesce(offbalance_ead, 0) = 0)\n    )\n)\n\n\nselect * \n, getdate() as etl_updated\n, coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom total \n\nwhere etl_updated > (select max(etl_updated) from \"n26\".\"credit_risk_playground\".\"bp_retail_provisions_m\")\n", "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_retail_provisions_m\"", "batch_results": null}], "elapsed_time": 70.24060893058777, "args": {"indirect_selection": "eager", "require_resource_names_without_spaces": false, "use_colors": true, "which": "run", "warn_error_options": {"include": [], "exclude": []}, "select": ["bp_retail_provisions_m"], "log_level_file": "debug", "log_path": "/Users/ilya.katliarou/Documents/jaffle_shop/logs", "source_freshness_run_project_hooks": false, "use_fast_test_edges": false, "macro_debugging": false, "cache_selected_only": false, "exclude": [], "print": true, "favor_state": false, "printer_width": 80, "log_format": "default", "static_parser": true, "strict_mode": false, "vars": {}, "validate_macro_args": false, "write_json": true, "state_modified_compare_vars": false, "empty": false, "upload_to_artifacts_ingest_api": false, "log_format_file": "debug", "require_yaml_configuration_for_mf_time_spines": false, "version_check": true, "quiet": false, "require_nested_cumulative_type_params": false, "partial_parse_file_diff": true, "log_file_max_bytes": 10485760, "populate_cache": true, "profiles_dir": "/Users/ilya.katliarou/Documents/jaffle_shop", "state_modified_compare_more_unrendered_values": false, "use_colors_file": true, "project_dir": "/Users/ilya.katliarou/Documents/jaffle_shop", "invocation_command": "dbt run --select bp_retail_provisions_m", "defer": false, "partial_parse": true, "require_explicit_package_overrides_for_builtin_materializations": true, "show_resource_report": false, "log_level": "info", "require_batched_execution_for_custom_microbatch_strategy": false, "skip_nodes_if_on_run_start_fails": false, "send_anonymous_usage_stats": true, "introspect": true}}