{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/manifest/v12.json", "dbt_version": "1.10.0b2", "generated_at": "2025-11-03T16:32:21.535668Z", "invocation_id": "91c76915-0029-46e0-8c3b-e86eecc7c8a3", "invocation_started_at": "2025-04-29T16:05:16.848997+00:00", "env": {}, "project_name": "credit_risk_playground", "project_id": "27586c13ff4a67d14dfc1ca38b7be5e0", "user_id": "b7b306fc-761d-45d4-a802-fd702f0f8b86", "send_anonymous_usage_stats": true, "adapter_type": "redshift"}, "nodes": {"model.credit_risk_playground.my_first_dbt_model": {"database": "n26", "schema": "credit_risk_playground", "name": "my_first_dbt_model", "resource_type": "model", "package_name": "credit_risk_playground", "path": "example/my_first_dbt_model.sql", "original_file_path": "models/example/my_first_dbt_model.sql", "unique_id": "model.credit_risk_playground.my_first_dbt_model", "fqn": ["credit_risk_playground", "example", "my_first_dbt_model"], "alias": "my_first_dbt_model", "checksum": {"name": "sha256", "checksum": "0f0a39768ca58b1f5b1e85acbb46843e16a97d88db12e7a25d1533b2e8f77b36"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": [], "description": "A starter dbt model", "columns": {"id": {"name": "id", "description": "The primary key for this table", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "granularity": null, "doc_blocks": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "credit_risk_playground://models/example/schema.yml", "build_path": null, "unrendered_config": {"materialized": "table"}, "created_at": 1745942717.6036422, "relation_name": "\"n26\".\"credit_risk_playground\".\"my_first_dbt_model\"", "raw_code": "/*\n    Welcome to your first dbt model!\n    Did you know that you can also configure models directly within SQL files?\n    This will override configurations stated in dbt_project.yml\n\n    Try changing \"table\" to \"view\" below\n*/\n\n{{ config(materialized='table') }}\n\nwith source_data as (\n\n    select 1 as id\n    union all\n    select null as id\n\n)\n\nselect *\nfrom source_data\n\n/*\n    Uncomment the line below to remove records with null `id` values\n*/\n\n-- where id is not null", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": ["id"], "time_spine": null, "freshness": null}, "model.credit_risk_playground.my_second_dbt_model": {"database": "n26", "schema": "credit_risk_playground", "name": "my_second_dbt_model", "resource_type": "model", "package_name": "credit_risk_playground", "path": "example/my_second_dbt_model.sql", "original_file_path": "models/example/my_second_dbt_model.sql", "unique_id": "model.credit_risk_playground.my_second_dbt_model", "fqn": ["credit_risk_playground", "example", "my_second_dbt_model"], "alias": "my_second_dbt_model", "checksum": {"name": "sha256", "checksum": "dc8c458292bc2fb8ce4591cb70c1e23046e3c2e33fb1c2ce732658f90e231f1e"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": [], "description": "A starter dbt model", "columns": {"id": {"name": "id", "description": "The primary key for this table", "meta": {}, "data_type": null, "constraints": [], "quote": null, "tags": [], "granularity": null, "doc_blocks": []}}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": "credit_risk_playground://models/example/schema.yml", "build_path": null, "unrendered_config": {"materialized": "view"}, "created_at": 1745942717.60399, "relation_name": "\"n26\".\"credit_risk_playground\".\"my_second_dbt_model\"", "raw_code": "-- Use the `ref` function to select from other models\n\nselect *\nfrom {{ ref('my_first_dbt_model') }}\nwhere id = 1", "doc_blocks": [], "language": "sql", "refs": [{"name": "my_first_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.credit_risk_playground.my_first_dbt_model"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": ["id"], "time_spine": null, "freshness": null}, "test.credit_risk_playground.unique_my_first_dbt_model_id.16e066b321": {"database": "n26", "schema": "credit_risk_playground_dbt_test__audit", "name": "unique_my_first_dbt_model_id", "resource_type": "test", "package_name": "credit_risk_playground", "path": "unique_my_first_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.credit_risk_playground.unique_my_first_dbt_model_id.16e066b321", "fqn": ["credit_risk_playground", "example", "unique_my_first_dbt_model_id"], "alias": "unique_my_first_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {}, "created_at": 1745942717.6350348, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "doc_blocks": [], "language": "sql", "refs": [{"name": "my_first_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["model.credit_risk_playground.my_first_dbt_model"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_first_dbt_model", "attached_node": "model.credit_risk_playground.my_first_dbt_model", "test_metadata": {"name": "unique", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_first_dbt_model')) }}"}, "namespace": null}}, "test.credit_risk_playground.not_null_my_first_dbt_model_id.5fb22c2710": {"database": "n26", "schema": "credit_risk_playground_dbt_test__audit", "name": "not_null_my_first_dbt_model_id", "resource_type": "test", "package_name": "credit_risk_playground", "path": "not_null_my_first_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.credit_risk_playground.not_null_my_first_dbt_model_id.5fb22c2710", "fqn": ["credit_risk_playground", "example", "not_null_my_first_dbt_model_id"], "alias": "not_null_my_first_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {}, "created_at": 1745942717.6357288, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "doc_blocks": [], "language": "sql", "refs": [{"name": "my_first_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["model.credit_risk_playground.my_first_dbt_model"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_first_dbt_model", "attached_node": "model.credit_risk_playground.my_first_dbt_model", "test_metadata": {"name": "not_null", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_first_dbt_model')) }}"}, "namespace": null}}, "test.credit_risk_playground.unique_my_second_dbt_model_id.57a0f8c493": {"database": "n26", "schema": "credit_risk_playground_dbt_test__audit", "name": "unique_my_second_dbt_model_id", "resource_type": "test", "package_name": "credit_risk_playground", "path": "unique_my_second_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.credit_risk_playground.unique_my_second_dbt_model_id.57a0f8c493", "fqn": ["credit_risk_playground", "example", "unique_my_second_dbt_model_id"], "alias": "unique_my_second_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {}, "created_at": 1745942717.6363251, "relation_name": null, "raw_code": "{{ test_unique(**_dbt_generic_test_kwargs) }}", "doc_blocks": [], "language": "sql", "refs": [{"name": "my_second_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_unique"], "nodes": ["model.credit_risk_playground.my_second_dbt_model"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_second_dbt_model", "attached_node": "model.credit_risk_playground.my_second_dbt_model", "test_metadata": {"name": "unique", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_second_dbt_model')) }}"}, "namespace": null}}, "test.credit_risk_playground.not_null_my_second_dbt_model_id.151b76d778": {"database": "n26", "schema": "credit_risk_playground_dbt_test__audit", "name": "not_null_my_second_dbt_model_id", "resource_type": "test", "package_name": "credit_risk_playground", "path": "not_null_my_second_dbt_model_id.sql", "original_file_path": "models/example/schema.yml", "unique_id": "test.credit_risk_playground.not_null_my_second_dbt_model_id.151b76d778", "fqn": ["credit_risk_playground", "example", "not_null_my_second_dbt_model_id"], "alias": "not_null_my_second_dbt_model_id", "checksum": {"name": "none", "checksum": ""}, "config": {"enabled": true, "alias": null, "schema": "dbt_test__audit", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "test", "severity": "ERROR", "store_failures": null, "store_failures_as": null, "where": null, "limit": null, "fail_calc": "count(*)", "warn_if": "!= 0", "error_if": "!= 0"}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {}, "created_at": 1745942717.636936, "relation_name": null, "raw_code": "{{ test_not_null(**_dbt_generic_test_kwargs) }}", "doc_blocks": [], "language": "sql", "refs": [{"name": "my_second_dbt_model", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.test_not_null"], "nodes": ["model.credit_risk_playground.my_second_dbt_model"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "column_name": "id", "file_key_name": "models.my_second_dbt_model", "attached_node": "model.credit_risk_playground.my_second_dbt_model", "test_metadata": {"name": "not_null", "kwargs": {"column_name": "id", "model": "{{ get_where_subquery(ref('my_second_dbt_model')) }}"}, "namespace": null}}, "model.credit_risk_playground.bp_overdue_amt_aud_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_overdue_amt_aud_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_overdue_amt_aud_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_overdue_amt_aud_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_overdue_amt_aud_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_overdue_amt_aud_m_v2"], "alias": "bp_overdue_amt_aud_m_v2", "checksum": {"name": "sha256", "checksum": "0293498ff9e24b631917225d29fbdf812f45288d39f88005f5848793a8e4499d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1750775608.8007, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_overdue_amt_aud_m_v2\"", "raw_code": "{{\n    config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- first drop it!\n\nwith \noverdraft_history as (\nselect distinct\no.user_id\n, o.end_time\n, o.max_amount_cents\n, o.od_enabled_flag\n, datediff('day'\n           , o.end_time\n           , lead(o.end_time,1) over(partition by o.user_id order by o.end_time)) as dd \n, coalesce(o.outstanding_balance_eur::numeric,0) - coalesce(o.max_amount_cents::numeric/100,0) as overdue_amount\n, coalesce(o.outstanding_balance_eur::numeric,0) as exposures\nfrom dbt.bp_overdraft_users o\nwhere   timeframe = 'day'\nand end_time < getdate()\nand end_time >= date_add('day',  -360, last_day(\n                                                date_add('month'\n                                                        , -1\n                                                        , last_day(getdate())\n                                                        )\n                                                )\n                         )\n                         \norder by end_time \n)\n\n-- 3.2 Arrears data for Loans\n\n, mmbr_loan_aud as (\nselect * \n, coalesce(lead(rev_timestamp - interval '0.000001 second', 1) over (partition by encoded_key order by rev_timestamp), '2100-01-01') as end_timestamp\nfrom mmbr_n26_loan_account_aud \n)\n\n, loans_dates AS ( \nSELECT lasa.encoded_key \n       , lasa.user_id \n       , d.end_time::date  AS date \nFROM dwh_cohort_dates d \nINNER JOIN ( SELECT m.encoded_key \n                    , mum.user_id \n                    , min(rev_timestamp::date)  AS disbursement_date \n                    , max(end_timestamp::date)  AS payback_date \nFROM mmbr_loan_aud m \ninner join dbt.mmbr_user_match mum on mum.mmbr_client_key = m.account_holder_key  and mum.is_current = true\nWHERE principal_balance <> 0 \n      OR interest_balance <> 0 \n      OR interest_from_arrears_balance <> 0 \n      OR fees_balance <> 0 \n      OR penalty_balance <> 0\nGROUP BY m.encoded_key , mum.user_id) lasa ON d.end_time::date BETWEEN lasa.disbursement_date AND lasa.payback_date \nWHERE d.date BETWEEN (last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n                            )+ interval'-360 days') AND last_day(\n                                                                date_add('month'\n                                                                        , -1\n                                                                        , last_day(getdate())\n                                                                        )\n                                                                ) \n                                                                          \n)\n\n, end_ts as (\nselect *,\n    coalesce(lead(rev_timestamp, 1) over (partition by encoded_key order by rev_timestamp), '2100-01-01') as end_timestamp\nfrom mmbr_n26_repayment_aud mrsa\n)\n\n, overdue_loan as (\nSELECT ld.user_id \n       , ld.encoded_key\n       , ld.date as end_time \n       , SUM(CASE WHEN r.due_date::date <= ld.date AND r.state = 'LATE' THEN r.principal_due - r.principal_paid\n                  ELSE 0 END) AS principal_overdue \n       , SUM(CASE WHEN r.due_date::date <= ld.date AND r.state = 'LATE' THEN r.interest_due - r.interest_paid \n                  ELSE 0 END) AS interest_overdue \n       , SUM(CASE WHEN (r.due_date AT TIME ZONE 'UTC')::date <= ld.date AND r.state = 'LATE' THEN r.fees_due - r.fees_paid \n                  ELSE 0 END) AS fees_overdue \n       , SUM(CASE WHEN (r.due_date AT TIME ZONE 'UTC')::date <= ld.date AND r.state = 'LATE' THEN r.penalty_due - r.penalty_paid \n                  ELSE 0 END) AS penalty_overdue \nFROM loans_dates ld \nLEFT JOIN end_ts r ON ld.encoded_key = r.parent_account_key \n                                   AND (ld.date BETWEEN r.rev_timestamp AND r.end_timestamp) \n-- where user_id = '107c3f96-9e5f-49e5-8994-04da6eb3dc41'\nGROUP BY ld.user_id \n       , ld.encoded_key\n       , ld.date \nORDER BY  ld.user_id \n       , ld.encoded_key\n       , ld.date \n)\n\n, loan_history as (\nselect m.*\n, mum.user_id \n, d.date as end_time\n, (principal_overdue\n   + interest_overdue \n   + fees_overdue\n   + penalty_overdue) as overdue_amount\n , (principal_balance\n    + interest_balance \n    + interest_from_arrears_balance \n    + fees_balance \n    + penalty_balance)  as exposures\nfrom mmbr_loan_aud m\ninner join dbt.mmbr_user_match mum on mum.mmbr_client_key = m.account_holder_key and mum.is_current = true\ninner join dwh_cohort_dates d on  d.end_time::timestamp  between m.rev_timestamp  and m.end_timestamp\ninner join dbt.mmbr_loan_product_mapping mp on m.loan_name = mp.loan_name and mp.product in ('consumer_credit'\n                                                                                                , 'installment_loans'\n                                                                                                , 'repayment_plans')\nleft join overdue_loan o on o.user_id = mum.user_id and o.encoded_key = m.encoded_key and  d.end_time::date = o.end_time::date \nwhere d.date >= date_add('day',  -360, last_day(\n                                            date_add('month'\n                                                    , -1\n                                                    , last_day(getdate())\n                                                    )\n                                                ) \n                        )\nand d.date < getdate()\nand ( principal_balance <> 0 \n            OR interest_balance <> 0 \n            OR interest_from_arrears_balance <> 0 \n            OR fees_balance <> 0 \n            OR penalty_balance <> 0 )\n)\n\n\n\n\n -- 3.3 Days past due calculation , all end_times are in \"date\" format so the reporting date in the end also should be transfered into \"date\"\n -- (based on https://www.eba.europa.eu/sites/default/documents/files/documents/10180/1597002/fe1db887-c6dc-4777-89c1-4f243584cafd/Final%20draft%20RTS%20on%20the%20materiality%20threshold%20for%20credit%20obligations%20%28EBA-RTS-2016-06%29.pdf?retry=1)\n\n , history_for_arrears as (\nselect distinct\n    o.user_id \n    , o.end_time::date as end_time\n    , case when o.overdue_amount < 0 then 0 else o.overdue_amount end overdue_amount\n    , o.exposures\n    from overdraft_history o \n\n    union all \n\n    select distinct\n    c.user_id \n    , c.end_time::date as end_time\n    , case when c.overdue_amount < 0 then 0 else c.overdue_amount end overdue_amount\n    , c.exposures\n    from loan_history c \n)\n\n\nselect \nuser_id \n, end_time \n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(end_time::varchar, '') as unique_key\n, sum(coalesce(overdue_amount,0)) as overdue_amount\n, sum(coalesce(exposures,0)) as exposures\nfrom history_for_arrears\ngroup by 1,2,3,4\norder by 1,2,3,4", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_arrears_reg_aud_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_arrears_reg_aud_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_arrears_reg_aud_v2.sql", "original_file_path": "models/Provisions/v4/bp_arrears_reg_aud_v2.sql", "unique_id": "model.credit_risk_playground.bp_arrears_reg_aud_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_arrears_reg_aud_v2"], "alias": "bp_arrears_reg_aud_v2", "checksum": {"name": "sha256", "checksum": "ff05b58ff45cd8cd74c6fd125d387d2a55a8b5c6b22b25cb776653210a1be57d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1750775608.828723, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_arrears_reg_aud_v2\"", "raw_code": "{{\n  config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- first drop it!\n\nwith \ndelcy_days as (\nselect * \nfrom {{ ref('bp_overdue_amt_aud_m_v2') }} \nwhere case when coalesce(exposures::numeric,0) = 0 and coalesce(overdue_amount::numeric,0) = 0 then 0\n           when coalesce(overdue_amount::numeric,0) > 0 \n                and coalesce(overdue_amount::numeric,0) >= 100 \n                and coalesce(overdue_amount::numeric,0) > coalesce(exposures::numeric,0)/100  then 1\n             else -1  end = 1 \norder by end_time\n)\n\n, data as (\n    select * \n           , datediff(day\n                      , end_time\n                      , lead(end_time,1) over (PARTITION BY user_id ORDER BY end_time asc)) as day_diff\n    from delcy_days\n    order by end_time\n)\n\n, first_date as (select * \n       , case when lag(day_diff)  over (PARTITION BY user_id ORDER BY end_time asc) <> 1 then end_time \n              when lag(day_diff)  over (PARTITION BY user_id ORDER BY end_time asc) is null then end_time \n              else null end as date_first\n       , case when day_diff  <> 1 then end_time \n              when day_diff is null then end_time \n              else null end as date_end\nfrom data\norder by end_time)\n\n, dpd as (\nselect * \n, max(date_first) ignore NULLS over(PARTITION BY user_id ORDER BY end_time asc\n                                                                            rows between unbounded preceding and current row) as start_in_arrears\n, min(date_end) ignore NULLS over(PARTITION BY user_id ORDER BY end_time asc\n                                                                            rows between current row  and unbounded following) as end_in_arrears\nfrom first_date\n)\n\n\nselect distinct user_id\n       , start_in_arrears\n       , end_in_arrears\nfrom dpd\norder by user_id, start_in_arrears", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdue_amt_aud_m_v2", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": ["model.credit_risk_playground.bp_overdue_amt_aud_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_portfolio_customers_aud_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_portfolio_customers_aud_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_portfolio_customers_aud_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_portfolio_customers_aud_m_v2"], "alias": "bp_portfolio_customers_aud_m_v2", "checksum": {"name": "sha256", "checksum": "cd42acdc14697c32ccec2eb1942929c95794c64c884a273645e89463fb4cc58b"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750928631.253951, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_portfolio_customers_aud_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_portfolio_customers_aud_m_v2 (first time)\n-- dbt run --models bp_portfolio_customers_aud_m_v2 (other runs)\n\n    with \n    users as (\n    select distinct\n    user_id \n    , encoded_key\n    , reporting_date\n    from {{ ref('bp_portfolio_balance_aud_m_v2') }}\n    where reporting_date::date = last_day(\n                                          date_add('month'\n                                                  , -1\n                                                  , last_day(getdate())\n                                                  )\n                                                  ) \n\n    union all \n\n    select \n    f.user_id\n    , f.encoded_key\n    , last_day(\n              date_add('month'\n                      , -1\n                      , last_day(getdate())\n                      )\n                      ) as reporting_date\n    from {{ ref('bp_overdraft_limit_periods_v2') }}  f\n    where  (f.amount_cents > 0) \n            and last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                            )  between f.rev_timestamp::timestamp and f.end_timestamp::timestamp\n    )\n\n    select distinct \n    user_id\n    , encoded_key\n    , reporting_date\n    , getdate() as etl_updated\n    , coalesce(encoded_key, '') || coalesce(etl_updated::varchar, '') as unique_key\n    from users \n    {% if is_incremental() %}\n    where etl_updated > (select max(etl_updated) from {{this}})\n    {% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_portfolio_balance_aud_m_v2", "package": null, "version": null}, {"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_overdraft_limit_periods_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_overdraft_split_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_overdraft_split_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_overdraft_split_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_overdraft_split_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_overdraft_split_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_overdraft_split_m_v2"], "alias": "bp_overdraft_split_m_v2", "checksum": {"name": "sha256", "checksum": "5b537047ea4040f593af6a185feb5004b69353cf241fb211c013a8534190d49d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750928869.635489, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_overdraft_split_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_overdraft_split_m_v2 (first time)\n-- dbt run --select bp_overdraft_split_m_v2 (other runs)\n\nwith \n\nmax_date_limit as  (\nselect  s.user_id \n, max(end_timestamp) as max_date_neg_balance\nfrom {{ ref('bp_overdraft_limit_periods_v2') }} s \nwhere s.amount_cents > 0 and s.rev_timestamp::date <= last_day(\n                                                        date_add('month'\n                                                               , -1\n                                                               , last_day(getdate())\n                                                               )\n                                                        )\ngroup by s.user_id \n)\n\n, overdraft_history as (\nselect distinct\no.user_id\n, o.end_time\n, o.max_amount_cents\n, o.od_enabled_flag\n, datediff('day'\n           , o.end_time\n           , lead(o.end_time,1) over(partition by o.user_id order by o.end_time)) as dd \n, coalesce(o.outstanding_balance_eur::numeric,0) - coalesce(o.max_amount_cents::numeric/100,0) as overdue_amount\n, coalesce(o.outstanding_balance_eur::numeric,0) as exposures\nfrom {{ source('dbt', 'bp_overdraft_users') }} o\nwhere   timeframe = 'day'\nand end_time <= last_day(\n                     date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                     )\norder by end_time \n)\n\n-- 4.2 Flag if there was a top-up after the last limit became 0 (also captures users with utilisation 0)\n\n, top_up as ( \nselect distinct\ns.user_id\nfrom overdraft_history  s\ninner join max_date_limit b on b.user_id = s.user_id and s.end_time between max_date_neg_balance and last_day(\n                                                                                                         date_add('month'\n                                                                                                                , -1\n                                                                                                                , last_day(getdate())\n                                                                                                                )\n                                                                                                         )::date\nwhere (coalesce(s.exposures,0) = 0 or s.dd > 1) \n)\n\n-- 4.3 Last limit for overdraft users (plutonium)\n\n, last_limit as (\nselect s.user_id\n, s.amount_cents as last_limit \nfrom {{ ref('bp_overdraft_limit_periods_v2') }}  s\ninner join max_date_limit b on b.user_id = s.user_id and s.end_timestamp = max_date_neg_balance\nwhere s.amount_cents > 0 and s.rev_timestamp::date <= last_day(\n                                                        date_add('month'\n                                                               , -1\n                                                               , last_day(getdate())\n                                                               )\n                                                        )\n)\n\n-- Balances \n\n, mambu_savings_accounts as (\nselect * \nfrom {{ ref('bp_portfolio_balance_aud_m_v2') }} b\nwhere b.reporting_date = last_day(\n                            date_add('month'\n                                   , -1\n                                   , last_day(getdate())\n                                   )\n                            )\n       and b.product = 'Overdraft'\n)\n\n-- 4.4 Overdraft portfolio with Arranged/Unarranged split\n\n\nselect \nm.user_id \n, m.encoded_key\n, m.balance \n, n.max_date_neg_balance\n, last_day(\n       date_add('month'\n              , -1\n              , last_day(getdate())\n              )\n       ) as reporting_date\n, case when (n.user_id is not null and t.user_id is null) or n.max_date_neg_balance::date = last_day(\n                                                                                                  date_add('month'\n                                                                                                                , -1\n                                                                                                                , last_day(getdate())\n                                                                                                                )\n                                                                                                  )::date then 'Arranged Overdraft' else 'Unarranged Overdraft' end as OD_type\n, case when (n.user_id is not null and t.user_id is null) or n.max_date_neg_balance::date = last_day(\n                                                                                                  date_add('month'\n                                                                                                                , -1\n                                                                                                                , last_day(getdate())\n                                                                                                                )\n                                                                                                  )::date\n                                                                            then la.last_limit/100\n       else 0 end overdraft_lim\n, getdate() as etl_updated\n, coalesce(m.user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom mambu_savings_accounts m \nleft join top_up t on t.user_id = m.user_id \nleft join max_date_limit n on n.user_id = m.user_id\nleft join last_limit la on la.user_id = m.user_id\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_portfolio_balance_aud_m_v2", "package": null, "version": null}], "sources": [["dbt", "bp_overdraft_users"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.dbt.bp_overdraft_users", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_monitoring_pd_supermodel_v2_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_monitoring_pd_supermodel_v2_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_monitoring_pd_supermodel_v2_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_monitoring_pd_supermodel_v2_m_v2"], "alias": "bp_monitoring_pd_supermodel_v2_m_v2", "checksum": {"name": "sha256", "checksum": "690c87e9a3fbf9311e887f6e254e2c1c185d8af8e7e0ee542ac93d1615afd26f"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "reporting_date"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "reporting_date", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750930032.955573, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_monitoring_pd_supermodel_v2_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='reporting_date',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_monitoring_pd_supermodel_v2_m_v2 (first time)\n-- dbt run --select bp_monitoring_pd_supermodel_v2_m_v2 (other runs)\n\nwith \n\nportfolio as (\nselect distinct \nuser_id \nfrom credit_risk_playground.bp_portfolio_customers_aud_m_v2\nwhere reporting_date::date = last_day(date_add('month', -1 , last_day(getdate()))) \n\n)\n\n, pd as (\n        select\n        ps.user_id\n        , z.country_tnc as tnc_country\n        , ps.created as calculated_at\n        , row_number() over (\n            partition by ps.user_id, ps.model_version\n            order by \n            ps.created,\n                case \n                    when ps.score_type = 'behavioral' then 1\n                    when ps.score_type = 'behavioral_unarranged' then 2\n                    when ps.score_type = 'application_TBIL' then 3\n                    when ps.score_type = 'application_CC' then 4\n                    when ps.score_type = 'application_OD' then 5\n                    else 6\n                end\n        ) as row_num\n        , pd::float as pd \n        , rating_class\n        , ps.meta.pit_calibration_beta as beta\n        , ps.meta.insample_calibrated_pd::float as internal_pd\n    from dbt_pii.credit_score_audit_log ps\n    inner join portfolio p on p.user_id = ps.user_id\n    inner join dbt.zrh_users z on z.user_id = ps.user_id\n    where ps.model_name = 'PORTO'\n          and ps.model_version = 'unified-1.0'\n      --    and ps.score_type in ('behavioral_unarranged', 'behavioral')\n          and ps.created::date = last_day(date_add('month', -1 , last_day(getdate()))) \n)\n\n, porto as (\n    select\n        user_id,\n        pd as pd_2,\n        calculated_at,\n        rating_class,\n        beta, \n        internal_pd\n    from pd\n    where row_num = 1\n)\n\n, porto_fixed as (\nselect \np.user_id \n, p.calculated_at\n, p.rating_class\n, p.pd_2\n, p.internal_pd\n, case when beta = 0.279614 then 'DEU_MIX_WITH_UTILIZATION'\n       when beta = -0.457881 then 'DEU_OD_WITH_UTILIZATION'\n       when beta = -0.227762 then 'AUT_OD_WITH_UTILIZATION'\n       when beta = -1.272583 then 'DEU_TBIL'\n       when beta = -0.465253 then 'ESP_TBIL'\n       when beta = -0.530291 then 'ITA_TBIL'\n       when beta = 0.402868  then 'FRA_TBIL'\n       when beta = -0.286839 then 'DEU_CC'\n       when beta = -1.713889 then 'DEU_OD_WITHOUT_UTILIZATION'\n       when beta = -1.218263 then 'AUT_OD_WITHOUT_UTILIZATION'\n       when beta = -1.481441 then 'DEU_MIX_WITHOUT_UTILIZATION'\n       when beta is null then 'UNARRANGED_OD'\n       end as calibration_sgm\n\nfrom porto p \n\n)\n\n\n    select\n    user_id\n    , calculated_at\n    , rating_class\n    , pd_2\n    , calibration_sgm\n    , internal_pd\n    , last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                            ) as reporting_date\n    , getdate() as etl_updated\n    , coalesce(user_id, '') || coalesce(getdate()::varchar, '') as unique_key\n    from porto_fixed l\n    {% if is_incremental() %}\n    where reporting_date > (select max(reporting_date) from {{this}})\n    {% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_default_dunning_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_default_dunning_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_default_dunning_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_default_dunning_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_default_dunning_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_default_dunning_m_v2"], "alias": "bp_default_dunning_m_v2", "checksum": {"name": "sha256", "checksum": "0b3532e845f62b448e9a3df943ccb39c2cc8db05c08c590c2170e6dc35f5e538"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750930890.4331331, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_default_dunning_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_default_dunning_m_v2 (first time)\n-- dbt run --select bp_default_dunning_m_v2 (other runs)\n\nwith\n\nlanthanum_action_log as (\nselect \nl.user_id\n, l.created_at as created\n, l.dunning_process_id\n, la.name as action\nfrom lanthanum_action_logs l \ninner join lanthanum_actions la on l.actions_id = la.id\n\nunion all \n\nselect distinct\nc.user_id \n, dp.created::date as created\n, dp.dunning_process_id\n, replace(ast.name,' ', '_') as action\nfrom aspirin_action_log as dp\ninner join carbonium_user_account c on c.account_id = dp.account_id\ninner join aspirin_dunning_process_task_definition t on t.id = dp.task_id\ninner join aspirin_dunning_process_step_definition ast on t.dunning_process_step = ast.id\n)\n\n\n\n, dunning_cancellations as (\nSELECT  user_id\n       , MAX(CASE WHEN action in ('SECOND_OFFICIAL_NOTIFICATION', 'SECOND_OFFICIAL_REMINDER') THEN created \n                  ELSE NULL END) AS default_date \nFROM lanthanum_action_log  \nWHERE dunning_process_id IN (SELECT dunning_process_id\n                             FROM lanthanum_action_log\n                             WHERE action in ('SECOND_OFFICIAL_NOTIFICATION', 'SECOND_OFFICIAL_REMINDER')\n                                   AND created::date <= last_day(\n                                                                date_add('month'\n                                                                        , -1\n                                                                        , last_day(getdate())\n                                                                        )\n                                                                )\n                                                                        EXCEPT (SELECT dunning_process_id \n                                                                                FROM lanthanum_action_log\n                                                                                WHERE action = 'USER_EXITS_FROM_ARREARS' \n                                                                                AND created::date <= last_day(\n                                                                                                            date_add('month'\n                                                                                                                    , -1\n                                                                                                                    , last_day(getdate())\n                                                                                                                    )\n                                                                                                            ) \n                                                                                                            EXCEPT SELECT dunning_process_id \n                                                                                                                            FROM lanthanum_action_log  \n                                                                                                                            WHERE action in ('SEND_CLOSURE_EMAIL','ACCOUNT_CLOSED_EMAIL') ) )\nGROUP BY  user_id \n)\n\nselect * \n       , last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                    ) as reporting_date\n        , getdate() as etl_updated\n        , coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom dunning_cancellations\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_default_internal_insolvency_v2_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_default_internal_insolvency_v2_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_default_internal_insolvency_v2_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_default_internal_insolvency_v2_m_v2"], "alias": "bp_default_internal_insolvency_v2_m_v2", "checksum": {"name": "sha256", "checksum": "18f3d8121acf479114e379425627e508440e644dd6e1a5b9978f721c58726b38"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750931415.8252668, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_default_internal_insolvency_v2_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_default_internal_insolvency_v2_m_v2 (first time)\n-- dbt run --select bp_default_internal_insolvency_v2_m_v2 (other runs)\n\nwith \n\ninsolvency_curr as (\nselect  \n    np.customer_id as user_id\n    , max(ni.origin_date::date) as internal_insolvency_date\nfrom {{ source('public', 'neodymium_insolvency') }}  ni\nleft join {{ source('public', 'nd_participant') }} np  on ni.id = np.garnishment_id\nwhere np.type = 'RESPONDENT' \n   and (\n            (\n            ni.status = 'CLOSE'\n                and last_day(date_add('month', -1, last_day(getdate()))) between ni.created::timestamp and ni.updated::timestamp\n            ) -- garnishment was active at the application, but now closed\n            or \n            (\n            ni.status = 'OPEN' and ni.created::timestamp <= last_day(date_add('month', -1, last_day(getdate())))\n            )\n        ) \ngroup by np.customer_id \n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n        ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom insolvency_curr\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [["public", "neodymium_insolvency"], ["public", "nd_participant"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.public.neodymium_insolvency", "source.credit_risk_playground.public.nd_participant"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_repayment_plan_ph1_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_repayment_plan_ph1_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_repayment_plan_ph1_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_repayment_plan_ph1_m_v2"], "alias": "bp_repayment_plan_ph1_m_v2", "checksum": {"name": "sha256", "checksum": "daed0cc162e91a9f6376a39fdd369c83cb31ff97aa4628199a4a096f4b743ae2"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750932240.974014, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_repayment_plan_ph1_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_repayment_plan_ph1_m_v2 (first time)\n-- dbt run --select bp_repayment_plan_ph1_m_v2 (other runs)\n\nwith \nrep_plan as (\nselect distinct user_id \nfrom plutonium_repayment_plan\nwhere (\n        ( \n        status = 'ACTIVE' and created::date  <= last_day(\n                                                    date_add('month'\n                                                            , -1\n                                                            , last_day(getdate()\n                                                                        )\n                                                            ) \n                                                        )\n            )\nor \n( status = 'CANCELLED' and last_day(\n                                    date_add('month'\n                                            , -1\n                                            , last_day(getdate()\n                                                        )\n                                                )\n                                    )\n                                            between created::date  and  updated::date \n    )\n)\n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n                ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom rep_plan\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_loan_contract_information_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_loan_contract_information_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_loan_contract_information_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_loan_contract_information_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_loan_contract_information_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_loan_contract_information_m_v2"], "alias": "bp_loan_contract_information_m_v2", "checksum": {"name": "sha256", "checksum": "cbe0207fa5633d516f3a29358ae6b98d23a899f559330cc0267364358a89c263"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "encoded_key", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "encoded_key", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750932383.6755478, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_loan_contract_information_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='encoded_key',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_loan_contract_information_m_v2 (first time)\n-- dbt run --select bp_loan_contract_information_m_v2 (other runs)\n\n\nwith  \nmmbr_loan_aud as (\nselect * \n, coalesce(lead(rev_timestamp - interval '0.000001 second', 1) over (partition by encoded_key order by rev_timestamp), '2100-01-01') as end_timestamp\nfrom mmbr_n26_loan_account_aud \n)\n \n, loans_additional_data as (\nselect \nml.encoded_key\n, ml.creation_date\n, m.interest_rate as interest_rate_loan\n, m.accrued_interest as accrued_interest_loan\n, m.loan_amount\n, m.loan_name\n, m.repayment_installments\n, m.repayment_period_count\n, m.principal_repayment_interval\nfrom mmbr_loan_account ml \nleft join mmbr_loan_aud m on m.encoded_key = ml.encoded_key\n-- reporting date to the last minute\nwhere date_add('minute'\n        , -1\n        , date_add('day'\n            , 1\n            , last_day(\n                    date_add('month'\n                        , -1\n                        , last_day(getdate())\n                        )\n                    )\n            \n                ) \n           ) between rev_timestamp and end_timestamp\n            )\n\n\nselect * \n, last_day(\n            date_add('month'\n                    , -1\n                    , last_day(getdate())\n                    )\n            ) as reporting_date \n, getdate() as etl_updated\n, coalesce(encoded_key, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom loans_additional_data\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_hrc_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_hrc_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_hrc_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_hrc_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_hrc_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_hrc_m_v2"], "alias": "bp_hrc_m_v2", "checksum": {"name": "sha256", "checksum": "d5ff4dd93383d9815b5a61c4a30dc0eea1ea4faab752aa89b2e300e662b67ff0"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750932621.097583, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_hrc_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_hrc_m_v2 (first time)\n-- dbt run --select bp_hrc_m_v2 (other runs)\n\nwith \nhrc_users as (\nselect * \nfrom dbt_pii.dash_hrc_history\nwhere last_day(\n            date_add('month'\n                    , -1\n                    , last_day(getdate())\n                    )\n            ) between nickel_event_start::timestamp and nickel_event_end::timestamp\nand type = 'addHrc'\n)\n\nselect * \n, last_day(\n            date_add('month'\n                    , -1\n                    , last_day(getdate())\n                    )\n            ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom hrc_users\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_social_benefits_v2_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_social_benefits_v2_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_social_benefits_v2_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_social_benefits_v2_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_social_benefits_v2_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_social_benefits_v2_m_v2"], "alias": "bp_social_benefits_v2_m_v2", "checksum": {"name": "sha256", "checksum": "e87acbd41c9d228f507656f265b3149e9e232c81ede4887b40b71cc32a4bfc5a"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750932695.154645, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_social_benefits_v2_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_social_benefits_v2_m_v2 (first time)\n-- dbt run --select bp_social_benefits_v2_m_v2 (other runs)\n\nwith\n\nsocial_benefits as (\nSELECT  \nua.user_id\n, max(t.created) as latest_sb_date\nFROM etl_reporting.zr_transaction t \nLEFT JOIN cr_account a ON t.account_id = a.id \nINNER JOIN cr_user_account ua USING(account_id) \nWHERE bank_balance_impact > 0 \n      AND t.partner_name LIKE '%Bundesagentur%Arbeit%' \n      AND t.partner_name NOT LIKE '%Familienkasse%' \n      AND ' / ' || SUBSTRING(reference_text, 1, 5) = SUBSTRING(reference_text, 15,8) /* ALG2 */ \n      AND a.account_role = 'PRIMARY' AND TRIM(a.status) <> 'CLOSED' \n      AND t.created::date between date_add('day', - 30, last_day(date_add('month'\n                                                                        , -1\n                                                                        , last_day(getdate())\n                                                                    )\n                                                                )\n                                        )::date and last_day(\n                                                            date_add('month'\n                                                                    , -1\n                                                                    , last_day(getdate())\n                                                                    )\n                                                            ) \ngroup by 1\n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n        ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom social_benefits\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_application_pd_supermodel_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_application_pd_supermodel_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_application_pd_supermodel_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_application_pd_supermodel_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_application_pd_supermodel_m_v2"], "alias": "bp_application_pd_supermodel_m_v2", "checksum": {"name": "sha256", "checksum": "844ee2e0ddd834c430264ee6c20731aa4402a679aa2b5b9af096bb840f18e648"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750932868.830827, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_application_pd_supermodel_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_application_pd_supermodel_m_v2 (first time)\n-- dbt run --select bp_application_pd_supermodel_m_v2 (other runs)\n\nwith \n\nfirst_enabled_date as (\nselect \nuser_id \n, encoded_key\n, min(rev_timestamp) as first_creation_date\n, max(rev_timestamp) as last_creation_date\nfrom {{ ref('bp_overdraft_limit_periods_v2') }}\nwhere rev_timestamp::date <= last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n                            ) and amount_cents > 0 \ngroup by \nuser_id \n, encoded_key\n\n)\n\n, portfolio as (\nselect * \nfrom {{ref('bp_portfolio_customers_aud_m_v2')}}\nwhere reporting_date::date = last_day(\n                                        date_add('month'\n                                                , -1\n                                                , last_day(getdate())\n                                                )\n                                        )\n)\n\n, pd_app_cc as (\n\n    select\n        c.user_id,\n        c.encoded_key,\n        ps.created::date as calculated_at, \n        row_number() over (partition by c.encoded_key, c.user_id order by ps.created desc) as row_num,\n        pd,\n        rating_class,\n        ps.score_type\n    \n    from portfolio c \n    inner join dbt_pii.credit_score_audit_log ps on c.user_id = ps.user_id \n    inner join mmbr_loan_account li on  li.encoded_key = c.encoded_key \n    inner join dbt.mmbr_loan_product_mapping mp on li.loan_name = mp.loan_name and mp.product in ('consumer_credit')\n    where ps.model_name = 'PORTO'\n          and ps.model_version = 'unified-1.0'\n          and ps.score_type in ('application_CC') -- IMPORTANT! Application scores time is THE SAME , make \n          and ps.created::date <= li.creation_date::date\n          and ps.created::date >= '2025-02-25'::date\n          and li.creation_date is not null\n     )\n     \n , pd_app_tbil as (\n      select\n        c.user_id,\n        c.encoded_key,\n        ps.created::date as calculated_at, \n        row_number() over (partition by c.encoded_key, c.user_id order by ps.created desc) as row_num,\n        pd,\n        rating_class,\n        ps.score_type\n    \n    from portfolio c \n    inner join dbt_pii.credit_score_audit_log ps on c.user_id = ps.user_id \n    inner join mmbr_loan_account li on  li.encoded_key = c.encoded_key \n    inner join dbt.mmbr_loan_product_mapping mp on li.loan_name = mp.loan_name and mp.product in ('installment_loans')\n    where ps.model_name = 'PORTO'\n          and ps.model_version = 'unified-1.0'\n          and ps.score_type in ('application_TBIL') -- IMPORTANT! Application scores time is THE SAME , make \n          and ps.created::date <= li.creation_date::date\n          and ps.created::date >= '2025-02-25'::date\n          and li.creation_date is not null\n )\n \n , pd_app_od as (\n      select\n        c.user_id,\n        c.encoded_key,\n        ps.created::date as calculated_at, \n        row_number() over (partition by c.encoded_key, c.user_id order by ps.created desc) as row_num,\n        pd,\n        rating_class,\n        ps.score_type\n    \n    from portfolio c \n    inner join dbt_pii.credit_score_audit_log ps on c.user_id = ps.user_id \n    inner join first_enabled_date f on f.encoded_key = c.encoded_key \n    where ps.model_name = 'PORTO'\n          and ps.model_version = 'unified-1.0'\n          and ps.score_type in ('application_OD') \n          and ps.created::date <= f.first_creation_date::date\n          and ps.created::date >= '2025-02-25'::date\n          and f.first_creation_date is not null\n )\n\n\n, porto_app as (\n    select\n        user_id\n        , encoded_key\n        , pd  as pd_2\n        , calculated_at\n        , rating_class \n    from pd_app_cc \n    where row_num = 1\n\n    union all \n\n    select\n        user_id\n        , encoded_key\n        , pd  as pd_2\n        , calculated_at\n        , rating_class \n    from pd_app_tbil\n    where row_num = 1\n\n    union all \n\n    select\n        user_id\n        , encoded_key\n        , pd  as pd_2\n        , calculated_at\n        , rating_class \n    from pd_app_od\n    where row_num = 1\n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n        ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom porto_app\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_portfolio_customers_aud_m_v2", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_application_pd_supermodel_m_ad_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_application_pd_supermodel_m_ad_v2.sql", "original_file_path": "models/Provisions/v4/bp_application_pd_supermodel_m_ad_v2.sql", "unique_id": "model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_application_pd_supermodel_m_ad_v2"], "alias": "bp_application_pd_supermodel_m_ad_v2", "checksum": {"name": "sha256", "checksum": "23ca7d1696879cfc98fc207acf5b5787c167085e435b8f0645f357b403aa5390"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750933397.5657952, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_application_pd_supermodel_m_ad_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_application_pd_supermodel_m_ad_v2 (first time)\n-- dbt run --select bp_application_pd_supermodel_m_ad_v2 (other runs)\n\nwith \n\nfirst_enabled_date as (\nselect \nuser_id \n, encoded_key\n, min(rev_timestamp) as first_creation_date\n, max(rev_timestamp) as last_creation_date\nfrom {{ ref('bp_overdraft_limit_periods_v2') }}\nwhere rev_timestamp::date <= last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n                            ) and amount_cents > 0 \ngroup by \nuser_id \n, encoded_key\n\n)\n\n\n, pd_app as (\n    select\n        c.user_id,\n        c.encoded_key,\n        ps.created::date as calculated_at, \n        row_number() over (partition by c.encoded_key, c.user_id order by ps.created desc) as row_num,\n        pd,\n        rating_class\n    \n    from {{ ref('bp_portfolio_customers_aud_m_v2') }} c \n    inner join dbt_pii.credit_score_audit_log ps on c.user_id = ps.user_id \n    left join first_enabled_date f on f.encoded_key = c.encoded_key \n    left join mmbr_loan_account li on  li.encoded_key = c.encoded_key \n    where ps.model_name = 'PORTO'\n          and ps.model_version = 'unified-1.0'\n          and ps.score_type in ('behavioral')\n           and c.reporting_date::date = last_day(\n                                        date_add('month'\n                                                , -1\n                                                , last_day(getdate())\n                                                )\n                                        )\n           and ps.created::date <= coalesce(f.first_creation_date::date, li.creation_date::date)\n          and coalesce(f.first_creation_date::date, li.creation_date::date) is not null\n)\n\n\n, porto_app as (\n    select\n        user_id\n        , encoded_key\n        , pd  as pd_2\n        , calculated_at\n        , rating_class \n    from pd_app\n    where row_num = 1\n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n        ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom porto_app\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_portfolio_customers_aud_m_v2", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_credit_bureau_rating_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_credit_bureau_rating_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_credit_bureau_rating_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_credit_bureau_rating_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_credit_bureau_rating_m_v2"], "alias": "bp_credit_bureau_rating_m_v2", "checksum": {"name": "sha256", "checksum": "39c60b234a70e6625608f12e457180960e937f78f3b525cf8d1bc7670f20d489"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1750950177.104674, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_credit_bureau_rating_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_credit_bureau_rating_m_v2 (first time)\n-- dbt run --select bp_credit_bureau_rating_m_v2 (other runs)\n\nwith \ncalifornium_credit_score as (\nselect \nuser_id \n, rating \n, provider\n, requested_on as rev_timestamp\n, coalesce(lead(requested_on - interval '0.000001 second', 1) over (partition by user_id order by requested_on), '2100-01-01') as end_timestamp\nfrom private.californium_credit_score_audit_log\norder by user_id, requested_on\n)\n\n, total as (\nselect distinct  a.user_id\n                    , a.rating\n                    , a.provider\n                    , a.rev_timestamp\n                    , last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n                                    ) as reporting_date\n                    , getdate() as etl_updated\n                    , coalesce(a.user_id, '') || coalesce(etl_updated::varchar, '') as unique_key \n           from californium_credit_score a \n           inner join {{ source('dbt', 'zrh_users') }} z using(user_id)\n           inner join ( select \n                       a.user_id\n                        , b.rev_timestamp\n                        , max(a.end_timestamp) as end_timestamp\n               from californium_credit_score a\n               inner join {{ source('dbt', 'zrh_users') }} z using(user_id)\n               inner join (select z.user_id\n                                  , max(rev_timestamp::date) as rev_timestamp\n                           from californium_credit_score ccra\n                           inner join {{ source('dbt', 'zrh_users') }} z using(user_id)\n                           where (\n                                  (\n                                   (z.country_tnc = 'DEU' or z.country_tnc is null) \n                                   and ccra.provider like 'SCHUFA%' \n                                  ) \n                                  or \n\n                                  (\n                                    z.country_tnc = 'AUT' \n                                    and ccra.provider like 'CRIF%'\n                                    )\n                                  )\n                                 and rev_timestamp::date <= last_day(\n                                                                date_add('month'\n                                                                        , -1\n                                                                        , last_day(getdate())\n                                                                        )\n                                                                        )\n                          group by z.user_id) b on a.user_id = b.user_id \n                                                 and a.rev_timestamp::date  = b.rev_timestamp::date \n                where  (\n                                  (\n                                   (z.country_tnc = 'DEU' or z.country_tnc is null) \n                                   and a.provider like 'SCHUFA%' \n                                  ) \n                                  or \n\n                                  (\n                                    z.country_tnc = 'AUT' \n                                    and a.provider like 'CRIF%'\n                                    )\n                                  )\n                group by \n                a.user_id\n                , b.rev_timestamp) c on c.user_id = a.user_id \n                                         and c.rev_timestamp::date = a.rev_timestamp::date\n                                         and c.end_timestamp::date = a.end_timestamp::date\n            where (\n                    (\n                      (z.country_tnc = 'DEU' or z.country_tnc is null) \n                      and a.provider like 'SCHUFA%' \n                     ) \n                     or \n\n                    (\n                      z.country_tnc = 'AUT' \n                      and a.provider like 'CRIF%'\n                     )\n                    )\n    )\n                    \n\n  select * \n  from total \n    {% if is_incremental() %}\n  where  etl_updated > (select max(etl_updated) from {{this}})\n    {% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [["dbt", "zrh_users"], ["dbt", "zrh_users"], ["dbt", "zrh_users"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.dbt.zrh_users"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_default_credit_bureau_insolvency_v3_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_default_credit_bureau_insolvency_v3_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_default_credit_bureau_insolvency_v3_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_default_credit_bureau_insolvency_v3_m_v2"], "alias": "bp_default_credit_bureau_insolvency_v3_m_v2", "checksum": {"name": "sha256", "checksum": "6b8edc758c432062c96013d14889da940290fad19b3793ff137ce77d37e79a4d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1751438425.9302132, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_default_credit_bureau_insolvency_v3_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n \nwith \n \nca_merkmal AS (\nSELECT merkmal_exploded.user_id,\n       merkmal_exploded.provider,\n       merkmal_exploded.rev_timestamp,\n       merkmal_exploded.etl_updated,\n       JSON_EXTRACT_PATH_TEXT(merkmal_exploded.merkmal, 'merkmalcode')  AS merkmalcode,\n       JSON_EXTRACT_PATH_TEXT(merkmal_exploded.merkmal, 'beschreibung') AS merkmaldescription,\n       merkmal_exploded.merkmal,\n       merkmal_exploded.reaction_type\nFROM credit_risk_playground.bp_default_credit_bureau_insolvency_me_v2 AS merkmal_exploded\n)\n\n, californium_credit_score_stg as (\nselect * \n, requested_on as rev_timestamp\n, coalesce(lead(requested_on - interval '0.000001 second', 1) over (partition by user_id order by requested_on), '2100-01-01') as end_timestamp\nfrom private.californium_credit_score_audit_log\norder by user_id, requested_on\n)\n\n, californium_credit_score as (\nselect ccra.* \nfrom californium_credit_score_stg ccra\nINNER JOIN {{ source('public', 'dwh_cohort_dates') }} m ON m.end_time between ccra.rev_timestamp and  ccra.end_timestamp\nwhere m.end_time::date = last_day(\n                                date_add('month'\n                                        , -1\n                                        , last_day(getdate())\n                                        )\n                                        ) \n)\n\n, schufa_curr as (\nselect distinct\n              ccra.user_id \n              , last_day(\n                        date_add('month'\n                                , -1\n                                , last_day(getdate())\n                                )\n                                )  as rev_timestamp\n       from californium_credit_score ccra\n       inner join dbt.zrh_users z using(user_id)\n       inner join ca_merkmal csr\n                       on ccra.user_id = csr.user_id\n                       and csr.rev_timestamp::date = ccra.rev_timestamp::date\n       where (\n        (ccra.rating in ( 'N', 'O', 'P' )\n             and (z.country_tnc = 'DEU' or z.country_tnc is null) \n             and ccra.provider like 'SCHUFA%' \n             and csr.merkmalcode in ( 'EV', 'HB', 'IA', 'IE', 'IS', 'RA', 'RV', 'S1', 'S2', 'S3' )\n             and (csr.merkmal not like '%nachmeldegrund%' or\n            (csr.merkmal not like '%l\u00f6sch%' and csr.merkmal not like '%erledigungsvermerk%')))\n       or \n        (z.country_tnc = 'AUT' \n            and ccra.provider like 'CRIF%'\n            and ccra.rating in ('P'))\n       ) \n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n                ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom schufa_curr\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [["public", "dwh_cohort_dates"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.public.dwh_cohort_dates"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_default_credit_bureau_insolvency_rmd_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_default_credit_bureau_insolvency_rmd_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_default_credit_bureau_insolvency_rmd_v2.sql", "original_file_path": "models/Provisions/v4/bp_default_credit_bureau_insolvency_rmd_v2.sql", "unique_id": "model.credit_risk_playground.bp_default_credit_bureau_insolvency_rmd_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_default_credit_bureau_insolvency_rmd_v2"], "alias": "bp_default_credit_bureau_insolvency_rmd_v2", "checksum": {"name": "sha256", "checksum": "0d1029740ef90bab877b4b3f1b4915d517480310dbab922e3279f257ac74674d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1751438425.944142, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_default_credit_bureau_insolvency_rmd_v2\"", "raw_code": "{{\n    config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n\nwith \n\nraw_merkmal_description as (SELECT  ca.user_id,\n            ca.provider,\n            ca.audit_rev_timestamp AS rev_timestamp,\n            ca.etl_updated,\n            COALESCE(\n                    NULLIF(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_PATH_TEXT(\n                                                          JSON_EXTRACT_ARRAY_ELEMENT_TEXT(\n                                                                  JSON_EXTRACT_PATH_TEXT(ca.response_raw_value, 'data', 'reaktion', TRUE),\n                                                                  0), 'bonitaetsauskunft',\n                                                          'merkmale', TRUE),\n                                                  'merkmalOrTextmerkmal'), ''),\n                    NULLIF(JSON_EXTRACT_PATH_TEXT(JSON_EXTRACT_PATH_TEXT(\n                                                          JSON_EXTRACT_ARRAY_ELEMENT_TEXT(\n                                                                  JSON_EXTRACT_PATH_TEXT(ca.response_raw_value, 'data', 'reaktion', TRUE),\n                                                                  0), 'nachmeldung',\n                                                          'merkmale', TRUE),\n                                                  'merkmalOrTextmerkmal'), '')\n                )               AS merkmal,\n            CASE\n                WHEN is_valid_json(ca.response_raw_value) THEN json_parse(ca.response_raw_value)\n                ELSE json_parse('{}')\n                END\n            AS response_value\n     FROM private.californium_credit_score_record_request_audit_log ca\n     inner join credit_risk_playground.bp_default_credit_bureau_insolvency_max_date_v2 m\n        on m.user_id = ca.user_id\n        and ca.audit_rev_timestamp::timestamp = m.rev_timestamp::timestamp\n     --WHERE merkmal IS NOT NULL\n     )\n\n     select * \n     from raw_merkmal_description", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_default_credit_bureau_insolvency_me_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_default_credit_bureau_insolvency_me_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_default_credit_bureau_insolvency_me_v2.sql", "original_file_path": "models/Provisions/v4/bp_default_credit_bureau_insolvency_me_v2.sql", "unique_id": "model.credit_risk_playground.bp_default_credit_bureau_insolvency_me_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_default_credit_bureau_insolvency_me_v2"], "alias": "bp_default_credit_bureau_insolvency_me_v2", "checksum": {"name": "sha256", "checksum": "bfde571d57516744c4ff26fff1bf7a2b4a6fdc8a839357cf52f37a95d64dd283"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1751438425.945772, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_default_credit_bureau_insolvency_me_v2\"", "raw_code": "{{\n    config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n \n with \n \n merkmal_exploded AS (\n    SELECT distinct\n     raw_merkmal_description.user_id,\n             raw_merkmal_description.provider,\n             raw_merkmal_description.rev_timestamp,\n             raw_merkmal_description.etl_updated,\n             JSON_EXTRACT_ARRAY_ELEMENT_TEXT(\n                     raw_merkmal_description.merkmal,\n                     sequence.ordinal::INT,\n                     TRUE\n                 )                                                 AS merkmal,\n             COALESCE(response_value.data.reaktion[0].bonitaetsauskunft,\n                      response_value.data.reaktion[0].nachmeldung) AS reaction_type\n      FROM credit_risk_playground.bp_default_credit_bureau_insolvency_rmd_v2 as raw_merkmal_description\n      inner join dbt.zrh_users z on z.user_id = raw_merkmal_description.user_id\n      CROSS JOIN public.generated_sequence AS sequence\n           --only generate the number of records in the cross join that corresponds\n           --to the number of merkmal in the order\n      WHERE case when z.country_tnc = 'DEU' and \n\t                  sequence.ordinal < JSON_ARRAY_LENGTH(raw_merkmal_description.merkmal, TRUE) then 1 \n\t\t\t\t when z.country_tnc = 'AUT' then 1 \n\t\t\t\t else 0 end = 1\n                 )\n\nselect * \nfrom merkmal_exploded", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_default_credit_bureau_insolvency_max_date_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_default_credit_bureau_insolvency_max_date_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_default_credit_bureau_insolvency_max_date_v2.sql", "original_file_path": "models/Provisions/v4/bp_default_credit_bureau_insolvency_max_date_v2.sql", "unique_id": "model.credit_risk_playground.bp_default_credit_bureau_insolvency_max_date_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_default_credit_bureau_insolvency_max_date_v2"], "alias": "bp_default_credit_bureau_insolvency_max_date_v2", "checksum": {"name": "sha256", "checksum": "c4f34898efcd875cc842c406c33d031a949f9c80b428e755298fad55dd4279d5"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1751438425.946615, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_default_credit_bureau_insolvency_max_date_v2\"", "raw_code": "{{\n    config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\nwith \n\n\nmax_merkmal_date as (\n\nSELECT csr.user_id, MAX(csr.audit_rev_timestamp) as rev_timestamp\nFROM private.californium_credit_score_record_request_audit_log csr\ninner join credit_risk_playground.bp_portfolio_customers_aud_m_v2 as portfolio ON portfolio.user_id = csr.user_id\nwhere --csr.audit_rev_timestamp <= LAST_DAY(date_add('month', -1, GETDATE()))\n\ncsr.audit_rev_timestamp::timestamp <= date_add('minute'\n                                                        , -1\n                                                        , date_add('day'\n                                                            , 1\n                                                            , last_day(\n                                                                    date_add('month'\n                                                                        , -1\n                                                                        , last_day(getdate())\n                                                                        )\n                                                                    )\n                                                            \n                                                                ) \n                                                           )\n\nGROUP BY csr.user_id\n\n)\n\n\nselect * \nfrom max_merkmal_date", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_p_accounts_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_p_accounts_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_p_accounts_v2.sql", "original_file_path": "models/Provisions/v4/bp_p_accounts_v2.sql", "unique_id": "model.credit_risk_playground.bp_p_accounts_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_p_accounts_v2"], "alias": "bp_p_accounts_v2", "checksum": {"name": "sha256", "checksum": "374d0bb490f44f3a4ec9bca44929d47595a1260f01efe82231c5535b3ea695ca"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1754055285.3584871, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_p_accounts_v2\"", "raw_code": "{{\n    config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\nwith \npaccount as (\n select \n user_id \n, created\n, active \n, coalesce(allowance_cents,0) as allowance_cents\n, lag(case when active = 1 then allowance_cents\n           else 0 end) OVER (PARTITION by z.user_id order by created) as previous_allowance_cents\nfrom {{ source('etl_reporting', 'pa_paccount') }} p\ninner join {{ source('dbt', 'zrh_users') }} z on p.account_id = z.account_id\n)\n, paccount_ts as ( \nselect \nuser_id \n, active\n, allowance_cents\n, created as rev_timestamp \n, coalesce( lead(created) OVER (PARTITION BY user_id ORDER BY created) + interval'-0.000001 seconds' \n                  , '2100-01-01'::timestamp) as end_timestamp \nfrom paccount\nwhere (previous_allowance_cents IS NULL OR previous_allowance_cents <> allowance_cents)\n)\n\n\n\nselect p.* \n, getdate() as etl_updated\nfrom  paccount_ts p\ninner join {{ source('dbt', 'zrh_users') }} z using(user_id)\nwhere active = 1 and allowance_cents > 0 -- and a.closed_at is null\norder by user_id, rev_timestamp", "doc_blocks": [], "language": "sql", "refs": [], "sources": [["dbt", "zrh_users"], ["etl_reporting", "pa_paccount"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.etl_reporting.pa_paccount"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_monitoring_pd_supermodel_v3_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_monitoring_pd_supermodel_v3_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_monitoring_pd_supermodel_v3_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_monitoring_pd_supermodel_v3_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_monitoring_pd_supermodel_v3_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_monitoring_pd_supermodel_v3_m_v2"], "alias": "bp_monitoring_pd_supermodel_v3_m_v2", "checksum": {"name": "sha256", "checksum": "beb057ab6f3b666204f95f5d64b6a820f8295f96a4085db42ce2db04f464185d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "reporting_date"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "reporting_date", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1754311024.215625, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_monitoring_pd_supermodel_v3_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='reporting_date',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_monitoring_pd_supermodel_v2_m_v2 (first time)\n-- dbt run --select bp_monitoring_pd_supermodel_v2_m_v2 (other runs)\n\nwith \n\nportfolio as (\nselect distinct \nuser_id \nfrom credit_risk_playground.bp_portfolio_customers_aud_m_v2\nwhere reporting_date::date = last_day(date_add('month', -1 , last_day(getdate()))) \n\n)\n\n, pd as (\n        select\n        ps.user_id\n        , z.country_tnc as tnc_country\n        , ps.created as calculated_at\n        , row_number() over (\n            partition by ps.user_id, pm.name || '-' || pm.version\n            order by \n            ps.created,\n                case \n                    when ps.score_type = 'behavioral' then 1\n                    when ps.score_type = 'behavioral_unarranged' then 2\n                    when ps.score_type = 'application_TBIL' then 3\n                    when ps.score_type = 'application_CC' then 4\n                    when ps.score_type = 'application_OD' then 5\n                    else 6\n                end\n        ) as row_num\n        , pd::float as pd \n        , rating_class\n        , ps.meta.pit_calibration_beta as beta\n        , ps.meta.insample_calibrated_pd::float as internal_pd\n    from etl_reporting.porto_score ps\n    inner join etl_reporting.porto_model pm on pm.id = ps.model_id\n    inner join portfolio p on p.user_id = ps.user_id\n    inner join dbt.zrh_users z on z.user_id = ps.user_id\n    where pm.name || '-' || pm.version = 'unified-1.0'\n      --    and ps.score_type in ('behavioral_unarranged', 'behavioral')\n    and ps.created::date = last_day(date_add('month', -1 , last_day(getdate()))) \n)\n\n, porto as (\n    select\n        user_id,\n        pd as pd_2,\n        calculated_at,\n        rating_class,\n        beta, \n        internal_pd\n    from pd\n    where row_num = 1\n)\n\n, porto_fixed as (\nselect \np.user_id \n, p.calculated_at\n, p.rating_class\n, p.pd_2\n, p.internal_pd\n, case when beta = 0.279614 then 'DEU_MIX_WITH_UTILIZATION'\n       when beta = -0.457881 then 'DEU_OD_WITH_UTILIZATION'\n       when beta = -0.227762 then 'AUT_OD_WITH_UTILIZATION'\n       when beta = -1.272583 then 'DEU_TBIL'\n       when beta = -0.465253 then 'ESP_TBIL'\n       when beta = -0.530291 then 'ITA_TBIL'\n       when beta = 0.402868  then 'FRA_TBIL'\n       when beta = -0.286839 then 'DEU_CC'\n       when beta = -1.713889 then 'DEU_OD_WITHOUT_UTILIZATION'\n       when beta = -1.218263 then 'AUT_OD_WITHOUT_UTILIZATION'\n       when beta = -1.481441 then 'DEU_MIX_WITHOUT_UTILIZATION'\n       when beta is null then 'UNARRANGED_OD'\n       end as calibration_sgm\n\nfrom porto p \n\n)\n\n\n    select\n    user_id\n    , calculated_at\n    , rating_class\n    , pd_2\n    , calibration_sgm\n    , internal_pd\n    , last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                            ) as reporting_date\n    , getdate() as etl_updated\n    , coalesce(user_id, '') || coalesce(getdate()::varchar, '') as unique_key\n    from porto_fixed l\n    {% if is_incremental() %}\n    where reporting_date > (select max(reporting_date) from {{this}})\n    {% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "analysis.credit_risk_playground.Social_benefits": {"database": "n26", "schema": "credit_risk_playground", "name": "Social_benefits", "resource_type": "analysis", "package_name": "credit_risk_playground", "path": "analysis/Social_benefits.sql", "original_file_path": "analyses/Social_benefits.sql", "unique_id": "analysis.credit_risk_playground.Social_benefits", "fqn": ["credit_risk_playground", "analysis", "Social_benefits"], "alias": "Social_benefits", "checksum": {"name": "sha256", "checksum": "0caa80e19cf8e1ca16f797fdb114eec62b81bb4c333866473d0dbdfd595a21ba"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": [], "meta": {}, "group": null, "materialized": "view", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null}, "tags": [], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {}, "created_at": 1759223444.403466, "relation_name": null, "raw_code": "WITH recent_alg2_transactions AS \n( \nSELECT \n      t.account_id \n      ,t.created \n      ,t.currency \n      ,(t.bank_balance_impact * 100)::int AS bank_balance_impact_cents \n      ,t.partner_name\n       ,t.reference_text \nFROM etl_reporting.zr_transaction t \nLEFT JOIN cr_account a ON t.account_id = a.id \nWHERE t.created >= DATE_TRUNC('month', '{reporting_date}'::timestamp AT TIME ZONE 'Europe/Berlin') \n      AND t.created < '{reporting_date}'::timestamp AT TIME ZONE 'Europe/Berlin' \n      AND bank_balance_impact > 0 \n      AND t.partner_name LIKE '%Bundesagentur%Arbeit%' \n      AND t.partner_name NOT LIKE '%Familienkasse%' \n      AND ' / ' || SUBSTRING(reference_text, 1, 5) = SUBSTRING(reference_text, 15,8) /* ALG2 */ \n      AND a.account_role = 'PRIMARY' AND TRIM(a.status) <> 'CLOSED' )\n\n, previous_bank_balances AS \n( \nSELECT \n      t.account_id \n      ,t.created \n      ,SUM(t2.bank_balance_impact) AS previous_bank_balance \nFROM recent_alg2_transactions t \nLEFT JOIN etl_reporting.zr_transaction t2 ON t.account_id = t2.account_id AND t2.created < t.created \nGROUP BY t.account_id ,t.created )\n\n, recent_salary AS \n( \nSELECT \n      t.account_id \n      ,SUM(t.bank_balance_impact * 100)::int AS sum_salary_cents \nFROM etl_reporting.zr_transaction t \nLEFT JOIN cr_account a ON t.account_id = a.id \nWHERE t.created >= DATE_TRUNC('month',  '{reporting_date}'::timestamp AT TIME ZONE 'Europe/Berlin') \n      AND t.created < '{reporting_date}'::timestamp AT TIME ZONE 'Europe/Berlin' \n      AND bank_balance_impact > 0 \n      AND (reference_text LIKE '%LOHN%' \n               OR reference_text LIKE '%Lohn%' \n               OR reference_text LIKE '%GEHALT%'\n               OR reference_text LIKE '%Gehalt%') \n      AND a.account_role = 'PRIMARY' AND TRIM(a.status) <> 'CLOSED ' GROUP BY t.account_id )\n\n\n\n, aggregation AS \n(\nSELECT account_id \n       ,SUM(bank_balance_impact_cents) / 100 AS last_months_ALG2_amount \n       ,greatest(0, -MIN(previous_bank_balance)) AS last_months_max_utilisation_before_ALG2 \nFROM previous_bank_balances \nINNER JOIN recent_alg2_transactions USING(account_id, created) \nGROUP BY account_id )\n\n, alg2_OD_users AS \n( \nSELECT ua.user_created AT TIME ZONE 'UTC' AS user_created \n       ,ua.user_id \n       ,ua.account_id \n       ,o.amount_cents / 100 AS OD_limit \n       ,t.last_months_max_utilisation_before_ALG2 + COALESCE(sum_salary_cents, 0) / 100 AS potential_limit \n       ,t.last_months_ALG2_amount \n       ,COALESCE(sum_salary_cents, 0) / 100 AS last_month_salary \nFROM aggregation t \nINNER JOIN cr_user_account ua USING(account_id) \nLEFT JOIN recent_salary USING(account_id) \nINNER JOIN pu_overdraft o ON o.user_created = (ua.user_created AT TIME ZONE 'UTC') \nWHERE ua.user_id NOT IN ('b8d7ad25-1ca4-49c0-a188-0cfd280816a7') /* internal accounts */ \n      AND o.status = 'ENABLED' )\n\nSELECT\n      user_created \n      ,user_id::text \n      ,account_id::text \n      ,OD_limit \n      ,potential_limit \n      ,last_months_ALG2_amount \n      ,last_month_salary \n      ,CEILING(greatest(0, potential_limit / 10, -current_balance / 10)) * 10 AS proposed_limit \nFROM alg2_OD_users \nLEFT JOIN ( \n              SELECT \n                   account_id \n                   ,SUM(bank_balance_impact) AS current_balance \n              FROM etl_reporting.zr_transaction \n              WHERE account_id IN (\n                                  SELECT account_id \n                                  FROM alg2_OD_users) \n              GROUP BY account_id \n              ) t USING(account_id) \nWHERE CEILING(greatest(0, potential_limit / 10, -current_balance / 10)) * 10 < OD_limit", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": [], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}}, "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_retail_provisions_stg_v5_pre_updated_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_retail_provisions_stg_v5_pre_updated_v2.sql", "original_file_path": "models/Provisions/v4/bp_retail_provisions_stg_v5_pre_updated_v2.sql", "unique_id": "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_retail_provisions_stg_v5_pre_updated_v2"], "alias": "bp_retail_provisions_stg_v5_pre_updated_v2", "checksum": {"name": "sha256", "checksum": "1b03f53518b347871208fcf6f0c8ad74857efdcbbcbd80792be708f6cd68b5b8"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "instrument_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "instrument_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1759400236.250321, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_retail_provisions_stg_v5_pre_updated_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='instrument_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_retail_provisions_stg_v5_pre_updated_v2 (first time)\n-- dbt run --select bp_retail_provisions_stg_v5_pre_updated_v2 (other runs)\n\nwith \n\nfirst_enabled_date as (\nselect user_id \n, encoded_key\n, min(rev_timestamp) as first_creation_date\n, max(rev_timestamp) as last_creation_date\nfrom {{ ref('bp_overdraft_limit_periods_v2') }}\nwhere rev_timestamp <= date_add('minute'\n                                                        , -1\n                                                        , date_add('day'\n                                                            , 1\n                                                            , last_day(\n                                                                    date_add('month'\n                                                                        , -1\n                                                                        , last_day(getdate())\n                                                                        )\n                                                                    )\n                                                            \n                                                                ) \n                                                           ) and amount_cents > 0 \ngroup by \nuser_id \n, encoded_key\n)\n\n, repayment as (\nselect parent_account_key\n, min(due_date) as first_repayment\n, max(due_date) as last_repayment\nfrom  {{ source('public', 'mmbr_repayment') }}  \ngroup by 1\n)\n\n\n, total as (\nselect distinct\n\n-- 1. Customers base\n\nc.user_id \n, c.encoded_key as Instrument_ID\n, z.country_tnc as Country\n, z.legal_entity as LegalEntity\n, 'YES' as IS_IFRS -- \"No\" for TSY bonds and \"Yes\" for other instruments\n,  last_day(date_add('month', -1, last_day(getdate()))) as ReportDate\n,  last_day(date_add('month', -1, last_day(getdate()))) as CalcDate -- for retail same as eom, for mortgage 1-month lag\n, current_date::date as Script_calculation_date\n-- 2. Product flag\n-- product\n\n, case when coalesce(p.amount_cents,0) > 0  and rp.user_id is not null then 'RP_1'\n       when mll.OD_type = 'Arranged Overdraft' and rp.user_id is not null then 'RP_1'\n       when c.user_id  = 'b8d7ad25-1ca4-49c0-a188-0cfd280816a7' then 'Unarranged Overdraft'\n       when coalesce(p.amount_cents,0) > 0 then 'Arranged Overdraft'\n       when mll.user_id is not null then mll.OD_type\n       when o.user_id is not null and o.product = 'Installment Loans'then 'TBIL'\n       when o.user_id is not null and o.product = 'Consumer Credit'then 'CC'\n       when o.user_id is not null and o.product = 'Repayment Plane (Phase 2)' then 'RP_2' \n       end product_flag\n\n, case when coalesce(p.amount_cents,0) > 0  and rp.user_id is not null then 'Arranged Overdraft'\n       when mll.OD_type = 'Arranged Overdraft' and rp.user_id is not null then 'Arranged Overdraft'\n       when c.user_id  = 'b8d7ad25-1ca4-49c0-a188-0cfd280816a7' then 'Unarranged Overdraft'\n       when coalesce(p.amount_cents,0) > 0 then 'Arranged Overdraft'\n       when mll.user_id is not null then mll.OD_type\n       when o.user_id is not null and o.product = 'Installment Loans'then 'TBIL'\n       when o.user_id is not null and o.product = 'Consumer Credit'then 'CC'\n       when o.user_id is not null and o.product = 'Repayment Plane (Phase 2)' then 'RP_2'\n       end Instrument_Type\n\n, 'Kredit' as Instrument \n\n-- 3. Creation date \n\n, case when product_flag in ('Arranged Overdraft', 'RP_1') then coalesce(f.first_creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n       when product_flag <> 'Unarranged Overdraft' then coalesce(li.creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n       else null end credit_creation_date\n\n-- 4. DPD\n\n, start_in_arrears::date as start_in_arrears\n, case when start_in_arrears is not null then datediff('day', start_in_arrears::date, last_day(date_add('month', -1, last_day(getdate())))) + 1\n       else 0 end dpd\n\n-- 5. Default\n\n, case when ins.user_id is not null then true else false end as insolvency \n, case when d.user_id is not null then true else false end as dunning \n, case when sch.user_id is not null then true else false end as schufa_insolvency\n, case when rp.user_id is not null then true else false end as rep_plan_user\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 1\n       when dpd > 90 then 1\n       else 0 end is_default\n\n\n-- 6. Credit Bureau flags\n\n, schr.rating as schufa_rating \n, schr.provider\n, case when schr.rev_timestamp::date is not null then last_day(date_add('month', -1, last_day(getdate())))\n       else null end as schufa_rating_date\n\n-- 7. Limit\n\n, case when c.user_id = 'b8d7ad25-1ca4-49c0-a188-0cfd280816a7' then 0 -- error in Plutonium\n       else coalesce(p.amount_cents/100::numeric,0) end as \"Limit\"\n\n, coalesce(mll.overdraft_lim,0) as last_limit_eur\n\n, mll.max_date_neg_balance::date as last_limit_date\n\n-- 8. Exposures\n\n, case when product_flag = 'TBIL' then coalesce(o.balance,0)\n       else 0 end as TBIL_exposures\n\n, case when product_flag = 'CC' then coalesce(o.balance,0)\n       else 0 end as CC_exposures\n\n, case when product_flag = 'RP_2' then coalesce(o.balance,0)\n       else 0 end as RP_2_exposures\n\n, case when product_flag in ('Arranged Overdraft', 'Unarranged Overdraft', 'RP_1') then coalesce(o.balance,0)\n       else 0 end as OD_exposures\n-- 9. PD\n\n-- Calibration segment\n\n-- ! Important ! In Porto if customer eligible for different calibration segment, we choose the one with the max PD\n\n, case when max(case when product_flag in ('RP_1') then 1 else 0 end) over(partition by c.user_id) = 1 then 'RP_phase_1'\n       when max(case when product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then 'RP_phase_2'\n       when m.calibration_sgm is not null then calibration_sgm\n       when product_flag = 'Unarranged Overdraft' then 'UNARRANGED_OD'\n       end porto_calibration_segment\n\n, case when max(case when product_flag in ('RP_1') then 1 else 0 end) over(partition by c.user_id) = 1 then 'RP_phase_1'\n       when max(case when product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then 'RP_phase_2'\n       when m.calibration_sgm is not null then calibration_sgm\n       when product_flag = 'Unarranged Overdraft' then 'UNARRANGED_OD'\n       end pit_calibration_segment  \n\n-- Available Porto PD\n\n, case when pit_calibration_segment in ('RP_phase_2') then 0.10979381443298969\n       when credit_creation_date = last_day(date_add('month', -1, last_day(getdate()))) \n            and product_flag not in ('Unarranged Overdraft', 'RP_2')\n            and m.pd_2 is null then pd_app.pd_2\n       else m.pd_2 end as internal_pd\n\n,  case when pit_calibration_segment in ('RP_phase_2') then ln(0.10979381443298969/(1 - 0.10979381443298969))\n        when credit_creation_date = last_day(date_add('month', -1, last_day(getdate()))) \n             and product_flag not in ('Unarranged Overdraft', 'RP_2')\n             and m.pd_2 is null then ln(pd_app.pd_2::float/(1-pd_app.pd_2::float)) \n        else ln(m.pd_2::float/(1-m.pd_2::float)) end as logit\n\n, case when pit_calibration_segment = 'RP_phase_2' then 0.10979381443298969\n       when credit_creation_date = last_day(date_add('month', -1, last_day(getdate()))) \n            and product_flag not in ('Unarranged Overdraft', 'RP_2')\n            and m.pd_2 is null then pd_app.pd_2\n       else m.pd_2 end as pd_pit_calibrated\n\n-- MEV scenarios\n\n-- down \n\n, case when pit_calibration_segment = 'RP_phase_2' then 0.10979381443298969\n       when product_flag = 'Arranged Overdraft' then 1 / (1 + exp(-0.993527844*logit))\n       when product_flag = 'CC' then 1 / (1 + exp(-0.9886120848*logit))\n       when product_flag = 'RP_1' then 1 / (1 + exp(-0.9871234659*logit))\n       when product_flag = 'TBIL' then 1 / (1 + exp(-0.8635598925*logit))\n       when product_flag = 'Unarranged Overdraft' then 1 / (1 + exp(-0.942206167*logit)) end as pd_pit_calibrated_down\n\n-- neu\n\n, case when pit_calibration_segment = 'RP_phase_2' then 0.10979381443298969\n       when product_flag = 'Arranged Overdraft' then 1 / (1 + exp(-1.002717242*logit))\n       when product_flag = 'CC' then 1 / (1 + exp(-1.003832904*logit))\n       when product_flag = 'RP_1' then 1 / (1 + exp(-1.0042727*logit))\n       when product_flag = 'TBIL' then 1 / (1 + exp(-1.036338268*logit))\n       when product_flag = 'Unarranged Overdraft' then 1 / (1 + exp(-1.02174169*logit)) end as pd_pit_calibrated_neu\n\n-- up\n\n, case when pit_calibration_segment = 'RP_phase_2' then 0.10979381443298969\n       when product_flag = 'Arranged Overdraft' then 1 / (1 + exp(-1.011675526*logit))\n       when product_flag = 'CC' then 1 / (1 + exp(-1.01799547*logit))\n       when product_flag = 'RP_1' then 1 / (1 + exp(-1.021116909*logit))\n       when product_flag = 'TBIL' then 1 / (1 + exp(-1.104161529*logit))\n       when product_flag = 'Unarranged Overdraft' then 1 / (1 + exp(-1.094211134*logit)) end as pd_pit_calibrated_up\n\n, 2.5*pd_pit_calibrated_down/100 + 95*pd_pit_calibrated_neu/100 + 2.5*pd_pit_calibrated_up/100 as pd_pit_calibrated_scen_weighted\n\n-- Calibration PD\n\n,  case  when pd_pit_calibrated::float >= 0 and pd_pit_calibrated::float < 0.0001 then 1\n         when pd_pit_calibrated::float >= 0.0001 and pd_pit_calibrated::float < 0.0005 then 2\n         when pd_pit_calibrated::float >= 0.0005 and pd_pit_calibrated::float < 0.0010 then 3\n         when pd_pit_calibrated::float >= 0.0010 and pd_pit_calibrated::float < 0.0016 then 4\n         when pd_pit_calibrated::float >= 0.0016 and pd_pit_calibrated::float <  0.0024 then 5\n         when pd_pit_calibrated::float >= 0.0024 and pd_pit_calibrated::float < 0.0039 then 6\n         when pd_pit_calibrated::float >= 0.0039 and pd_pit_calibrated::float < 0.0074 then 7\n         when pd_pit_calibrated::float >= 0.0074 and pd_pit_calibrated::float < 0.0143 then 8\n         when pd_pit_calibrated::float >= 0.0143 and pd_pit_calibrated::float < 0.0226 then 9\n         when pd_pit_calibrated::float >= 0.0226 and pd_pit_calibrated::float < 0.0322 then 10\n         when pd_pit_calibrated::float >= 0.0322 and pd_pit_calibrated::float < 0.0430 then 11\n         when pd_pit_calibrated::float >= 0.0430 and pd_pit_calibrated::float < 0.0562 then 12\n         when pd_pit_calibrated::float >= 0.0562 and pd_pit_calibrated::float < 0.1119 then 13\n         when pd_pit_calibrated::float >= 0.1119 and pd_pit_calibrated::float < 0.2790 then 14\n         when pd_pit_calibrated::float >= 0.2790 and pd_pit_calibrated::float < 0.4601 then 15\n         when pd_pit_calibrated::float >= 0.4601 and pd_pit_calibrated::float < 0.6087 then 16\n         when pd_pit_calibrated::float >= 0.6087 and pd_pit_calibrated::float < 1 then 17\n         end as rating_class_pit_calibrated\n\n\n -- down \n\n,  case when pd_pit_calibrated_down::float >= 0 and pd_pit_calibrated_down::float < 0.0001 then 1\n         when pd_pit_calibrated_down::float >= 0.0001 and pd_pit_calibrated_down::float < 0.0005 then 2\n         when pd_pit_calibrated_down::float >= 0.0005 and pd_pit_calibrated_down::float < 0.0010 then 3\n         when pd_pit_calibrated_down::float >= 0.0010 and pd_pit_calibrated_down::float < 0.0016 then 4\n         when pd_pit_calibrated_down::float >= 0.0016 and pd_pit_calibrated_down::float <  0.0024 then 5\n         when pd_pit_calibrated_down::float >= 0.0024 and pd_pit_calibrated_down::float < 0.0039 then 6\n         when pd_pit_calibrated_down::float >= 0.0039 and pd_pit_calibrated_down::float < 0.0074 then 7\n         when pd_pit_calibrated_down::float >= 0.0074 and pd_pit_calibrated_down::float < 0.0143 then 8\n         when pd_pit_calibrated_down::float >= 0.0143 and pd_pit_calibrated_down::float < 0.0226 then 9\n         when pd_pit_calibrated_down::float >= 0.0226 and pd_pit_calibrated_down::float < 0.0322 then 10\n         when pd_pit_calibrated_down::float >= 0.0322 and pd_pit_calibrated_down::float < 0.0430 then 11\n         when pd_pit_calibrated_down::float >= 0.0430 and pd_pit_calibrated_down::float < 0.0562 then 12\n         when pd_pit_calibrated_down::float >= 0.0562 and pd_pit_calibrated_down::float < 0.1119 then 13\n         when pd_pit_calibrated_down::float >= 0.1119 and pd_pit_calibrated_down::float < 0.2790 then 14\n         when pd_pit_calibrated_down::float >= 0.2790 and pd_pit_calibrated_down::float < 0.4601 then 15\n         when pd_pit_calibrated_down::float >= 0.4601 and pd_pit_calibrated_down::float < 0.6087 then 16\n         when pd_pit_calibrated_down::float >= 0.6087 and pd_pit_calibrated_down::float < 1 then 17\n         end as rating_class_pit_calibrated_down\n\n-- neu \n\n,  case  when pd_pit_calibrated_neu::float >= 0 and pd_pit_calibrated_neu::float < 0.0001 then 1\n         when pd_pit_calibrated_neu::float >= 0.0001 and pd_pit_calibrated_neu::float < 0.0005 then 2\n         when pd_pit_calibrated_neu::float >= 0.0005 and pd_pit_calibrated_neu::float < 0.0010 then 3\n         when pd_pit_calibrated_neu::float >= 0.0010 and pd_pit_calibrated_neu::float < 0.0016 then 4\n         when pd_pit_calibrated_neu::float >= 0.0016 and pd_pit_calibrated_neu::float <  0.0024 then 5\n         when pd_pit_calibrated_neu::float >= 0.0024 and pd_pit_calibrated_neu::float < 0.0039 then 6\n         when pd_pit_calibrated_neu::float >= 0.0039 and pd_pit_calibrated_neu::float < 0.0074 then 7\n         when pd_pit_calibrated_neu::float >= 0.0074 and pd_pit_calibrated_neu::float < 0.0143 then 8\n         when pd_pit_calibrated_neu::float >= 0.0143 and pd_pit_calibrated_neu::float < 0.0226 then 9\n         when pd_pit_calibrated_neu::float >= 0.0226 and pd_pit_calibrated_neu::float < 0.0322 then 10\n         when pd_pit_calibrated_neu::float >= 0.0322 and pd_pit_calibrated_neu::float < 0.0430 then 11\n         when pd_pit_calibrated_neu::float >= 0.0430 and pd_pit_calibrated_neu::float < 0.0562 then 12\n         when pd_pit_calibrated_neu::float >= 0.0562 and pd_pit_calibrated_neu::float < 0.1119 then 13\n         when pd_pit_calibrated_neu::float >= 0.1119 and pd_pit_calibrated_neu::float < 0.2790 then 14\n         when pd_pit_calibrated_neu::float >= 0.2790 and pd_pit_calibrated_neu::float < 0.4601 then 15\n         when pd_pit_calibrated_neu::float >= 0.4601 and pd_pit_calibrated_neu::float < 0.6087 then 16\n         when pd_pit_calibrated_neu::float >= 0.6087 and pd_pit_calibrated_neu::float < 1 then 17\n         end as rating_class_pit_calibrated_neu -- 'Unrated'\n\n,  case  when pd_pit_calibrated_up::float >= 0 and pd_pit_calibrated_up::float < 0.0001 then 1\n         when pd_pit_calibrated_up::float >= 0.0001 and pd_pit_calibrated_up::float < 0.0005 then 2\n         when pd_pit_calibrated_up::float >= 0.0005 and pd_pit_calibrated_up::float < 0.0010 then 3\n         when pd_pit_calibrated_up::float >= 0.0010 and pd_pit_calibrated_up::float < 0.0016 then 4\n         when pd_pit_calibrated_up::float >= 0.0016 and pd_pit_calibrated_up::float <  0.0024 then 5\n         when pd_pit_calibrated_up::float >= 0.0024 and pd_pit_calibrated_up::float < 0.0039 then 6\n         when pd_pit_calibrated_up::float >= 0.0039 and pd_pit_calibrated_up::float < 0.0074 then 7\n         when pd_pit_calibrated_up::float >= 0.0074 and pd_pit_calibrated_up::float < 0.0143 then 8\n         when pd_pit_calibrated_up::float >= 0.0143 and pd_pit_calibrated_up::float < 0.0226 then 9\n         when pd_pit_calibrated_up::float >= 0.0226 and pd_pit_calibrated_up::float < 0.0322 then 10\n         when pd_pit_calibrated_up::float >= 0.0322 and pd_pit_calibrated_up::float < 0.0430 then 11\n         when pd_pit_calibrated_up::float >= 0.0430 and pd_pit_calibrated_up::float < 0.0562 then 12\n         when pd_pit_calibrated_up::float >= 0.0562 and pd_pit_calibrated_up::float < 0.1119 then 13\n         when pd_pit_calibrated_up::float >= 0.1119 and pd_pit_calibrated_up::float < 0.2790 then 14\n         when pd_pit_calibrated_up::float >= 0.2790 and pd_pit_calibrated_up::float < 0.4601 then 15\n         when pd_pit_calibrated_up::float >= 0.4601 and pd_pit_calibrated_up::float < 0.6087 then 16\n         when pd_pit_calibrated_up::float >= 0.6087 and pd_pit_calibrated_up::float < 1 then 17\n         end as rating_class_pit_calibrated_up\n\n\n,  case  when pd_pit_calibrated_scen_weighted::float >= 0 and pd_pit_calibrated_scen_weighted::float < 0.0001 then 1\n         when pd_pit_calibrated_scen_weighted::float >= 0.0001 and pd_pit_calibrated_scen_weighted::float < 0.0005 then 2\n         when pd_pit_calibrated_scen_weighted::float >= 0.0005 and pd_pit_calibrated_scen_weighted::float < 0.0010 then 3\n         when pd_pit_calibrated_scen_weighted::float >= 0.0010 and pd_pit_calibrated_scen_weighted::float < 0.0016 then 4\n         when pd_pit_calibrated_scen_weighted::float >= 0.0016 and pd_pit_calibrated_scen_weighted::float <  0.0024 then 5\n         when pd_pit_calibrated_scen_weighted::float >= 0.0024 and pd_pit_calibrated_scen_weighted::float < 0.0039 then 6\n         when pd_pit_calibrated_scen_weighted::float >= 0.0039 and pd_pit_calibrated_scen_weighted::float < 0.0074 then 7\n         when pd_pit_calibrated_scen_weighted::float >= 0.0074 and pd_pit_calibrated_scen_weighted::float < 0.0143 then 8\n         when pd_pit_calibrated_scen_weighted::float >= 0.0143 and pd_pit_calibrated_scen_weighted::float < 0.0226 then 9\n         when pd_pit_calibrated_scen_weighted::float >= 0.0226 and pd_pit_calibrated_scen_weighted::float < 0.0322 then 10\n         when pd_pit_calibrated_scen_weighted::float >= 0.0322 and pd_pit_calibrated_scen_weighted::float < 0.0430 then 11\n         when pd_pit_calibrated_scen_weighted::float >= 0.0430 and pd_pit_calibrated_scen_weighted::float < 0.0562 then 12\n         when pd_pit_calibrated_scen_weighted::float >= 0.0562 and pd_pit_calibrated_scen_weighted::float < 0.1119 then 13\n         when pd_pit_calibrated_scen_weighted::float >= 0.1119 and pd_pit_calibrated_scen_weighted::float < 0.2790 then 14\n         when pd_pit_calibrated_scen_weighted::float >= 0.2790 and pd_pit_calibrated_scen_weighted::float < 0.4601 then 15\n         when pd_pit_calibrated_scen_weighted::float >= 0.4601 and pd_pit_calibrated_scen_weighted::float < 0.6087 then 16\n         when pd_pit_calibrated_scen_weighted::float >= 0.6087 and pd_pit_calibrated_scen_weighted::float < 1 then 17\n         end as rating_class_pit_calibrated_scen_weighted\n\n\n-- Final PD and rating (PIT)\n\n, case  when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 1\n        when dpd > 90 then 1\n        when max(case when product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else pd_pit_calibrated\n               end \n        when pd_pit_calibrated is not null then pd_pit_calibrated\n        when pd_pit_calibrated is null then \n             case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else \n                     case when schr.rating = 'A' then 0.0049\n                          when schr.rating = 'B' then 0.0110\n                          when schr.rating = 'C' then 0.0185\n                          when schr.rating = 'D' then 0.0275\n                          when schr.rating = 'E' then 0.0375\n                          when schr.rating = 'F' then 0.0491\n                          when schr.rating = 'G' then 0.0643\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then 0.1945\n                          when schr.rating = 'N' then 0.4000\n                          when schr.rating = 'O' then 0.5292\n                          when schr.rating = 'P' then 0.7000\n                          else 0.4\n                          end\n                    end\n       else 0.4 end as PD\n\n-- PD scenarios \n\n-- down\n\n, case  when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 1\n        when dpd > 90 then 1\n        when max(case when product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else pd_pit_calibrated_down\n               end  \n        when pd_pit_calibrated_down is not null then pd_pit_calibrated_down\n        when pd_pit_calibrated_down is null then \n             case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else \n                     case when schr.rating = 'A' then 0.0049\n                          when schr.rating = 'B' then 0.0110\n                          when schr.rating = 'C' then 0.0185\n                          when schr.rating = 'D' then 0.0275\n                          when schr.rating = 'E' then 0.0375\n                          when schr.rating = 'F' then 0.0491\n                          when schr.rating = 'G' then 0.0643\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then 0.1945\n                          when schr.rating = 'N' then 0.4000\n                          when schr.rating = 'O' then 0.5292\n                          when schr.rating = 'P' then 0.7000\n                          else 0.4\n                          end\n                    end\n       else 0.4 end as PD_down\n\n-- neu\n\n, case  when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 1\n        when dpd > 90 then 1\n        when max(case when product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else pd_pit_calibrated_neu\n               end \n        when pd_pit_calibrated_neu is not null then pd_pit_calibrated_neu\n        when pd_pit_calibrated_neu is null then \n             case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else \n                     case when schr.rating = 'A' then 0.0049\n                          when schr.rating = 'B' then 0.0110\n                          when schr.rating = 'C' then 0.0185\n                          when schr.rating = 'D' then 0.0275\n                          when schr.rating = 'E' then 0.0375\n                          when schr.rating = 'F' then 0.0491\n                          when schr.rating = 'G' then 0.0643\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then 0.1945\n                          when schr.rating = 'N' then 0.4000\n                          when schr.rating = 'O' then 0.5292\n                          when schr.rating = 'P' then 0.7000\n                          else 0.4\n                          end\n                    end\n       else 0.4 end as PD_neu\n\n-- up \n\n, case  when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 1\n        when dpd > 90 then 1\n        when max(case when product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  -- when pd_pit_calibrated_up < 0.125 then pd_pit_calibrated_up\n                  else pd_pit_calibrated_up\n               end \n        when pd_pit_calibrated_up is not null then pd_pit_calibrated_up\n        when pd_pit_calibrated_up is null then \n             case when dpd > 90 then 1\n                  when dpd > 60 then  0.7000\n                  when dpd > 30 then 0.5292\n                  when dpd > 0 then 0.4000\n                  else \n                     case when schr.rating = 'A' then 0.0049\n                          when schr.rating = 'B' then 0.0110\n                          when schr.rating = 'C' then 0.0185\n                          when schr.rating = 'D' then 0.0275\n                          when schr.rating = 'E' then 0.0375\n                          when schr.rating = 'F' then 0.0491\n                          when schr.rating = 'G' then 0.0643\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then 0.1945\n                          when schr.rating = 'N' then 0.4000\n                          when schr.rating = 'O' then 0.5292\n                          when schr.rating = 'P' then 0.7000\n                          else 0.4\n                          end\n                    end\n       else 0.4 end as PD_up\n\n\n, 2.5*PD_down/100 + 95*PD_neu/100 + 2.5*PD_up/100 as PD_scen_weighted\n\nfrom {{ ref('bp_portfolio_customers_aud_m_v2') }} c \nleft join {{ ref('bp_portfolio_balance_aud_m_v2') }} o on o.encoded_key = c.encoded_key and c.reporting_date::date = o.reporting_date::date\nleft join {{ ref('bp_application_pd_supermodel_m_v2') }} pd_app on pd_app.encoded_key = c.encoded_key \n                                                                and pd_app.reporting_date::date = c.reporting_date::date\nleft join {{ ref('bp_overdraft_split_m_v2') }}  mll on mll.encoded_key = c.encoded_key and c.reporting_date::date = mll.reporting_date::date\nleft join {{ ref('bp_monitoring_pd_supermodel_v2_m_v2') }} m on m.user_id = c.user_id and m.reporting_date::date = c.reporting_date::date\n-- to be fixed - application scores should be from porto\nleft join {{ ref('bp_default_dunning_m_v2') }} d on d.user_id = c.user_id  and d.reporting_date::date = c.reporting_date::date   \nleft join {{ ref('bp_default_internal_insolvency_v2_m_v2') }} ins on ins.user_id = c.user_id and ins.reporting_date::date = c.reporting_date::date\nleft join {{ ref('bp_default_credit_bureau_insolvency_v3_m_v2') }} sch on sch.user_id = c.user_id and sch.reporting_date::date = c.reporting_date::date\nleft join {{ ref('bp_repayment_plan_ph1_m_v2') }} rp on rp.user_id = c.user_id and rp.reporting_date::date = c.reporting_date::date\nleft join {{ ref('bp_credit_bureau_rating_m_v2') }} schr on schr.user_id = c.user_id and schr.reporting_date::date = c.reporting_date::date\nleft join dbt.bp_arrears_reg_aud de on de.user_id = c.user_id\n                                       and  last_day(date_add('month', -1, last_day(getdate()))) between start_in_arrears::date and end_in_arrears::date\nleft join {{ ref('bp_overdraft_limit_periods_v2') }} p on c.encoded_key = p.encoded_key \n                                                        and p.amount_cents > 0 \n                                                        and date_add('minute', -1, date_add('day', 1, last_day(date_add('month', -1, last_day(getdate())))) ) between p.rev_timestamp and p.end_timestamp\nleft join first_enabled_date f on f.encoded_key = c.encoded_key and f.user_id = c.user_id and f.first_creation_date::date <= last_day(date_add('month', -1, last_day(getdate())))\nleft join repayment r on r.parent_account_key = c.encoded_key\nleft join  {{ source('dbt', 'zrh_users') }} z on z.user_id = c.user_id \nleft join {{ ref('bp_loan_contract_information_m_v2') }} li on li.encoded_key = c.encoded_key and li.reporting_date::date = c.reporting_date::date\nleft join {{ source('public', 'mmbr_savings_account') }} s on s.encoded_key = c.encoded_key and s.account_type = 'CURRENT_ACCOUNT'\nwhere \nc.reporting_date::date = last_day(date_add('month', -1, last_day(getdate())))\nand case when z.closed_at <= last_day(date_add('month', -1, last_day(getdate()))) \n                and coalesce(o.balance,0) = 0 then 1 \n           when c.encoded_key is null then 1\n      else 0 end = 0\norder by 1\n)\n\nselect * \n, getdate() as etl_updated\n, coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom total \n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_portfolio_customers_aud_m_v2", "package": null, "version": null}, {"name": "bp_portfolio_balance_aud_m_v2", "package": null, "version": null}, {"name": "bp_application_pd_supermodel_m_v2", "package": null, "version": null}, {"name": "bp_overdraft_split_m_v2", "package": null, "version": null}, {"name": "bp_monitoring_pd_supermodel_v2_m_v2", "package": null, "version": null}, {"name": "bp_default_dunning_m_v2", "package": null, "version": null}, {"name": "bp_default_internal_insolvency_v2_m_v2", "package": null, "version": null}, {"name": "bp_default_credit_bureau_insolvency_v3_m_v2", "package": null, "version": null}, {"name": "bp_repayment_plan_ph1_m_v2", "package": null, "version": null}, {"name": "bp_credit_bureau_rating_m_v2", "package": null, "version": null}, {"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_loan_contract_information_m_v2", "package": null, "version": null}], "sources": [["public", "mmbr_repayment"], ["dbt", "zrh_users"], ["public", "mmbr_savings_account"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.public.mmbr_repayment", "source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.public.mmbr_savings_account", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "model.credit_risk_playground.bp_default_dunning_m_v2", "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_loan_contract_information_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_retail_provisions_m": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_retail_provisions_m", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_retail_provisions_m.sql", "original_file_path": "models/Provisions/v4/bp_retail_provisions_m.sql", "unique_id": "model.credit_risk_playground.bp_retail_provisions_m", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_retail_provisions_m"], "alias": "bp_retail_provisions_m", "checksum": {"name": "sha256", "checksum": "1ae2611167f8afb4e3b7e46dc8879a7dc5cdc46044add77674c4f69d9c5dae7c"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "instrument_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "instrument_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1759745497.286298, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_retail_provisions_m\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='instrument_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n/*\nModels to run\n\nbp_portfolio_balance_aud_m_v2 +\nbp_overdraft_limit_periods_v2   (first drop then create again) +\nbp_portfolio_customers_aud_m_v2 + \nbp_overdue_amt_aud_m  (is not used anymore) +\nbp_arrears_reg_aud  (use dbt.bp_arrears_reg_aud instead) \nbp_overdraft_split_m_v2 +\nbp_monitoring_pd_supermodel_v2_m_v2 \nbp_credit_bureau_rating_m_v2  \nbp_default_dunning_m_v2 \nbp_default_internal_insolvency_v2_m_v2\nbp_default_credit_bureau_insolvency_max_date_v2 (first drop) +\nbp_default_credit_bureau_insolvency_rmd_v2 (first drop) +\nbp_default_credit_bureau_insolvency_me_v2 (first drop) +\nbp_default_credit_bureau_insolvency_v3_m_v2 +\nbp_repayment_plan_ph1_m_v2 +\nbp_loan_contract_information_m_v2 +\nbp_p_accounts_v2 (first drop) +\nbp_hrc_m_v2 +\nbp_social_benefits_v2_m_v2 +\nbp_garnishment_m_v2\nbp_application_pd_supermodel_m_v2 +\nbp_application_pd_supermodel_m_ad_v2 +\nbp_retail_provisions_stg_v5_pre_updated_v2 +\nbp_forbearance_m_v2_v2\nbp_retail_provisions_stg_v5_v4_updated_v2 +\nbp_retail_provisions_m\n*/\n\n-- dbt run --full-refresh --select bp_retail_provisions_m_v3 (first time)\n-- dbt run --select bp_retail_provisions_m_v3 (other runs)\n\nwith \n\ntotal as (\nselect distinct\n\n-- 1. Customers base\n\nuser_id \n,  Instrument_ID\n,  Country\n,  LegalEntity\n,  IS_IFRS -- \"No\" for TSY bonds and \"Yes\" for other instruments\n,  ReportDate\n,  CalcDate -- for retail same as eom, for mortgage 1-month lag\n,  Script_calculation_date\n\n\n\n-- 2. Product flag\n\n, product_flag\n\n, Instrument_Type\n\n, Instrument \n\n\n-- 3. Creation date \n\n, credit_creation_date\n\n-- 4. DPD\n\n, start_in_arrears\n, dpd\n-- , coalesce(datediff('day', start_in_arrears::date, ReportDate::date) + 1,0) as dpd\n\n\n\n-- 5. Default\n\n, insolvency \n, dunning \n, schufa_insolvency\n, rep_plan_user\n\n, is_default\n\n\n-- 6. Credit Bureau flags\n\n, schufa_rating \n, provider\n, schufa_rating_date\n\n-- 7. Limit\n\n, \"Limit\"\n\n, last_limit_eur\n\n, last_limit_date\n\n-- 8. Exposures\n\n, TBIL_exposures\n\n, CC_exposures\n\n, RP_2_exposures\n\n, OD_exposures\n\n-- , coalesce(lo.exposures_loan,0) as loan_exposures\n\n-- 9. PD\n\n-- Available Lisbon 2 PD\n\n\n, logit\n\n-- , (logit - 0.09089766913677097) / 0.9897750804490338 as logit_porto_corr\n\n, pd_pit_calibrated_scen_weighted as pd_pit\n\n\n, pd_pit_calibrated_scen_weighted as pd_od\n\n\n-- Calibration PD\n\n, pd_pit_calibrated_scen_weighted as pd_pit_calibrated\n\n, rating_class_pit_calibrated_scen_weighted as rating_class_pit_calibrated\n\n-- Final PD and rating (PIT)\n\n\n, PD_scen_weighted as  PD\n\n, CurrentRating_scen_weighted as CurrentRating\n\n, CurrentRating_date\n\n\n\n -- 10. CCF\n\n, utilization_pct\n, usage\n\n\n, ccf\n\n, off_balance_exposure\n\n-- 11. EAD\n\n, OffBalance_EAD -- only for off-balance exposures by finance request\n\n, OnBalance_EAD\n\n, IsOffBalance\n\n\n\n-- 12. LGD \n\n, case --when dxaud::date < date_add('year', -3, reportdate)::date then 1.0::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 500.22 then 0.461767::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 2751.38 then 0.521929::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 5992.30 then 0.552278::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 5992.30 then 0.71094::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 102.50 then 0.287018::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 240.50 then 0.368662::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 526.00 then 0.443474::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 526.00 then 0.520718::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 43.50 then 0.840663::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 83.50 then 0.846696::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 123.50 then 0.878149::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 123.50 then 0.924742::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 61.50 then 0.865395::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 124.00 then 0.90235::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 124.00 then 0.941614::float\n     when product_flag = 'CC' then 0.678207::float\n     when product_flag = 'TBIL' then 0.287018::float\n     when product_flag in ('Unarranged Overdraft') and country in ('AUT') then 0.81860::float\n     when product_flag in ('Unarranged Overdraft') and country in ('BEL') then 0.84210::float\n     when product_flag in ('Unarranged Overdraft') and country in ('DEU') then 0.77610::float\n     when product_flag in ('Unarranged Overdraft') and country in ('ESP') then 0.93170::float\n     when product_flag in ('Unarranged Overdraft') and country in ('FRA') then 0.87090::float\n     when product_flag in ('Unarranged Overdraft') and country in ('IRL') then 0.70410::float\n     when product_flag in ('Unarranged Overdraft') and country in ('ITA') then 0.84320::float\n     when product_flag in ('Unarranged Overdraft') and country in ('NLD') then 0.77300::float\n     when product_flag in ('Unarranged Overdraft') and country in ('POL') then 0.92630::float\n     when product_flag in ('Unarranged Overdraft') and country in ('PRT') then 0.83770::float\n     when product_flag in ('Unarranged Overdraft') then 0.9048::float\n     else 0.80000::float end as LGD\n\n-- 13. Finance\n\n, overdraft_interest_accrued\n-- , mi.interest_rate as interest_rate_overdraft\n, interest_rate_loan\n, accrued_interest_loan\n\n, first_repayment\n, last_repayment\n\n, loan_amount \n, loan_name\n, repayment_installments\n, repayment_period_count\n, principal_repayment_interval\n\n-- 14. Maturity\n\n, MaturityDate\n\n, Maturity\n\n\n-- 15. Stages \n\n-- for stage 2 reasons in https://docs.google.com/document/d/1xnfIHGd-4GTxUJ2QiZ04ImMk8yYe2EfBctrk3dW-Bjc/edit# : Section 5, only with Intensified Management\n --flag\n --and +200% PD increase as significat risk increase measure\n \n\n-- application_date\n, InitialPD_date\n\n, InitialPD\n\n, InitialPD_lifetime\n\n, PD_lifetime_scenarios as PD_lifetime\n\n, Stage_scenarios as Stage \n\n\n, Stage_scenarios_description as stage_description \n\n\n-- 16. SLLP \n\n, SLLP\n\n-- per product\n\n, SLLP_OD\n, SLLP_CC\n, SLLP_TBIL\n, SLLP_RP_2\n\n\n-- 17. GLLP\n\n, GLLP_OD_scen_weighted as GLLP_OD\n\n, GLLP_RP_2_scen_weighted as GLLP_RP_2\n\n, GLLP_CC_scen_weighted as GLLP_CC\n\n, GLLP_TBIL_scen_weighted as GLLP_TBIL\n\n-- GLLP new \n, CASE \n    WHEN GLLP_scen_weighted < 0 THEN 0 \n    ELSE GLLP_scen_weighted end as GLLP\n-- ECL split \n\n, CASE \n    WHEN ECL_On_scen_weighted < 0 THEN 0 \n    ELSE ECL_On_scen_weighted end as ECL_On\n\n, ECL_Off_scen_weighted as ECL_Off\n\n\nfrom {{ ref('bp_retail_provisions_stg_v5_v4_updated_v2') }} \nwhere ReportDate::date = last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n\t\t\t\t\t\t\t\t\t)\n    and not (\n        (coalesce(onbalance_ead, 0) = 0 and coalesce(\"limit\", 0) = 0)\n        or\n        (product_flag is null and coalesce(onbalance_ead, 0) + coalesce(offbalance_ead, 0) = 0)\n    )\n)\n\n\nselect * \n, getdate() as etl_updated\n, coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom total \n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_retail_provisions_stg_v5_v4_updated_v2", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2"]}, "compiled_path": "target/compiled/credit_risk_playground/models/Provisions/v4/bp_retail_provisions_m.sql", "compiled": true, "compiled_code": "\n\n/*\nModels to run\n\nbp_portfolio_balance_aud_m_v2 +\nbp_overdraft_limit_periods_v2   (first drop then create again) +\nbp_portfolio_customers_aud_m_v2 + \nbp_overdue_amt_aud_m  (is not used anymore) +\nbp_arrears_reg_aud  (use dbt.bp_arrears_reg_aud instead) \nbp_overdraft_split_m_v2 +\nbp_monitoring_pd_supermodel_v2_m_v2 \nbp_credit_bureau_rating_m_v2  \nbp_default_dunning_m_v2 \nbp_default_internal_insolvency_v2_m_v2\nbp_default_credit_bureau_insolvency_max_date_v2 (first drop) +\nbp_default_credit_bureau_insolvency_rmd_v2 (first drop) +\nbp_default_credit_bureau_insolvency_me_v2 (first drop) +\nbp_default_credit_bureau_insolvency_v3_m_v2 +\nbp_repayment_plan_ph1_m_v2 +\nbp_loan_contract_information_m_v2 +\nbp_p_accounts_v2 (first drop) +\nbp_hrc_m_v2 +\nbp_social_benefits_v2_m_v2 +\nbp_garnishment_m_v2\nbp_application_pd_supermodel_m_v2 +\nbp_application_pd_supermodel_m_ad_v2 +\nbp_retail_provisions_stg_v5_pre_updated_v2 +\nbp_forbearance_m_v2_v2\nbp_retail_provisions_stg_v5_v4_updated_v2 +\nbp_retail_provisions_m\n*/\n\n-- dbt run --full-refresh --select bp_retail_provisions_m_v3 (first time)\n-- dbt run --select bp_retail_provisions_m_v3 (other runs)\n\nwith \n\ntotal as (\nselect distinct\n\n-- 1. Customers base\n\nuser_id \n,  Instrument_ID\n,  Country\n,  LegalEntity\n,  IS_IFRS -- \"No\" for TSY bonds and \"Yes\" for other instruments\n,  ReportDate\n,  CalcDate -- for retail same as eom, for mortgage 1-month lag\n,  Script_calculation_date\n\n\n\n-- 2. Product flag\n\n, product_flag\n\n, Instrument_Type\n\n, Instrument \n\n\n-- 3. Creation date \n\n, credit_creation_date\n\n-- 4. DPD\n\n, start_in_arrears\n, dpd\n-- , coalesce(datediff('day', start_in_arrears::date, ReportDate::date) + 1,0) as dpd\n\n\n\n-- 5. Default\n\n, insolvency \n, dunning \n, schufa_insolvency\n, rep_plan_user\n\n, is_default\n\n\n-- 6. Credit Bureau flags\n\n, schufa_rating \n, provider\n, schufa_rating_date\n\n-- 7. Limit\n\n, \"Limit\"\n\n, last_limit_eur\n\n, last_limit_date\n\n-- 8. Exposures\n\n, TBIL_exposures\n\n, CC_exposures\n\n, RP_2_exposures\n\n, OD_exposures\n\n-- , coalesce(lo.exposures_loan,0) as loan_exposures\n\n-- 9. PD\n\n-- Available Lisbon 2 PD\n\n\n, logit\n\n-- , (logit - 0.09089766913677097) / 0.9897750804490338 as logit_porto_corr\n\n, pd_pit_calibrated_scen_weighted as pd_pit\n\n\n, pd_pit_calibrated_scen_weighted as pd_od\n\n\n-- Calibration PD\n\n, pd_pit_calibrated_scen_weighted as pd_pit_calibrated\n\n, rating_class_pit_calibrated_scen_weighted as rating_class_pit_calibrated\n\n-- Final PD and rating (PIT)\n\n\n, PD_scen_weighted as  PD\n\n, CurrentRating_scen_weighted as CurrentRating\n\n, CurrentRating_date\n\n\n\n -- 10. CCF\n\n, utilization_pct\n, usage\n\n\n, ccf\n\n, off_balance_exposure\n\n-- 11. EAD\n\n, OffBalance_EAD -- only for off-balance exposures by finance request\n\n, OnBalance_EAD\n\n, IsOffBalance\n\n\n\n-- 12. LGD \n\n, case --when dxaud::date < date_add('year', -3, reportdate)::date then 1.0::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 500.22 then 0.461767::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 2751.38 then 0.521929::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 5992.30 then 0.552278::float\n     when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 5992.30 then 0.71094::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 102.50 then 0.287018::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 240.50 then 0.368662::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 526.00 then 0.443474::float\n     when product_flag in ('TBIL') and country = 'DEU' and sum(case when product_flag in ('TBIL') and country = 'DEU' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 526.00 then 0.520718::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 43.50 then 0.840663::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 83.50 then 0.846696::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 123.50 then 0.878149::float\n     when product_flag in ('TBIL') and country = 'FRA' and sum(case when product_flag in ('TBIL') and country = 'FRA' then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 123.50 then 0.924742::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 61.50 then 0.865395::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) < 124.00 then 0.90235::float\n     when product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(OnBalance_EAD,0) else 0 end) over(partition by user_id) >= 124.00 then 0.941614::float\n     when product_flag = 'CC' then 0.678207::float\n     when product_flag = 'TBIL' then 0.287018::float\n     when product_flag in ('Unarranged Overdraft') and country in ('AUT') then 0.81860::float\n     when product_flag in ('Unarranged Overdraft') and country in ('BEL') then 0.84210::float\n     when product_flag in ('Unarranged Overdraft') and country in ('DEU') then 0.77610::float\n     when product_flag in ('Unarranged Overdraft') and country in ('ESP') then 0.93170::float\n     when product_flag in ('Unarranged Overdraft') and country in ('FRA') then 0.87090::float\n     when product_flag in ('Unarranged Overdraft') and country in ('IRL') then 0.70410::float\n     when product_flag in ('Unarranged Overdraft') and country in ('ITA') then 0.84320::float\n     when product_flag in ('Unarranged Overdraft') and country in ('NLD') then 0.77300::float\n     when product_flag in ('Unarranged Overdraft') and country in ('POL') then 0.92630::float\n     when product_flag in ('Unarranged Overdraft') and country in ('PRT') then 0.83770::float\n     when product_flag in ('Unarranged Overdraft') then 0.9048::float\n     else 0.80000::float end as LGD\n\n-- 13. Finance\n\n, overdraft_interest_accrued\n-- , mi.interest_rate as interest_rate_overdraft\n, interest_rate_loan\n, accrued_interest_loan\n\n, first_repayment\n, last_repayment\n\n, loan_amount \n, loan_name\n, repayment_installments\n, repayment_period_count\n, principal_repayment_interval\n\n-- 14. Maturity\n\n, MaturityDate\n\n, Maturity\n\n\n-- 15. Stages \n\n-- for stage 2 reasons in https://docs.google.com/document/d/1xnfIHGd-4GTxUJ2QiZ04ImMk8yYe2EfBctrk3dW-Bjc/edit# : Section 5, only with Intensified Management\n --flag\n --and +200% PD increase as significat risk increase measure\n \n\n-- application_date\n, InitialPD_date\n\n, InitialPD\n\n, InitialPD_lifetime\n\n, PD_lifetime_scenarios as PD_lifetime\n\n, Stage_scenarios as Stage \n\n\n, Stage_scenarios_description as stage_description \n\n\n-- 16. SLLP \n\n, SLLP\n\n-- per product\n\n, SLLP_OD\n, SLLP_CC\n, SLLP_TBIL\n, SLLP_RP_2\n\n\n-- 17. GLLP\n\n, GLLP_OD_scen_weighted as GLLP_OD\n\n, GLLP_RP_2_scen_weighted as GLLP_RP_2\n\n, GLLP_CC_scen_weighted as GLLP_CC\n\n, GLLP_TBIL_scen_weighted as GLLP_TBIL\n\n-- GLLP new \n, CASE \n    WHEN GLLP_scen_weighted < 0 THEN 0 \n    ELSE GLLP_scen_weighted end as GLLP\n-- ECL split \n\n, CASE \n    WHEN ECL_On_scen_weighted < 0 THEN 0 \n    ELSE ECL_On_scen_weighted end as ECL_On\n\n, ECL_Off_scen_weighted as ECL_Off\n\n\nfrom \"n26\".\"credit_risk_playground\".\"bp_retail_provisions_stg_v5_v4_updated_v2\" \nwhere ReportDate::date = last_day(\n                            date_add('month'\n                                    , -1\n                                    , last_day(getdate())\n                                    )\n\t\t\t\t\t\t\t\t\t)\n    and not (\n        (coalesce(onbalance_ead, 0) = 0 and coalesce(\"limit\", 0) = 0)\n        or\n        (product_flag is null and coalesce(onbalance_ead, 0) + coalesce(offbalance_ead, 0) = 0)\n    )\n)\n\n\nselect * \n, getdate() as etl_updated\n, coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom total \n\nwhere etl_updated > (select max(etl_updated) from \"n26\".\"credit_risk_playground\".\"bp_retail_provisions_m\")\n", "extra_ctes_injected": true, "extra_ctes": [], "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_portfolio_balance_aud_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_portfolio_balance_aud_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_portfolio_balance_aud_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_portfolio_balance_aud_m_v2"], "alias": "bp_portfolio_balance_aud_m_v2", "checksum": {"name": "sha256", "checksum": "27f00f6ded9f11b5824500f9c611b1073eb3b97295ad75d635a0d1858dfdf9cf"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "encoded_key", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "encoded_key", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1759764119.715224, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_portfolio_balance_aud_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='encoded_key',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_portfolio_balance_aud_m (first time)\n-- dbt run --models bp_portfolio_balance_aud_m (other runs)\n\nwith\n\noverdraft_gl_accounts as (\n        select\n            cl.user_id\n            , s.encoded_key\n            , last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                    ) as reporting_date\n            , 'Overdraft' as  product\n            , sum(\n                case\n                    when glje.\"type\" = 'CREDIT' then glje.amount * (-1)\n                    when glje.\"type\" = 'DEBIT' then glje.amount\n                end\n            ) as balance\n        from {{ source('public', 'mmbr_gl_account') }} as gla\n        inner join {{ source('public', 'mmbr_gl_journal_entry') }} as glje\n            on gla.encoded_key = glje.glaccount_encodedkey_oid\n        inner join {{ source('public', 'mmbr_savings_account') }} s on glje.account_key = s.encoded_key \n                                                                        and s.account_type = 'CURRENT_ACCOUNT'\n        inner join {{ source('dbt', 'mmbr_user_match') }} cl \n            on cl.encoded_key = s.encoded_key and cl.is_current = true\n        where gla.gl_code = '104.00.00' and glje.entry_date::date <= last_day(\n                                                                            date_add('month'\n                                                                                    , -1\n                                                                                    , last_day(getdate())\n                                                                                    )\n                                                                            )\n        group by 1,2,3,4\n        having sum(\n                case\n                    when glje.\"type\" = 'CREDIT' then glje.amount * (-1)\n                    when glje.\"type\" = 'DEBIT' then glje.amount\n                end\n            ) <> 0\n        )\n\n\n, loan_balance as (\n        select\n            cl.user_id\n            , s.encoded_key\n            , last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                            ) as reporting_date\n            , case when gl_code = '104.00.05' then 'Consumer Credit'\n                    when gl_code = '104' then 'Consumer Credit'\n                    when gl_code = '104.00.06' then 'Installment Loans'\n                    when gl_code = '104.00.07' then 'Repayment Plane (Phase 2)' \n                    end as product\n            , sum(\n                case\n                    when glje.\"type\" = 'CREDIT' then glje.amount * (-1)\n                    when glje.\"type\" = 'DEBIT' then glje.amount\n                end\n            ) as balance\n        from {{ source('public', 'mmbr_gl_account') }}  as gla\n        inner join {{ source('public', 'mmbr_gl_journal_entry') }} as glje\n            on gla.encoded_key = glje.glaccount_encodedkey_oid\n        left join {{ source('public', 'mmbr_loan_account') }} s on glje.account_key = s.encoded_key\n        left join {{ source('dbt', 'mmbr_user_match') }} cl\n            on cl.mmbr_client_key = s.account_holder_key and cl.is_current = true\n        where gla.gl_code in ('104.00.05', '104', '104.00.06', '104.00.07') and glje.entry_date::date <= last_day(\n                                                                                                                date_add('month'\n                                                                                                                        , -1\n                                                                                                                        , last_day(getdate())\n                                                                                                                        )\n                                                                                                                )\n            group by 1, 2, 3, 4\n        having sum(\n                case\n                    when glje.\"type\" = 'CREDIT' then glje.amount * (-1)\n                    when glje.\"type\" = 'DEBIT' then glje.amount\n                end\n            ) <> 0\n)\n\n, total as (\nselect distinct \n        user_id \n        , encoded_key \n        , last_day(\n                    date_add('month'\n                            , -1\n                            , last_day(getdate())\n                            )\n                            ) as reporting_date\n        , product\n        , balance \n        , getdate() as etl_updated\nfrom overdraft_gl_accounts\n\nunion all \n\nselect distinct \n        user_id \n        , encoded_key \n        , reporting_date\n        , product\n        , balance \n        , getdate() as etl_updated\nfrom loan_balance\n)\n\nselect distinct\nuser_id \n, encoded_key \n, reporting_date\n, product\n, balance \n, coalesce(encoded_key, '') || coalesce(etl_updated::varchar, '') as unique_key\n, etl_updated\nfrom total \n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [["public", "mmbr_gl_account"], ["public", "mmbr_gl_journal_entry"], ["public", "mmbr_savings_account"], ["dbt", "mmbr_user_match"], ["public", "mmbr_gl_account"], ["public", "mmbr_gl_journal_entry"], ["public", "mmbr_loan_account"], ["dbt", "mmbr_user_match"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.public.mmbr_gl_account", "source.credit_risk_playground.public.mmbr_gl_journal_entry", "source.credit_risk_playground.public.mmbr_savings_account", "source.credit_risk_playground.dbt.mmbr_user_match", "source.credit_risk_playground.public.mmbr_loan_account"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_garnishment_m_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_garnishment_m_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_garnishment_m_v2.sql", "original_file_path": "models/Provisions/v4/bp_garnishment_m_v2.sql", "unique_id": "model.credit_risk_playground.bp_garnishment_m_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_garnishment_m_v2"], "alias": "bp_garnishment_m_v2", "checksum": {"name": "sha256", "checksum": "9fd0a155e247ecee64dcc47880013ae7948bb8d40ca34f2eec3c80349458b219"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "user_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "user_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1762168491.224139, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_garnishment_m_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='user_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_garnishment_m_v2 (first time)\n-- dbt run --select bp_garnishment_m_v2 (other runs)\n\nwith \n\ngarnishment as (\n  select \n  customer_id as user_id\n  , max(ng.created) as latest_garnishment_date\n  from nd_garnishment ng\n  left join nd_participant np  on ng.id = np.garnishment_id\n  where np.type = 'RESPONDENT' --and ng.status = 'OPEN'\n\n   and (\n            (\n            ng.status = 'CLOSED'\n                and last_day(date_add('month', -1, last_day(getdate()))) between ng.created::timestamp and ng.updated::timestamp\n            ) -- garnishment was active at the application, but now closed\n            or \n            (\n            ng.status = 'OPEN' and ng.created::timestamp <= last_day(date_add('month', -1, last_day(getdate())))\n            )\n        ) \n    group by 1 \n)\n\nselect * \n, last_day(\n        date_add('month'\n                , -1\n                , last_day(getdate())\n                )\n                ) as reporting_date\n, getdate() as etl_updated\n, coalesce(user_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom garnishment\n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": []}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_overdraft_limit_periods_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_overdraft_limit_periods_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_overdraft_limit_periods_v2.sql", "original_file_path": "models/Provisions/v4/bp_overdraft_limit_periods_v2.sql", "unique_id": "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_overdraft_limit_periods_v2"], "alias": "bp_overdraft_limit_periods_v2", "checksum": {"name": "sha256", "checksum": "1d8d5ba15f982ee2f00d90e25c341f73e69da6c77943072a4ded19802afec3b9"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "table", "tags": ["retail_provisions"]}, "created_at": 1762168491.2457979, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_overdraft_limit_periods_v2\"", "raw_code": "{{\n    config(\n    materialized = \"table\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\nwith \n\nod_users as (\nselect distinct user_id \nfrom {{ source('public', 'pu_overdraft_history') }}\nwhere status = 'ENABLED'\n\nUNION\n\nselect distinct z.id as user_id\nfrom {{ source('public', 'ddb_overdraft_settings_aud') }} \ninner join etl_reporting.cmd_users z using(user_created)\nwhere enabled = 1 \n\n)\n\n, ddb_os as (\nselect \nz.id as user_id\n, d.user_created\n, rev_timestamp\n, case when enabled = 1 then max_amount_cents \n       else 0 end as amount_cents \n, lag(case when enabled = 1 then max_amount_cents\n           else 0 end) OVER (PARTITION by user_created order by rev_timestamp) as previous_amount_cents \nfrom  {{ source('public', 'ddb_overdraft_settings_aud') }} d \ninner join {{ source('etl_reporting', 'cmd_users') }} z using(user_created)\n, (select min(created) as mpd \n    from {{ source('public', 'pu_overdraft_history') }}) min_pu_date\nwhere d.rev_timestamp < mpd -- coalesce(mp.mpud , mpd)\n)\n\n, plutonium as (\n select \n user_id \n, user_created \n, created as rev_timestamp\n, case when status ='ENABLED' then amount_cents \n       else 0 end as amount_cents \n, lag(case when status = 'ENABLED' then amount_cents \n           else 0 end) OVER (PARTITION by user_created order by created) as previous_amount_cents \nfrom {{ source('public', 'pu_overdraft_history') }} \n)\n\n, limits_history as (\nselect distinct\na.* \nfrom (\nselect * \nfrom ddb_os\nunion all \nselect * \nfrom plutonium ) a\norder by a.user_id, a.user_created, a.rev_timestamp\n)\n\n, limits_periods as ( \nselect \nuser_created \n, user_id \n, rev_timestamp \n, coalesce( lead(rev_timestamp) OVER (PARTITION BY user_id ORDER BY rev_timestamp) + interval'-0.000001 seconds' \n                  , '2100-01-01'::timestamp) as end_timestamp \n, amount_cents \nfrom plutonium\nwhere (previous_amount_cents IS NULL OR previous_amount_cents <> amount_cents) ) \n\nselect \nf.* \n, s.encoded_key\n, getdate() as etl_updated\nfrom limits_periods f\ninner join od_users o on o.user_id = f.user_id\ninner join {{ source('dbt', 'mmbr_user_match') }} cl on cl.user_id = f.user_id  and cl.is_current = true\ninner join {{ source('public', 'mmbr_savings_account') }} s on s.encoded_key = cl.encoded_key \n                                                                and s.account_type = 'CURRENT_ACCOUNT'", "doc_blocks": [], "language": "sql", "refs": [], "sources": [["public", "ddb_overdraft_settings_aud"], ["public", "mmbr_savings_account"], ["dbt", "mmbr_user_match"], ["public", "pu_overdraft_history"], ["etl_reporting", "cmd_users"]], "metrics": [], "depends_on": {"macros": [], "nodes": ["source.credit_risk_playground.public.ddb_overdraft_settings_aud", "source.credit_risk_playground.public.mmbr_savings_account", "source.credit_risk_playground.dbt.mmbr_user_match", "source.credit_risk_playground.public.pu_overdraft_history", "source.credit_risk_playground.etl_reporting.cmd_users"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_retail_provisions_stg_v5_v4_updated_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_retail_provisions_stg_v5_v4_updated_v2.sql", "original_file_path": "models/Provisions/v4/bp_retail_provisions_stg_v5_v4_updated_v2.sql", "unique_id": "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_retail_provisions_stg_v5_v4_updated_v2"], "alias": "bp_retail_provisions_stg_v5_v4_updated_v2", "checksum": {"name": "sha256", "checksum": "b027ac2e966d616a9e00d2ac13062576729f33877ce528988e2aab4873daf4bb"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "instrument_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "instrument_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1762180355.1882062, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_retail_provisions_stg_v5_v4_updated_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='instrument_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_retail_provisions_stg_v5_v4_updated_v2 (first time)\n-- dbt run --select bp_retail_provisions_stg_v5_v4_updated_v2 (other runs)\n\nwith \n\nfirst_enabled_date as (\nselect user_id \n, encoded_key\n, min(rev_timestamp) as first_creation_date\n, max(rev_timestamp) as last_creation_date\nfrom {{ ref('bp_overdraft_limit_periods_v2') }}\nwhere rev_timestamp <= date_add('minute', -1, date_add('day', 1, last_day(date_add('month', -1, last_day(getdate())))) ) and amount_cents > 0 \ngroup by \nuser_id \n, encoded_key\n)\n\n, repayment as (\nselect parent_account_key\n, min(due_date) as first_repayment\n, max(due_date) as last_repayment\nfrom  {{ source('public', 'mmbr_repayment') }}  \ngroup by 1\n)\n\n, forbearance_last_year as (\nselect distinct \ninstrument_id\nfrom {{ ref('bp_forbearance_m_v2_v2') }} f \nwhere f.credit_creation_date::date between date_add('month', -12\n                                                    , last_day(date_add('month', -1, last_day(getdate())))\n                                                    ) and last_day(date_add('month', -1, last_day(getdate())))\n      and f.reportdate = last_day(date_add('month', -1, last_day(getdate())))\n\n)\n\n, latest_default_during_forbearance as (\nselect \nc.user_id \n--, c.instrument_id \n, max(c.reportdate::date) as default_during_forbearance_date\nfrom (\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated   -- from May 2024\n   where reportdate::date <= '2025-04-30'::date  \n\n   union all \n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_ik  \n   where reportdate::date > '2025-04-30'::date  AND reportdate::date <=  '2025-05-31'::date\n\n   union all \n\n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2\n   where reportdate::date > '2025-05-31'::date \n) c --{{ ref('bp_retail_provisions_stg_v5_pre_updated_v2') }} c \nleft join {{ ref('bp_forbearance_m_v2_v2') }} f on c.instrument_id = f.instrument_id and c.reportdate::date = f.reportdate::date\nwhere (c.is_default = 1) and (f.instrument_id is not null)\ngroup by 1\n)\n\n, default_last_12_months as (\nselect \nc.user_id \n--, c.instrument_id \n, max(c.reportdate::date) as last_default_date\nfrom (\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated   -- from May 2024\n   where reportdate::date <= '2025-04-30'::date  \n\n   union all \n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_ik  \n   where reportdate::date > '2025-04-30'::date  AND reportdate::date <=  '2025-05-31'::date\n\n   union all \n\n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2\n   where reportdate::date > '2025-05-31'::date \n) c \nwhere (c.is_default = 1) \ngroup by 1\n)\n\n, total as (\nselect distinct\n\n-- 1. Customers base\n\nc.user_id \n, c.Instrument_ID\n, c.Country\n, c.LegalEntity\n, c.IS_IFRS -- \"No\" for TSY bonds and \"Yes\" for other instruments\n, c.ReportDate\n, c.CalcDate -- for retail same as eom, for mortgage 1-month lag\n, c.Script_calculation_date\n-- 2. Product flag\n-- product\n\n, c.product_flag\n\n, c.Instrument_Type\n\n, c.Instrument \n\n-- 3. Creation date \n\n, c.credit_creation_date\n\n-- 4. DPD\n\n, c.start_in_arrears\n, c.dpd\n\n-- 5. Default\n\n, c.insolvency \n, c.dunning \n, c.schufa_insolvency\n, c.rep_plan_user\n\n, case when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1\n       else c.is_default end as is_default\n\n\n-- 6. Credit Bureau flags\n\n, c.schufa_rating \n, c.provider\n, c.schufa_rating_date\n\n-- 7. Limit\n\n, c.\"Limit\"\n\n, c.last_limit_eur\n\n, c.last_limit_date\n\n-- 8. Exposures\n\n, c.TBIL_exposures\n\n, c.CC_exposures\n\n, c.RP_2_exposures\n\n, c.OD_exposures\n-- 9. PD\n\n-- Calibration segment\n\n-- ! Important ! In Porto if customer eligible for different calibration segment, we choose the one with the max PD\n\n, c.porto_calibration_segment\n\n, c.pit_calibration_segment  \n\n-- Available Porto PD\n\n, c.internal_pd\n\n,  c.logit\n\n, c.pd_pit_calibrated\n\n-- MEV scenarios\n\n-- down \n\n, c.pd_pit_calibrated_down\n\n-- neu\n\n, c.pd_pit_calibrated_neu\n\n-- up\n\n, c.pd_pit_calibrated_up\n\n, c.pd_pit_calibrated_scen_weighted\n\n-- Calibration PD\n\n,  c.rating_class_pit_calibrated\n\n\n -- down \n\n,  c.rating_class_pit_calibrated_down\n\n-- neu \n\n,  c.rating_class_pit_calibrated_neu\n\n,  c.rating_class_pit_calibrated_up\n\n\n,  c.rating_class_pit_calibrated_scen_weighted\n\n\n-- Final PD and rating (PIT)\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD end as PD\n\n-- PD scenarios \n\n-- down\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_down end as PD_down\n\n-- neu\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_neu end as PD_neu\n\n-- up \n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_up end as PD_up\n\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_scen_weighted end as PD_scen_weighted\n\n\n-- Final Rating\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19' \n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated as varchar)\n               end \n       when c.pd_pit_calibrated is not null then cast(c.rating_class_pit_calibrated as varchar)\n       when c.pd_pit_calibrated is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating\n\n-- Final Rating scenarios \n\n-- down\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\nwhen (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_down as varchar)\n               end \n         when c.pd_pit_calibrated_down is not null then cast(c.rating_class_pit_calibrated_down as varchar)\n         when c.pd_pit_calibrated_down is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_down\n\n-- neu\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_neu as varchar)\n               end \n         when c.pd_pit_calibrated_neu is not null then cast(c.rating_class_pit_calibrated_neu as varchar)\n         when c.pd_pit_calibrated_neu is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_neu\n\n\n-- up \n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_up as varchar)\n               end \n         when c.pd_pit_calibrated_up is not null then cast(c.rating_class_pit_calibrated_up as varchar)\n         when c.pd_pit_calibrated_up is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_up\n\n-- scneraios-weighted \n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_scen_weighted as varchar)\n               end \n         when c.pd_pit_calibrated_scen_weighted is not null then cast(c.rating_class_pit_calibrated_scen_weighted as varchar)\n         when c.pd_pit_calibrated_scen_weighted is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated' -- 'Unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_scen_weighted\n\n-- Final Rating date\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then last_day(date_add('month', -1, last_day(getdate())))\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then last_day(date_add('month', -1, last_day(getdate())))\n       when c.dpd > 90 then last_day(date_add('month', -1, last_day(getdate())))\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then last_day(date_add('month', -1, last_day(getdate())))\n                  when c.dpd > 60 then  last_day(date_add('month', -1, last_day(getdate())))\n                  when c.dpd > 30 then last_day(date_add('month', -1, last_day(getdate())))\n                  when c.dpd > 0 then last_day(date_add('month', -1, last_day(getdate())))\n                  --when c.rating_class_pit_calibrated < 14 then m.calculated_at::date \n                  else last_day(date_add('month', -1, last_day(getdate())))\n               end \n       when c.pd_pit_calibrated is not null then m.calculated_at::date \n       when c.pd_pit_calibrated is null then \n            case when c.dpd > 90 then last_day(date_add('month', -1, last_day(getdate())))\n                 when c.dpd > 60 then last_day(date_add('month', -1, last_day(getdate())))\n                 when c.dpd > 30 then last_day(date_add('month', -1, last_day(getdate())))\n                 when c.dpd > 0 then last_day(date_add('month', -1, last_day(getdate())))\n                 else \n                     case when schr.rating = 'A' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'B' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'C' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'D' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'E' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'F' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'G' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'N' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'O' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'P' then last_day(date_add('month', -1, last_day(getdate())))\n                          else last_day(date_add('month', -1, last_day(getdate())))\n                          end\n                    end\n       else last_day(date_add('month', -1, last_day(getdate())))\n       end as CurrentRating_date\n\n-- Final rating source\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 'default_flag'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 'default_flag_fbe'\n       when c.dpd > 90 then 'default_flag'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then 'default_flag'\n                  when c.dpd > 60 then  'dpd 61-90'\n                  when c.dpd > 30 then 'dpd 31-60'\n                  when c.dpd > 0 then 'dpd 1-30'\n                  else 'repayment_plan_2'\n               end \n         when c.pd_pit_calibrated_scen_weighted is not null then 'internal_rating_model'\n         when c.pd_pit_calibrated_scen_weighted is null then \n            case when c.dpd > 90 then 'default_flag'\n                 when c.dpd > 60 then 'dpd 61-90'\n                 when c.dpd > 30 then 'dpd 31-60'\n                 when c.dpd > 0 then 'dpd 1-30'\n                 else \n                     case when schr.rating = 'A' then 'CB'\n                          when schr.rating = 'B' then 'CB'\n                          when schr.rating = 'C' then 'CB'\n                          when schr.rating = 'D' then 'CB'\n                          when schr.rating = 'E' then 'CB'\n                          when schr.rating = 'F' then 'CB'\n                          when schr.rating = 'G' then 'CB'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then 'CB'\n                          when schr.rating = 'N' then 'CB'\n                          when schr.rating = 'O' then 'CB'\n                          when schr.rating = 'P' then 'CB'\n                          else 'no_rating'\n                          end\n                    end\n       else 'no_rating' end as CurrentRating_source\n\n -- 10. CCF\n\n, case when coalesce(c.\"Limit\"::numeric,0) = 0 then 0\n            when coalesce(c.OD_exposures::numeric,0) = 0 then 0\n            else round(coalesce(c.OD_exposures::numeric,0)/coalesce(c.\"Limit\"::numeric,0), 2) \n        end as utilization_pct\n, case\n            when coalesce(c.OD_exposures,0)  > coalesce(c.\"Limit\",0) then ' > 80%'\n            when utilization_pct < 0.2 then '  <=20%'\n            when utilization_pct between 0.2 and 0.4 then ' 20% to 40%'\n            when utilization_pct between 0.4 and 0.6 then ' 40% to 60%'\n            when utilization_pct between 0.6 and 0.8 then ' 60% to 80%'\n            when utilization_pct >= 0.8 then ' > 80%' \n        end as usage\n\n, decode(usage,\n            '  <=20%', 0.3644,\n            ' 20% to 40%', 0.6360,\n            ' 40% to 60%', 0.7221,\n            ' 60% to 80%', 0.8089,\n            ' > 80%', 1) as ccf\n\n, case when CurrentRating not in ('18', '19') \n            and c.product_flag in ('RP_1', 'Arranged Overdraft') then  \n\n                case when coalesce(c.\"Limit\",0) <= coalesce(c.OD_exposures,0) then 0\n                     when usage not in (' > 80%') then (coalesce(c.\"Limit\",0) -  coalesce(c.OD_exposures,0)) \n                     else 0\n                     end \n\n        else 0 end off_balance_exposure\n\n-- 11. EAD\n\n, case when CurrentRating not in ('18', '19') \n            and c.product_flag in ('RP_1', 'Arranged Overdraft') then  \n                case when coalesce(c.\"Limit\",0) <= coalesce(c.OD_exposures,0) then 0\n                     when usage not in (' > 80%') then ((coalesce(c.\"Limit\",0) -  coalesce(c.OD_exposures,0)) * ccf )\n                     else 0\n                     end \n        else 0 end OffBalance_EAD -- only for off-balance exposures by finance request\n\n, coalesce(o.balance,0) as OnBalance_EAD\n\n, case when OffBalance_EAD <> 0 then 1 else 0 end as IsOffBalance\n-- 12. LGD \n\n, CASE\n    WHEN c.is_default = 1 \n         AND GREATEST(\n                COALESCE(c.credit_creation_date, DATE '0001-01-01'),\n                COALESCE(\n                    CASE \n                        WHEN d.user_id IS NOT NULL THEN d.default_date\n                        WHEN ins.user_id IS NOT NULL THEN ins.internal_insolvency_date\n                        WHEN sch.user_id IS NOT NULL THEN c.schufa_rating_date\n                        WHEN c.dpd > 90 THEN date_add('day', 90, c.start_in_arrears)\n                    END,\n                    DATE '0001-01-01'\n                )\n             ) < date_add('year', -3, c.reportdate)\n    THEN 1.000000::float\n  else\n     case \n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 500.22 then 0.461767::float\n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 2751.38 then 0.521929::float\n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 5992.30 then 0.552278::float\n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 5992.30 then 0.71094::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 102.50 then 0.287018::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 240.50 then 0.368662::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 526.00 then 0.443474::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 526.00 then 0.520718::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 43.50 then 0.840663::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 83.50 then 0.846696::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 123.50 then 0.878149::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 123.50 then 0.924742::float\n       when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 61.50 then 0.865395::float\n       when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 124.00 then 0.90235::float\n       when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 124.00 then 0.941614::float\n       when c.product_flag = 'CC' then 0.678207::float\n       when c.product_flag = 'TBIL' then 0.287018::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('AUT') then 0.818600::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('BEL') then 0.842100::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('DEU') then 0.776100::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('ESP') then 0.931700::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('FRA') then 0.870900::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('IRL') then 0.704100::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('ITA') then 0.843200::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('NLD') then 0.773000::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('POL') then 0.926300::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('PRT') then 0.837700::float\n       when c.product_flag in ('Unarranged Overdraft') then 0.904800::float\n     else 0.800000::float\n     end\nend as LGD\n\n-- 13. Finance\n\n, s.overdraft_interest_accrued\n-- , mi.interest_rate as interest_rate_overdraft\n, li.interest_rate_loan\n, li.accrued_interest_loan\n, r.first_repayment\n, r.last_repayment\n\n, li.loan_amount \n, li.loan_name\n, li.repayment_installments\n, li.repayment_period_count\n, li.principal_repayment_interval\n\n-- 14. Maturity\n\n,  r.last_repayment::date as MaturityDate\n\n, case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 12\n       when r.last_repayment::date < last_day(date_add('month', -1, last_day(getdate()))) then 12 -- edge case, late customers payments\n       when round(datediff('month', last_day(date_add('month', -1, last_day(getdate()))), r.last_repayment::date)) = 0 then 1 -- edge case, less than 1 month till maturity\n       else round(datediff('month', last_day(date_add('month', -1, last_day(getdate()))), r.last_repayment::date)) end as Maturity\n\n-- 15. Stages \n\n-- for stage 2 reasons in https://docs.google.com/document/d/1xnfIHGd-4GTxUJ2QiZ04ImMk8yYe2EfBctrk3dW-Bjc/edit# : Section 5, only with Intensified Management\n --flag\n --and +200% PD increase as significat risk increase measure\n \n\n-- application_date\n\n, case when c.product_flag in ('Arranged Overdraft', 'RP_1') then coalesce(f.first_creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n       when c.product_flag <> 'Unarranged Overdraft' then coalesce(li.creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n       else null end as InitialPD_date\n       \n, case when coalesce(\n              coalesce(\n                coalesce(pd_sc.pd_init::float\n                           , pd_od.pd_init::float)\n                              , pd_app.pd_2::float)\n                                , pd_app_ad.pd_2::float) is null and c.product_flag = 'RP_2' then c.pd_pit_calibrated_scen_weighted::float\n       else coalesce(\n              coalesce(\n                coalesce(pd_sc.pd_init::float\n                           , pd_od.pd_init::float)\n                              , pd_app.pd_2::float)\n                                , pd_app_ad.pd_2::float) end as InitialPD\n\n, case when coalesce(\n              coalesce(\n                coalesce(pd_sc.pd_init::float\n                           , pd_od.pd_init::float)\n                              , pd_app.pd_2::float)\n                                , pd_app_ad.pd_2::float) is null and c.product_flag = 'RP_2' then 'repayment_plan_2'\n       else case when pd_sc.pd_init::float is not null then 'manually_scored_loans_sample'\n                 when pd_od.pd_init::float is not null then 'manually_scored_overdraft_sample'\n                 when pd_app.pd_2::float is not null then 'application_score_porto'\n                 when pd_app_ad.pd_2::float is not null then 'application_score_porto'\n                 end \n\n       end InitialPD_source\n\n, (1.0 - pow(1.0 - case when coalesce(\n                                coalesce(\n                                   coalesce(pd_sc.pd_init::float\n                                          , pd_od.pd_init::float)\n                                                 , pd_app.pd_2::float)\n                                                 , pd_app_ad.pd_2::float) is null and c.product_flag = 'RP_2' then c.pd_pit_calibrated_scen_weighted::float\n                            else coalesce(\n                                   coalesce(\n                                          coalesce(pd_sc.pd_init::float\n                                                 , pd_od.pd_init::float)\n                                                        , pd_app.pd_2::float)\n                                                        , pd_app_ad.pd_2::float) end, case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                                 else maturity/12 end)) as InitialPD_lifetime\n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD , maturity/12) end as PD_lifetime\n\n-- down\n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD_down , maturity/12) end as PD_lifetime_down\n\n-- neu\n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD_neu , maturity/12) end as PD_lifetime_neu\n\n-- up \n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD_up , maturity/12) end as PD_lifetime_up\n\n-- Scenarios weighted PD lifetime\n\n, 2.5*PD_lifetime_down/100 + 95*PD_lifetime_neu/100 + 2.5*PD_lifetime_up/100 as PD_lifetime_scenarios\n\n, case when fb.instrument_id is not null then true else false end as forbearance_flag\n, case when fb.instrument_id is not null then fb.forbearance_reason else 'no_forbearance' end as forbearance_reason\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 3\n       when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 3\n       when c.dpd > 90 then 3\n       when c.dpd > 30 then 2\n       when CurrentRating in ('15','16','17') then 2 \n\n       -- uneployment benefits (ever, on the reporting date or what?)\n       when sb.user_id is not null then 2\n\n       -- employers bankruptcy (where to find?)\n\n       -- active garnishment \n\n       when g.user_id is not null then 2\n\n       -- active P-accounts (in progress)\n       when pa.user_id is not null then 2\n\n       -- Credit Bureau\n\n       when schr.provider = 'SCHUFA' and schr.rating in ('N','O' ,'P') then 2 \n\n       when schr.provider = 'CRIF' and schr.rating in ('M' ,'P') then 2\n\n       -- HRC\n\n       when hrc.user_id is not null then  2\n\n       -- significant increase in PD\n\n       when InitialPD_lifetime <> 0 and PD_lifetime / InitialPD_lifetime > 3 then 2 -- add loans!\n\n       when fly.instrument_id is not null then 2 \n\n       -- Other portfolio - Stage_1 \n\n       else 1\n       end Stage\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 3\n       when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 3\n       when c.dpd > 90 then 3\n       when c.dpd > 30 then 2\n       when CurrentRating in ('15','16','17') then 2 \n\n       -- uneployment benefits (ever, on the reporting date or what?)\n       when sb.user_id is not null then 2\n\n       -- employers bankruptcy (where to find?)\n\n       -- active garnishment \n\n       when g.user_id is not null then 2\n\n       -- active P-accounts (in progress)\n       when pa.user_id is not null then 2\n\n       -- Credit Bureau\n\n       when schr.provider = 'SCHUFA' and schr.rating in ('N','O' ,'P') then 2 \n\n       when schr.provider = 'CRIF' and schr.rating in ('M' ,'P') then 2\n\n       -- HRC\n\n       when hrc.user_id is not null then  2\n\n       -- significant increase in PD\n\n       when InitialPD_lifetime <> 0 and PD_lifetime_scenarios / InitialPD_lifetime > 3 then 2 -- add loans!\n\n       when fly.instrument_id is not null then 2 \n\n       -- Other portfolio - Stage_1 \n\n       else 1\n       end Stage_scenarios \n\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 'default_via_dunning_insolvency'\n       when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 'default_via_fbe'\n       when c.dpd > 90 then 'default_via_dpd'\n       \n       when c.dpd > 30 then 'dpd_30+'\n\n       when CurrentRating in ('15','16','17') then 'rating_15_16_17'\n       \n\n        -- uneployment benefits (ever, on the reporting date or what?)\n       when sb.user_id is not null then 'unemployment_or_other_benefits'\n       -- employers bankruptcy ?\n\n       -- active garnishment\n\n       when g.user_id is not null then 'Garmishment_cancellation'\n       -- active P-accounts\n\n       when pa.user_id is not null then 'P_account'\n\n       -- Credit Bureau\n\n       when schr.provider = 'SCHUFA' and schr.rating in ('N','O' ,'P') then 'SCHUFA_NOP'\n\n       when schr.provider = 'CRIF' and schr.rating in ('M' ,'P') then 'CRIF_MP'\n\n       -- HRC\n\n       when hrc.user_id is not null then  'HRC'\n\n       -- significant increase in PD\n       when InitialPD_lifetime <> 0  and PD_lifetime_scenarios / InitialPD_lifetime > 3 then '200+%_pd_increase' -- double check \n\n       when fly.instrument_id is not null then 'Forbearance'\n\n       else 'Stage_1'\n       end Stage_scenarios_description \n\n\n-- 16. SLLP \n\n, LGD * case when CurrentRating in ('18', '19') then OnBalance_EAD else 0 end SLLP\n\n-- per product\n\n, LGD * case when CurrentRating in ('18', '19') then c.OD_exposures else 0 end SLLP_OD\n, LGD * case when CurrentRating in ('18', '19') then CC_exposures else 0 end SLLP_CC\n, LGD * case when CurrentRating in ('18', '19') then TBIL_exposures else 0 end SLLP_TBIL\n, LGD * case when CurrentRating in ('18', '19') then RP_2_exposures else 0 end SLLP_RP_2\n\n\n-- 17. GLLP\n\n, LGD * PD * case when CurrentRating not in ('18', '19') and c.product_flag in ('RP_1'\n                                                                                , 'Arranged Overdraft'\n                                                                                , 'Unarranged Overdraft') then  (OnBalance_EAD + OffBalance_EAD)\n                        else 0 end GLLP_OD\n\n, LGD * (1.0 - pow((1.0 - PD) , case when  maturity > 12 and stage  = 2 then maturity/12\n                                 when  maturity <= 12  then maturity/12\n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then RP_2_exposures \n                                                     else 0 end as GLLP_RP_2\n\n, LGD * (1.0 - pow((1.0 - PD) , case when maturity > 12 and stage  = 2 then maturity/12\n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then CC_exposures \n                                                     else 0 end as GLLP_CC\n\n, LGD * (1.0 - pow((1.0 - PD) , case when maturity > 12 and stage  = 2 then maturity/12 \n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then TBIL_exposures\n                                            else 0 end as GLLP_TBIL\n\n-- GLLP new \n\n, LGD * (1.0 - pow((1.0 - PD) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and stage  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP\n\n-- by scenarios\n\n, LGD * PD_scen_weighted * case when CurrentRating_scen_weighted not in ('18', '19') and c.product_flag in ('RP_1'\n                                                                                , 'Arranged Overdraft'\n                                                                                , 'Unarranged Overdraft') then  (OnBalance_EAD + OffBalance_EAD)\n                        else 0 end GLLP_OD_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when  maturity > 12 and Stage_scenarios  = 2 then maturity/12\n                                 when  maturity <= 12  then maturity/12\n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then RP_2_exposures \n                                                     else 0 end as GLLP_RP_2_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when maturity > 12 and Stage_scenarios  = 2 then maturity/12\n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then CC_exposures \n                                                     else 0 end as GLLP_CC_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when maturity > 12 and Stage_scenarios  = 2 then maturity/12 \n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then TBIL_exposures\n                                            else 0 end as GLLP_TBIL_scen_weighted\n\n-- down\n\n, LGD * (1.0 - pow((1.0 - PD_down) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_down not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_down\n-- neu\n, LGD * (1.0 - pow((1.0 - PD_neu) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_neu not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_neu\n\n-- up \n\n, LGD * (1.0 - pow((1.0 - PD_up) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_up not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_up\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted::float) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_scen_weighted\n\n-- ECL split \n\n, (LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then (OnBalance_EAD)\n                                                     else 0 end) +  (LGD * case when CurrentRating in ('18', '19') then OnBalance_EAD else 0 end) as ECL_On_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then (OffBalance_EAD)\n                                                     else 0 end as ECL_Off_scen_weighted\n\n\n\n-- Fields for Reg. Reporting \n\n, case when c.is_default = 1 then 'J' else 'N' end as \"AUSFL\"\n\n, CASE\n    WHEN c.is_default = 1 THEN\n        GREATEST(\n            COALESCE(c.credit_creation_date, DATE '0001-01-01'),\n            COALESCE(\n                CASE \n                    WHEN d.user_id IS NOT NULL THEN d.default_date\n                    WHEN ins.user_id IS NOT NULL THEN ins.internal_insolvency_date\n                    WHEN sch.user_id IS NOT NULL THEN c.schufa_rating_date\n                    WHEN c.dpd > 90 THEN date_add('day', 90, c.start_in_arrears)\n                END,\n                DATE '0001-01-01'\n            )\n        )\n    ELSE NULL\nEND AS \"DXAUD\"\n\n, case when sch.user_id is not null then 'J'  -- debtor applies for insolvency\n       when ins.user_id is not null then 'I'  -- institution aplies for debtor insolvency\n       when d.user_id is not null then 'K' -- TBD with Anja, here - OD cancellation & forbearance (should be here?)\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 'K'\n       when c.dpd > 90 then 'C'\n       when c.PD > 0.04 then 'B'\n       else 'A' end \"RISGR\"\n       \n\n-- RISGR\n\n, CASE\n      WHEN d.user_id IS NOT NULL THEN \n          COALESCE(GREATEST(c.credit_creation_date, d.default_date), d.default_date)\n      WHEN ins.user_id IS NOT NULL THEN \n          COALESCE(GREATEST(c.credit_creation_date, ins.internal_insolvency_date), ins.internal_insolvency_date)\n      WHEN sch.user_id IS NOT NULL THEN \n          COALESCE(GREATEST(c.credit_creation_date, c.schufa_rating_date), c.schufa_rating_date)\n      WHEN df.user_id IS NOT NULL\n           AND c.reportdate::date BETWEEN df.default_during_forbearance_date::date \n                                     AND date_add('month', 12, df.default_during_forbearance_date::date)\n      THEN COALESCE(GREATEST(c.credit_creation_date, df.default_during_forbearance_date::date), df.default_during_forbearance_date::date)\n      WHEN c.dpd > 90 THEN \n          COALESCE(GREATEST(c.credit_creation_date, date_add('day', 90, c.start_in_arrears)), date_add('day', 90, c.start_in_arrears))\n  END AS \"DXNPE\"\n\n, case when is_default = 1 and max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 \n            then max(fb.credit_creation_date) over(partition by c.user_id) end as \"DXFBE\"\n\n, case when fb.instrument_id is not null then 3290 end as \"FBSFI\"\n\n, case when Stage_scenarios = 1 then 5020 \n       when Stage_scenarios = 2 then 5021 \n       when Stage_scenarios = 3 then 5022 end \"IMSFI\"\n\n, case when is_default = 1 then 3292\n       when is_default = 0 \n            and ld.last_default_date::date between date_add('month', -12, c.reportdate::date) and c.reportdate::date\n            then 3294\n       else 3293 end \"PFSFI\"\n\n, case when is_default = 1 and coalesce(c.dpd,0) <= 90 then 3296\n       when coalesce(c.dpd,0) <= 30 then 3295\n       when coalesce(c.dpd,0) <= 90 then 5032 \n       when coalesce(c.dpd,0) <= 180 then 2792\n       when coalesce(c.dpd,0) <= 360 then 2785\n       when coalesce(c.dpd,0) <= 720 then 3280\n       when coalesce(c.dpd,0) <= 1800 then 3282\n       when coalesce(c.dpd,0) <= 2520 then 6934\n       when coalesce(c.dpd,0) > 2520 then 6935\n       end as \"TPDFI\"\n\nfrom {{ ref('bp_retail_provisions_stg_v5_pre_updated_v2') }} c \nleft join {{ ref('bp_portfolio_balance_aud_m_v2') }} o on o.encoded_key = c.instrument_id and c.reportdate::date = o.reporting_date::date\nleft join {{ ref('bp_overdraft_split_m_v2') }}  mll on mll.encoded_key = c.instrument_id and c.reportdate::date = mll.reporting_date::date\nleft join {{ ref('bp_monitoring_pd_supermodel_v2_m_v2') }} m on m.user_id = c.user_id and m.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_application_pd_supermodel_m_v2') }} pd_app on pd_app.encoded_key = c.instrument_id \n                                                                and  pd_app.reporting_date::date = c.reportdate::date\n                                                                and c.product_flag not in ('Unarranged Overdraft', 'RP_2')\nleft join {{ ref('bp_application_pd_supermodel_m_ad_v2') }} pd_app_ad on pd_app_ad.encoded_key = c.instrument_id \n                                                                and  pd_app_ad.reporting_date::date = c.reportdate::date\n                                                                and c.product_flag not in ('Unarranged Overdraft', 'RP_2')\nleft join {{ ref('bp_default_dunning_m_v2') }} d on d.user_id = c.user_id  and d.reporting_date::date = c.reportdate::date   \nleft join {{ ref('bp_default_internal_insolvency_v2_m_v2') }} ins on ins.user_id = c.user_id and ins.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_default_credit_bureau_insolvency_v3_m_v2') }} sch on sch.user_id = c.user_id and sch.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_repayment_plan_ph1_m_v2') }} rp on rp.user_id = c.user_id and rp.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_credit_bureau_rating_m_v2') }} schr on schr.user_id = c.user_id and schr.reporting_date::date = c.reportdate::date\nleft join first_enabled_date f on f.encoded_key = c.instrument_id and f.user_id = c.user_id and f.first_creation_date::date <= last_day(date_add('month', -1, last_day(getdate())))\nleft join credit_risk_playground.porto_pit_app_users pd_sc on pd_sc.instrument_id = c.instrument_id \n                                                              and c.product_flag in ('CC', 'TBIL')\n                                                              and pd_sc.product_flag = c.product_flag\nleft join credit_risk_playground.porto_pit_app_users pd_od on pd_od.user_id = c.user_id \n                                                               and pd_od.product_flag in ('Arranged Overdraft', 'RP_1')\n                                                               and c.product_flag in ('Arranged Overdraft', 'RP_1')\n                                                              -- and pd_od.product_flag = c.product_flag\n                                                               and pd_od.credit_creation_date::date = coalesce(f.first_creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n                                                               \nleft join repayment r on r.parent_account_key = c.instrument_id\nleft join  {{ source('dbt', 'zrh_users') }} z on z.user_id = c.user_id \nleft join {{ ref('bp_loan_contract_information_m_v2') }} li on li.encoded_key = c.instrument_id and li.reporting_date::date = c.reportdate::date\nleft join {{ source('public', 'mmbr_savings_account') }} s on s.encoded_key = c.instrument_id and s.account_type = 'CURRENT_ACCOUNT'\nleft join {{ ref('bp_garnishment_m_v2') }} g on g.user_id = c.user_id \n                                             and c.reportdate::date = g.reporting_date::date  \nleft join {{ ref('bp_social_benefits_v2_m_v2') }} sb on sb.user_id = c.user_id and sb.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_p_accounts_v2') }} pa on pa.user_id = c.user_id and last_day(date_add('month', -1, last_day(getdate()))) between pa.rev_timestamp and pa.end_timestamp\nleft join {{ ref('bp_hrc_m_v2') }} hrc on c.user_id = hrc.user_id and c.reportdate::date = hrc.reporting_date::date\nleft join forbearance_last_year fly on fly.instrument_id = c.instrument_id \nleft join {{ ref('bp_forbearance_m_v2_v2') }} fb on fb.instrument_id = c.instrument_id and c.reportdate::date = fb.reportdate::date\nleft join latest_default_during_forbearance df on df.user_id = c.user_id\nleft join default_last_12_months ld on ld.user_id = c.user_id\nwhere c.reportdate::date = last_day(date_add('month', -1, last_day(getdate())))\norder by 1\n)\n\nselect * \n, getdate() as etl_updated\n, coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom total \n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_forbearance_m_v2_v2", "package": null, "version": null}, {"name": "bp_retail_provisions_stg_v5_pre_updated_v2", "package": null, "version": null}, {"name": "bp_forbearance_m_v2_v2", "package": null, "version": null}, {"name": "bp_retail_provisions_stg_v5_pre_updated_v2", "package": null, "version": null}, {"name": "bp_portfolio_balance_aud_m_v2", "package": null, "version": null}, {"name": "bp_overdraft_split_m_v2", "package": null, "version": null}, {"name": "bp_monitoring_pd_supermodel_v2_m_v2", "package": null, "version": null}, {"name": "bp_application_pd_supermodel_m_v2", "package": null, "version": null}, {"name": "bp_application_pd_supermodel_m_ad_v2", "package": null, "version": null}, {"name": "bp_default_dunning_m_v2", "package": null, "version": null}, {"name": "bp_default_internal_insolvency_v2_m_v2", "package": null, "version": null}, {"name": "bp_default_credit_bureau_insolvency_v3_m_v2", "package": null, "version": null}, {"name": "bp_repayment_plan_ph1_m_v2", "package": null, "version": null}, {"name": "bp_credit_bureau_rating_m_v2", "package": null, "version": null}, {"name": "bp_loan_contract_information_m_v2", "package": null, "version": null}, {"name": "bp_garnishment_m_v2", "package": null, "version": null}, {"name": "bp_social_benefits_v2_m_v2", "package": null, "version": null}, {"name": "bp_p_accounts_v2", "package": null, "version": null}, {"name": "bp_hrc_m_v2", "package": null, "version": null}, {"name": "bp_forbearance_m_v2_v2", "package": null, "version": null}], "sources": [["public", "mmbr_repayment"], ["dbt", "zrh_users"], ["public", "mmbr_savings_account"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.public.mmbr_repayment", "source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.public.mmbr_savings_account", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_forbearance_m_v2_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "model.credit_risk_playground.bp_default_dunning_m_v2", "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_loan_contract_information_m_v2", "model.credit_risk_playground.bp_garnishment_m_v2", "model.credit_risk_playground.bp_social_benefits_v2_m_v2", "model.credit_risk_playground.bp_p_accounts_v2", "model.credit_risk_playground.bp_hrc_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_retail_provisions_stg_v5_v4_updated_v2_test", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_retail_provisions_stg_v5_v4_updated_v2_test.sql", "original_file_path": "models/Provisions/v4/bp_retail_provisions_stg_v5_v4_updated_v2_test.sql", "unique_id": "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_retail_provisions_stg_v5_v4_updated_v2_test"], "alias": "bp_retail_provisions_stg_v5_v4_updated_v2_test", "checksum": {"name": "sha256", "checksum": "b027ac2e966d616a9e00d2ac13062576729f33877ce528988e2aab4873daf4bb"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "instrument_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "instrument_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1762180355.2062259, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_retail_provisions_stg_v5_v4_updated_v2_test\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='instrument_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_retail_provisions_stg_v5_v4_updated_v2 (first time)\n-- dbt run --select bp_retail_provisions_stg_v5_v4_updated_v2 (other runs)\n\nwith \n\nfirst_enabled_date as (\nselect user_id \n, encoded_key\n, min(rev_timestamp) as first_creation_date\n, max(rev_timestamp) as last_creation_date\nfrom {{ ref('bp_overdraft_limit_periods_v2') }}\nwhere rev_timestamp <= date_add('minute', -1, date_add('day', 1, last_day(date_add('month', -1, last_day(getdate())))) ) and amount_cents > 0 \ngroup by \nuser_id \n, encoded_key\n)\n\n, repayment as (\nselect parent_account_key\n, min(due_date) as first_repayment\n, max(due_date) as last_repayment\nfrom  {{ source('public', 'mmbr_repayment') }}  \ngroup by 1\n)\n\n, forbearance_last_year as (\nselect distinct \ninstrument_id\nfrom {{ ref('bp_forbearance_m_v2_v2') }} f \nwhere f.credit_creation_date::date between date_add('month', -12\n                                                    , last_day(date_add('month', -1, last_day(getdate())))\n                                                    ) and last_day(date_add('month', -1, last_day(getdate())))\n      and f.reportdate = last_day(date_add('month', -1, last_day(getdate())))\n\n)\n\n, latest_default_during_forbearance as (\nselect \nc.user_id \n--, c.instrument_id \n, max(c.reportdate::date) as default_during_forbearance_date\nfrom (\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated   -- from May 2024\n   where reportdate::date <= '2025-04-30'::date  \n\n   union all \n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_ik  \n   where reportdate::date > '2025-04-30'::date  AND reportdate::date <=  '2025-05-31'::date\n\n   union all \n\n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2\n   where reportdate::date > '2025-05-31'::date \n) c --{{ ref('bp_retail_provisions_stg_v5_pre_updated_v2') }} c \nleft join {{ ref('bp_forbearance_m_v2_v2') }} f on c.instrument_id = f.instrument_id and c.reportdate::date = f.reportdate::date\nwhere (c.is_default = 1) and (f.instrument_id is not null)\ngroup by 1\n)\n\n, default_last_12_months as (\nselect \nc.user_id \n--, c.instrument_id \n, max(c.reportdate::date) as last_default_date\nfrom (\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated   -- from May 2024\n   where reportdate::date <= '2025-04-30'::date  \n\n   union all \n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_ik  \n   where reportdate::date > '2025-04-30'::date  AND reportdate::date <=  '2025-05-31'::date\n\n   union all \n\n\n   select \n   instrument_id \n   , user_id\n   , reportdate \n   , is_default\n   from credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2\n   where reportdate::date > '2025-05-31'::date \n) c \nwhere (c.is_default = 1) \ngroup by 1\n)\n\n, total as (\nselect distinct\n\n-- 1. Customers base\n\nc.user_id \n, c.Instrument_ID\n, c.Country\n, c.LegalEntity\n, c.IS_IFRS -- \"No\" for TSY bonds and \"Yes\" for other instruments\n, c.ReportDate\n, c.CalcDate -- for retail same as eom, for mortgage 1-month lag\n, c.Script_calculation_date\n-- 2. Product flag\n-- product\n\n, c.product_flag\n\n, c.Instrument_Type\n\n, c.Instrument \n\n-- 3. Creation date \n\n, c.credit_creation_date\n\n-- 4. DPD\n\n, c.start_in_arrears\n, c.dpd\n\n-- 5. Default\n\n, c.insolvency \n, c.dunning \n, c.schufa_insolvency\n, c.rep_plan_user\n\n, case when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1\n       else c.is_default end as is_default\n\n\n-- 6. Credit Bureau flags\n\n, c.schufa_rating \n, c.provider\n, c.schufa_rating_date\n\n-- 7. Limit\n\n, c.\"Limit\"\n\n, c.last_limit_eur\n\n, c.last_limit_date\n\n-- 8. Exposures\n\n, c.TBIL_exposures\n\n, c.CC_exposures\n\n, c.RP_2_exposures\n\n, c.OD_exposures\n-- 9. PD\n\n-- Calibration segment\n\n-- ! Important ! In Porto if customer eligible for different calibration segment, we choose the one with the max PD\n\n, c.porto_calibration_segment\n\n, c.pit_calibration_segment  \n\n-- Available Porto PD\n\n, c.internal_pd\n\n,  c.logit\n\n, c.pd_pit_calibrated\n\n-- MEV scenarios\n\n-- down \n\n, c.pd_pit_calibrated_down\n\n-- neu\n\n, c.pd_pit_calibrated_neu\n\n-- up\n\n, c.pd_pit_calibrated_up\n\n, c.pd_pit_calibrated_scen_weighted\n\n-- Calibration PD\n\n,  c.rating_class_pit_calibrated\n\n\n -- down \n\n,  c.rating_class_pit_calibrated_down\n\n-- neu \n\n,  c.rating_class_pit_calibrated_neu\n\n,  c.rating_class_pit_calibrated_up\n\n\n,  c.rating_class_pit_calibrated_scen_weighted\n\n\n-- Final PD and rating (PIT)\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD end as PD\n\n-- PD scenarios \n\n-- down\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_down end as PD_down\n\n-- neu\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_neu end as PD_neu\n\n-- up \n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_up end as PD_up\n\n\n, case when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 1 \n       else c.PD_scen_weighted end as PD_scen_weighted\n\n\n-- Final Rating\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19' \n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated as varchar)\n               end \n       when c.pd_pit_calibrated is not null then cast(c.rating_class_pit_calibrated as varchar)\n       when c.pd_pit_calibrated is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating\n\n-- Final Rating scenarios \n\n-- down\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\nwhen (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_down as varchar)\n               end \n         when c.pd_pit_calibrated_down is not null then cast(c.rating_class_pit_calibrated_down as varchar)\n         when c.pd_pit_calibrated_down is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_down\n\n-- neu\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_neu as varchar)\n               end \n         when c.pd_pit_calibrated_neu is not null then cast(c.rating_class_pit_calibrated_neu as varchar)\n         when c.pd_pit_calibrated_neu is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_neu\n\n\n-- up \n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_up as varchar)\n               end \n         when c.pd_pit_calibrated_up is not null then cast(c.rating_class_pit_calibrated_up as varchar)\n         when c.pd_pit_calibrated_up is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_up\n\n-- scneraios-weighted \n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then '19'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then '19'\n       when c.dpd > 90 then '18'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then '18'\n                  when c.dpd > 60 then  '17'\n                  when c.dpd > 30 then '16'\n                  when c.dpd > 0 then '15'\n                  else cast(c.rating_class_pit_calibrated_scen_weighted as varchar)\n               end \n         when c.pd_pit_calibrated_scen_weighted is not null then cast(c.rating_class_pit_calibrated_scen_weighted as varchar)\n         when c.pd_pit_calibrated_scen_weighted is null then \n            case when c.dpd > 90 then '18'\n                 when c.dpd > 60 then '17'\n                 when c.dpd > 30 then '16'\n                 when c.dpd > 0 then '15'\n                 else \n                     case when schr.rating = 'A' then '7'\n                          when schr.rating = 'B' then '8'\n                          when schr.rating = 'C' then '9'\n                          when schr.rating = 'D' then '10'\n                          when schr.rating = 'E' then '11'\n                          when schr.rating = 'F' then '12'\n                          when schr.rating = 'G' then '13'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then '14'\n                          when schr.rating = 'N' then '15'\n                          when schr.rating = 'O' then '16'\n                          when schr.rating = 'P' then '17'\n                          else 'unrated' -- 'Unrated'\n                          end\n                    end\n       else 'unrated' end as CurrentRating_scen_weighted\n\n-- Final Rating date\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then last_day(date_add('month', -1, last_day(getdate())))\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then last_day(date_add('month', -1, last_day(getdate())))\n       when c.dpd > 90 then last_day(date_add('month', -1, last_day(getdate())))\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then last_day(date_add('month', -1, last_day(getdate())))\n                  when c.dpd > 60 then  last_day(date_add('month', -1, last_day(getdate())))\n                  when c.dpd > 30 then last_day(date_add('month', -1, last_day(getdate())))\n                  when c.dpd > 0 then last_day(date_add('month', -1, last_day(getdate())))\n                  --when c.rating_class_pit_calibrated < 14 then m.calculated_at::date \n                  else last_day(date_add('month', -1, last_day(getdate())))\n               end \n       when c.pd_pit_calibrated is not null then m.calculated_at::date \n       when c.pd_pit_calibrated is null then \n            case when c.dpd > 90 then last_day(date_add('month', -1, last_day(getdate())))\n                 when c.dpd > 60 then last_day(date_add('month', -1, last_day(getdate())))\n                 when c.dpd > 30 then last_day(date_add('month', -1, last_day(getdate())))\n                 when c.dpd > 0 then last_day(date_add('month', -1, last_day(getdate())))\n                 else \n                     case when schr.rating = 'A' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'B' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'C' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'D' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'E' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'F' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'G' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'N' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'O' then last_day(date_add('month', -1, last_day(getdate())))\n                          when schr.rating = 'P' then last_day(date_add('month', -1, last_day(getdate())))\n                          else last_day(date_add('month', -1, last_day(getdate())))\n                          end\n                    end\n       else last_day(date_add('month', -1, last_day(getdate())))\n       end as CurrentRating_date\n\n-- Final rating source\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 'default_flag'\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 'default_flag_fbe'\n       when c.dpd > 90 then 'default_flag'\n       when max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 then\n              case when c.dpd > 90 then 'default_flag'\n                  when c.dpd > 60 then  'dpd 61-90'\n                  when c.dpd > 30 then 'dpd 31-60'\n                  when c.dpd > 0 then 'dpd 1-30'\n                  else 'repayment_plan_2'\n               end \n         when c.pd_pit_calibrated_scen_weighted is not null then 'internal_rating_model'\n         when c.pd_pit_calibrated_scen_weighted is null then \n            case when c.dpd > 90 then 'default_flag'\n                 when c.dpd > 60 then 'dpd 61-90'\n                 when c.dpd > 30 then 'dpd 31-60'\n                 when c.dpd > 0 then 'dpd 1-30'\n                 else \n                     case when schr.rating = 'A' then 'CB'\n                          when schr.rating = 'B' then 'CB'\n                          when schr.rating = 'C' then 'CB'\n                          when schr.rating = 'D' then 'CB'\n                          when schr.rating = 'E' then 'CB'\n                          when schr.rating = 'F' then 'CB'\n                          when schr.rating = 'G' then 'CB'\n                          when schr.rating in ('H','I','K','L', 'M','UNKNOWN') then 'CB'\n                          when schr.rating = 'N' then 'CB'\n                          when schr.rating = 'O' then 'CB'\n                          when schr.rating = 'P' then 'CB'\n                          else 'no_rating'\n                          end\n                    end\n       else 'no_rating' end as CurrentRating_source\n\n -- 10. CCF\n\n, case when coalesce(c.\"Limit\"::numeric,0) = 0 then 0\n            when coalesce(c.OD_exposures::numeric,0) = 0 then 0\n            else round(coalesce(c.OD_exposures::numeric,0)/coalesce(c.\"Limit\"::numeric,0), 2) \n        end as utilization_pct\n, case\n            when coalesce(c.OD_exposures,0)  > coalesce(c.\"Limit\",0) then ' > 80%'\n            when utilization_pct < 0.2 then '  <=20%'\n            when utilization_pct between 0.2 and 0.4 then ' 20% to 40%'\n            when utilization_pct between 0.4 and 0.6 then ' 40% to 60%'\n            when utilization_pct between 0.6 and 0.8 then ' 60% to 80%'\n            when utilization_pct >= 0.8 then ' > 80%' \n        end as usage\n\n, decode(usage,\n            '  <=20%', 0.3644,\n            ' 20% to 40%', 0.6360,\n            ' 40% to 60%', 0.7221,\n            ' 60% to 80%', 0.8089,\n            ' > 80%', 1) as ccf\n\n, case when CurrentRating not in ('18', '19') \n            and c.product_flag in ('RP_1', 'Arranged Overdraft') then  \n\n                case when coalesce(c.\"Limit\",0) <= coalesce(c.OD_exposures,0) then 0\n                     when usage not in (' > 80%') then (coalesce(c.\"Limit\",0) -  coalesce(c.OD_exposures,0)) \n                     else 0\n                     end \n\n        else 0 end off_balance_exposure\n\n-- 11. EAD\n\n, case when CurrentRating not in ('18', '19') \n            and c.product_flag in ('RP_1', 'Arranged Overdraft') then  \n                case when coalesce(c.\"Limit\",0) <= coalesce(c.OD_exposures,0) then 0\n                     when usage not in (' > 80%') then ((coalesce(c.\"Limit\",0) -  coalesce(c.OD_exposures,0)) * ccf )\n                     else 0\n                     end \n        else 0 end OffBalance_EAD -- only for off-balance exposures by finance request\n\n, coalesce(o.balance,0) as OnBalance_EAD\n\n, case when OffBalance_EAD <> 0 then 1 else 0 end as IsOffBalance\n-- 12. LGD \n\n, CASE\n    WHEN c.is_default = 1 \n         AND GREATEST(\n                COALESCE(c.credit_creation_date, DATE '0001-01-01'),\n                COALESCE(\n                    CASE \n                        WHEN d.user_id IS NOT NULL THEN d.default_date\n                        WHEN ins.user_id IS NOT NULL THEN ins.internal_insolvency_date\n                        WHEN sch.user_id IS NOT NULL THEN c.schufa_rating_date\n                        WHEN c.dpd > 90 THEN date_add('day', 90, c.start_in_arrears)\n                    END,\n                    DATE '0001-01-01'\n                )\n             ) < date_add('year', -3, c.reportdate)\n    THEN 1.000000::float\n  else\n     case \n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 500.22 then 0.461767::float\n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 2751.38 then 0.521929::float\n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 5992.30 then 0.552278::float\n       when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') and sum(case when c.product_flag in ('Arranged Overdraft', 'RP_1', 'RP_2') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 5992.30 then 0.71094::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 102.50 then 0.287018::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 240.50 then 0.368662::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 526.00 then 0.443474::float\n       when c.product_flag in ('TBIL') and country = 'DEU' and sum(case when c.product_flag in ('TBIL') and country = 'DEU' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 526.00 then 0.520718::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 43.50 then 0.840663::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 83.50 then 0.846696::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 123.50 then 0.878149::float\n       when c.product_flag in ('TBIL') and country = 'FRA' and sum(case when c.product_flag in ('TBIL') and country = 'FRA' then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 123.50 then 0.924742::float\n       when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 61.50 then 0.865395::float\n       when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) < 124.00 then 0.90235::float\n       when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') and sum(case when c.product_flag in ('TBIL') and country in ('ESP', 'ITA') then coalesce(o.balance,0) else 0 end) over(partition by c.user_id) >= 124.00 then 0.941614::float\n       when c.product_flag = 'CC' then 0.678207::float\n       when c.product_flag = 'TBIL' then 0.287018::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('AUT') then 0.818600::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('BEL') then 0.842100::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('DEU') then 0.776100::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('ESP') then 0.931700::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('FRA') then 0.870900::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('IRL') then 0.704100::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('ITA') then 0.843200::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('NLD') then 0.773000::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('POL') then 0.926300::float\n       when c.product_flag in ('Unarranged Overdraft') and country in ('PRT') then 0.837700::float\n       when c.product_flag in ('Unarranged Overdraft') then 0.904800::float\n     else 0.800000::float\n     end\nend as LGD\n\n-- 13. Finance\n\n, s.overdraft_interest_accrued\n-- , mi.interest_rate as interest_rate_overdraft\n, li.interest_rate_loan\n, li.accrued_interest_loan\n, r.first_repayment\n, r.last_repayment\n\n, li.loan_amount \n, li.loan_name\n, li.repayment_installments\n, li.repayment_period_count\n, li.principal_repayment_interval\n\n-- 14. Maturity\n\n,  r.last_repayment::date as MaturityDate\n\n, case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 12\n       when r.last_repayment::date < last_day(date_add('month', -1, last_day(getdate()))) then 12 -- edge case, late customers payments\n       when round(datediff('month', last_day(date_add('month', -1, last_day(getdate()))), r.last_repayment::date)) = 0 then 1 -- edge case, less than 1 month till maturity\n       else round(datediff('month', last_day(date_add('month', -1, last_day(getdate()))), r.last_repayment::date)) end as Maturity\n\n-- 15. Stages \n\n-- for stage 2 reasons in https://docs.google.com/document/d/1xnfIHGd-4GTxUJ2QiZ04ImMk8yYe2EfBctrk3dW-Bjc/edit# : Section 5, only with Intensified Management\n --flag\n --and +200% PD increase as significat risk increase measure\n \n\n-- application_date\n\n, case when c.product_flag in ('Arranged Overdraft', 'RP_1') then coalesce(f.first_creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n       when c.product_flag <> 'Unarranged Overdraft' then coalesce(li.creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n       else null end as InitialPD_date\n       \n, case when coalesce(\n              coalesce(\n                coalesce(pd_sc.pd_init::float\n                           , pd_od.pd_init::float)\n                              , pd_app.pd_2::float)\n                                , pd_app_ad.pd_2::float) is null and c.product_flag = 'RP_2' then c.pd_pit_calibrated_scen_weighted::float\n       else coalesce(\n              coalesce(\n                coalesce(pd_sc.pd_init::float\n                           , pd_od.pd_init::float)\n                              , pd_app.pd_2::float)\n                                , pd_app_ad.pd_2::float) end as InitialPD\n\n, case when coalesce(\n              coalesce(\n                coalesce(pd_sc.pd_init::float\n                           , pd_od.pd_init::float)\n                              , pd_app.pd_2::float)\n                                , pd_app_ad.pd_2::float) is null and c.product_flag = 'RP_2' then 'repayment_plan_2'\n       else case when pd_sc.pd_init::float is not null then 'manually_scored_loans_sample'\n                 when pd_od.pd_init::float is not null then 'manually_scored_overdraft_sample'\n                 when pd_app.pd_2::float is not null then 'application_score_porto'\n                 when pd_app_ad.pd_2::float is not null then 'application_score_porto'\n                 end \n\n       end InitialPD_source\n\n, (1.0 - pow(1.0 - case when coalesce(\n                                coalesce(\n                                   coalesce(pd_sc.pd_init::float\n                                          , pd_od.pd_init::float)\n                                                 , pd_app.pd_2::float)\n                                                 , pd_app_ad.pd_2::float) is null and c.product_flag = 'RP_2' then c.pd_pit_calibrated_scen_weighted::float\n                            else coalesce(\n                                   coalesce(\n                                          coalesce(pd_sc.pd_init::float\n                                                 , pd_od.pd_init::float)\n                                                        , pd_app.pd_2::float)\n                                                        , pd_app_ad.pd_2::float) end, case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                                 else maturity/12 end)) as InitialPD_lifetime\n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD , maturity/12) end as PD_lifetime\n\n-- down\n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD_down , maturity/12) end as PD_lifetime_down\n\n-- neu\n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD_neu , maturity/12) end as PD_lifetime_neu\n\n-- up \n\n, case when CurrentRating in ('18', '19') then 1 \n       else  1.0 - pow(1.0 - PD_up , maturity/12) end as PD_lifetime_up\n\n-- Scenarios weighted PD lifetime\n\n, 2.5*PD_lifetime_down/100 + 95*PD_lifetime_neu/100 + 2.5*PD_lifetime_up/100 as PD_lifetime_scenarios\n\n, case when fb.instrument_id is not null then true else false end as forbearance_flag\n, case when fb.instrument_id is not null then fb.forbearance_reason else 'no_forbearance' end as forbearance_reason\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 3\n       when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 3\n       when c.dpd > 90 then 3\n       when c.dpd > 30 then 2\n       when CurrentRating in ('15','16','17') then 2 \n\n       -- uneployment benefits (ever, on the reporting date or what?)\n       when sb.user_id is not null then 2\n\n       -- employers bankruptcy (where to find?)\n\n       -- active garnishment \n\n       when g.user_id is not null then 2\n\n       -- active P-accounts (in progress)\n       when pa.user_id is not null then 2\n\n       -- Credit Bureau\n\n       when schr.provider = 'SCHUFA' and schr.rating in ('N','O' ,'P') then 2 \n\n       when schr.provider = 'CRIF' and schr.rating in ('M' ,'P') then 2\n\n       -- HRC\n\n       when hrc.user_id is not null then  2\n\n       -- significant increase in PD\n\n       when InitialPD_lifetime <> 0 and PD_lifetime / InitialPD_lifetime > 3 then 2 -- add loans!\n\n       when fly.instrument_id is not null then 2 \n\n       -- Other portfolio - Stage_1 \n\n       else 1\n       end Stage\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 3\n       when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 3\n       when c.dpd > 90 then 3\n       when c.dpd > 30 then 2\n       when CurrentRating in ('15','16','17') then 2 \n\n       -- uneployment benefits (ever, on the reporting date or what?)\n       when sb.user_id is not null then 2\n\n       -- employers bankruptcy (where to find?)\n\n       -- active garnishment \n\n       when g.user_id is not null then 2\n\n       -- active P-accounts (in progress)\n       when pa.user_id is not null then 2\n\n       -- Credit Bureau\n\n       when schr.provider = 'SCHUFA' and schr.rating in ('N','O' ,'P') then 2 \n\n       when schr.provider = 'CRIF' and schr.rating in ('M' ,'P') then 2\n\n       -- HRC\n\n       when hrc.user_id is not null then  2\n\n       -- significant increase in PD\n\n       when InitialPD_lifetime <> 0 and PD_lifetime_scenarios / InitialPD_lifetime > 3 then 2 -- add loans!\n\n       when fly.instrument_id is not null then 2 \n\n       -- Other portfolio - Stage_1 \n\n       else 1\n       end Stage_scenarios \n\n\n, case when d.user_id is not null or ins.user_id is not null or sch.user_id is not null then 'default_via_dunning_insolvency'\n       when (df.user_id is not null) \n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 'default_via_fbe'\n       when c.dpd > 90 then 'default_via_dpd'\n       \n       when c.dpd > 30 then 'dpd_30+'\n\n       when CurrentRating in ('15','16','17') then 'rating_15_16_17'\n       \n\n        -- uneployment benefits (ever, on the reporting date or what?)\n       when sb.user_id is not null then 'unemployment_or_other_benefits'\n       -- employers bankruptcy ?\n\n       -- active garnishment\n\n       when g.user_id is not null then 'Garmishment_cancellation'\n       -- active P-accounts\n\n       when pa.user_id is not null then 'P_account'\n\n       -- Credit Bureau\n\n       when schr.provider = 'SCHUFA' and schr.rating in ('N','O' ,'P') then 'SCHUFA_NOP'\n\n       when schr.provider = 'CRIF' and schr.rating in ('M' ,'P') then 'CRIF_MP'\n\n       -- HRC\n\n       when hrc.user_id is not null then  'HRC'\n\n       -- significant increase in PD\n       when InitialPD_lifetime <> 0  and PD_lifetime_scenarios / InitialPD_lifetime > 3 then '200+%_pd_increase' -- double check \n\n       when fly.instrument_id is not null then 'Forbearance'\n\n       else 'Stage_1'\n       end Stage_scenarios_description \n\n\n-- 16. SLLP \n\n, LGD * case when CurrentRating in ('18', '19') then OnBalance_EAD else 0 end SLLP\n\n-- per product\n\n, LGD * case when CurrentRating in ('18', '19') then c.OD_exposures else 0 end SLLP_OD\n, LGD * case when CurrentRating in ('18', '19') then CC_exposures else 0 end SLLP_CC\n, LGD * case when CurrentRating in ('18', '19') then TBIL_exposures else 0 end SLLP_TBIL\n, LGD * case when CurrentRating in ('18', '19') then RP_2_exposures else 0 end SLLP_RP_2\n\n\n-- 17. GLLP\n\n, LGD * PD * case when CurrentRating not in ('18', '19') and c.product_flag in ('RP_1'\n                                                                                , 'Arranged Overdraft'\n                                                                                , 'Unarranged Overdraft') then  (OnBalance_EAD + OffBalance_EAD)\n                        else 0 end GLLP_OD\n\n, LGD * (1.0 - pow((1.0 - PD) , case when  maturity > 12 and stage  = 2 then maturity/12\n                                 when  maturity <= 12  then maturity/12\n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then RP_2_exposures \n                                                     else 0 end as GLLP_RP_2\n\n, LGD * (1.0 - pow((1.0 - PD) , case when maturity > 12 and stage  = 2 then maturity/12\n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then CC_exposures \n                                                     else 0 end as GLLP_CC\n\n, LGD * (1.0 - pow((1.0 - PD) , case when maturity > 12 and stage  = 2 then maturity/12 \n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then TBIL_exposures\n                                            else 0 end as GLLP_TBIL\n\n-- GLLP new \n\n, LGD * (1.0 - pow((1.0 - PD) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and stage  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP\n\n-- by scenarios\n\n, LGD * PD_scen_weighted * case when CurrentRating_scen_weighted not in ('18', '19') and c.product_flag in ('RP_1'\n                                                                                , 'Arranged Overdraft'\n                                                                                , 'Unarranged Overdraft') then  (OnBalance_EAD + OffBalance_EAD)\n                        else 0 end GLLP_OD_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when  maturity > 12 and Stage_scenarios  = 2 then maturity/12\n                                 when  maturity <= 12  then maturity/12\n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then RP_2_exposures \n                                                     else 0 end as GLLP_RP_2_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when maturity > 12 and Stage_scenarios  = 2 then maturity/12\n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then CC_exposures \n                                                     else 0 end as GLLP_CC_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when maturity > 12 and Stage_scenarios  = 2 then maturity/12 \n                                 when maturity <= 12  then  maturity/12\n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then TBIL_exposures\n                                            else 0 end as GLLP_TBIL_scen_weighted\n\n-- down\n\n, LGD * (1.0 - pow((1.0 - PD_down) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_down not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_down\n-- neu\n, LGD * (1.0 - pow((1.0 - PD_neu) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_neu not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_neu\n\n-- up \n\n, LGD * (1.0 - pow((1.0 - PD_up) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_up not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_up\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted::float) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then (OnBalance_EAD + OffBalance_EAD)\n                                                     else 0 end as GLLP_scen_weighted\n\n-- ECL split \n\n, (LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then (OnBalance_EAD)\n                                                     else 0 end) +  (LGD * case when CurrentRating in ('18', '19') then OnBalance_EAD else 0 end) as ECL_On_scen_weighted\n\n, LGD * (1.0 - pow((1.0 - PD_scen_weighted) , case when c.product_flag in ('RP_1', 'Arranged Overdraft', 'Unarranged Overdraft') then 1\n                                 when maturity > 12 and Stage_scenarios  = 2  then maturity/12 \n                                 when maturity <= 12 then maturity/12 \n                                 else 1 end)) * case when CurrentRating_scen_weighted not in ('18', '19') then (OffBalance_EAD)\n                                                     else 0 end as ECL_Off_scen_weighted\n\n\n\n-- Fields for Reg. Reporting \n\n, case when c.is_default = 1 then 'J' else 'N' end as \"AUSFL\"\n\n, CASE\n    WHEN c.is_default = 1 THEN\n        GREATEST(\n            COALESCE(c.credit_creation_date, DATE '0001-01-01'),\n            COALESCE(\n                CASE \n                    WHEN d.user_id IS NOT NULL THEN d.default_date\n                    WHEN ins.user_id IS NOT NULL THEN ins.internal_insolvency_date\n                    WHEN sch.user_id IS NOT NULL THEN c.schufa_rating_date\n                    WHEN c.dpd > 90 THEN date_add('day', 90, c.start_in_arrears)\n                END,\n                DATE '0001-01-01'\n            )\n        )\n    ELSE NULL\nEND AS \"DXAUD\"\n\n, case when sch.user_id is not null then 'J'  -- debtor applies for insolvency\n       when ins.user_id is not null then 'I'  -- institution aplies for debtor insolvency\n       when d.user_id is not null then 'K' -- TBD with Anja, here - OD cancellation & forbearance (should be here?)\n       when (df.user_id is not null)\n            and (c.reportdate::date between df.default_during_forbearance_date::date and date_add('month', 12, df.default_during_forbearance_date::date)) then 'K'\n       when c.dpd > 90 then 'C'\n       when c.PD > 0.04 then 'B'\n       else 'A' end \"RISGR\"\n       \n\n-- RISGR\n\n, CASE\n      WHEN d.user_id IS NOT NULL THEN \n          COALESCE(GREATEST(c.credit_creation_date, d.default_date), d.default_date)\n      WHEN ins.user_id IS NOT NULL THEN \n          COALESCE(GREATEST(c.credit_creation_date, ins.internal_insolvency_date), ins.internal_insolvency_date)\n      WHEN sch.user_id IS NOT NULL THEN \n          COALESCE(GREATEST(c.credit_creation_date, c.schufa_rating_date), c.schufa_rating_date)\n      WHEN df.user_id IS NOT NULL\n           AND c.reportdate::date BETWEEN df.default_during_forbearance_date::date \n                                     AND date_add('month', 12, df.default_during_forbearance_date::date)\n      THEN COALESCE(GREATEST(c.credit_creation_date, df.default_during_forbearance_date::date), df.default_during_forbearance_date::date)\n      WHEN c.dpd > 90 THEN \n          COALESCE(GREATEST(c.credit_creation_date, date_add('day', 90, c.start_in_arrears)), date_add('day', 90, c.start_in_arrears))\n  END AS \"DXNPE\"\n\n, case when is_default = 1 and max(case when c.product_flag in ('RP_2') then 1 else 0 end) over(partition by c.user_id) = 1 \n            then max(fb.credit_creation_date) over(partition by c.user_id) end as \"DXFBE\"\n\n, case when fb.instrument_id is not null then 3290 end as \"FBSFI\"\n\n, case when Stage_scenarios = 1 then 5020 \n       when Stage_scenarios = 2 then 5021 \n       when Stage_scenarios = 3 then 5022 end \"IMSFI\"\n\n, case when is_default = 1 then 3292\n       when is_default = 0 \n            and ld.last_default_date::date between date_add('month', -12, c.reportdate::date) and c.reportdate::date\n            then 3294\n       else 3293 end \"PFSFI\"\n\n, case when is_default = 1 and coalesce(c.dpd,0) <= 90 then 3296\n       when coalesce(c.dpd,0) <= 30 then 3295\n       when coalesce(c.dpd,0) <= 90 then 5032 \n       when coalesce(c.dpd,0) <= 180 then 2792\n       when coalesce(c.dpd,0) <= 360 then 2785\n       when coalesce(c.dpd,0) <= 720 then 3280\n       when coalesce(c.dpd,0) <= 1800 then 3282\n       when coalesce(c.dpd,0) <= 2520 then 6934\n       when coalesce(c.dpd,0) > 2520 then 6935\n       end as \"TPDFI\"\n\nfrom {{ ref('bp_retail_provisions_stg_v5_pre_updated_v2') }} c \nleft join {{ ref('bp_portfolio_balance_aud_m_v2') }} o on o.encoded_key = c.instrument_id and c.reportdate::date = o.reporting_date::date\nleft join {{ ref('bp_overdraft_split_m_v2') }}  mll on mll.encoded_key = c.instrument_id and c.reportdate::date = mll.reporting_date::date\nleft join {{ ref('bp_monitoring_pd_supermodel_v2_m_v2') }} m on m.user_id = c.user_id and m.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_application_pd_supermodel_m_v2') }} pd_app on pd_app.encoded_key = c.instrument_id \n                                                                and  pd_app.reporting_date::date = c.reportdate::date\n                                                                and c.product_flag not in ('Unarranged Overdraft', 'RP_2')\nleft join {{ ref('bp_application_pd_supermodel_m_ad_v2') }} pd_app_ad on pd_app_ad.encoded_key = c.instrument_id \n                                                                and  pd_app_ad.reporting_date::date = c.reportdate::date\n                                                                and c.product_flag not in ('Unarranged Overdraft', 'RP_2')\nleft join {{ ref('bp_default_dunning_m_v2') }} d on d.user_id = c.user_id  and d.reporting_date::date = c.reportdate::date   \nleft join {{ ref('bp_default_internal_insolvency_v2_m_v2') }} ins on ins.user_id = c.user_id and ins.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_default_credit_bureau_insolvency_v3_m_v2') }} sch on sch.user_id = c.user_id and sch.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_repayment_plan_ph1_m_v2') }} rp on rp.user_id = c.user_id and rp.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_credit_bureau_rating_m_v2') }} schr on schr.user_id = c.user_id and schr.reporting_date::date = c.reportdate::date\nleft join first_enabled_date f on f.encoded_key = c.instrument_id and f.user_id = c.user_id and f.first_creation_date::date <= last_day(date_add('month', -1, last_day(getdate())))\nleft join credit_risk_playground.porto_pit_app_users pd_sc on pd_sc.instrument_id = c.instrument_id \n                                                              and c.product_flag in ('CC', 'TBIL')\n                                                              and pd_sc.product_flag = c.product_flag\nleft join credit_risk_playground.porto_pit_app_users pd_od on pd_od.user_id = c.user_id \n                                                               and pd_od.product_flag in ('Arranged Overdraft', 'RP_1')\n                                                               and c.product_flag in ('Arranged Overdraft', 'RP_1')\n                                                              -- and pd_od.product_flag = c.product_flag\n                                                               and pd_od.credit_creation_date::date = coalesce(f.first_creation_date::date,last_day(date_add('month', -1, last_day(getdate()))))\n                                                               \nleft join repayment r on r.parent_account_key = c.instrument_id\nleft join  {{ source('dbt', 'zrh_users') }} z on z.user_id = c.user_id \nleft join {{ ref('bp_loan_contract_information_m_v2') }} li on li.encoded_key = c.instrument_id and li.reporting_date::date = c.reportdate::date\nleft join {{ source('public', 'mmbr_savings_account') }} s on s.encoded_key = c.instrument_id and s.account_type = 'CURRENT_ACCOUNT'\nleft join {{ ref('bp_garnishment_m_v2') }} g on g.user_id = c.user_id \n                                             and c.reportdate::date = g.reporting_date::date  \nleft join {{ ref('bp_social_benefits_v2_m_v2') }} sb on sb.user_id = c.user_id and sb.reporting_date::date = c.reportdate::date\nleft join {{ ref('bp_p_accounts_v2') }} pa on pa.user_id = c.user_id and last_day(date_add('month', -1, last_day(getdate()))) between pa.rev_timestamp and pa.end_timestamp\nleft join {{ ref('bp_hrc_m_v2') }} hrc on c.user_id = hrc.user_id and c.reportdate::date = hrc.reporting_date::date\nleft join forbearance_last_year fly on fly.instrument_id = c.instrument_id \nleft join {{ ref('bp_forbearance_m_v2_v2') }} fb on fb.instrument_id = c.instrument_id and c.reportdate::date = fb.reportdate::date\nleft join latest_default_during_forbearance df on df.user_id = c.user_id\nleft join default_last_12_months ld on ld.user_id = c.user_id\nwhere c.reportdate::date = last_day(date_add('month', -1, last_day(getdate())))\norder by 1\n)\n\nselect * \n, getdate() as etl_updated\n, coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key\nfrom total \n{% if is_incremental() %}\nwhere etl_updated > (select max(etl_updated) from {{this}})\n{% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_overdraft_limit_periods_v2", "package": null, "version": null}, {"name": "bp_forbearance_m_v2_v2", "package": null, "version": null}, {"name": "bp_retail_provisions_stg_v5_pre_updated_v2", "package": null, "version": null}, {"name": "bp_forbearance_m_v2_v2", "package": null, "version": null}, {"name": "bp_retail_provisions_stg_v5_pre_updated_v2", "package": null, "version": null}, {"name": "bp_portfolio_balance_aud_m_v2", "package": null, "version": null}, {"name": "bp_overdraft_split_m_v2", "package": null, "version": null}, {"name": "bp_monitoring_pd_supermodel_v2_m_v2", "package": null, "version": null}, {"name": "bp_application_pd_supermodel_m_v2", "package": null, "version": null}, {"name": "bp_application_pd_supermodel_m_ad_v2", "package": null, "version": null}, {"name": "bp_default_dunning_m_v2", "package": null, "version": null}, {"name": "bp_default_internal_insolvency_v2_m_v2", "package": null, "version": null}, {"name": "bp_default_credit_bureau_insolvency_v3_m_v2", "package": null, "version": null}, {"name": "bp_repayment_plan_ph1_m_v2", "package": null, "version": null}, {"name": "bp_credit_bureau_rating_m_v2", "package": null, "version": null}, {"name": "bp_loan_contract_information_m_v2", "package": null, "version": null}, {"name": "bp_garnishment_m_v2", "package": null, "version": null}, {"name": "bp_social_benefits_v2_m_v2", "package": null, "version": null}, {"name": "bp_p_accounts_v2", "package": null, "version": null}, {"name": "bp_hrc_m_v2", "package": null, "version": null}, {"name": "bp_forbearance_m_v2_v2", "package": null, "version": null}], "sources": [["public", "mmbr_repayment"], ["dbt", "zrh_users"], ["public", "mmbr_savings_account"]], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["source.credit_risk_playground.public.mmbr_repayment", "source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.public.mmbr_savings_account", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_forbearance_m_v2_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "model.credit_risk_playground.bp_default_dunning_m_v2", "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_loan_contract_information_m_v2", "model.credit_risk_playground.bp_garnishment_m_v2", "model.credit_risk_playground.bp_social_benefits_v2_m_v2", "model.credit_risk_playground.bp_p_accounts_v2", "model.credit_risk_playground.bp_hrc_m_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}, "model.credit_risk_playground.bp_forbearance_m_v2_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_forbearance_m_v2_v2", "resource_type": "model", "package_name": "credit_risk_playground", "path": "Provisions/v4/bp_forbearance_m_v2_v2.sql", "original_file_path": "models/Provisions/v4/bp_forbearance_m_v2_v2.sql", "unique_id": "model.credit_risk_playground.bp_forbearance_m_v2_v2", "fqn": ["credit_risk_playground", "Provisions", "v4", "bp_forbearance_m_v2_v2"], "alias": "bp_forbearance_m_v2_v2", "checksum": {"name": "sha256", "checksum": "39e840223f62cef50be6fd2824d3cf7ea723b5320fdd6572610d981ab2a9d33d"}, "config": {"enabled": true, "alias": null, "schema": null, "database": null, "tags": ["retail_provisions"], "meta": {}, "group": null, "materialized": "incremental", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": "unique_key", "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected", "dist": "instrument_id", "sort": "etl_updated"}, "tags": ["retail_provisions"], "description": "", "columns": {}, "meta": {}, "group": null, "docs": {"show": true, "node_color": null}, "patch_path": null, "build_path": null, "unrendered_config": {"materialized": "incremental", "dist": "instrument_id", "sort": "etl_updated", "unique_key": "unique_key", "tags": ["retail_provisions"]}, "created_at": 1762181576.695317, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_forbearance_m_v2_v2\"", "raw_code": "{{\n  config(\n    materialized = \"incremental\",\n    dist='instrument_id',\n    sort='etl_updated',\n    unique_key=\"unique_key\",\n    tags=[\"retail_provisions\"]\n    )\n}}\n\n-- dbt run --full-refresh --select bp_forbearance_m_v2_v2 (first time)\n-- dbt run --select bp_forbearance_m_v2_v2 (other runs)\n\nwith \n\n\nportfolio as (\nselect \nc.user_id \n, c.instrument_id \n, c.reportdate\n, c.credit_creation_date\n, c.product_flag\n, c.TBIL_exposures + c.CC_exposures + c.RP_2_exposures + c.OD_exposures as bal\n, coalesce(ps.pd\n           , coalesce(ps_old.pd\n                     , ps_lis.pd)) as InitialPD\nfrom {{ ref('bp_retail_provisions_stg_v5_pre_updated_v2') }} c\nleft join dbt_pii.credit_score_audit_log ps on c.user_id = ps.user_id \n                                               and c.credit_creation_date::date = ps.calculated_at::date \n                                               and ps.model_name = 'PORTO'\n                                               and ps.model_version = 'unified-1.0'\n                                               and ps.score_type in ('behavioral')\nleft join dbt_pii.credit_score_audit_log ps_old on c.user_id = ps_old.user_id \n                                               and c.credit_creation_date::date = ps_old.calculated_at::date \n                                               and ps_old.model_name = 'PORTO'\n                                               and ps_old.model_version = 'overdraft-1.1'\n                                               and ps_old.score_type in ('behavioral_arranged')\nleft join dbt_pii.credit_score_audit_log ps_lis on c.user_id = ps_lis.user_id \n                                               and c.credit_creation_date::date = ps_lis.calculated_at::date \n                                               and ps_lis.model_name = 'LISBON'\n                                               and ps_lis.score_type in ('behavioral_arranged', 'lisbon')\n                                              \nwhere reportdate::date = last_day(date_add('month', -1, last_day(getdate()))) \n      and c.product_flag in ('RP_2') -- rp ph.2\n)\n\n\n, californium_credit_score as (\nselect \nuser_id \n, rating \n, provider\n, requested_on as rev_timestamp\n, coalesce(lead(requested_on - interval '0.000001 second', 1) over (partition by user_id order by requested_on), '2100-01-01') as end_timestamp\nfrom private.californium_credit_score_audit_log\norder by user_id, requested_on\n)\n\n, paccount as (\n select \n user_id \n, created\n, active \n, coalesce(allowance_cents,0) as allowance_cents\n, lag(case when active = 1 then allowance_cents\n           else 0 end) OVER (PARTITION by z.user_id order by created) as previous_allowance_cents\nfrom etl_reporting.pa_paccount p\ninner join dbt.zrh_users z on p.account_id = z.account_id\n)\n, paccount_ts as ( \nselect \nuser_id \n, active\n, allowance_cents\n, created as rev_timestamp \n, coalesce( lead(created) OVER (PARTITION BY user_id ORDER BY created) + interval'-0.000001 seconds' \n                  , '2100-01-01'::timestamp) as end_timestamp \nfrom paccount\nwhere (previous_allowance_cents IS NULL OR previous_allowance_cents <> allowance_cents)\n)\n\n, garnishment as (\n  select\n  customer_id\n  , ng.status\n  , ng.created \n  , ng.updated\n  from nd_garnishment ng\n  left join  nd_participant np  on ng.id = np.garnishment_id\n  where np.type = 'RESPONDENT' --and ng.status = 'OPEN'\n)\n\n, total as (\nselect distinct\np.*\n, coalesce(date_diff('day',d.start_in_arrears::date, p.credit_creation_date::date),0) as dpd_at_credit_decision\n, c.rev_timestamp as cb_report_date\n, c.provider as cb_provider \n, c.rating as cb_rating\n-- hrc is not used, since such customers are not eligible for repayment plan\n, case when coalesce(date_diff('day',d.start_in_arrears::date, p.credit_creation_date::date),0) > 30 then 'dpd_30+'\n       when initialpd >= 0.2790 then 'RC_15+'\n       -- includes financial difficulties (+ insolvency)\n       when (c.provider like 'SCHUFA%' and c.rating in ('N', 'O', 'P')) then 'cb_financial_difficulty'\n       when (c.provider like 'CRIF%' and c.rating in ('P')) then 'cb_financial_difficulty'\n       when (pa.user_id is not null) then 'p_account'\n       when m.initiator_user_id is not null then 'unemployment_benefits'\n       when g.customer_id is not null then 'garnishment'\n        else 'other' end as forbearance_reason\nfrom portfolio p \nleft join dbt.bp_arrears_reg_aud d on p.user_id = d.user_id \n                                      and p.credit_creation_date::timestamp between d.start_in_arrears::timestamp and d.end_in_arrears::timestamp\nleft join californium_credit_score  c on c.user_id = p.user_id \n                                      and p.credit_creation_date::timestamp between c.rev_timestamp::timestamp and c.end_timestamp::timestamp\nleft join paccount_ts pa on pa.user_id = p.user_id \n                            and p.credit_creation_date::date between pa.rev_timestamp::timestamp and pa.end_timestamp::timestamp\nleft join garnishment g on g.customer_id = p.user_id \n                           and (\n                                  (\n                                    g.status = 'CLOSED'\n                                      and p.credit_creation_date::timestamp between g.created::timestamp and g.updated::timestamp\n                                  ) -- garnishment was active at the application, but now closed\n                                  or \n                                  (\n                                    g.status = 'OPEN' and g.created::timestamp <= p.credit_creation_date::timestamp\n                                  )\n                                ) \nleft join madrid_categorization m on m.initiator_user_id = p.user_id \n                                      and m.created::date between date_add('day', -91, p.credit_creation_date)::date and p.credit_creation_date::date\n                                      and (m.detailed_category like '%PublicAssistance%') \n                                      and (m.detailed_category not like '%FamilySupportAllowance%')\n                                      and (m.detailed_category not like '%PublicAssistanceWelfare%')\nwhere (dpd_at_credit_decision > 30) \n       or (initialpd >= 0.2790) \n       or (c.provider like 'SCHUFA%' and c.rating in ('N', 'O', 'P')) \n       or (c.provider like 'CRIF%' and c.rating in ('P')) \n       or (pa.user_id is not null)\n       or (g.customer_id is not null)\n       or (m.initiator_user_id is not null)\norder by user_id, instrument_id\n)\n\n  select * \n  , getdate() as etl_updated\n  , coalesce(instrument_id, '') || coalesce(etl_updated::varchar, '') as unique_key \n  from total \n    {% if is_incremental() %}\n  where  etl_updated > (select max(etl_updated) from {{this}})\n    {% endif %}", "doc_blocks": [], "language": "sql", "refs": [{"name": "bp_retail_provisions_stg_v5_pre_updated_v2", "package": null, "version": null}], "sources": [], "metrics": [], "depends_on": {"macros": ["macro.dbt.is_incremental"], "nodes": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2"]}, "compiled_path": null, "contract": {"enforced": false, "alias_types": true, "checksum": null}, "access": "protected", "constraints": [], "version": null, "latest_version": null, "deprecation_date": null, "primary_key": [], "time_spine": null, "freshness": null}}, "sources": {"source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs": {"database": "n26", "schema": "credit_risk_playground", "name": "macroeconomic_inputs", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs", "fqn": ["credit_risk_playground", "credit_risk_playground", "macroeconomic_inputs"], "source_name": "credit_risk_playground", "source_description": "credit_risk_playground credit-related self-made tables", "loader": "", "identifier": "macroeconomic_inputs", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "inputs (from OECD) for macroeconomic features creation", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"credit_risk_playground\".\"macroeconomic_inputs\"", "created_at": 1745942717.671796, "unrendered_database": null, "unrendered_schema": "credit_risk_playground", "doc_blocks": []}, "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs_v2": {"database": "n26", "schema": "credit_risk_playground", "name": "macroeconomic_inputs_v2", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs_v2", "fqn": ["credit_risk_playground", "credit_risk_playground", "macroeconomic_inputs_v2"], "source_name": "credit_risk_playground", "source_description": "credit_risk_playground credit-related self-made tables", "loader": "", "identifier": "macroeconomic_inputs_v2", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "inputs (from new OECD website) for macroeconomic features creation", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"credit_risk_playground\".\"macroeconomic_inputs_v2\"", "created_at": 1745942717.6722171, "unrendered_database": null, "unrendered_schema": "credit_risk_playground", "doc_blocks": []}, "source.credit_risk_playground.credit_risk_playground.bp_retail_provisions_stg_v5_pre": {"database": "n26", "schema": "credit_risk_playground", "name": "bp_retail_provisions_stg_v5_pre", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.credit_risk_playground.bp_retail_provisions_stg_v5_pre", "fqn": ["credit_risk_playground", "credit_risk_playground", "bp_retail_provisions_stg_v5_pre"], "source_name": "credit_risk_playground", "source_description": "credit_risk_playground credit-related self-made tables", "loader": "", "identifier": "bp_retail_provisions_stg_v5_pre", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "first part of provisions final table", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"credit_risk_playground\".\"bp_retail_provisions_stg_v5_pre\"", "created_at": 1745942717.672277, "unrendered_database": null, "unrendered_schema": "credit_risk_playground", "doc_blocks": []}, "source.credit_risk_playground.private.ca_credit_report_aud": {"database": "n26", "schema": "private", "name": "ca_credit_report_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.ca_credit_report_aud", "fqn": ["credit_risk_playground", "private", "ca_credit_report_aud"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "ca_credit_report_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "audit table with credit bureau reports", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"ca_credit_report_aud\"", "created_at": 1745942717.6727931, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.ca_credit_score_record_request_aud": {"database": "n26", "schema": "private", "name": "ca_credit_score_record_request_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.ca_credit_score_record_request_aud", "fqn": ["credit_risk_playground", "private", "ca_credit_score_record_request_aud"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "ca_credit_score_record_request_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "schufa (DEU) reports with scores", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"ca_credit_score_record_request_aud\"", "created_at": 1745942717.672844, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.ca_credit_score_record_request_merkmal_aud": {"database": "n26", "schema": "private", "name": "ca_credit_score_record_request_merkmal_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.ca_credit_score_record_request_merkmal_aud", "fqn": ["credit_risk_playground", "private", "ca_credit_score_record_request_merkmal_aud"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "ca_credit_score_record_request_merkmal_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "schufa (DEU) reports with merkmale", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"ca_credit_score_record_request_merkmal_aud\"", "created_at": 1745942717.672896, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.californium_customer_attribute": {"database": "n26", "schema": "private", "name": "californium_customer_attribute", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.californium_customer_attribute", "fqn": ["credit_risk_playground", "private", "californium_customer_attribute"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "californium_customer_attribute", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Merkmales from Schufa", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"californium_customer_attribute\"", "created_at": 1745942717.672943, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.einsteinium_repayment_capacity_audit_log": {"database": "n26", "schema": "private", "name": "einsteinium_repayment_capacity_audit_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.einsteinium_repayment_capacity_audit_log", "fqn": ["credit_risk_playground", "private", "einsteinium_repayment_capacity_audit_log"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "einsteinium_repayment_capacity_audit_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "user repayment capacity (Cortisol)", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"einsteinium_repayment_capacity_audit_log\"", "created_at": 1745942717.672989, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.es_requested_repayment_capacity": {"database": "n26", "schema": "private", "name": "es_requested_repayment_capacity", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.es_requested_repayment_capacity", "fqn": ["credit_risk_playground", "private", "es_requested_repayment_capacity"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "es_requested_repayment_capacity", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "user repayment capacity (Miami)", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"es_requested_repayment_capacity\"", "created_at": 1745942717.673035, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.einsteinium_internal_credit_score_audit_log": {"database": "n26", "schema": "private", "name": "einsteinium_internal_credit_score_audit_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.einsteinium_internal_credit_score_audit_log", "fqn": ["credit_risk_playground", "private", "einsteinium_internal_credit_score_audit_log"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "einsteinium_internal_credit_score_audit_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "tbil scores", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"einsteinium_internal_credit_score_audit_log\"", "created_at": 1745942717.67308, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.es_requested_credit_score": {"database": "n26", "schema": "private", "name": "es_requested_credit_score", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.es_requested_credit_score", "fqn": ["credit_risk_playground", "private", "es_requested_credit_score"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "es_requested_credit_score", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "requested credit scores (application)", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"es_requested_credit_score\"", "created_at": 1745942717.673128, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.es_internal_credit_score": {"database": "n26", "schema": "private", "name": "es_internal_credit_score", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.es_internal_credit_score", "fqn": ["credit_risk_playground", "private", "es_internal_credit_score"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "es_internal_credit_score", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "credit scores < Apr 2022", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"es_internal_credit_score\"", "created_at": 1745942717.673173, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.einsteinium_n26_credit_score_audit_log": {"database": "n26", "schema": "private", "name": "einsteinium_n26_credit_score_audit_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.einsteinium_n26_credit_score_audit_log", "fqn": ["credit_risk_playground", "private", "einsteinium_n26_credit_score_audit_log"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "einsteinium_n26_credit_score_audit_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "credit scores Apr - Nov 2022", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"einsteinium_n26_credit_score_audit_log\"", "created_at": 1745942717.6732202, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.einsteinium_credit_score_audit_log": {"database": "n26", "schema": "private", "name": "einsteinium_credit_score_audit_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.einsteinium_credit_score_audit_log", "fqn": ["credit_risk_playground", "private", "einsteinium_credit_score_audit_log"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "einsteinium_credit_score_audit_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "credit scores > Nov 2022", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"einsteinium_credit_score_audit_log\"", "created_at": 1745942717.673268, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.miracle_days_past_due": {"database": "n26", "schema": "private", "name": "miracle_days_past_due", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.miracle_days_past_due", "fqn": ["credit_risk_playground", "private", "miracle_days_past_due"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "miracle_days_past_due", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Miracle, DPD", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"miracle_days_past_due\"", "created_at": 1745942717.673315, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.private.miracle_unlikeliness_to_pay": {"database": "n26", "schema": "private", "name": "miracle_unlikeliness_to_pay", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.private.miracle_unlikeliness_to_pay", "fqn": ["credit_risk_playground", "private", "miracle_unlikeliness_to_pay"], "source_name": "private", "source_description": "private credit-related audit tables", "loader": "", "identifier": "miracle_unlikeliness_to_pay", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Miracle, UTP", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"private\".\"miracle_unlikeliness_to_pay\"", "created_at": 1745942717.673364, "unrendered_database": null, "unrendered_schema": "private", "doc_blocks": []}, "source.credit_risk_playground.dbt.bp_overdraft_users": {"database": "n26", "schema": "dbt", "name": "bp_overdraft_users", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.bp_overdraft_users", "fqn": ["credit_risk_playground", "dbt", "bp_overdraft_users"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "bp_overdraft_users", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "overdraft limits and balances", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"bp_overdraft_users\"", "created_at": 1745942717.673412, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.bank_products_users": {"database": "n26", "schema": "dbt", "name": "bank_products_users", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.bank_products_users", "fqn": ["credit_risk_playground", "dbt", "bank_products_users"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "bank_products_users", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "monthly credit products data", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"bank_products_users\"", "created_at": 1745942717.6734579, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.stg_user_detail": {"database": "n26", "schema": "dbt", "name": "stg_user_detail", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.stg_user_detail", "fqn": ["credit_risk_playground", "dbt", "stg_user_detail"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "stg_user_detail", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "subscription data", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"stg_user_detail\"", "created_at": 1745942717.673502, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.zrh_users": {"database": "n26", "schema": "dbt", "name": "zrh_users", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.zrh_users", "fqn": ["credit_risk_playground", "dbt", "zrh_users"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "zrh_users", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "master table with users", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"zrh_users\"", "created_at": 1745942717.673547, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.zrh_txn_day": {"database": "n26", "schema": "dbt", "name": "zrh_txn_day", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.zrh_txn_day", "fqn": ["credit_risk_playground", "dbt", "zrh_txn_day"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "zrh_txn_day", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "daily transactions", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"zrh_txn_day\"", "created_at": 1745942717.673594, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.mmb_weekly_balance_aud": {"database": "n26", "schema": "dbt", "name": "mmb_weekly_balance_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.mmb_weekly_balance_aud", "fqn": ["credit_risk_playground", "dbt", "mmb_weekly_balance_aud"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "mmb_weekly_balance_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "weekly balances Mambu", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"mmb_weekly_balance_aud\"", "created_at": 1745942717.673644, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.write_off": {"database": "n26", "schema": "dbt", "name": "write_off", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.write_off", "fqn": ["credit_risk_playground", "dbt", "write_off"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "write_off", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "write-offs table", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"write_off\"", "created_at": 1745942717.6736908, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.ucm_overdraft": {"database": "n26", "schema": "dbt", "name": "ucm_overdraft", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.ucm_overdraft", "fqn": ["credit_risk_playground", "dbt", "ucm_overdraft"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "ucm_overdraft", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "interest income for overdrafts", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"ucm_overdraft\"", "created_at": 1745942717.673738, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.mmbr_user_match": {"database": "n26", "schema": "dbt", "name": "mmbr_user_match", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.mmbr_user_match", "fqn": ["credit_risk_playground", "dbt", "mmbr_user_match"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "mmbr_user_match", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "to join user_id to mambu logs", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"mmbr_user_match\"", "created_at": 1745942717.673785, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.mmbr_repayment_aud": {"database": "n26", "schema": "dbt", "name": "mmbr_repayment_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.mmbr_repayment_aud", "fqn": ["credit_risk_playground", "dbt", "mmbr_repayment_aud"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "mmbr_repayment_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "repayment logs in Mambu", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"mmbr_repayment_aud\"", "created_at": 1745942717.673831, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.mmbr_loan_account_aud": {"database": "n26", "schema": "dbt", "name": "mmbr_loan_account_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.mmbr_loan_account_aud", "fqn": ["credit_risk_playground", "dbt", "mmbr_loan_account_aud"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "mmbr_loan_account_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "this is an effort to reconcile mmb and mmbr tables", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"mmbr_loan_account_aud\"", "created_at": 1745942717.673878, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.card_transactions_pt": {"database": "n26", "schema": "dbt", "name": "card_transactions_pt", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.card_transactions_pt", "fqn": ["credit_risk_playground", "dbt", "card_transactions_pt"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "card_transactions_pt", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "transactions for cards presentments", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"card_transactions_pt\"", "created_at": 1745942717.673923, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.zr_transaction_user": {"database": "n26", "schema": "dbt", "name": "zr_transaction_user", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.zr_transaction_user", "fqn": ["credit_risk_playground", "dbt", "zr_transaction_user"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "zr_transaction_user", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "payment schemes", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"zr_transaction_user\"", "created_at": 1745942717.673968, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.device_tokens": {"database": "n26", "schema": "dbt", "name": "device_tokens", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.device_tokens", "fqn": ["credit_risk_playground", "dbt", "device_tokens"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "device_tokens", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "device tokens", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"device_tokens\"", "created_at": 1745942717.674015, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.login_attempts": {"database": "n26", "schema": "dbt", "name": "login_attempts", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.login_attempts", "fqn": ["credit_risk_playground", "dbt", "login_attempts"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "login_attempts", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "login attempts", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"login_attempts\"", "created_at": 1745942717.674061, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.dbt.bp_overdue_amounts_loans": {"database": "n26", "schema": "dbt", "name": "bp_overdue_amounts_loans", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.dbt.bp_overdue_amounts_loans", "fqn": ["credit_risk_playground", "dbt", "bp_overdue_amounts_loans"], "source_name": "dbt", "source_description": "Data Analytics' dbt models", "loader": "", "identifier": "bp_overdue_amounts_loans", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "overdue amounts for loan accounts per day", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"dbt\".\"bp_overdue_amounts_loans\"", "created_at": 1745942717.6741068, "unrendered_database": null, "unrendered_schema": "dbt", "doc_blocks": []}, "source.credit_risk_playground.public.dwh_cohort_months": {"database": "n26", "schema": "public", "name": "dwh_cohort_months", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.dwh_cohort_months", "fqn": ["credit_risk_playground", "public", "dwh_cohort_months"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "dwh_cohort_months", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "end of months dates", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"dwh_cohort_months\"", "created_at": 1745942717.6741529, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.cmd_users": {"database": "n26", "schema": "public", "name": "cmd_users", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.cmd_users", "fqn": ["credit_risk_playground", "public", "cmd_users"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "cmd_users", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "simpler version of zrh_users", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"cmd_users\"", "created_at": 1745942717.674198, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.cmd_n26_tnc_address": {"database": "n26", "schema": "public", "name": "cmd_n26_tnc_address", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.cmd_n26_tnc_address", "fqn": ["credit_risk_playground", "public", "cmd_n26_tnc_address"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "cmd_n26_tnc_address", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "address of users", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"cmd_n26_tnc_address\"", "created_at": 1745942717.674243, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.dwh_sneaky_transaction": {"database": "n26", "schema": "public", "name": "dwh_sneaky_transaction", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.dwh_sneaky_transaction", "fqn": ["credit_risk_playground", "public", "dwh_sneaky_transaction"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "dwh_sneaky_transaction", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "deprecated", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"dwh_sneaky_transaction\"", "created_at": 1745942717.67429, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_loan_transaction": {"database": "n26", "schema": "public", "name": "mmbr_loan_transaction", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_loan_transaction", "fqn": ["credit_risk_playground", "public", "mmbr_loan_transaction"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_loan_transaction", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "loan transactions in Mambu", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_loan_transaction\"", "created_at": 1745942717.674336, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_loan_account": {"database": "n26", "schema": "public", "name": "mmbr_loan_account", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_loan_account", "fqn": ["credit_risk_playground", "public", "mmbr_loan_account"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_loan_account", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "loan accounts in Mambu", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_loan_account\"", "created_at": 1745942717.674382, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmb_loan_account_semi_aud": {"database": "n26", "schema": "public", "name": "mmb_loan_account_semi_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmb_loan_account_semi_aud", "fqn": ["credit_risk_playground", "public", "mmb_loan_account_semi_aud"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmb_loan_account_semi_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "deprecated", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmb_loan_account_semi_aud\"", "created_at": 1745942717.67443, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mcv_infocard_template": {"database": "n26", "schema": "public", "name": "mcv_infocard_template", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mcv_infocard_template", "fqn": ["credit_risk_playground", "public", "mcv_infocard_template"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mcv_infocard_template", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "dunning infocards", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mcv_infocard_template\"", "created_at": 1745942717.674479, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_n26_repayment_aud": {"database": "n26", "schema": "public", "name": "mmbr_n26_repayment_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_n26_repayment_aud", "fqn": ["credit_risk_playground", "public", "mmbr_n26_repayment_aud"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_n26_repayment_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Mambu repayments audit log", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_n26_repayment_aud\"", "created_at": 1745942717.674525, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_repayment": {"database": "n26", "schema": "public", "name": "mmbr_repayment", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_repayment", "fqn": ["credit_risk_playground", "public", "mmbr_repayment"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_repayment", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Mambu repayment schedule", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_repayment\"", "created_at": 1745942717.674572, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.dwh_portfolio_status_aud": {"database": "n26", "schema": "public", "name": "dwh_portfolio_status_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.dwh_portfolio_status_aud", "fqn": ["credit_risk_playground", "public", "dwh_portfolio_status_aud"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "dwh_portfolio_status_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "old dunning records", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"dwh_portfolio_status_aud\"", "created_at": 1745942717.674618, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.la_action_log": {"database": "n26", "schema": "public", "name": "la_action_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.la_action_log", "fqn": ["credit_risk_playground", "public", "la_action_log"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "la_action_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "lanthanum dunning logs", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"la_action_log\"", "created_at": 1745942717.674664, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.neodymium_insolvency": {"database": "n26", "schema": "public", "name": "neodymium_insolvency", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.neodymium_insolvency", "fqn": ["credit_risk_playground", "public", "neodymium_insolvency"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "neodymium_insolvency", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "internal bankruptcy log", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"neodymium_insolvency\"", "created_at": 1745942717.67471, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.nd_participant": {"database": "n26", "schema": "public", "name": "nd_participant", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.nd_participant", "fqn": ["credit_risk_playground", "public", "nd_participant"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "nd_participant", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "bankruptcy source", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"nd_participant\"", "created_at": 1745942717.674757, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.nh_transaction_instalment_loan": {"database": "n26", "schema": "public", "name": "nh_transaction_instalment_loan", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.nh_transaction_instalment_loan", "fqn": ["credit_risk_playground", "public", "nh_transaction_instalment_loan"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "nh_transaction_instalment_loan", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "nihonium tbil", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"nh_transaction_instalment_loan\"", "created_at": 1745942717.6748018, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.nihonium_eligibility_decision_audit": {"database": "n26", "schema": "public", "name": "nihonium_eligibility_decision_audit", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.nihonium_eligibility_decision_audit", "fqn": ["credit_risk_playground", "public", "nihonium_eligibility_decision_audit"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "nihonium_eligibility_decision_audit", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "nihonium decision audit", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"nihonium_eligibility_decision_audit\"", "created_at": 1745942717.67485, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.strontium_loan": {"database": "n26", "schema": "public", "name": "strontium_loan", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.strontium_loan", "fqn": ["credit_risk_playground", "public", "strontium_loan"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "strontium_loan", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "strontium", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"strontium_loan\"", "created_at": 1745942717.674898, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.cc_credit_draft": {"database": "n26", "schema": "public", "name": "cc_credit_draft", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.cc_credit_draft", "fqn": ["credit_risk_playground", "public", "cc_credit_draft"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "cc_credit_draft", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "consumer credit applications", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"cc_credit_draft\"", "created_at": 1745942717.6749609, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.cc_credit_offer": {"database": "n26", "schema": "public", "name": "cc_credit_offer", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.cc_credit_offer", "fqn": ["credit_risk_playground", "public", "cc_credit_offer"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "cc_credit_offer", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "consumer credit offers", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"cc_credit_offer\"", "created_at": 1745942717.6750069, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.miracle_customer_default": {"database": "n26", "schema": "public", "name": "miracle_customer_default", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.miracle_customer_default", "fqn": ["credit_risk_playground", "public", "miracle_customer_default"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "miracle_customer_default", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Miracle defaults table", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"miracle_customer_default\"", "created_at": 1745942717.6750531, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.amh_categories": {"database": "n26", "schema": "public", "name": "amh_categories", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.amh_categories", "fqn": ["credit_risk_playground", "public", "amh_categories"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "amh_categories", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Amherst categories table", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"amh_categories\"", "created_at": 1745942717.6750998, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.madrid_categorization": {"database": "n26", "schema": "public", "name": "madrid_categorization", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.madrid_categorization", "fqn": ["credit_risk_playground", "public", "madrid_categorization"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "madrid_categorization", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "Madrid (TX classification) logs", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"madrid_categorization\"", "created_at": 1745942717.675144, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.pu_overdraft_history": {"database": "n26", "schema": "public", "name": "pu_overdraft_history", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.pu_overdraft_history", "fqn": ["credit_risk_playground", "public", "pu_overdraft_history"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "pu_overdraft_history", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "overdraft history", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"pu_overdraft_history\"", "created_at": 1745942717.675192, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_gl_account": {"database": "n26", "schema": "public", "name": "mmbr_gl_account", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_gl_account", "fqn": ["credit_risk_playground", "public", "mmbr_gl_account"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_gl_account", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "GLs codes", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_gl_account\"", "created_at": 1745942717.675244, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_gl_journal_entry": {"database": "n26", "schema": "public", "name": "mmbr_gl_journal_entry", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_gl_journal_entry", "fqn": ["credit_risk_playground", "public", "mmbr_gl_journal_entry"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_gl_journal_entry", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "debit/credit transactions", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_gl_journal_entry\"", "created_at": 1745942717.675292, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.mmbr_savings_account": {"database": "n26", "schema": "public", "name": "mmbr_savings_account", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.mmbr_savings_account", "fqn": ["credit_risk_playground", "public", "mmbr_savings_account"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "mmbr_savings_account", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "savings accounts info", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"mmbr_savings_account\"", "created_at": 1745942717.675339, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.ddb_overdraft_settings_aud": {"database": "n26", "schema": "public", "name": "ddb_overdraft_settings_aud", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.ddb_overdraft_settings_aud", "fqn": ["credit_risk_playground", "public", "ddb_overdraft_settings_aud"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "ddb_overdraft_settings_aud", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "old overdraft logs", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"ddb_overdraft_settings_aud\"", "created_at": 1745942717.675384, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.dwh_cohort_dates": {"database": "n26", "schema": "public", "name": "dwh_cohort_dates", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.dwh_cohort_dates", "fqn": ["credit_risk_playground", "public", "dwh_cohort_dates"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "dwh_cohort_dates", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "dates", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"dwh_cohort_dates\"", "created_at": 1745942717.675429, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.public.plutonium_repayment_plan": {"database": "n26", "schema": "public", "name": "plutonium_repayment_plan", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.public.plutonium_repayment_plan", "fqn": ["credit_risk_playground", "public", "plutonium_repayment_plan"], "source_name": "public", "source_description": "public sources", "loader": "", "identifier": "plutonium_repayment_plan", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "repayment plan ph.1 history", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"public\".\"plutonium_repayment_plan\"", "created_at": 1745942717.675475, "unrendered_database": null, "unrendered_schema": "public", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.lisbon_model_inputs": {"database": "n26", "schema": "etl_reporting", "name": "lisbon_model_inputs", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.lisbon_model_inputs", "fqn": ["credit_risk_playground", "etl_reporting", "lisbon_model_inputs"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "lisbon_model_inputs", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "woe features (available from August 2022)", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"lisbon_model_inputs\"", "created_at": 1754055285.4157481, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.lisbon_model_outputs": {"database": "n26", "schema": "etl_reporting", "name": "lisbon_model_outputs", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.lisbon_model_outputs", "fqn": ["credit_risk_playground", "etl_reporting", "lisbon_model_outputs"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "lisbon_model_outputs", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "pd submodule scores (available from August 2022)", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"lisbon_model_outputs\"", "created_at": 1754055285.4162571, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.lisbon_score_audit_log": {"database": "n26", "schema": "etl_reporting", "name": "lisbon_score_audit_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.lisbon_score_audit_log", "fqn": ["credit_risk_playground", "etl_reporting", "lisbon_score_audit_log"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "lisbon_score_audit_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "pd and ratings audit log", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"lisbon_score_audit_log\"", "created_at": 1754055285.416321, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.zr_transaction": {"database": "n26", "schema": "etl_reporting", "name": "zr_transaction", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.zr_transaction", "fqn": ["credit_risk_playground", "etl_reporting", "zr_transaction"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "zr_transaction", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "transactions for tx classification", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"zr_transaction\"", "created_at": 1754055285.416376, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity": {"database": "n26", "schema": "etl_reporting", "name": "cortisol_repayment_capacity", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity", "fqn": ["credit_risk_playground", "etl_reporting", "cortisol_repayment_capacity"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "cortisol_repayment_capacity", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "repayment capacity on user level", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"cortisol_repayment_capacity\"", "created_at": 1754055285.416428, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity_calculation_categories": {"database": "n26", "schema": "etl_reporting", "name": "cortisol_repayment_capacity_calculation_categories", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity_calculation_categories", "fqn": ["credit_risk_playground", "etl_reporting", "cortisol_repayment_capacity_calculation_categories"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "cortisol_repayment_capacity_calculation_categories", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "repayment capacity on category level", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"cortisol_repayment_capacity_calculation_categories\"", "created_at": 1754055285.416476, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.pa_paccount": {"database": "n26", "schema": "etl_reporting", "name": "pa_paccount", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.pa_paccount", "fqn": ["credit_risk_playground", "etl_reporting", "pa_paccount"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "pa_paccount", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "protected accounts", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"pa_paccount\"", "created_at": 1754055285.416524, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.dw_audit_log": {"database": "n26", "schema": "etl_reporting", "name": "dw_audit_log", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.dw_audit_log", "fqn": ["credit_risk_playground", "etl_reporting", "dw_audit_log"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "dw_audit_log", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "source for Fraud flags", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"dw_audit_log\"", "created_at": 1754055285.4165812, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}, "source.credit_risk_playground.etl_reporting.cmd_users": {"database": "n26", "schema": "etl_reporting", "name": "cmd_users", "resource_type": "source", "package_name": "credit_risk_playground", "path": "models/sources.yaml", "original_file_path": "models/sources.yaml", "unique_id": "source.credit_risk_playground.etl_reporting.cmd_users", "fqn": ["credit_risk_playground", "etl_reporting", "cmd_users"], "source_name": "etl_reporting", "source_description": "etl_reporting credit-related audit tables", "loader": "", "identifier": "cmd_users", "quoting": {"database": null, "schema": null, "identifier": null, "column": null}, "loaded_at_field": null, "loaded_at_query": null, "freshness": {"warn_after": {"count": null, "period": null}, "error_after": {"count": null, "period": null}, "filter": null}, "external": null, "description": "source for user information", "columns": {}, "meta": {}, "source_meta": {}, "tags": [], "config": {"enabled": true, "event_time": null}, "patch_path": null, "unrendered_config": {}, "relation_name": "\"n26\".\"etl_reporting\".\"cmd_users\"", "created_at": 1754055285.41663, "unrendered_database": null, "unrendered_schema": "etl_reporting", "doc_blocks": []}}, "macros": {"macro.dbt_redshift.redshift__current_timestamp": {"name": "redshift__current_timestamp", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_redshift.redshift__current_timestamp", "macro_sql": "{% macro redshift__current_timestamp() -%}\n    getdate()\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1866, "supported_languages": null}, "macro.dbt_redshift.redshift__snapshot_get_time": {"name": "redshift__snapshot_get_time", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_redshift.redshift__snapshot_get_time", "macro_sql": "{% macro redshift__snapshot_get_time() -%}\n    {{ current_timestamp() }}::timestamp\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1867, "supported_languages": null}, "macro.dbt_redshift.redshift__snapshot_string_as_time": {"name": "redshift__snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_redshift.redshift__snapshot_string_as_time", "macro_sql": "{% macro redshift__snapshot_string_as_time(timestamp) -%}\n    {%- set result = \"'\" ~ timestamp ~ \"'::timestamp\" -%}\n    {{ return(result) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.186829, "supported_languages": null}, "macro.dbt_redshift.redshift__current_timestamp_backcompat": {"name": "redshift__current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_redshift.redshift__current_timestamp_backcompat", "macro_sql": "{% macro redshift__current_timestamp_backcompat() -%}\n    getdate()\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.186877, "supported_languages": null}, "macro.dbt_redshift.redshift__current_timestamp_in_utc_backcompat": {"name": "redshift__current_timestamp_in_utc_backcompat", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_redshift.redshift__current_timestamp_in_utc_backcompat", "macro_sql": "{% macro redshift__current_timestamp_in_utc_backcompat() -%}\n    getdate()\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1869252, "supported_languages": null}, "macro.dbt_redshift.redshift__get_relations": {"name": "redshift__get_relations", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations.sql", "original_file_path": "macros/relations.sql", "unique_id": "macro.dbt_redshift.redshift__get_relations", "macro_sql": "{% macro redshift__get_relations() -%}\n\n{%- call statement('relations', fetch_result=True) -%}\n\nwith\n    relation as (\n        select\n            pg_class.oid as relation_id,\n            pg_class.relname as relation_name,\n            pg_class.relnamespace as schema_id,\n            pg_namespace.nspname as schema_name,\n            pg_class.relkind as relation_type\n        from pg_class\n        join pg_namespace\n          on pg_class.relnamespace = pg_namespace.oid\n        where pg_namespace.nspname != 'information_schema'\n          and pg_namespace.nspname not like 'pg\\_%'\n    ),\n    dependency as (\n        select distinct\n            coalesce(pg_rewrite.ev_class, pg_depend.objid) as dep_relation_id,\n            pg_depend.refobjid as ref_relation_id,\n            pg_depend.refclassid as ref_class_id\n        from pg_depend\n        left join pg_rewrite\n          on pg_depend.objid = pg_rewrite.oid\n        where coalesce(pg_rewrite.ev_class, pg_depend.objid) != pg_depend.refobjid\n    )\n\nselect distinct\n    dep.schema_name as dependent_schema,\n    dep.relation_name as dependent_name,\n    ref.schema_name as referenced_schema,\n    ref.relation_name as referenced_name\nfrom dependency\njoin relation ref\n    on dependency.ref_relation_id = ref.relation_id\njoin relation dep\n    on dependency.dep_relation_id = dep.relation_id\n\n{%- endcall -%}\n\n{{ return(load_result('relations').table) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.187207, "supported_languages": null}, "macro.dbt_redshift.dist": {"name": "dist", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.dist", "macro_sql": "{% macro dist(dist) %}\n  {%- if dist is not none -%}\n      {%- set dist = dist.strip().lower() -%}\n\n      {%- if dist in ['all', 'even'] -%}\n        diststyle {{ dist }}\n      {%- elif dist == \"auto\" -%}\n      {%- else -%}\n        diststyle key distkey ({{ dist }})\n      {%- endif -%}\n\n  {%- endif -%}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.188261, "supported_languages": null}, "macro.dbt_redshift.sort": {"name": "sort", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.sort", "macro_sql": "{% macro sort(sort_type, sort) %}\n  {%- if sort is not none %}\n      {{ sort_type | default('compound', boolean=true) }} sortkey(\n      {%- if sort is string -%}\n        {%- set sort = [sort] -%}\n      {%- endif -%}\n      {%- for item in sort -%}\n        {{ item }}\n        {%- if not loop.last -%},{%- endif -%}\n      {%- endfor -%}\n      )\n  {%- endif %}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.188524, "supported_languages": null}, "macro.dbt_redshift.redshift__create_table_as": {"name": "redshift__create_table_as", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__create_table_as", "macro_sql": "{% macro redshift__create_table_as(temporary, relation, sql) -%}\n\n  {%- set _dist = config.get('dist') -%}\n  {%- set _sort_type = config.get(\n          'sort_type',\n          validator=validation.any['compound', 'interleaved']) -%}\n  {%- set _sort = config.get(\n          'sort',\n          validator=validation.any[list, basestring]) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n  {%- set backup = config.get('backup') -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  {%- set contract_config = config.get('contract') -%}\n  {%- if contract_config.enforced -%}\n\n  create {% if temporary -%}temporary{%- endif %} table\n    {{ relation.include(database=(not temporary), schema=(not temporary)) }}\n    {{ get_table_columns_and_constraints() }}\n    {{ get_assert_columns_equivalent(sql) }}\n    {%- set sql = get_select_subquery(sql) %}\n    {% if backup == false -%}backup no{%- endif %}\n    {{ dist(_dist) }}\n    {{ sort(_sort_type, _sort) }}\n  ;\n\n  insert into {{ relation.include(database=(not temporary), schema=(not temporary)) }}\n    (\n      {{ sql }}\n    )\n  ;\n\n  {%- else %}\n\n  create {% if temporary -%}temporary{%- endif %} table\n    {{ relation.include(database=(not temporary), schema=(not temporary)) }}\n    {% if backup == false -%}backup no{%- endif %}\n    {{ dist(_dist) }}\n    {{ sort(_sort_type, _sort) }}\n  as (\n    {{ sql }}\n  );\n\n  {%- endif %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_table_columns_and_constraints", "macro.dbt.get_assert_columns_equivalent", "macro.dbt.get_select_subquery", "macro.dbt_redshift.dist", "macro.dbt_redshift.sort"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1893618, "supported_languages": null}, "macro.dbt_redshift.redshift__create_view_as": {"name": "redshift__create_view_as", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__create_view_as", "macro_sql": "{% macro redshift__create_view_as(relation, sql) -%}\n  {%- set binding = config.get('bind', default=True) -%}\n\n  {% set bind_qualifier = '' if binding else 'with no schema binding' %}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  create view {{ relation }}\n  {%- set contract_config = config.get('contract') -%}\n  {%- if contract_config.enforced -%}\n    {{ get_assert_columns_equivalent(sql) }}\n  {%- endif %} as (\n    {{ sql }}\n  ) {{ bind_qualifier }};\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.189684, "supported_languages": null}, "macro.dbt_redshift.redshift__create_schema": {"name": "redshift__create_schema", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__create_schema", "macro_sql": "{% macro redshift__create_schema(relation) -%}\n  {{ postgres__create_schema(relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__create_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.189756, "supported_languages": null}, "macro.dbt_redshift.redshift__drop_schema": {"name": "redshift__drop_schema", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__drop_schema", "macro_sql": "{% macro redshift__drop_schema(relation) -%}\n  {{ postgres__drop_schema(relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__drop_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.189821, "supported_languages": null}, "macro.dbt_redshift.redshift__get_columns_in_relation": {"name": "redshift__get_columns_in_relation", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__get_columns_in_relation", "macro_sql": "{% macro redshift__get_columns_in_relation(relation) -%}\n  {% call statement('get_columns_in_relation', fetch_result=True) %}\n      with bound_views as (\n        select\n          ordinal_position,\n          table_schema,\n          column_name,\n          data_type,\n          character_maximum_length,\n          numeric_precision,\n          numeric_scale\n\n        from information_schema.\"columns\"\n        where table_name = '{{ relation.identifier }}'\n    ),\n\n    unbound_views as (\n      select\n        ordinal_position,\n        view_schema,\n        col_name,\n        case\n          when col_type ilike 'character varying%' then\n            'character varying'\n          when col_type ilike 'numeric%' then 'numeric'\n          else col_type\n        end as col_type,\n        case\n          when col_type like 'character%'\n          then nullif(REGEXP_SUBSTR(col_type, '[0-9]+'), '')::int\n          else null\n        end as character_maximum_length,\n        case\n          when col_type like 'numeric%'\n          then nullif(\n            SPLIT_PART(REGEXP_SUBSTR(col_type, '[0-9,]+'), ',', 1),\n            '')::int\n          else null\n        end as numeric_precision,\n        case\n          when col_type like 'numeric%'\n          then nullif(\n            SPLIT_PART(REGEXP_SUBSTR(col_type, '[0-9,]+'), ',', 2),\n            '')::int\n          else null\n        end as numeric_scale\n\n      from pg_get_late_binding_view_cols()\n      cols(view_schema name, view_name name, col_name name,\n           col_type varchar, ordinal_position int)\n      where view_name = '{{ relation.identifier }}'\n    ),\n\n    external_views as (\n      select\n        columnnum,\n        schemaname,\n        columnname,\n        case\n          when external_type ilike 'character varying%' or external_type ilike 'varchar%'\n          then 'character varying'\n          when external_type ilike 'numeric%' then 'numeric'\n          else external_type\n        end as external_type,\n        case\n          when external_type like 'character%' or external_type like 'varchar%'\n          then nullif(\n            REGEXP_SUBSTR(external_type, '[0-9]+'),\n            '')::int\n          else null\n        end as character_maximum_length,\n        case\n          when external_type like 'numeric%'\n          then nullif(\n            SPLIT_PART(REGEXP_SUBSTR(external_type, '[0-9,]+'), ',', 1),\n            '')::int\n          else null\n        end as numeric_precision,\n        case\n          when external_type like 'numeric%'\n          then nullif(\n            SPLIT_PART(REGEXP_SUBSTR(external_type, '[0-9,]+'), ',', 2),\n            '')::int\n          else null\n        end as numeric_scale\n      from\n        pg_catalog.svv_external_columns\n      where\n        schemaname = '{{ relation.schema }}'\n        and tablename = '{{ relation.identifier }}'\n\n    ),\n\n    unioned as (\n      select * from bound_views\n      union all\n      select * from unbound_views\n      union all\n      select * from external_views\n    )\n\n    select\n      column_name,\n      data_type,\n      character_maximum_length,\n      numeric_precision,\n      numeric_scale\n\n    from unioned\n    {% if relation.schema %}\n    where table_schema = '{{ relation.schema }}'\n    {% endif %}\n    order by ordinal_position\n  {% endcall %}\n  {% set table = load_result('get_columns_in_relation').table %}\n  {{ return(sql_convert_columns_in_relation(table)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.sql_convert_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.190193, "supported_languages": null}, "macro.dbt_redshift.redshift__list_relations_without_caching": {"name": "redshift__list_relations_without_caching", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__list_relations_without_caching", "macro_sql": "{% macro redshift__list_relations_without_caching(schema_relation) %}\n\n  {% call statement('list_relations_without_caching', fetch_result=True) -%}\n    select\n        table_catalog as database,\n        table_name as name,\n        table_schema as schema,\n        'table' as type\n    from information_schema.tables\n    where table_schema ilike '{{ schema_relation.schema }}'\n    and table_type = 'BASE TABLE'\n    union all\n    select\n      table_catalog as database,\n      table_name as name,\n      table_schema as schema,\n      case\n        when view_definition ilike '%create materialized view%'\n          then 'materialized_view'\n        else 'view'\n      end as type\n    from information_schema.views\n    where table_schema ilike '{{ schema_relation.schema }}'\n  {% endcall %}\n  {{ return(load_result('list_relations_without_caching').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.190378, "supported_languages": null}, "macro.dbt_redshift.redshift__information_schema_name": {"name": "redshift__information_schema_name", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__information_schema_name", "macro_sql": "{% macro redshift__information_schema_name(database) -%}\n  {{ return(postgres__information_schema_name(database)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__information_schema_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.190455, "supported_languages": null}, "macro.dbt_redshift.redshift__list_schemas": {"name": "redshift__list_schemas", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__list_schemas", "macro_sql": "{% macro redshift__list_schemas(database) -%}\n  {{ return(postgres__list_schemas(database)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__list_schemas"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1905248, "supported_languages": null}, "macro.dbt_redshift.redshift__check_schema_exists": {"name": "redshift__check_schema_exists", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__check_schema_exists", "macro_sql": "{% macro redshift__check_schema_exists(information_schema, schema) -%}\n  {{ return(postgres__check_schema_exists(information_schema, schema)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__check_schema_exists"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1906078, "supported_languages": null}, "macro.dbt_redshift.redshift__persist_docs": {"name": "redshift__persist_docs", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__persist_docs", "macro_sql": "{% macro redshift__persist_docs(relation, model, for_relation, for_columns) -%}\n  {% if for_relation and config.persist_relation_docs() and model.description %}\n    {% do run_query(alter_relation_comment(relation, model.description)) %}\n  {% endif %}\n\n  {# Override: do not set column comments for LBVs #}\n  {% set is_lbv = config.get('materialized') == 'view' and config.get('bind') == false %}\n  {% if for_columns and config.persist_column_docs() and model.columns and not is_lbv %}\n    {% do run_query(alter_column_comment(relation, model.columns)) %}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query", "macro.dbt.alter_relation_comment", "macro.dbt.alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1909409, "supported_languages": null}, "macro.dbt_redshift.escape_comment": {"name": "escape_comment", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.escape_comment", "macro_sql": "{% macro escape_comment(comment) -%}\n  {% if comment is not string %}\n    {% do exceptions.raise_compiler_error('cannot escape a non-string: ' ~ comment) %}\n  {% endif %}\n  {%- set magic = '$dbt_comment_literal_block$' -%}\n  {%- if magic in comment -%}\n    {%- do exceptions.raise_compiler_error('The string ' ~ magic ~ ' is not allowed in comments.') -%}\n  {%- endif -%}\n  {{ magic }}{{ comment }}{{ magic }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.191166, "supported_languages": null}, "macro.dbt_redshift.redshift__alter_relation_comment": {"name": "redshift__alter_relation_comment", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__alter_relation_comment", "macro_sql": "{% macro redshift__alter_relation_comment(relation, comment) %}\n  {%- set escaped_comment = escape_comment(comment) -%}\n  {%- set relation_type = 'view' if relation.type == 'materialized_view' else relation.type -%}\n  comment on {{ relation_type }} {{ relation }} is {{ escaped_comment }};\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.escape_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1913311, "supported_languages": null}, "macro.dbt_redshift.redshift__alter_column_comment": {"name": "redshift__alter_column_comment", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__alter_column_comment", "macro_sql": "{% macro redshift__alter_column_comment(relation, column_dict) %}\n  {% do return(postgres__alter_column_comment(relation, column_dict)) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.191425, "supported_languages": null}, "macro.dbt_redshift.redshift__alter_relation_add_remove_columns": {"name": "redshift__alter_relation_add_remove_columns", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_redshift.redshift__alter_relation_add_remove_columns", "macro_sql": "{% macro redshift__alter_relation_add_remove_columns(relation, add_columns, remove_columns) %}\n\n  {% if add_columns %}\n\n    {% for column in add_columns %}\n      {% set sql -%}\n          alter {{ relation.type }} {{ relation }} add column {{ column.name }} {{ column.data_type }}\n      {% endset %}\n      {% do run_query(sql) %}\n    {% endfor %}\n\n  {% endif %}\n\n  {% if remove_columns %}\n\n    {% for column in remove_columns %}\n      {% set sql -%}\n          alter {{ relation.type }} {{ relation }} drop column {{ column.name }}\n      {% endset %}\n      {% do run_query(sql) %}\n    {% endfor %}\n\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.191775, "supported_languages": null}, "macro.dbt_redshift.redshift__get_materialized_view_configuration_changes": {"name": "redshift__get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/materialized_view.sql", "original_file_path": "macros/materializations/materialized_view.sql", "unique_id": "macro.dbt_redshift.redshift__get_materialized_view_configuration_changes", "macro_sql": "{% macro redshift__get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    {% set _existing_materialized_view = redshift__describe_materialized_view(existing_relation) %}\n    {% set _configuration_changes = existing_relation.materialized_view_config_changeset(_existing_materialized_view, new_config.model) %}\n    {% do return(_configuration_changes) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__describe_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.191977, "supported_languages": null}, "macro.dbt_redshift.redshift__get_merge_sql": {"name": "redshift__get_merge_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/incremental_merge.sql", "original_file_path": "macros/materializations/incremental_merge.sql", "unique_id": "macro.dbt_redshift.redshift__get_merge_sql", "macro_sql": "{% macro redshift__get_merge_sql(target, source, unique_key, dest_columns, incremental_predicates=none) -%}\n    {%- set predicates = _update_predicates(target, incremental_predicates) -%}\n\n    {%- set merge_update_columns = config.get('merge_update_columns') -%}\n    {%- set merge_exclude_columns = config.get('merge_exclude_columns') -%}\n    {%- set update_columns = get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) -%}\n    {%- set insert_columns = get_merge_update_columns(none, none, dest_columns) -%}\n    {%- set sql_header = config.get('sql_header', none) -%}\n\n    {% if unique_key %}\n        {% if unique_key is sequence and unique_key is not mapping and unique_key is not string %}\n            {% for key in unique_key %}\n                {% set this_key_match %}\n                    DBT_INTERNAL_SOURCE.{{ key }} = {{ target }}.{{ key }}\n                {% endset %}\n                {% do predicates.append(this_key_match) %}\n            {% endfor %}\n        {% else %}\n            {% set unique_key_match %}\n                DBT_INTERNAL_SOURCE.{{ unique_key }} = {{ target }}.{{ unique_key }}\n            {% endset %}\n            {% do predicates.append(unique_key_match) %}\n        {% endif %}\n    {% else %}\n        {% do predicates.append('FALSE') %}\n    {% endif %}\n\n    {{ sql_header if sql_header is not none }}\n\n    merge into {{ target }}\n        using {{ source }} as DBT_INTERNAL_SOURCE\n        on {{\"(\" ~ predicates | join(\") and (\") ~ \")\"}}\n\n    {% if unique_key %}\n    when matched then update set\n        {% for column_name in update_columns -%}\n            {{ column_name }} = DBT_INTERNAL_SOURCE.{{ column_name }}\n            {%- if not loop.last %}, {% endif %}\n        {% endfor %}\n    {% endif %}\n\n    when not matched then insert (\n        {% for column_name in insert_columns -%}\n            {{ column_name }}\n            {%- if not loop.last %}, {% endif %}\n        {% endfor %}\n    )\n    values (\n        {% for column_name in insert_columns -%}\n            DBT_INTERNAL_SOURCE.{{ column_name }}\n            {%- if not loop.last %}, {% endif %}\n        {% endfor %}\n    )\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift._update_predicates", "macro.dbt.get_merge_update_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1933959, "supported_languages": null}, "macro.dbt_redshift.redshift__get_incremental_microbatch_sql": {"name": "redshift__get_incremental_microbatch_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/incremental_merge.sql", "original_file_path": "macros/materializations/incremental_merge.sql", "unique_id": "macro.dbt_redshift.redshift__get_incremental_microbatch_sql", "macro_sql": "{% macro redshift__get_incremental_microbatch_sql(arg_dict) %}\n    {#-\n        Technically this function could just call out to the default implementation of delete_insert.\n        However, the default implementation requires a unique_id, which we actually do not want or\n        need. Thus we re-implement delete insert here without the unique_id requirement\n    -#}\n\n    {%- set target = arg_dict[\"target_relation\"] -%}\n    {%- set source = arg_dict[\"temp_relation\"] -%}\n    {%- set dest_columns = arg_dict[\"dest_columns\"] -%}\n    {%- set predicates = [] -%}\n\n    {%- set incremental_predicates = [] if arg_dict.get('incremental_predicates') is none else arg_dict.get('incremental_predicates') -%}\n    {%- for pred in incremental_predicates -%}\n        {% if \"DBT_INTERNAL_DEST.\" in pred %}\n            {%- set pred =  pred | replace(\"DBT_INTERNAL_DEST.\", target ~ \".\" ) -%}\n        {% endif %}\n        {% if \"dbt_internal_dest.\" in pred %}\n            {%- set pred =  pred | replace(\"dbt_internal_dest.\", target ~ \".\" ) -%}\n        {% endif %}\n        {% do predicates.append(pred) %}\n    {% endfor %}\n\n    {% if not model.batch or (not model.batch.event_time_start or not model.batch.event_time_end) -%}\n        {% do exceptions.raise_compiler_error('dbt could not compute the start and end timestamps for the running batch') %}\n    {% endif %}\n\n    {#-- Add additional incremental_predicates to filter for batch --#}\n    {% do predicates.append(model.config.event_time ~ \" >= TIMESTAMP '\" ~ model.batch.event_time_start ~ \"'\") %}\n    {% do predicates.append(model.config.event_time ~ \" < TIMESTAMP '\" ~ model.batch.event_time_end ~ \"'\") %}\n    {% do arg_dict.update({'incremental_predicates': predicates}) %}\n\n    delete from {{ target }}\n    where (\n    {% for predicate in predicates %}\n        {%- if not loop.first %}and {% endif -%} {{ predicate }}\n    {% endfor %}\n    );\n\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n    insert into {{ target }} ({{ dest_cols_csv }})\n    (\n        select {{ dest_cols_csv }}\n        from {{ source }}\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.194347, "supported_languages": null}, "macro.dbt_redshift._update_predicates": {"name": "_update_predicates", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/incremental_merge.sql", "original_file_path": "macros/materializations/incremental_merge.sql", "unique_id": "macro.dbt_redshift._update_predicates", "macro_sql": "{% macro _update_predicates(target, incremental_predicates) %}\n\n    {%- set predicates = [] -%}\n    {% if incremental_predicates is not none %}\n        {%- set incremental_predicates_list = [] + incremental_predicates -%}\n        {%- for pred in incremental_predicates_list -%}\n            {% if \"DBT_INTERNAL_DEST.\" in pred %}\n                {%- set pred =  pred | replace(\"DBT_INTERNAL_DEST.\", target ~ \".\" ) -%}\n            {% endif %}\n            {% if \"dbt_internal_dest.\" in pred %}\n                {%- set pred =  pred | replace(\"dbt_internal_dest.\", target ~ \".\" ) -%}\n            {% endif %}\n            {% do predicates.append(pred) %}\n        {% endfor %}\n    {% endif %}\n\n    {%- do return(predicates) -%}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.194716, "supported_languages": null}, "macro.dbt_redshift.materialization_view_redshift": {"name": "materialization_view_redshift", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/view.sql", "original_file_path": "macros/materializations/view.sql", "unique_id": "macro.dbt_redshift.materialization_view_redshift", "macro_sql": "{%- materialization view, adapter='redshift' -%}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='view') -%}\n  {%- set intermediate_relation =  make_intermediate_relation(target_relation) -%}\n\n  -- the intermediate_relation should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) -%}\n  /*\n     This relation (probably) doesn't exist yet. If it does exist, it's a leftover from\n     a previous run, and we're going to try to drop it immediately. At the end of this\n     materialization, we're going to rename the \"existing_relation\" to this identifier,\n     and then we're going to drop it. In order to make sure we run the correct one of:\n       - drop view ...\n       - drop table ...\n\n     We need to set the type of this relation to be the type of the existing_relation, if it exists,\n     or else \"view\" as a sane default if it does not. Note that if the existing_relation does not\n     exist, then there is nothing to move out of the way and subsequentally drop. In that case,\n     this relation will be effectively unused.\n  */\n  {%- set backup_relation_type = 'view' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n  -- as above, the backup_relation should not already exist\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n  -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- drop the temp relations if they exist already in the database\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_view_as_sql(intermediate_relation, sql) }}\n  {%- endcall %}\n\n  -- cleanup\n  -- move the existing view out of the way\n  {% if existing_relation is not none %}\n     /* Do the equivalent of rename_if_exists. 'existing_relation' could have been dropped\n        since the variable was first set. */\n    {% set existing_relation = load_cached_relation(existing_relation) %}\n    {% if existing_relation is not none %}\n        {% if existing_relation.can_be_renamed %}\n            {{ adapter.rename_relation(existing_relation, backup_relation) }}\n        {% else  %}\n            {{ drop_relation_if_exists(existing_relation) }}\n        {% endif %}\n    {% endif %}\n  {% endif %}\n\n  {{ adapter.rename_relation(intermediate_relation, target_relation) }}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {{ adapter.commit() }}\n\n  {{ drop_relation_if_exists(backup_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.run_hooks", "macro.dbt.drop_relation_if_exists", "macro.dbt.statement", "macro.dbt.get_create_view_as_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.195905, "supported_languages": ["sql"]}, "macro.dbt_redshift.redshift__snapshot_merge_sql": {"name": "redshift__snapshot_merge_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/snapshot_merge.sql", "original_file_path": "macros/materializations/snapshot_merge.sql", "unique_id": "macro.dbt_redshift.redshift__snapshot_merge_sql", "macro_sql": "{% macro redshift__snapshot_merge_sql(target, source, insert_cols) -%}\n    {{ postgres__snapshot_merge_sql(target, source, insert_cols) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__snapshot_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.196039, "supported_languages": null}, "macro.dbt_redshift.materialization_table_redshift": {"name": "materialization_table_redshift", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/table.sql", "original_file_path": "macros/materializations/table.sql", "unique_id": "macro.dbt_redshift.materialization_table_redshift", "macro_sql": "{% materialization table, adapter='redshift' %}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='table') %}\n  {%- set intermediate_relation =  make_intermediate_relation(target_relation) -%}\n  -- the intermediate_relation should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) -%}\n  /*\n      See ../view/view.sql for more information about this relation.\n  */\n  {%- set backup_relation_type = 'table' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n  -- as above, the backup_relation should not already exist\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n  -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n\n  -- drop the temp relations if they exist already in the database\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_table_as_sql(False, intermediate_relation, sql) }}\n  {%- endcall %}\n\n  -- cleanup\n  {% if existing_relation is not none %}\n     /* Do the equivalent of rename_if_exists. 'existing_relation' could have been dropped\n        since the variable was first set. */\n    {% set existing_relation = load_cached_relation(existing_relation) %}\n    {% if existing_relation is not none %}\n        {% if existing_relation.can_be_renamed %}\n            {{ adapter.rename_relation(existing_relation, backup_relation) }}\n        {% else  %}\n            {{ drop_relation_if_exists(existing_relation) }}\n        {% endif %}\n    {% endif %}\n  {% endif %}\n\n\n  {{ adapter.rename_relation(intermediate_relation, target_relation) }}\n\n  {% do create_indexes(target_relation) %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  -- `COMMIT` happens here\n  {{ adapter.commit() }}\n\n  -- finally, drop the existing/backup relation after the commit\n  {{ drop_relation_if_exists(backup_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.get_create_table_as_sql", "macro.dbt.create_indexes", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1972082, "supported_languages": ["sql"]}, "macro.dbt_redshift.default__get_delete_insert_merge_sql": {"name": "default__get_delete_insert_merge_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/incremental_delete_insert.sql", "original_file_path": "macros/materializations/incremental_delete_insert.sql", "unique_id": "macro.dbt_redshift.default__get_delete_insert_merge_sql", "macro_sql": "{% macro default__get_delete_insert_merge_sql(target, source, unique_key, dest_columns, incremental_predicates) -%}\n    {%- set predicates = _update_predicates(target, incremental_predicates) -%}\n\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n\n    {% if unique_key %}\n        {% if unique_key is string %}\n            {% set unique_key = [unique_key] %}\n        {% endif %}\n\n        {%- set unique_key_str = unique_key | join(', ') -%}\n\n    delete from {{ target }}\n    where ({{ unique_key_str }}) in (\n        select distinct {{ unique_key_str }}\n        from {{ source }} as DBT_INTERNAL_SOURCE\n    )\n    {% for predicate in predicates %}\n    and {{ predicate }}\n    {% endfor %}\n    ;\n    {% endif %}\n\n    insert into {{ target }} ({{ dest_cols_csv }})\n        (\n            select {{ dest_cols_csv }}\n            from {{ source }}\n        )\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift._update_predicates", "macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.197692, "supported_languages": null}, "macro.dbt_redshift.redshift__create_csv_table": {"name": "redshift__create_csv_table", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt_redshift.redshift__create_csv_table", "macro_sql": "{% macro redshift__create_csv_table(model, agate_table) %}\n  {%- set column_override = model['config'].get('column_types', {}) -%}\n  {%- set quote_seed_column = model['config'].get('quote_columns', None) -%}\n  {%- set _dist = model['config'].get('dist', None) -%}\n\n  {% set sql %}\n    create table {{ this.render() }} (\n        {%- for col_name in agate_table.column_names -%}\n            {%- set inferred_type = adapter.convert_type(agate_table, loop.index0) -%}\n            {%- set type = column_override.get(col_name, inferred_type) -%}\n            {%- set column_name = (col_name | string) -%}\n            {{ adapter.quote_seed_column(column_name, quote_seed_column) }} {{ type }} {%- if not loop.last -%}, {%- endif -%}\n        {%- endfor -%}\n    )\n    {{ dist(_dist) }}\n  {% endset %}\n\n  {% call statement('_') -%}\n    {{ sql }}\n  {%- endcall %}\n\n  {{ return(sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.dist", "macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1983209, "supported_languages": null}, "macro.dbt_redshift.redshift__get_batch_size": {"name": "redshift__get_batch_size", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt_redshift.redshift__get_batch_size", "macro_sql": "{% macro redshift__get_batch_size() %}\n  {{ return(500) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1983922, "supported_languages": null}, "macro.dbt_redshift.redshift__drop_materialized_view": {"name": "redshift__drop_materialized_view", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt_redshift.redshift__drop_materialized_view", "macro_sql": "{% macro redshift__drop_materialized_view(relation) -%}\n    drop materialized view if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1984699, "supported_languages": null}, "macro.dbt_redshift.redshift__describe_materialized_view": {"name": "redshift__describe_materialized_view", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/materialized_view/describe.sql", "original_file_path": "macros/relations/materialized_view/describe.sql", "unique_id": "macro.dbt_redshift.redshift__describe_materialized_view", "macro_sql": "{% macro redshift__describe_materialized_view(relation) %}\n    {#-\n        These need to be separate queries because redshift will not let you run queries\n        against svv_table_info and pg_views in the same query. The same is true of svv_redshift_columns.\n    -#}\n\n    {%- set _materialized_view_sql -%}\n        select\n            tb.database,\n            tb.schema,\n            tb.table,\n            tb.diststyle,\n            tb.sortkey1,\n            mv.autorefresh\n        from svv_table_info tb\n        -- svv_mv_info is queryable by Redshift Serverless, but stv_mv_info is not\n        left join svv_mv_info mv\n            on mv.database_name = tb.database\n            and mv.schema_name = tb.schema\n            and mv.name = tb.table\n        where tb.table ilike '{{ relation.identifier }}'\n        and tb.schema ilike '{{ relation.schema }}'\n        and tb.database ilike '{{ relation.database }}'\n    {%- endset %}\n    {% set _materialized_view = run_query(_materialized_view_sql) %}\n\n    {%- set _column_descriptor_sql -%}\n        SELECT\n            a.attname as column,\n            a.attisdistkey as is_dist_key,\n            a.attsortkeyord as sort_key_position\n        FROM pg_class c\n        JOIN pg_namespace n ON n.oid = c.relnamespace\n        JOIN pg_attribute a ON a.attrelid = c.oid\n        WHERE\n            n.nspname ilike '{{ relation.schema }}'\n            AND c.relname LIKE 'mv_tbl__{{ relation.identifier }}__%'\n    {%- endset %}\n    {% set _column_descriptor = run_query(_column_descriptor_sql) %}\n\n    {%- set _query_sql -%}\n        select\n            vw.definition\n        from pg_views vw\n        where vw.viewname = '{{ relation.identifier }}'\n        and vw.schemaname = '{{ relation.schema }}'\n        and vw.definition ilike '%create materialized view%'\n    {%- endset %}\n    {% set _query = run_query(_query_sql) %}\n\n    {% do return({\n       'materialized_view': _materialized_view,\n       'query': _query,\n       'columns': _column_descriptor,\n    })%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1990259, "supported_languages": null}, "macro.dbt_redshift.redshift__refresh_materialized_view": {"name": "redshift__refresh_materialized_view", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt_redshift.redshift__refresh_materialized_view", "macro_sql": "{% macro redshift__refresh_materialized_view(relation) -%}\n    refresh materialized view {{ relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.199156, "supported_languages": null}, "macro.dbt_redshift.redshift__get_alter_materialized_view_as_sql": {"name": "redshift__get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt_redshift.redshift__get_alter_materialized_view_as_sql", "macro_sql": "{% macro redshift__get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n\n    -- apply a full refresh immediately if needed\n    {% if configuration_changes.requires_full_refresh %}\n\n        {{ get_replace_sql(existing_relation, relation,  sql) }}\n\n    -- otherwise apply individual changes as needed\n    {% else %}\n\n        {%- set autorefresh = configuration_changes.autorefresh -%}\n        {%- if autorefresh -%}{{- log('Applying UPDATE AUTOREFRESH to: ' ~ relation) -}}{%- endif -%}\n\n        alter materialized view {{ relation }}\n            auto refresh {% if autorefresh.context %}yes{% else %}no{% endif %}\n\n    {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_replace_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.199522, "supported_languages": null}, "macro.dbt_redshift.redshift__get_create_materialized_view_as_sql": {"name": "redshift__get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt_redshift.redshift__get_create_materialized_view_as_sql", "macro_sql": "{% macro redshift__get_create_materialized_view_as_sql(relation, sql) %}\n\n    {%- set materialized_view = relation.from_config(config.model) -%}\n\n    create materialized view {{ materialized_view.path }}\n        backup {% if materialized_view.backup %}yes{% else %}no{% endif %}\n        diststyle {{ materialized_view.dist.diststyle }}\n        {% if materialized_view.dist.distkey %}distkey ({{ materialized_view.dist.distkey }}){% endif %}\n        {% if materialized_view.sort.sortkey %}sortkey ({{ ','.join(materialized_view.sort.sortkey) }}){% endif %}\n        auto refresh {% if materialized_view.autorefresh %}yes{% else %}no{% endif %}\n    as (\n        {{ materialized_view.query }}\n    )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.1999302, "supported_languages": null}, "macro.dbt_redshift.redshift__drop_table": {"name": "redshift__drop_table", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt_redshift.redshift__drop_table", "macro_sql": "{%- macro redshift__drop_table(relation) -%}\n    drop table if exists {{ relation }} cascade\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2000158, "supported_languages": null}, "macro.dbt_redshift.redshift__get_rename_table_sql": {"name": "redshift__get_rename_table_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt_redshift.redshift__get_rename_table_sql", "macro_sql": "{% macro redshift__get_rename_table_sql(relation, new_name) %}\n    alter table {{ relation }} rename to {{ new_name }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2001112, "supported_languages": null}, "macro.dbt_redshift.redshift__drop_view": {"name": "redshift__drop_view", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt_redshift.redshift__drop_view", "macro_sql": "{%- macro redshift__drop_view(relation) -%}\n    drop view if exists {{ relation }} cascade\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.200191, "supported_languages": null}, "macro.dbt_redshift.redshift__get_replace_view_sql": {"name": "redshift__get_replace_view_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt_redshift.redshift__get_replace_view_sql", "macro_sql": "{% macro redshift__get_replace_view_sql(relation, sql) -%}\n\n  {%- set binding = config.get('bind', default=True) -%}\n\n  {% set bind_qualifier = '' if binding else 'with no schema binding' %}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  create or replace view {{ relation }}\n  {%- set contract_config = config.get('contract') -%}\n  {%- if contract_config.enforced -%}\n    {{ get_assert_columns_equivalent(sql) }}\n  {%- endif %} as (\n    {{ sql }}\n  ) {{ bind_qualifier }}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.200562, "supported_languages": null}, "macro.dbt_redshift.redshift__get_rename_view_sql": {"name": "redshift__get_rename_view_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt_redshift.redshift__get_rename_view_sql", "macro_sql": "{% macro redshift__get_rename_view_sql(relation, new_name) %}\n    alter table {{ relation }} rename to {{ new_name }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.200664, "supported_languages": null}, "macro.dbt_redshift.redshift__get_catalog_relations": {"name": "redshift__get_catalog_relations", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_relation.sql", "original_file_path": "macros/catalog/by_relation.sql", "unique_id": "macro.dbt_redshift.redshift__get_catalog_relations", "macro_sql": "{% macro redshift__get_catalog_relations(information_schema, relations) -%}\n\n    {% set database = information_schema.database %}\n    {{ adapter.verify_database(database) }}\n\n    {#-- Compute a left-outer join in memory. Some Redshift queries are\n      -- leader-only, and cannot be joined to other compute-based queries #}\n\n    {% set catalog = _redshift__get_base_catalog_by_relation(database, relations) %}\n\n    {% set select_extended = redshift__can_select_from('svv_table_info') %}\n    {% if select_extended %}\n        {% set extended_catalog = _redshift__get_extended_catalog_by_relation(relations) %}\n        {% set catalog = catalog.join(extended_catalog, ['table_schema', 'table_name']) %}\n    {% else %}\n        {{ redshift__no_svv_table_info_warning() }}\n    {% endif %}\n\n    {{ return(catalog) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift._redshift__get_base_catalog_by_relation", "macro.dbt_redshift.redshift__can_select_from", "macro.dbt_redshift._redshift__get_extended_catalog_by_relation", "macro.dbt_redshift.redshift__no_svv_table_info_warning"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.201343, "supported_languages": null}, "macro.dbt_redshift._redshift__get_base_catalog_by_relation": {"name": "_redshift__get_base_catalog_by_relation", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_relation.sql", "original_file_path": "macros/catalog/by_relation.sql", "unique_id": "macro.dbt_redshift._redshift__get_base_catalog_by_relation", "macro_sql": "{% macro _redshift__get_base_catalog_by_relation(database, relations) -%}\n    {%- call statement('base_catalog', fetch_result=True) -%}\n        with\n            late_binding as ({{ _redshift__get_late_binding_by_relation_sql(relations) }}),\n            early_binding as ({{ _redshift__get_early_binding_by_relation_sql(database, relations) }}),\n            unioned as (select * from early_binding union all select * from late_binding),\n            table_owners as ({{ redshift__get_table_owners_sql() }})\n        select '{{ database }}' as table_database, *\n        from unioned\n        join table_owners using (table_schema, table_name)\n        order by \"column_index\"\n    {%- endcall -%}\n    {{ return(load_result('base_catalog').table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_redshift._redshift__get_late_binding_by_relation_sql", "macro.dbt_redshift._redshift__get_early_binding_by_relation_sql", "macro.dbt_redshift.redshift__get_table_owners_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.201577, "supported_languages": null}, "macro.dbt_redshift._redshift__get_late_binding_by_relation_sql": {"name": "_redshift__get_late_binding_by_relation_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_relation.sql", "original_file_path": "macros/catalog/by_relation.sql", "unique_id": "macro.dbt_redshift._redshift__get_late_binding_by_relation_sql", "macro_sql": "{% macro _redshift__get_late_binding_by_relation_sql(relations) %}\n    {{ redshift__get_late_binding_sql() }}\n    where (\n        {%- for relation in relations -%}\n            (\n                upper(table_schema) = upper('{{ relation.schema }}')\n            and upper(table_name) = upper('{{ relation.identifier }}')\n            )\n            {%- if not loop.last %} or {% endif -%}\n        {%- endfor -%}\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_late_binding_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.20175, "supported_languages": null}, "macro.dbt_redshift._redshift__get_early_binding_by_relation_sql": {"name": "_redshift__get_early_binding_by_relation_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_relation.sql", "original_file_path": "macros/catalog/by_relation.sql", "unique_id": "macro.dbt_redshift._redshift__get_early_binding_by_relation_sql", "macro_sql": "{% macro _redshift__get_early_binding_by_relation_sql(database, relations) %}\n    {{ redshift__get_early_binding_sql(database) }}\n    and (\n        {%- for relation in relations -%}\n            (\n                upper(sch.nspname) = upper('{{ relation.schema }}')\n            and upper(tbl.relname) = upper('{{ relation.identifier }}')\n            )\n            {%- if not loop.last %} or {% endif -%}\n        {%- endfor -%}\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_early_binding_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.201919, "supported_languages": null}, "macro.dbt_redshift._redshift__get_extended_catalog_by_relation": {"name": "_redshift__get_extended_catalog_by_relation", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_relation.sql", "original_file_path": "macros/catalog/by_relation.sql", "unique_id": "macro.dbt_redshift._redshift__get_extended_catalog_by_relation", "macro_sql": "{% macro _redshift__get_extended_catalog_by_relation(relations) %}\n    {%- call statement('extended_catalog', fetch_result=True) -%}\n        {{ redshift__get_extended_catalog_sql() }}\n        where (\n            {%- for relation in relations -%}\n                (\n                    upper(\"schema\") = upper('{{ relation.schema }}')\n                and upper(\"table\") = upper('{{ relation.identifier }}')\n                )\n            {%- if not loop.last %} or {% endif -%}\n            {%- endfor -%}\n        )\n    {%- endcall -%}\n    {{ return(load_result('extended_catalog').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_redshift.redshift__get_extended_catalog_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.202157, "supported_languages": null}, "macro.dbt_redshift.redshift__get_late_binding_sql": {"name": "redshift__get_late_binding_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/catalog.sql", "original_file_path": "macros/catalog/catalog.sql", "unique_id": "macro.dbt_redshift.redshift__get_late_binding_sql", "macro_sql": "{% macro redshift__get_late_binding_sql() %}\n    select\n        table_schema,\n        table_name,\n        'LATE BINDING VIEW'::varchar as table_type,\n        null::text as table_comment,\n        column_name,\n        column_index,\n        column_type,\n        null::text as column_comment\n    from pg_get_late_binding_view_cols()\n        cols(\n            table_schema name,\n            table_name name,\n            column_name name,\n            column_type varchar,\n            column_index int\n        )\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.202527, "supported_languages": null}, "macro.dbt_redshift.redshift__get_early_binding_sql": {"name": "redshift__get_early_binding_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/catalog.sql", "original_file_path": "macros/catalog/catalog.sql", "unique_id": "macro.dbt_redshift.redshift__get_early_binding_sql", "macro_sql": "{% macro redshift__get_early_binding_sql(database) %}\n    select\n        sch.nspname as table_schema,\n        tbl.relname as table_name,\n        case\n            when tbl.relkind = 'v' and mat_views.table_name is not null then 'MATERIALIZED VIEW'\n            when tbl.relkind = 'v' then 'VIEW'\n            else 'BASE TABLE'\n        end as table_type,\n        tbl_desc.description as table_comment,\n        col.attname as column_name,\n        col.attnum as column_index,\n        pg_catalog.format_type(col.atttypid, col.atttypmod) as column_type,\n        col_desc.description as column_comment\n    from pg_catalog.pg_namespace sch\n    join pg_catalog.pg_class tbl\n        on tbl.relnamespace = sch.oid\n    join pg_catalog.pg_attribute col\n        on col.attrelid = tbl.oid\n    left outer join pg_catalog.pg_description tbl_desc\n        on tbl_desc.objoid = tbl.oid\n        and tbl_desc.objsubid = 0\n    left outer join pg_catalog.pg_description col_desc\n        on col_desc.objoid = tbl.oid\n        and col_desc.objsubid = col.attnum\n    left outer join information_schema.views mat_views\n        on mat_views.table_schema = sch.nspname\n        and mat_views.table_name = tbl.relname\n        and mat_views.view_definition ilike '%create materialized view%'\n        and mat_views.table_catalog = '{{ database }}'\n    where tbl.relkind in ('r', 'v', 'f', 'p')\n    and col.attnum > 0\n    and not col.attisdropped\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.202645, "supported_languages": null}, "macro.dbt_redshift.redshift__get_table_owners_sql": {"name": "redshift__get_table_owners_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/catalog.sql", "original_file_path": "macros/catalog/catalog.sql", "unique_id": "macro.dbt_redshift.redshift__get_table_owners_sql", "macro_sql": "{% macro redshift__get_table_owners_sql() %}\n    select\n        schemaname as table_schema,\n        tablename as table_name,\n        tableowner as table_owner\n    from pg_tables\n    union all\n    select\n        schemaname as table_schema,\n        viewname as table_name,\n        viewowner as table_owner\n    from pg_views\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.202698, "supported_languages": null}, "macro.dbt_redshift.redshift__get_extended_catalog_sql": {"name": "redshift__get_extended_catalog_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/catalog.sql", "original_file_path": "macros/catalog/catalog.sql", "unique_id": "macro.dbt_redshift.redshift__get_extended_catalog_sql", "macro_sql": "{% macro redshift__get_extended_catalog_sql() %}\n    select\n        \"schema\" as table_schema,\n        \"table\" as table_name,\n\n        'Encoded'::text as \"stats:encoded:label\",\n        encoded as \"stats:encoded:value\",\n        'Indicates whether any column in the table has compression encoding defined.'::text as \"stats:encoded:description\",\n        true as \"stats:encoded:include\",\n\n        'Dist Style' as \"stats:diststyle:label\",\n        diststyle as \"stats:diststyle:value\",\n        'Distribution style or distribution key column, if key distribution is defined.'::text as \"stats:diststyle:description\",\n        true as \"stats:diststyle:include\",\n\n        'Sort Key 1' as \"stats:sortkey1:label\",\n        -- handle 0xFF byte in response for interleaved sort styles\n        case\n            when sortkey1 like 'INTERLEAVED%' then 'INTERLEAVED'::text\n            else sortkey1\n        end as \"stats:sortkey1:value\",\n        'First column in the sort key.'::text as \"stats:sortkey1:description\",\n        (sortkey1 is not null) as \"stats:sortkey1:include\",\n\n        'Max Varchar' as \"stats:max_varchar:label\",\n        max_varchar as \"stats:max_varchar:value\",\n        'Size of the largest column that uses a VARCHAR data type.'::text as \"stats:max_varchar:description\",\n        true as \"stats:max_varchar:include\",\n\n        -- exclude this, as the data is strangely returned with null-byte characters\n        'Sort Key 1 Encoding' as \"stats:sortkey1_enc:label\",\n        sortkey1_enc as \"stats:sortkey1_enc:value\",\n        'Compression encoding of the first column in the sort key.' as \"stats:sortkey1_enc:description\",\n        false as \"stats:sortkey1_enc:include\",\n\n        '# Sort Keys' as \"stats:sortkey_num:label\",\n        sortkey_num as \"stats:sortkey_num:value\",\n        'Number of columns defined as sort keys.' as \"stats:sortkey_num:description\",\n        (sortkey_num > 0) as \"stats:sortkey_num:include\",\n\n        'Approximate Size' as \"stats:size:label\",\n        size * 1000000 as \"stats:size:value\",\n        'Approximate size of the table, calculated from a count of 1MB blocks'::text as \"stats:size:description\",\n        true as \"stats:size:include\",\n\n        'Disk Utilization' as \"stats:pct_used:label\",\n        pct_used / 100.0 as \"stats:pct_used:value\",\n        'Percent of available space that is used by the table.'::text as \"stats:pct_used:description\",\n        true as \"stats:pct_used:include\",\n\n        'Unsorted %' as \"stats:unsorted:label\",\n        unsorted / 100.0 as \"stats:unsorted:value\",\n        'Percent of unsorted rows in the table.'::text as \"stats:unsorted:description\",\n        (unsorted is not null) as \"stats:unsorted:include\",\n\n        'Stats Off' as \"stats:stats_off:label\",\n        stats_off as \"stats:stats_off:value\",\n        'Number that indicates how stale the table statistics are; 0 is current, 100 is out of date.'::text as \"stats:stats_off:description\",\n        true as \"stats:stats_off:include\",\n\n        'Approximate Row Count' as \"stats:rows:label\",\n        tbl_rows as \"stats:rows:value\",\n        'Approximate number of rows in the table. This value includes rows marked for deletion, but not yet vacuumed.'::text as \"stats:rows:description\",\n        true as \"stats:rows:include\",\n\n        'Sort Key Skew' as \"stats:skew_sortkey1:label\",\n        skew_sortkey1 as \"stats:skew_sortkey1:value\",\n        'Ratio of the size of the largest non-sort key column to the size of the first column of the sort key.'::text as \"stats:skew_sortkey1:description\",\n        (skew_sortkey1 is not null) as \"stats:skew_sortkey1:include\",\n\n        'Skew Rows' as \"stats:skew_rows:label\",\n        skew_rows as \"stats:skew_rows:value\",\n        'Ratio of the number of rows in the slice with the most rows to the number of rows in the slice with the fewest rows.'::text as \"stats:skew_rows:description\",\n        (skew_rows is not null) as \"stats:skew_rows:include\"\n\n    from svv_table_info\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2028952, "supported_languages": null}, "macro.dbt_redshift.redshift__can_select_from": {"name": "redshift__can_select_from", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/catalog.sql", "original_file_path": "macros/catalog/catalog.sql", "unique_id": "macro.dbt_redshift.redshift__can_select_from", "macro_sql": "{% macro redshift__can_select_from(table_name) %}\n\n    {%- call statement('has_table_privilege', fetch_result=True) -%}\n        select has_table_privilege(current_user, '{{ table_name }}', 'SELECT') as can_select\n    {%- endcall -%}\n\n    {% set can_select = load_result('has_table_privilege').table[0]['can_select'] %}\n    {{ return(can_select) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.203143, "supported_languages": null}, "macro.dbt_redshift.redshift__no_svv_table_info_warning": {"name": "redshift__no_svv_table_info_warning", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/catalog.sql", "original_file_path": "macros/catalog/catalog.sql", "unique_id": "macro.dbt_redshift.redshift__no_svv_table_info_warning", "macro_sql": "{% macro redshift__no_svv_table_info_warning() %}\n\n    {% set msg %}\n\n    Warning: The database user \"{{ target.user }}\" has insufficient permissions to\n    query the \"svv_table_info\" table. Please grant SELECT permissions on this table\n    to the \"{{ target.user }}\" user to fetch extended table details from Redshift.\n\n    {% endset %}\n\n    {{ log(msg, info=True) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.203281, "supported_languages": null}, "macro.dbt_redshift.redshift__get_catalog": {"name": "redshift__get_catalog", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_schema.sql", "original_file_path": "macros/catalog/by_schema.sql", "unique_id": "macro.dbt_redshift.redshift__get_catalog", "macro_sql": "{% macro redshift__get_catalog(information_schema, schemas) %}\n\n    {% set database = information_schema.database %}\n    {{ adapter.verify_database(database) }}\n\n    {#-- Compute a left-outer join in memory. Some Redshift queries are\n      -- leader-only, and cannot be joined to other compute-based queries #}\n\n    {% set catalog = _redshift__get_base_catalog_by_schema(database, schemas) %}\n\n    {% set select_extended = redshift__can_select_from('svv_table_info') %}\n    {% if select_extended %}\n        {% set extended_catalog = _redshift__get_extended_catalog_by_schema(schemas) %}\n        {% set catalog = catalog.join(extended_catalog, ['table_schema', 'table_name']) %}\n    {% else %}\n        {{ redshift__no_svv_table_info_warning() }}\n    {% endif %}\n\n    {{ return(catalog) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift._redshift__get_base_catalog_by_schema", "macro.dbt_redshift.redshift__can_select_from", "macro.dbt_redshift._redshift__get_extended_catalog_by_schema", "macro.dbt_redshift.redshift__no_svv_table_info_warning"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.203844, "supported_languages": null}, "macro.dbt_redshift._redshift__get_base_catalog_by_schema": {"name": "_redshift__get_base_catalog_by_schema", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_schema.sql", "original_file_path": "macros/catalog/by_schema.sql", "unique_id": "macro.dbt_redshift._redshift__get_base_catalog_by_schema", "macro_sql": "{% macro _redshift__get_base_catalog_by_schema(database, schemas) -%}\n    {%- call statement('base_catalog', fetch_result=True) -%}\n        with\n            late_binding as ({{ _redshift__get_late_binding_by_schema_sql(schemas) }}),\n            early_binding as ({{ _redshift__get_early_binding_by_schema_sql(database, schemas) }}),\n            unioned as (select * from early_binding union all select * from late_binding),\n            table_owners as ({{ redshift__get_table_owners_sql() }})\n        select '{{ database }}' as table_database, *\n        from unioned\n        join table_owners using (table_schema, table_name)\n        order by \"column_index\"\n    {%- endcall -%}\n    {{ return(load_result('base_catalog').table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_redshift._redshift__get_late_binding_by_schema_sql", "macro.dbt_redshift._redshift__get_early_binding_by_schema_sql", "macro.dbt_redshift.redshift__get_table_owners_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.204059, "supported_languages": null}, "macro.dbt_redshift._redshift__get_late_binding_by_schema_sql": {"name": "_redshift__get_late_binding_by_schema_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_schema.sql", "original_file_path": "macros/catalog/by_schema.sql", "unique_id": "macro.dbt_redshift._redshift__get_late_binding_by_schema_sql", "macro_sql": "{% macro _redshift__get_late_binding_by_schema_sql(schemas) %}\n    {{ redshift__get_late_binding_sql() }}\n    where (\n        {%- for schema in schemas -%}\n            upper(table_schema) = upper('{{ schema }}'){%- if not loop.last %} or {% endif -%}\n        {%- endfor -%}\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_late_binding_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2041988, "supported_languages": null}, "macro.dbt_redshift._redshift__get_early_binding_by_schema_sql": {"name": "_redshift__get_early_binding_by_schema_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_schema.sql", "original_file_path": "macros/catalog/by_schema.sql", "unique_id": "macro.dbt_redshift._redshift__get_early_binding_by_schema_sql", "macro_sql": "{% macro _redshift__get_early_binding_by_schema_sql(database, schemas) %}\n    {{ redshift__get_early_binding_sql(database) }}\n    and (\n        {%- for schema in schemas -%}\n            upper(sch.nspname) = upper('{{ schema }}'){%- if not loop.last %} or {% endif -%}\n        {%- endfor -%}\n    )\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_early_binding_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.204343, "supported_languages": null}, "macro.dbt_redshift._redshift__get_extended_catalog_by_schema": {"name": "_redshift__get_extended_catalog_by_schema", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/catalog/by_schema.sql", "original_file_path": "macros/catalog/by_schema.sql", "unique_id": "macro.dbt_redshift._redshift__get_extended_catalog_by_schema", "macro_sql": "{% macro _redshift__get_extended_catalog_by_schema(schemas) %}\n    {%- call statement('extended_catalog', fetch_result=True) -%}\n        {{ redshift__get_extended_catalog_sql() }}\n        where (\n            {%- for schema in schemas -%}\n                upper(\"schema\") = upper('{{ schema }}'){%- if not loop.last %} or {% endif -%}\n            {%- endfor -%}\n        )\n    {%- endcall -%}\n    {{ return(load_result('extended_catalog').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt_redshift.redshift__get_extended_catalog_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.204554, "supported_languages": null}, "macro.dbt_redshift.redshift__length": {"name": "redshift__length", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/length.sql", "original_file_path": "macros/utils/length.sql", "unique_id": "macro.dbt_redshift.redshift__length", "macro_sql": "{% macro redshift__length(expression) %}\n\n    len(\n        {{ expression }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.20464, "supported_languages": null}, "macro.dbt_redshift.redshift__dateadd": {"name": "redshift__dateadd", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt_redshift.redshift__dateadd", "macro_sql": "{% macro redshift__dateadd(datepart, interval, from_date_or_timestamp) %}\n\n    dateadd(\n        {{ datepart }},\n        {{ interval }},\n        {{ from_date_or_timestamp }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.204758, "supported_languages": null}, "macro.dbt_redshift.redshift__listagg": {"name": "redshift__listagg", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt_redshift.redshift__listagg", "macro_sql": "{% macro redshift__listagg(measure, delimiter_text, order_by_clause, limit_num) -%}\n\n    {% if limit_num -%}\n    {% set ns = namespace() %}\n    {% set ns.delimiter_text_regex = delimiter_text|trim(\"'\") %}\n    {% set special_chars %}\\,^,$,.,|,?,*,+,(,),[,],{,}{% endset %}\n    {%- for char in special_chars.split(',') -%}\n        {% set escape_char %}\\\\{{ char }}{% endset %}\n        {% set ns.delimiter_text_regex = ns.delimiter_text_regex|replace(char,escape_char) %}\n    {%- endfor -%}\n\n    {% set regex %}'([^{{ ns.delimiter_text_regex }}]+{{ ns.delimiter_text_regex }}){1,{{ limit_num - 1}}}[^{{ ns.delimiter_text_regex }}]+'{% endset %}\n    regexp_substr(\n        listagg(\n            {{ measure }},\n            {{ delimiter_text }}\n            )\n            {% if order_by_clause -%}\n            within group ({{ order_by_clause }})\n            {%- endif %}\n        ,{{ regex }}\n        )\n    {%- else %}\n    listagg(\n        {{ measure }},\n        {{ delimiter_text }}\n        )\n        {% if order_by_clause -%}\n        within group ({{ order_by_clause }})\n        {%- endif %}\n    {%- endif %}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2054021, "supported_languages": null}, "macro.dbt_redshift.redshift__datediff": {"name": "redshift__datediff", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt_redshift.redshift__datediff", "macro_sql": "{% macro redshift__datediff(first_date, second_date, datepart) -%}\n\n    datediff(\n        {{ datepart }},\n        {{ first_date }},\n        {{ second_date }}\n        )\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.205526, "supported_languages": null}, "macro.dbt_redshift.redshift__cast_bool_to_text": {"name": "redshift__cast_bool_to_text", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/cast_bool_to_text.sql", "original_file_path": "macros/utils/cast_bool_to_text.sql", "unique_id": "macro.dbt_redshift.redshift__cast_bool_to_text", "macro_sql": "{% macro redshift__cast_bool_to_text(field) %}\n    case\n        when {{ field }} is true then 'true'\n        when {{ field }} is false then 'false'\n    end::text\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.205628, "supported_languages": null}, "macro.dbt_redshift.redshift__array_concat": {"name": "redshift__array_concat", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/array_concat.sql", "original_file_path": "macros/utils/array_concat.sql", "unique_id": "macro.dbt_redshift.redshift__array_concat", "macro_sql": "{% macro redshift__array_concat(array_1, array_2) -%}\n    array_concat({{ array_1 }}, {{ array_2 }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2057228, "supported_languages": null}, "macro.dbt_redshift.redshift__last_day": {"name": "redshift__last_day", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt_redshift.redshift__last_day", "macro_sql": "{% macro redshift__last_day(date, datepart) %}\n    cast(\n        {{dbt.dateadd('day', '-1',\n        dbt.dateadd(datepart, '1', dbt.date_trunc(datepart, date))\n        )}}\n        as date)\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.dateadd", "macro.dbt.date_trunc"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.205888, "supported_languages": null}, "macro.dbt_redshift.redshift__split_part": {"name": "redshift__split_part", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt_redshift.redshift__split_part", "macro_sql": "{% macro redshift__split_part(string_text, delimiter_text, part_number) %}\n\n  {% if part_number >= 0 %}\n    {{ dbt.default__split_part(string_text, delimiter_text, part_number) }}\n  {% else %}\n    {{ dbt._split_part_negative(string_text, delimiter_text, part_number) }}\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__split_part", "macro.dbt._split_part_negative"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.206103, "supported_languages": null}, "macro.dbt_redshift.redshift__array_construct": {"name": "redshift__array_construct", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/array_construct.sql", "original_file_path": "macros/utils/array_construct.sql", "unique_id": "macro.dbt_redshift.redshift__array_construct", "macro_sql": "{% macro redshift__array_construct(inputs, data_type) -%}\n    array( {{ inputs|join(' , ') }} )\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.206207, "supported_languages": null}, "macro.dbt_redshift.redshift__array_append": {"name": "redshift__array_append", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/utils/array_append.sql", "original_file_path": "macros/utils/array_append.sql", "unique_id": "macro.dbt_redshift.redshift__array_append", "macro_sql": "{% macro redshift__array_append(array, new_element) -%}\n    {{ array_concat(array, array_construct([new_element])) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.array_concat", "macro.dbt.array_construct"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.206323, "supported_languages": null}, "macro.dbt_redshift.redshift__validate_fixture_rows": {"name": "redshift__validate_fixture_rows", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters/unit_testing.sql", "original_file_path": "macros/adapters/unit_testing.sql", "unique_id": "macro.dbt_redshift.redshift__validate_fixture_rows", "macro_sql": "{%- macro redshift__validate_fixture_rows(rows, row_number) -%}\n  {%- if rows is not none and rows|length > 0 -%}\n    {%- set row = rows[0] -%}\n    {%- for key, value in row.items() -%}\n      {%- if value is none -%}\n          {%- set fixture_name = \"expected output\" if model.resource_type == 'unit_test' else (\"'\" ~ model.name ~ \"'\") -%}\n          {{ exceptions.raise_compiler_error(\"Unit test fixture \" ~ fixture_name ~ \" in \" ~ model.name ~ \" does not have any row free of null values, which may cause type mismatch errors during unit test execution.\") }}\n      {%- endif -%}\n    {%- endfor -%}\n  {%- endif -%}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2067142, "supported_languages": null}, "macro.dbt_redshift.redshift__get_show_grant_sql": {"name": "redshift__get_show_grant_sql", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt_redshift.redshift__get_show_grant_sql", "macro_sql": "{% macro redshift__get_show_grant_sql(relation) %}\n\nwith privileges as (\n\n    -- valid options per https://docs.aws.amazon.com/redshift/latest/dg/r_HAS_TABLE_PRIVILEGE.html\n    select 'select' as privilege_type\n    union all\n    select 'insert' as privilege_type\n    union all\n    select 'update' as privilege_type\n    union all\n    select 'delete' as privilege_type\n    union all\n    select 'references' as privilege_type\n\n)\n\nselect\n    u.usename as grantee,\n    p.privilege_type\nfrom pg_user u\ncross join privileges p\nwhere has_table_privilege(u.usename, '{{ relation }}', privilege_type)\n    and u.usename != current_user\n    and not u.usesuper\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.206843, "supported_languages": null}, "macro.dbt_redshift.redshift__get_relation_last_modified": {"name": "redshift__get_relation_last_modified", "resource_type": "macro", "package_name": "dbt_redshift", "path": "macros/metadata/relation_last_modified.sql", "original_file_path": "macros/metadata/relation_last_modified.sql", "unique_id": "macro.dbt_redshift.redshift__get_relation_last_modified", "macro_sql": "{% macro redshift__get_relation_last_modified(information_schema, relations) -%}\n\n    {%- call statement('last_modified', fetch_result=True) -%}\n        select\n            ns.nspname as \"schema\",\n            c.relname as identifier,\n            max(qd.start_time) as last_modified,\n            {{ current_timestamp() }} as snapshotted_at\n        from pg_class c\n        join pg_namespace ns\n            on ns.oid = c.relnamespace\n        join sys_query_detail qd\n            on qd.table_id = c.oid\n        where qd.step_name = 'insert'\n        and (\n            {%- for relation in relations -%}\n                (\n                    upper(ns.nspname) = upper('{{ relation.schema }}')\n                and upper(c.relname) = upper('{{ relation.identifier }}')\n                )\n                {%- if not loop.last %} or {% endif -%}\n            {%- endfor -%}\n        )\n        group by 1, 2, 4\n    {%- endcall -%}\n\n    {{ return(load_result('last_modified')) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.207176, "supported_languages": null}, "macro.dbt_postgres.postgres__current_timestamp": {"name": "postgres__current_timestamp", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_postgres.postgres__current_timestamp", "macro_sql": "{% macro postgres__current_timestamp() -%}\n    now()\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.207295, "supported_languages": null}, "macro.dbt_postgres.postgres__snapshot_string_as_time": {"name": "postgres__snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_postgres.postgres__snapshot_string_as_time", "macro_sql": "{% macro postgres__snapshot_string_as_time(timestamp) -%}\n    {%- set result = \"'\" ~ timestamp ~ \"'::timestamp without time zone\" -%}\n    {{ return(result) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.207393, "supported_languages": null}, "macro.dbt_postgres.postgres__snapshot_get_time": {"name": "postgres__snapshot_get_time", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_postgres.postgres__snapshot_get_time", "macro_sql": "{% macro postgres__snapshot_get_time() -%}\n  {{ current_timestamp() }}::timestamp without time zone\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2074518, "supported_languages": null}, "macro.dbt_postgres.postgres__current_timestamp_backcompat": {"name": "postgres__current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_postgres.postgres__current_timestamp_backcompat", "macro_sql": "{% macro postgres__current_timestamp_backcompat() %}\n    current_timestamp::{{ type_timestamp() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.type_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.207513, "supported_languages": null}, "macro.dbt_postgres.postgres__current_timestamp_in_utc_backcompat": {"name": "postgres__current_timestamp_in_utc_backcompat", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/timestamps.sql", "original_file_path": "macros/timestamps.sql", "unique_id": "macro.dbt_postgres.postgres__current_timestamp_in_utc_backcompat", "macro_sql": "{% macro postgres__current_timestamp_in_utc_backcompat() %}\n    (current_timestamp at time zone 'utc')::{{ type_timestamp() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.type_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.207571, "supported_languages": null}, "macro.dbt_postgres.postgres__get_catalog_relations": {"name": "postgres__get_catalog_relations", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/catalog.sql", "original_file_path": "macros/catalog.sql", "unique_id": "macro.dbt_postgres.postgres__get_catalog_relations", "macro_sql": "{% macro postgres__get_catalog_relations(information_schema, relations) -%}\n  {%- call statement('catalog', fetch_result=True) -%}\n\n    {#\n      If the user has multiple databases set and the first one is wrong, this will fail.\n      But we won't fail in the case where there are multiple quoting-difference-only dbs, which is better.\n    #}\n    {% set database = information_schema.database %}\n    {{ adapter.verify_database(database) }}\n\n    select\n        '{{ database }}' as table_database,\n        sch.nspname as table_schema,\n        tbl.relname as table_name,\n        case tbl.relkind\n            when 'v' then 'VIEW'\n            when 'm' then 'MATERIALIZED VIEW'\n            else 'BASE TABLE'\n        end as table_type,\n        tbl_desc.description as table_comment,\n        col.attname as column_name,\n        col.attnum as column_index,\n        pg_catalog.format_type(col.atttypid, col.atttypmod) as column_type,\n        col_desc.description as column_comment,\n        pg_get_userbyid(tbl.relowner) as table_owner\n\n    from pg_catalog.pg_namespace sch\n    join pg_catalog.pg_class tbl on tbl.relnamespace = sch.oid\n    join pg_catalog.pg_attribute col on col.attrelid = tbl.oid\n    left outer join pg_catalog.pg_description tbl_desc on (tbl_desc.objoid = tbl.oid and tbl_desc.objsubid = 0)\n    left outer join pg_catalog.pg_description col_desc on (col_desc.objoid = tbl.oid and col_desc.objsubid = col.attnum)\n    where (\n      {%- for relation in relations -%}\n        {%- if relation.identifier -%}\n          (upper(sch.nspname) = upper('{{ relation.schema }}') and\n           upper(tbl.relname) = upper('{{ relation.identifier }}'))\n        {%- else-%}\n          upper(sch.nspname) = upper('{{ relation.schema }}')\n        {%- endif -%}\n        {%- if not loop.last %} or {% endif -%}\n      {%- endfor -%}\n    )\n      and not pg_is_other_temp_schema(sch.oid) -- not a temporary schema belonging to another session\n      and tbl.relpersistence in ('p', 'u') -- [p]ermanent table or [u]nlogged table. Exclude [t]emporary tables\n      and tbl.relkind in ('r', 'v', 'f', 'p', 'm') -- o[r]dinary table, [v]iew, [f]oreign table, [p]artitioned table, [m]aterialized view. Other values are [i]ndex, [S]equence, [c]omposite type, [t]OAST table\n      and col.attnum > 0 -- negative numbers are used for system columns such as oid\n      and not col.attisdropped -- column as not been dropped\n\n    order by\n        sch.nspname,\n        tbl.relname,\n        col.attnum\n\n  {%- endcall -%}\n\n  {{ return(load_result('catalog').table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.208135, "supported_languages": null}, "macro.dbt_postgres.postgres__get_catalog": {"name": "postgres__get_catalog", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/catalog.sql", "original_file_path": "macros/catalog.sql", "unique_id": "macro.dbt_postgres.postgres__get_catalog", "macro_sql": "{% macro postgres__get_catalog(information_schema, schemas) -%}\n  {%- set relations = [] -%}\n  {%- for schema in schemas -%}\n    {%- set dummy = relations.append({'schema': schema}) -%}\n  {%- endfor -%}\n  {{ return(postgres__get_catalog_relations(information_schema, relations)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_catalog_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.208383, "supported_languages": null}, "macro.dbt_postgres.postgres__get_relations": {"name": "postgres__get_relations", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations.sql", "original_file_path": "macros/relations.sql", "unique_id": "macro.dbt_postgres.postgres__get_relations", "macro_sql": "{% macro postgres__get_relations() -%}\n\n  {#\n      -- in pg_depend, objid is the dependent, refobjid is the referenced object\n      --  > a pg_depend entry indicates that the referenced object cannot be\n      --  > dropped without also dropping the dependent object.\n  #}\n\n  {%- call statement('relations', fetch_result=True) -%}\n    with relation as (\n        select\n            pg_rewrite.ev_class as class,\n            pg_rewrite.oid as id\n        from pg_rewrite\n    ),\n    class as (\n        select\n            oid as id,\n            relname as name,\n            relnamespace as schema,\n            relkind as kind\n        from pg_class\n    ),\n    dependency as (\n        select distinct\n            pg_depend.objid as id,\n            pg_depend.refobjid as ref\n        from pg_depend\n    ),\n    schema as (\n        select\n            pg_namespace.oid as id,\n            pg_namespace.nspname as name\n        from pg_namespace\n        where nspname != 'information_schema' and nspname not like 'pg\\_%'\n    ),\n    referenced as (\n        select\n            relation.id AS id,\n            referenced_class.name ,\n            referenced_class.schema ,\n            referenced_class.kind\n        from relation\n        join class as referenced_class on relation.class=referenced_class.id\n        where referenced_class.kind in ('r', 'v', 'm')\n    ),\n    relationships as (\n        select\n            referenced.name as referenced_name,\n            referenced.schema as referenced_schema_id,\n            dependent_class.name as dependent_name,\n            dependent_class.schema as dependent_schema_id,\n            referenced.kind as kind\n        from referenced\n        join dependency on referenced.id=dependency.id\n        join class as dependent_class on dependency.ref=dependent_class.id\n        where\n            (referenced.name != dependent_class.name or\n             referenced.schema != dependent_class.schema)\n    )\n\n    select\n        referenced_schema.name as referenced_schema,\n        relationships.referenced_name as referenced_name,\n        dependent_schema.name as dependent_schema,\n        relationships.dependent_name as dependent_name\n    from relationships\n    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id\n    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id\n    group by referenced_schema, referenced_name, dependent_schema, dependent_name\n    order by referenced_schema, referenced_name, dependent_schema, dependent_name;\n\n  {%- endcall -%}\n\n  {{ return(load_result('relations').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.208731, "supported_languages": null}, "macro.dbt_postgres.postgres_get_relations": {"name": "postgres_get_relations", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations.sql", "original_file_path": "macros/relations.sql", "unique_id": "macro.dbt_postgres.postgres_get_relations", "macro_sql": "{% macro postgres_get_relations() %}\n  {{ return(postgres__get_relations()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.208799, "supported_languages": null}, "macro.dbt_postgres.postgres__create_table_as": {"name": "postgres__create_table_as", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__create_table_as", "macro_sql": "{% macro postgres__create_table_as(temporary, relation, sql) -%}\n  {%- set unlogged = config.get('unlogged', default=false) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  create {% if temporary -%}\n    temporary\n  {%- elif unlogged -%}\n    unlogged\n  {%- endif %} table {{ relation }}\n  {% set contract_config = config.get('contract') %}\n  {% if contract_config.enforced %}\n    {{ get_assert_columns_equivalent(sql) }}\n  {% endif -%}\n  {% if contract_config.enforced and (not temporary) -%}\n      {{ get_table_columns_and_constraints() }} ;\n    insert into {{ relation }} (\n      {{ adapter.dispatch('get_column_names', 'dbt')() }}\n    )\n    {%- set sql = get_select_subquery(sql) %}\n  {% else %}\n    as\n  {% endif %}\n  (\n    {{ sql }}\n  );\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent", "macro.dbt.get_table_columns_and_constraints", "macro.dbt.default__get_column_names", "macro.dbt.get_select_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.210046, "supported_languages": null}, "macro.dbt_postgres.postgres__get_create_index_sql": {"name": "postgres__get_create_index_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__get_create_index_sql", "macro_sql": "{% macro postgres__get_create_index_sql(relation, index_dict) -%}\n  {%- set index_config = adapter.parse_index(index_dict) -%}\n  {%- set comma_separated_columns = \", \".join(index_config.columns) -%}\n  {%- set index_name = index_config.render(relation) -%}\n\n  create {% if index_config.unique -%}\n    unique\n  {%- endif %} index if not exists\n  \"{{ index_name }}\"\n  on {{ relation }} {% if index_config.type -%}\n    using {{ index_config.type }}\n  {%- endif %}\n  ({{ comma_separated_columns }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.210315, "supported_languages": null}, "macro.dbt_postgres.postgres__create_schema": {"name": "postgres__create_schema", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__create_schema", "macro_sql": "{% macro postgres__create_schema(relation) -%}\n  {% if relation.database -%}\n    {{ adapter.verify_database(relation.database) }}\n  {%- endif -%}\n  {%- call statement('create_schema') -%}\n    create schema if not exists {{ relation.without_identifier().include(database=False) }}\n  {%- endcall -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.210484, "supported_languages": null}, "macro.dbt_postgres.postgres__drop_schema": {"name": "postgres__drop_schema", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__drop_schema", "macro_sql": "{% macro postgres__drop_schema(relation) -%}\n  {% if relation.database -%}\n    {{ adapter.verify_database(relation.database) }}\n  {%- endif -%}\n  {%- call statement('drop_schema') -%}\n    drop schema if exists {{ relation.without_identifier().include(database=False) }} cascade\n  {%- endcall -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.210651, "supported_languages": null}, "macro.dbt_postgres.postgres__get_columns_in_relation": {"name": "postgres__get_columns_in_relation", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__get_columns_in_relation", "macro_sql": "{% macro postgres__get_columns_in_relation(relation) -%}\n  {% call statement('get_columns_in_relation', fetch_result=True) %}\n      select\n          column_name,\n          data_type,\n          character_maximum_length,\n          numeric_precision,\n          numeric_scale\n\n      from {{ relation.information_schema('columns') }}\n      where table_name = '{{ relation.identifier }}'\n        {% if relation.schema %}\n        and table_schema = '{{ relation.schema }}'\n        {% endif %}\n      order by ordinal_position\n\n  {% endcall %}\n  {% set table = load_result('get_columns_in_relation').table %}\n  {{ return(sql_convert_columns_in_relation(table)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.sql_convert_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.210892, "supported_languages": null}, "macro.dbt_postgres.postgres__list_relations_without_caching": {"name": "postgres__list_relations_without_caching", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__list_relations_without_caching", "macro_sql": "{% macro postgres__list_relations_without_caching(schema_relation) %}\n  {% call statement('list_relations_without_caching', fetch_result=True) -%}\n    select\n      '{{ schema_relation.database }}' as database,\n      tablename as name,\n      schemaname as schema,\n      'table' as type\n    from pg_tables\n    where schemaname ilike '{{ schema_relation.schema }}'\n    union all\n    select\n      '{{ schema_relation.database }}' as database,\n      viewname as name,\n      schemaname as schema,\n      'view' as type\n    from pg_views\n    where schemaname ilike '{{ schema_relation.schema }}'\n    union all\n    select\n      '{{ schema_relation.database }}' as database,\n      matviewname as name,\n      schemaname as schema,\n      'materialized_view' as type\n    from pg_matviews\n    where schemaname ilike '{{ schema_relation.schema }}'\n  {% endcall %}\n  {{ return(load_result('list_relations_without_caching').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2111192, "supported_languages": null}, "macro.dbt_postgres.postgres__information_schema_name": {"name": "postgres__information_schema_name", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__information_schema_name", "macro_sql": "{% macro postgres__information_schema_name(database) -%}\n  {% if database_name -%}\n    {{ adapter.verify_database(database_name) }}\n  {%- endif -%}\n  information_schema\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.211216, "supported_languages": null}, "macro.dbt_postgres.postgres__list_schemas": {"name": "postgres__list_schemas", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__list_schemas", "macro_sql": "{% macro postgres__list_schemas(database) %}\n  {% if database -%}\n    {{ adapter.verify_database(database) }}\n  {%- endif -%}\n  {% call statement('list_schemas', fetch_result=True, auto_begin=False) %}\n    select distinct nspname from pg_namespace\n  {% endcall %}\n  {{ return(load_result('list_schemas').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.211394, "supported_languages": null}, "macro.dbt_postgres.postgres__check_schema_exists": {"name": "postgres__check_schema_exists", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__check_schema_exists", "macro_sql": "{% macro postgres__check_schema_exists(information_schema, schema) -%}\n  {% if information_schema.database -%}\n    {{ adapter.verify_database(information_schema.database) }}\n  {%- endif -%}\n  {% call statement('check_schema_exists', fetch_result=True, auto_begin=False) %}\n    select count(*) from pg_namespace where nspname = '{{ schema }}'\n  {% endcall %}\n  {{ return(load_result('check_schema_exists').table) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2115939, "supported_languages": null}, "macro.dbt_postgres.postgres__make_relation_with_suffix": {"name": "postgres__make_relation_with_suffix", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__make_relation_with_suffix", "macro_sql": "{% macro postgres__make_relation_with_suffix(base_relation, suffix, dstring) %}\n    {% if dstring %}\n      {% set dt = modules.datetime.datetime.now() %}\n      {% set dtstring = dt.strftime(\"%H%M%S%f\") %}\n      {% set suffix = suffix ~ dtstring %}\n    {% endif %}\n    {% set suffix_length = suffix|length %}\n    {% set relation_max_name_length = base_relation.relation_max_name_length() %}\n    {% if suffix_length > relation_max_name_length %}\n        {% do exceptions.raise_compiler_error('Relation suffix is too long (' ~ suffix_length ~ ' characters). Maximum length is ' ~ relation_max_name_length ~ ' characters.') %}\n    {% endif %}\n    {% set identifier = base_relation.identifier[:relation_max_name_length - suffix_length] ~ suffix %}\n\n    {{ return(base_relation.incorporate(path={\"identifier\": identifier })) }}\n\n  {% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.21202, "supported_languages": null}, "macro.dbt_postgres.postgres__make_intermediate_relation": {"name": "postgres__make_intermediate_relation", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__make_intermediate_relation", "macro_sql": "{% macro postgres__make_intermediate_relation(base_relation, suffix) %}\n    {{ return(postgres__make_relation_with_suffix(base_relation, suffix, dstring=False)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__make_relation_with_suffix"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2121222, "supported_languages": null}, "macro.dbt_postgres.postgres__make_temp_relation": {"name": "postgres__make_temp_relation", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__make_temp_relation", "macro_sql": "{% macro postgres__make_temp_relation(base_relation, suffix) %}\n    {% set temp_relation = postgres__make_relation_with_suffix(base_relation, suffix, dstring=True) %}\n    {{ return(temp_relation.incorporate(path={\"schema\": none,\n                                              \"database\": none})) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__make_relation_with_suffix"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.212287, "supported_languages": null}, "macro.dbt_postgres.postgres__make_backup_relation": {"name": "postgres__make_backup_relation", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__make_backup_relation", "macro_sql": "{% macro postgres__make_backup_relation(base_relation, backup_relation_type, suffix) %}\n    {% set backup_relation = postgres__make_relation_with_suffix(base_relation, suffix, dstring=False) %}\n    {{ return(backup_relation.incorporate(type=backup_relation_type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__make_relation_with_suffix"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.21243, "supported_languages": null}, "macro.dbt_postgres.postgres_escape_comment": {"name": "postgres_escape_comment", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres_escape_comment", "macro_sql": "{% macro postgres_escape_comment(comment) -%}\n  {% if comment is not string %}\n    {% do exceptions.raise_compiler_error('cannot escape a non-string: ' ~ comment) %}\n  {% endif %}\n  {%- set magic = '$dbt_comment_literal_block$' -%}\n  {%- if magic in comment -%}\n    {%- do exceptions.raise_compiler_error('The string ' ~ magic ~ ' is not allowed in comments.') -%}\n  {%- endif -%}\n  {{ magic }}{{ comment }}{{ magic }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.212659, "supported_languages": null}, "macro.dbt_postgres.postgres__alter_relation_comment": {"name": "postgres__alter_relation_comment", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__alter_relation_comment", "macro_sql": "{% macro postgres__alter_relation_comment(relation, comment) %}\n  {% set escaped_comment = postgres_escape_comment(comment) %}\n  {% if relation.type == 'materialized_view' -%}\n    {% set relation_type = \"materialized view\" %}\n  {%- else -%}\n    {%- set relation_type = relation.type -%}\n  {%- endif -%}\n  comment on {{ relation_type }} {{ relation }} is {{ escaped_comment }};\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres_escape_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.212857, "supported_languages": null}, "macro.dbt_postgres.postgres__alter_column_comment": {"name": "postgres__alter_column_comment", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__alter_column_comment", "macro_sql": "{% macro postgres__alter_column_comment(relation, column_dict) %}\n  {% set existing_columns = adapter.get_columns_in_relation(relation) | map(attribute=\"name\") | list %}\n  {% for column_name in column_dict if (column_name in existing_columns) %}\n    {% set comment = column_dict[column_name]['description'] %}\n    {% set escaped_comment = postgres_escape_comment(comment) %}\n    comment on column {{ relation }}.{{ adapter.quote(column_name) if column_dict[column_name]['quote'] else column_name }} is {{ escaped_comment }};\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres_escape_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.21316, "supported_languages": null}, "macro.dbt_postgres.postgres__get_show_grant_sql": {"name": "postgres__get_show_grant_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__get_show_grant_sql", "macro_sql": "\n\n{%- macro postgres__get_show_grant_sql(relation) -%}\n  select grantee, privilege_type\n  from {{ relation.information_schema('role_table_grants') }}\n      where grantor = current_role\n        and grantee != current_role\n        and table_schema = '{{ relation.schema }}'\n        and table_name = '{{ relation.identifier }}'\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2132711, "supported_languages": null}, "macro.dbt_postgres.postgres__copy_grants": {"name": "postgres__copy_grants", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__copy_grants", "macro_sql": "{% macro postgres__copy_grants() %}\n    {{ return(False) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.213336, "supported_languages": null}, "macro.dbt_postgres.postgres__get_show_indexes_sql": {"name": "postgres__get_show_indexes_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__get_show_indexes_sql", "macro_sql": "{% macro postgres__get_show_indexes_sql(relation) %}\n    select\n        i.relname                                   as name,\n        m.amname                                    as method,\n        ix.indisunique                              as \"unique\",\n        array_to_string(array_agg(a.attname), ',')  as column_names\n    from pg_index ix\n    join pg_class i\n        on i.oid = ix.indexrelid\n    join pg_am m\n        on m.oid=i.relam\n    join pg_class t\n        on t.oid = ix.indrelid\n    join pg_namespace n\n        on n.oid = t.relnamespace\n    join pg_attribute a\n        on a.attrelid = t.oid\n        and a.attnum = ANY(ix.indkey)\n    where t.relname = '{{ relation.identifier }}'\n      and n.nspname = '{{ relation.schema }}'\n      and t.relkind in ('r', 'm')\n    group by 1, 2, 3\n    order by 1, 2, 3\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.213438, "supported_languages": null}, "macro.dbt_postgres.postgres__get_drop_index_sql": {"name": "postgres__get_drop_index_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/adapters.sql", "original_file_path": "macros/adapters.sql", "unique_id": "macro.dbt_postgres.postgres__get_drop_index_sql", "macro_sql": "\n\n\n{%- macro postgres__get_drop_index_sql(relation, index_name) -%}\n    drop index if exists \"{{ relation.schema }}\".\"{{ index_name }}\"\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.213513, "supported_languages": null}, "macro.dbt_postgres.postgres__get_incremental_default_sql": {"name": "postgres__get_incremental_default_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/materializations/incremental_strategies.sql", "original_file_path": "macros/materializations/incremental_strategies.sql", "unique_id": "macro.dbt_postgres.postgres__get_incremental_default_sql", "macro_sql": "{% macro postgres__get_incremental_default_sql(arg_dict) %}\n\n  {% if arg_dict[\"unique_key\"] %}\n    {% do return(get_incremental_delete_insert_sql(arg_dict)) %}\n  {% else %}\n    {% do return(get_incremental_append_sql(arg_dict)) %}\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_incremental_delete_insert_sql", "macro.dbt.get_incremental_append_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.213747, "supported_languages": null}, "macro.dbt_postgres.postgres__get_incremental_microbatch_sql": {"name": "postgres__get_incremental_microbatch_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/materializations/incremental_strategies.sql", "original_file_path": "macros/materializations/incremental_strategies.sql", "unique_id": "macro.dbt_postgres.postgres__get_incremental_microbatch_sql", "macro_sql": "{% macro postgres__get_incremental_microbatch_sql(arg_dict) %}\n\n  {% if arg_dict[\"unique_key\"] %}\n    {% do return(adapter.dispatch('get_incremental_merge_sql', 'dbt')(arg_dict)) %}\n  {% else %}\n    {{ exceptions.raise_compiler_error(\"dbt-postgres 'microbatch' requires a `unique_key` config\") }}\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_incremental_merge_sql", "macro.dbt.default__get_incremental_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.213983, "supported_languages": null}, "macro.dbt_postgres.postgres__snapshot_merge_sql": {"name": "postgres__snapshot_merge_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/materializations/snapshot_merge.sql", "original_file_path": "macros/materializations/snapshot_merge.sql", "unique_id": "macro.dbt_postgres.postgres__snapshot_merge_sql", "macro_sql": "{% macro postgres__snapshot_merge_sql(target, source, insert_cols) -%}\n    {%- set insert_cols_csv = insert_cols | join(', ') -%}\n\n    {%- set columns = config.get(\"snapshot_table_column_names\") or get_snapshot_table_column_names() -%}\n\n    update {{ target }}\n    set {{ columns.dbt_valid_to }} = DBT_INTERNAL_SOURCE.{{ columns.dbt_valid_to }}\n    from {{ source }} as DBT_INTERNAL_SOURCE\n    where DBT_INTERNAL_SOURCE.{{ columns.dbt_scd_id }}::text = {{ target }}.{{ columns.dbt_scd_id }}::text\n      and DBT_INTERNAL_SOURCE.dbt_change_type::text in ('update'::text, 'delete'::text)\n      {% if config.get(\"dbt_valid_to_current\") %}\n        and ({{ target }}.{{ columns.dbt_valid_to }} = {{ config.get('dbt_valid_to_current') }} or {{ target }}.{{ columns.dbt_valid_to }} is null);\n      {% else %}\n        and {{ target }}.{{ columns.dbt_valid_to }} is null;\n      {% endif %}\n\n\n    insert into {{ target }} ({{ insert_cols_csv }})\n    select {% for column in insert_cols -%}\n        DBT_INTERNAL_SOURCE.{{ column }} {%- if not loop.last %}, {%- endif %}\n    {%- endfor %}\n    from {{ source }} as DBT_INTERNAL_SOURCE\n    where DBT_INTERNAL_SOURCE.dbt_change_type::text = 'insert'::text;\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_snapshot_table_column_names"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.21456, "supported_languages": null}, "macro.dbt_postgres.postgres__drop_materialized_view": {"name": "postgres__drop_materialized_view", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt_postgres.postgres__drop_materialized_view", "macro_sql": "{% macro postgres__drop_materialized_view(relation) -%}\n    drop materialized view if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.214645, "supported_languages": null}, "macro.dbt_postgres.postgres__describe_materialized_view": {"name": "postgres__describe_materialized_view", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/describe.sql", "original_file_path": "macros/relations/materialized_view/describe.sql", "unique_id": "macro.dbt_postgres.postgres__describe_materialized_view", "macro_sql": "{% macro postgres__describe_materialized_view(relation) %}\n    -- for now just get the indexes, we don't need the name or the query yet\n    {% set _indexes = run_query(get_show_indexes_sql(relation)) %}\n    {% do return({'indexes': _indexes}) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query", "macro.dbt.get_show_indexes_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2148008, "supported_languages": null}, "macro.dbt_postgres.postgres__refresh_materialized_view": {"name": "postgres__refresh_materialized_view", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt_postgres.postgres__refresh_materialized_view", "macro_sql": "{% macro postgres__refresh_materialized_view(relation) %}\n    refresh materialized view {{ relation }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2148821, "supported_languages": null}, "macro.dbt_postgres.postgres__get_rename_materialized_view_sql": {"name": "postgres__get_rename_materialized_view_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/rename.sql", "original_file_path": "macros/relations/materialized_view/rename.sql", "unique_id": "macro.dbt_postgres.postgres__get_rename_materialized_view_sql", "macro_sql": "{% macro postgres__get_rename_materialized_view_sql(relation, new_name) %}\n    alter materialized view {{ relation }} rename to {{ new_name }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2149749, "supported_languages": null}, "macro.dbt_postgres.postgres__get_alter_materialized_view_as_sql": {"name": "postgres__get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt_postgres.postgres__get_alter_materialized_view_as_sql", "macro_sql": "{% macro postgres__get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n\n    -- apply a full refresh immediately if needed\n    {% if configuration_changes.requires_full_refresh %}\n\n        {{ get_replace_sql(existing_relation, relation, sql) }}\n\n    -- otherwise apply individual changes as needed\n    {% else %}\n\n        {{ postgres__update_indexes_on_materialized_view(relation, configuration_changes.indexes) }}\n\n    {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_replace_sql", "macro.dbt_postgres.postgres__update_indexes_on_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.215277, "supported_languages": null}, "macro.dbt_postgres.postgres__update_indexes_on_materialized_view": {"name": "postgres__update_indexes_on_materialized_view", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt_postgres.postgres__update_indexes_on_materialized_view", "macro_sql": "\n\n\n{%- macro postgres__update_indexes_on_materialized_view(relation, index_changes) -%}\n    {{- log(\"Applying UPDATE INDEXES to: \" ~ relation) -}}\n\n    {%- for _index_change in index_changes -%}\n        {%- set _index = _index_change.context -%}\n\n        {%- if _index_change.action == \"drop\" -%}\n\n            {{ postgres__get_drop_index_sql(relation, _index.name) }}\n\n        {%- elif _index_change.action == \"create\" -%}\n\n            {{ postgres__get_create_index_sql(relation, _index.as_node_config) }}\n\n        {%- endif -%}\n\t{{ ';' if not loop.last else \"\" }}\n\n    {%- endfor -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_drop_index_sql", "macro.dbt_postgres.postgres__get_create_index_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.215551, "supported_languages": null}, "macro.dbt_postgres.postgres__get_materialized_view_configuration_changes": {"name": "postgres__get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt_postgres.postgres__get_materialized_view_configuration_changes", "macro_sql": "{% macro postgres__get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    {% set _existing_materialized_view = postgres__describe_materialized_view(existing_relation) %}\n    {% set _configuration_changes = existing_relation.get_materialized_view_config_change_collection(_existing_materialized_view, new_config.model) %}\n    {% do return(_configuration_changes) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__describe_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.215706, "supported_languages": null}, "macro.dbt_postgres.postgres__get_create_materialized_view_as_sql": {"name": "postgres__get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt_postgres.postgres__get_create_materialized_view_as_sql", "macro_sql": "{% macro postgres__get_create_materialized_view_as_sql(relation, sql) %}\n    create materialized view if not exists {{ relation }} as {{ sql }};\n\n    {% for _index_dict in config.get('indexes', []) -%}\n        {{- get_create_index_sql(relation, _index_dict) -}}{{ ';' if not loop.last else \"\" }}\n    {%- endfor -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_create_index_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.215936, "supported_languages": null}, "macro.dbt_postgres.postgres__drop_table": {"name": "postgres__drop_table", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt_postgres.postgres__drop_table", "macro_sql": "{% macro postgres__drop_table(relation) -%}\n    drop table if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2160199, "supported_languages": null}, "macro.dbt_postgres.postgres__get_replace_table_sql": {"name": "postgres__get_replace_table_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/table/replace.sql", "original_file_path": "macros/relations/table/replace.sql", "unique_id": "macro.dbt_postgres.postgres__get_replace_table_sql", "macro_sql": "{% macro postgres__get_replace_table_sql(relation, sql) -%}\n\n    {%- set sql_header = config.get('sql_header', none) -%}\n    {{ sql_header if sql_header is not none }}\n\n    create or replace table {{ relation }}\n        {% set contract_config = config.get('contract') %}\n        {% if contract_config.enforced %}\n            {{ get_assert_columns_equivalent(sql) }}\n            {{ get_table_columns_and_constraints() }}\n            {%- set sql = get_select_subquery(sql) %}\n        {% endif %}\n    as (\n        {{ sql }}\n    );\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent", "macro.dbt.get_table_columns_and_constraints", "macro.dbt.get_select_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.216346, "supported_languages": null}, "macro.dbt_postgres.postgres__get_rename_table_sql": {"name": "postgres__get_rename_table_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt_postgres.postgres__get_rename_table_sql", "macro_sql": "{% macro postgres__get_rename_table_sql(relation, new_name) %}\n    alter table {{ relation }} rename to {{ new_name }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.216444, "supported_languages": null}, "macro.dbt_postgres.postgres__drop_view": {"name": "postgres__drop_view", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt_postgres.postgres__drop_view", "macro_sql": "{% macro postgres__drop_view(relation) -%}\n    drop view if exists {{ relation }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.216521, "supported_languages": null}, "macro.dbt_postgres.postgres__get_replace_view_sql": {"name": "postgres__get_replace_view_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt_postgres.postgres__get_replace_view_sql", "macro_sql": "{% macro postgres__get_replace_view_sql(relation, sql) -%}\n\n    {%- set sql_header = config.get('sql_header', none) -%}\n    {{ sql_header if sql_header is not none }}\n\n    create or replace view {{ relation }}\n        {% set contract_config = config.get('contract') %}\n        {% if contract_config.enforced %}\n            {{ get_assert_columns_equivalent(sql) }}\n        {%- endif %}\n    as (\n        {{ sql }}\n    );\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.216796, "supported_languages": null}, "macro.dbt_postgres.postgres__get_rename_view_sql": {"name": "postgres__get_rename_view_sql", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt_postgres.postgres__get_rename_view_sql", "macro_sql": "{% macro postgres__get_rename_view_sql(relation, new_name) %}\n    alter view {{ relation }} rename to {{ new_name }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.216906, "supported_languages": null}, "macro.dbt_postgres.postgres__dateadd": {"name": "postgres__dateadd", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt_postgres.postgres__dateadd", "macro_sql": "{% macro postgres__dateadd(datepart, interval, from_date_or_timestamp) %}\n\n    {{ from_date_or_timestamp }} + ((interval '1 {{ datepart }}') * ({{ interval }}))\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.217023, "supported_languages": null}, "macro.dbt_postgres.postgres__listagg": {"name": "postgres__listagg", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt_postgres.postgres__listagg", "macro_sql": "{% macro postgres__listagg(measure, delimiter_text, order_by_clause, limit_num) -%}\n\n    {% if limit_num -%}\n    array_to_string(\n        (array_agg(\n            {{ measure }}\n            {% if order_by_clause -%}\n            {{ order_by_clause }}\n            {%- endif %}\n        ))[1:{{ limit_num }}],\n        {{ delimiter_text }}\n        )\n    {%- else %}\n    string_agg(\n        {{ measure }},\n        {{ delimiter_text }}\n        {% if order_by_clause -%}\n        {{ order_by_clause }}\n        {%- endif %}\n        )\n    {%- endif %}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.217298, "supported_languages": null}, "macro.dbt_postgres.postgres__datediff": {"name": "postgres__datediff", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt_postgres.postgres__datediff", "macro_sql": "{% macro postgres__datediff(first_date, second_date, datepart) -%}\n\n    {% if datepart == 'year' %}\n        (date_part('year', ({{second_date}})::date) - date_part('year', ({{first_date}})::date))\n    {% elif datepart == 'quarter' %}\n        ({{ datediff(first_date, second_date, 'year') }} * 4 + date_part('quarter', ({{second_date}})::date) - date_part('quarter', ({{first_date}})::date))\n    {% elif datepart == 'month' %}\n        ({{ datediff(first_date, second_date, 'year') }} * 12 + date_part('month', ({{second_date}})::date) - date_part('month', ({{first_date}})::date))\n    {% elif datepart == 'day' %}\n        (({{second_date}})::date - ({{first_date}})::date)\n    {% elif datepart == 'week' %}\n        ({{ datediff(first_date, second_date, 'day') }} / 7 + case\n            when date_part('dow', ({{first_date}})::timestamp) <= date_part('dow', ({{second_date}})::timestamp) then\n                case when {{first_date}} <= {{second_date}} then 0 else -1 end\n            else\n                case when {{first_date}} <= {{second_date}} then 1 else 0 end\n        end)\n    {% elif datepart == 'hour' %}\n        ({{ datediff(first_date, second_date, 'day') }} * 24 + date_part('hour', ({{second_date}})::timestamp) - date_part('hour', ({{first_date}})::timestamp))\n    {% elif datepart == 'minute' %}\n        ({{ datediff(first_date, second_date, 'hour') }} * 60 + date_part('minute', ({{second_date}})::timestamp) - date_part('minute', ({{first_date}})::timestamp))\n    {% elif datepart == 'second' %}\n        ({{ datediff(first_date, second_date, 'minute') }} * 60 + floor(date_part('second', ({{second_date}})::timestamp)) - floor(date_part('second', ({{first_date}})::timestamp)))\n    {% elif datepart == 'millisecond' %}\n        ({{ datediff(first_date, second_date, 'minute') }} * 60000 + floor(date_part('millisecond', ({{second_date}})::timestamp)) - floor(date_part('millisecond', ({{first_date}})::timestamp)))\n    {% elif datepart == 'microsecond' %}\n        ({{ datediff(first_date, second_date, 'minute') }} * 60000000 + floor(date_part('microsecond', ({{second_date}})::timestamp)) - floor(date_part('microsecond', ({{first_date}})::timestamp)))\n    {% else %}\n        {{ exceptions.raise_compiler_error(\"Unsupported datepart for macro datediff in postgres: {!r}\".format(datepart)) }}\n    {% endif %}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2183738, "supported_languages": null}, "macro.dbt_postgres.postgres__any_value": {"name": "postgres__any_value", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/utils/any_value.sql", "original_file_path": "macros/utils/any_value.sql", "unique_id": "macro.dbt_postgres.postgres__any_value", "macro_sql": "{% macro postgres__any_value(expression) -%}\n\n    min({{ expression }})\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.218467, "supported_languages": null}, "macro.dbt_postgres.postgres__last_day": {"name": "postgres__last_day", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt_postgres.postgres__last_day", "macro_sql": "{% macro postgres__last_day(date, datepart) -%}\n\n    {%- if datepart == 'quarter' -%}\n    -- postgres dateadd does not support quarter interval.\n    cast(\n        {{dbt.dateadd('day', '-1',\n        dbt.dateadd('month', '3', dbt.date_trunc(datepart, date))\n        )}}\n        as date)\n    {%- else -%}\n    {{dbt.default_last_day(date, datepart)}}\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.dateadd", "macro.dbt.date_trunc", "macro.dbt.default_last_day"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.218722, "supported_languages": null}, "macro.dbt_postgres.postgres__split_part": {"name": "postgres__split_part", "resource_type": "macro", "package_name": "dbt_postgres", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt_postgres.postgres__split_part", "macro_sql": "{% macro postgres__split_part(string_text, delimiter_text, part_number) %}\n\n  {% if part_number >= 0 %}\n    {{ dbt.default__split_part(string_text, delimiter_text, part_number) }}\n  {% else %}\n    {{ dbt._split_part_negative(string_text, delimiter_text, part_number) }}\n  {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__split_part", "macro.dbt._split_part_negative"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.218933, "supported_languages": null}, "macro.dbt.run_hooks": {"name": "run_hooks", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.run_hooks", "macro_sql": "{% macro run_hooks(hooks, inside_transaction=True) %}\n  {% for hook in hooks | selectattr('transaction', 'equalto', inside_transaction)  %}\n    {% if not inside_transaction and loop.first %}\n      {% call statement(auto_begin=inside_transaction) %}\n        commit;\n      {% endcall %}\n    {% endif %}\n    {% set rendered = render(hook.get('sql')) | trim %}\n    {% if (rendered | length) > 0 %}\n      {% call statement(auto_begin=inside_transaction) %}\n        {{ rendered }}\n      {% endcall %}\n    {% endif %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2193868, "supported_languages": null}, "macro.dbt.make_hook_config": {"name": "make_hook_config", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.make_hook_config", "macro_sql": "{% macro make_hook_config(sql, inside_transaction) %}\n    {{ tojson({\"sql\": sql, \"transaction\": inside_transaction}) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.219549, "supported_languages": null}, "macro.dbt.before_begin": {"name": "before_begin", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.before_begin", "macro_sql": "{% macro before_begin(sql) %}\n    {{ make_hook_config(sql, inside_transaction=False) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_hook_config"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.219628, "supported_languages": null}, "macro.dbt.in_transaction": {"name": "in_transaction", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.in_transaction", "macro_sql": "{% macro in_transaction(sql) %}\n    {{ make_hook_config(sql, inside_transaction=True) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_hook_config"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.219703, "supported_languages": null}, "macro.dbt.after_commit": {"name": "after_commit", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/hooks.sql", "original_file_path": "macros/materializations/hooks.sql", "unique_id": "macro.dbt.after_commit", "macro_sql": "{% macro after_commit(sql) %}\n    {{ make_hook_config(sql, inside_transaction=False) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_hook_config"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.219778, "supported_languages": null}, "macro.dbt.set_sql_header": {"name": "set_sql_header", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/configs.sql", "original_file_path": "macros/materializations/configs.sql", "unique_id": "macro.dbt.set_sql_header", "macro_sql": "{% macro set_sql_header(config) -%}\n  {{ config.set('sql_header', caller()) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2199402, "supported_languages": null}, "macro.dbt.should_full_refresh": {"name": "should_full_refresh", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/configs.sql", "original_file_path": "macros/materializations/configs.sql", "unique_id": "macro.dbt.should_full_refresh", "macro_sql": "{% macro should_full_refresh() %}\n  {% set config_full_refresh = config.get('full_refresh') %}\n  {% if config_full_refresh is none %}\n    {% set config_full_refresh = flags.FULL_REFRESH %}\n  {% endif %}\n  {% do return(config_full_refresh) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.220095, "supported_languages": null}, "macro.dbt.should_store_failures": {"name": "should_store_failures", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/configs.sql", "original_file_path": "macros/materializations/configs.sql", "unique_id": "macro.dbt.should_store_failures", "macro_sql": "{% macro should_store_failures() %}\n  {% set config_store_failures = config.get('store_failures') %}\n  {% if config_store_failures is none %}\n    {% set config_store_failures = flags.STORE_FAILURES %}\n  {% endif %}\n  {% do return(config_store_failures) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2202501, "supported_languages": null}, "macro.dbt.snapshot_merge_sql": {"name": "snapshot_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/snapshot_merge.sql", "original_file_path": "macros/materializations/snapshots/snapshot_merge.sql", "unique_id": "macro.dbt.snapshot_merge_sql", "macro_sql": "{% macro snapshot_merge_sql(target, source, insert_cols) -%}\n  {{ adapter.dispatch('snapshot_merge_sql', 'dbt')(target, source, insert_cols) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__snapshot_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2204852, "supported_languages": null}, "macro.dbt.default__snapshot_merge_sql": {"name": "default__snapshot_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/snapshot_merge.sql", "original_file_path": "macros/materializations/snapshots/snapshot_merge.sql", "unique_id": "macro.dbt.default__snapshot_merge_sql", "macro_sql": "{% macro default__snapshot_merge_sql(target, source, insert_cols) -%}\n    {%- set insert_cols_csv = insert_cols | join(', ') -%}\n\n    {%- set columns = config.get(\"snapshot_table_column_names\") or get_snapshot_table_column_names() -%}\n\n    merge into {{ target.render() }} as DBT_INTERNAL_DEST\n    using {{ source }} as DBT_INTERNAL_SOURCE\n    on DBT_INTERNAL_SOURCE.{{ columns.dbt_scd_id }} = DBT_INTERNAL_DEST.{{ columns.dbt_scd_id }}\n\n    when matched\n     {% if config.get(\"dbt_valid_to_current\") %}\n\t{% set source_unique_key = (\"DBT_INTERNAL_DEST.\" ~ columns.dbt_valid_to) | trim %}\n\t{% set target_unique_key = config.get('dbt_valid_to_current') | trim %}\n\tand ({{ equals(source_unique_key, target_unique_key) }} or {{ source_unique_key }} is null)\n\n     {% else %}\n       and DBT_INTERNAL_DEST.{{ columns.dbt_valid_to }} is null\n     {% endif %}\n     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')\n        then update\n        set {{ columns.dbt_valid_to }} = DBT_INTERNAL_SOURCE.{{ columns.dbt_valid_to }}\n\n    when not matched\n     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'\n        then insert ({{ insert_cols_csv }})\n        values ({{ insert_cols_csv }})\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_snapshot_table_column_names", "macro.dbt.equals"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.220913, "supported_languages": null}, "macro.dbt.strategy_dispatch": {"name": "strategy_dispatch", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.strategy_dispatch", "macro_sql": "{% macro strategy_dispatch(name) -%}\n{% set original_name = name %}\n  {% if '.' in name %}\n    {% set package_name, name = name.split(\".\", 1) %}\n  {% else %}\n    {% set package_name = none %}\n  {% endif %}\n\n  {% if package_name is none %}\n    {% set package_context = context %}\n  {% elif package_name in context %}\n    {% set package_context = context[package_name] %}\n  {% else %}\n    {% set error_msg %}\n        Could not find package '{{package_name}}', called with '{{original_name}}'\n    {% endset %}\n    {{ exceptions.raise_compiler_error(error_msg | trim) }}\n  {% endif %}\n\n  {%- set search_name = 'snapshot_' ~ name ~ '_strategy' -%}\n\n  {% if search_name not in package_context %}\n    {% set error_msg %}\n        The specified strategy macro '{{name}}' was not found in package '{{ package_name }}'\n    {% endset %}\n    {{ exceptions.raise_compiler_error(error_msg | trim) }}\n  {% endif %}\n  {{ return(package_context[search_name]) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2220402, "supported_languages": null}, "macro.dbt.snapshot_hash_arguments": {"name": "snapshot_hash_arguments", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_hash_arguments", "macro_sql": "{% macro snapshot_hash_arguments(args) -%}\n  {{ adapter.dispatch('snapshot_hash_arguments', 'dbt')(args) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__snapshot_hash_arguments"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.222133, "supported_languages": null}, "macro.dbt.default__snapshot_hash_arguments": {"name": "default__snapshot_hash_arguments", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.default__snapshot_hash_arguments", "macro_sql": "{% macro default__snapshot_hash_arguments(args) -%}\n    md5({%- for arg in args -%}\n        coalesce(cast({{ arg }} as varchar ), '')\n        {% if not loop.last %} || '|' || {% endif %}\n    {%- endfor -%})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.222253, "supported_languages": null}, "macro.dbt.snapshot_timestamp_strategy": {"name": "snapshot_timestamp_strategy", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_timestamp_strategy", "macro_sql": "{% macro snapshot_timestamp_strategy(node, snapshotted_rel, current_rel, model_config, target_exists) %}\n    {# The model_config parameter is no longer used, but is passed in anyway for compatibility. #}\n    {% set primary_key = config.get('unique_key') %}\n    {% set updated_at = config.get('updated_at') %}\n    {% set hard_deletes = adapter.get_hard_deletes_behavior(config) %}\n    {% set invalidate_hard_deletes = hard_deletes == 'invalidate' %}\n    {% set columns = config.get(\"snapshot_table_column_names\") or get_snapshot_table_column_names() %}\n\n    {#/*\n        The snapshot relation might not have an {{ updated_at }} value if the\n        snapshot strategy is changed from `check` to `timestamp`. We\n        should use a dbt-created column for the comparison in the snapshot\n        table instead of assuming that the user-supplied {{ updated_at }}\n        will be present in the historical data.\n\n        See https://github.com/dbt-labs/dbt-core/issues/2350\n    */ #}\n    {% set row_changed_expr -%}\n        ({{ snapshotted_rel }}.{{ columns.dbt_valid_from }} < {{ current_rel }}.{{ updated_at }})\n    {%- endset %}\n\n    {% set scd_args = api.Relation.scd_args(primary_key, updated_at) %}\n    {% set scd_id_expr = snapshot_hash_arguments(scd_args) %}\n\n    {% do return({\n        \"unique_key\": primary_key,\n        \"updated_at\": updated_at,\n        \"row_changed\": row_changed_expr,\n        \"scd_id\": scd_id_expr,\n        \"invalidate_hard_deletes\": invalidate_hard_deletes,\n        \"hard_deletes\": hard_deletes\n    }) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_snapshot_table_column_names", "macro.dbt.snapshot_hash_arguments"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.222752, "supported_languages": null}, "macro.dbt.snapshot_string_as_time": {"name": "snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_string_as_time", "macro_sql": "{% macro snapshot_string_as_time(timestamp) -%}\n    {{ adapter.dispatch('snapshot_string_as_time', 'dbt')(timestamp) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__snapshot_string_as_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.222844, "supported_languages": null}, "macro.dbt.default__snapshot_string_as_time": {"name": "default__snapshot_string_as_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.default__snapshot_string_as_time", "macro_sql": "{% macro default__snapshot_string_as_time(timestamp) %}\n    {% do exceptions.raise_not_implemented(\n        'snapshot_string_as_time macro not implemented for adapter '+adapter.type()\n    ) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2229362, "supported_languages": null}, "macro.dbt.snapshot_check_all_get_existing_columns": {"name": "snapshot_check_all_get_existing_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_check_all_get_existing_columns", "macro_sql": "{% macro snapshot_check_all_get_existing_columns(node, target_exists, check_cols_config) -%}\n    {%- if not target_exists -%}\n        {#-- no table yet -> return whatever the query does --#}\n        {{ return((false, query_columns)) }}\n    {%- endif -%}\n\n    {#-- handle any schema changes --#}\n    {%- set target_relation = adapter.get_relation(database=node.database, schema=node.schema, identifier=node.alias) -%}\n\n    {% if check_cols_config == 'all' %}\n        {%- set query_columns = get_columns_in_query(node['compiled_code']) -%}\n\n    {% elif check_cols_config is iterable and (check_cols_config | length) > 0 %}\n        {#-- query for proper casing/quoting, to support comparison below --#}\n        {%- set select_check_cols_from_target -%}\n            {#-- N.B. The whitespace below is necessary to avoid edge case issue with comments --#}\n            {#-- See: https://github.com/dbt-labs/dbt-core/issues/6781 --#}\n            select {{ check_cols_config | join(', ') }} from (\n                {{ node['compiled_code'] }}\n            ) subq\n        {%- endset -%}\n        {% set query_columns = get_columns_in_query(select_check_cols_from_target) %}\n\n    {% else %}\n        {% do exceptions.raise_compiler_error(\"Invalid value for 'check_cols': \" ~ check_cols_config) %}\n    {% endif %}\n\n    {%- set existing_cols = adapter.get_columns_in_relation(target_relation) | map(attribute = 'name') | list -%}\n    {%- set ns = namespace() -%} {#-- handle for-loop scoping with a namespace --#}\n    {%- set ns.column_added = false -%}\n\n    {%- set intersection = [] -%}\n    {%- for col in query_columns -%}\n        {%- if col in existing_cols -%}\n            {%- do intersection.append(adapter.quote(col)) -%}\n        {%- else -%}\n            {% set ns.column_added = true %}\n        {%- endif -%}\n    {%- endfor -%}\n    {{ return((ns.column_added, intersection)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_columns_in_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.223646, "supported_languages": null}, "macro.dbt.snapshot_check_strategy": {"name": "snapshot_check_strategy", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/strategies.sql", "original_file_path": "macros/materializations/snapshots/strategies.sql", "unique_id": "macro.dbt.snapshot_check_strategy", "macro_sql": "{% macro snapshot_check_strategy(node, snapshotted_rel, current_rel, model_config, target_exists) %}\n    {# The model_config parameter is no longer used, but is passed in anyway for compatibility. #}\n    {% set check_cols_config = config.get('check_cols') %}\n    {% set primary_key = config.get('unique_key') %}\n    {% set hard_deletes = adapter.get_hard_deletes_behavior(config) %}\n    {% set invalidate_hard_deletes = hard_deletes == 'invalidate' %}\n    {% set updated_at = config.get('updated_at') or snapshot_get_time() %}\n\n    {% set column_added = false %}\n\n    {% set column_added, check_cols = snapshot_check_all_get_existing_columns(node, target_exists, check_cols_config) %}\n\n    {%- set row_changed_expr -%}\n    (\n    {%- if column_added -%}\n        {{ get_true_sql() }}\n    {%- else -%}\n    {%- for col in check_cols -%}\n        {{ snapshotted_rel }}.{{ col }} != {{ current_rel }}.{{ col }}\n        or\n        (\n            (({{ snapshotted_rel }}.{{ col }} is null) and not ({{ current_rel }}.{{ col }} is null))\n            or\n            ((not {{ snapshotted_rel }}.{{ col }} is null) and ({{ current_rel }}.{{ col }} is null))\n        )\n        {%- if not loop.last %} or {% endif -%}\n    {%- endfor -%}\n    {%- endif -%}\n    )\n    {%- endset %}\n\n    {% set scd_args = api.Relation.scd_args(primary_key, updated_at) %}\n    {% set scd_id_expr = snapshot_hash_arguments(scd_args) %}\n\n    {% do return({\n        \"unique_key\": primary_key,\n        \"updated_at\": updated_at,\n        \"row_changed\": row_changed_expr,\n        \"scd_id\": scd_id_expr,\n        \"invalidate_hard_deletes\": invalidate_hard_deletes,\n        \"hard_deletes\": hard_deletes\n    }) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.snapshot_get_time", "macro.dbt.snapshot_check_all_get_existing_columns", "macro.dbt.get_true_sql", "macro.dbt.snapshot_hash_arguments"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.224438, "supported_languages": null}, "macro.dbt.create_columns": {"name": "create_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.create_columns", "macro_sql": "{% macro create_columns(relation, columns) %}\n  {{ adapter.dispatch('create_columns', 'dbt')(relation, columns) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__create_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.225558, "supported_languages": null}, "macro.dbt.default__create_columns": {"name": "default__create_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__create_columns", "macro_sql": "{% macro default__create_columns(relation, columns) %}\n  {% for column in columns %}\n    {% call statement() %}\n      alter table {{ relation.render() }} add column \"{{ column.name }}\" {{ column.data_type }};\n    {% endcall %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.225712, "supported_languages": null}, "macro.dbt.post_snapshot": {"name": "post_snapshot", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.post_snapshot", "macro_sql": "{% macro post_snapshot(staging_relation) %}\n  {{ adapter.dispatch('post_snapshot', 'dbt')(staging_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__post_snapshot"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.225803, "supported_languages": null}, "macro.dbt.default__post_snapshot": {"name": "default__post_snapshot", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__post_snapshot", "macro_sql": "{% macro default__post_snapshot(staging_relation) %}\n    {# no-op #}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2258508, "supported_languages": null}, "macro.dbt.get_true_sql": {"name": "get_true_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.get_true_sql", "macro_sql": "{% macro get_true_sql() %}\n  {{ adapter.dispatch('get_true_sql', 'dbt')() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_true_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2259278, "supported_languages": null}, "macro.dbt.default__get_true_sql": {"name": "default__get_true_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__get_true_sql", "macro_sql": "{% macro default__get_true_sql() %}\n    {{ return('TRUE') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.225991, "supported_languages": null}, "macro.dbt.snapshot_staging_table": {"name": "snapshot_staging_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.snapshot_staging_table", "macro_sql": "{% macro snapshot_staging_table(strategy, source_sql, target_relation) -%}\n  {{ adapter.dispatch('snapshot_staging_table', 'dbt')(strategy, source_sql, target_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__snapshot_staging_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2260969, "supported_languages": null}, "macro.dbt.get_snapshot_table_column_names": {"name": "get_snapshot_table_column_names", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.get_snapshot_table_column_names", "macro_sql": "{% macro get_snapshot_table_column_names() %}\n    {{ return({'dbt_valid_to': 'dbt_valid_to', 'dbt_valid_from': 'dbt_valid_from', 'dbt_scd_id': 'dbt_scd_id', 'dbt_updated_at': 'dbt_updated_at', 'dbt_is_deleted': 'dbt_is_deleted'}) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.226225, "supported_languages": null}, "macro.dbt.default__snapshot_staging_table": {"name": "default__snapshot_staging_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__snapshot_staging_table", "macro_sql": "{% macro default__snapshot_staging_table(strategy, source_sql, target_relation) -%}\n    {% set columns = config.get('snapshot_table_column_names') or get_snapshot_table_column_names() %}\n    {% if strategy.hard_deletes == 'new_record' %}\n        {% set new_scd_id = snapshot_hash_arguments([columns.dbt_scd_id, snapshot_get_time()]) %}\n    {% endif %}\n    with snapshot_query as (\n\n        {{ source_sql }}\n\n    ),\n\n    snapshotted_data as (\n\n        select *, {{ unique_key_fields(strategy.unique_key) }}\n        from {{ target_relation }}\n        where\n            {% if config.get('dbt_valid_to_current') %}\n\t\t{% set source_unique_key = columns.dbt_valid_to | trim %}\n\t\t{% set target_unique_key = config.get('dbt_valid_to_current') | trim %}\n\n\t\t{# The exact equals semantics between NULL values depends on the current behavior flag set. Also, update records if the source field is null #}\n                ( {{ equals(source_unique_key, target_unique_key) }} or {{ source_unique_key }} is null )\n            {% else %}\n                {{ columns.dbt_valid_to }} is null\n            {% endif %}\n\n    ),\n\n    insertions_source_data as (\n\n        select *, {{ unique_key_fields(strategy.unique_key) }},\n            {{ strategy.updated_at }} as {{ columns.dbt_updated_at }},\n            {{ strategy.updated_at }} as {{ columns.dbt_valid_from }},\n            {{ get_dbt_valid_to_current(strategy, columns) }},\n            {{ strategy.scd_id }} as {{ columns.dbt_scd_id }}\n\n        from snapshot_query\n    ),\n\n    updates_source_data as (\n\n        select *, {{ unique_key_fields(strategy.unique_key) }},\n            {{ strategy.updated_at }} as {{ columns.dbt_updated_at }},\n            {{ strategy.updated_at }} as {{ columns.dbt_valid_from }},\n            {{ strategy.updated_at }} as {{ columns.dbt_valid_to }}\n\n        from snapshot_query\n    ),\n\n    {%- if strategy.hard_deletes == 'invalidate' or strategy.hard_deletes == 'new_record' %}\n\n    deletes_source_data as (\n\n        select *, {{ unique_key_fields(strategy.unique_key) }}\n        from snapshot_query\n    ),\n    {% endif %}\n\n    insertions as (\n\n        select\n            'insert' as dbt_change_type,\n            source_data.*\n          {%- if strategy.hard_deletes == 'new_record' -%}\n            ,'False' as {{ columns.dbt_is_deleted }}\n          {%- endif %}\n\n        from insertions_source_data as source_data\n        left outer join snapshotted_data\n            on {{ unique_key_join_on(strategy.unique_key, \"snapshotted_data\", \"source_data\") }}\n            where {{ unique_key_is_null(strategy.unique_key, \"snapshotted_data\") }}\n            or ({{ unique_key_is_not_null(strategy.unique_key, \"snapshotted_data\") }} and ({{ strategy.row_changed }})\n\n        )\n\n    ),\n\n    updates as (\n\n        select\n            'update' as dbt_change_type,\n            source_data.*,\n            snapshotted_data.{{ columns.dbt_scd_id }}\n          {%- if strategy.hard_deletes == 'new_record' -%}\n            , snapshotted_data.{{ columns.dbt_is_deleted }}\n          {%- endif %}\n\n        from updates_source_data as source_data\n        join snapshotted_data\n            on {{ unique_key_join_on(strategy.unique_key, \"snapshotted_data\", \"source_data\") }}\n        where (\n            {{ strategy.row_changed }}\n        )\n    )\n\n    {%- if strategy.hard_deletes == 'invalidate' or strategy.hard_deletes == 'new_record' %}\n    ,\n    deletes as (\n\n        select\n            'delete' as dbt_change_type,\n            source_data.*,\n            {{ snapshot_get_time() }} as {{ columns.dbt_valid_from }},\n            {{ snapshot_get_time() }} as {{ columns.dbt_updated_at }},\n            {{ snapshot_get_time() }} as {{ columns.dbt_valid_to }},\n            snapshotted_data.{{ columns.dbt_scd_id }}\n          {%- if strategy.hard_deletes == 'new_record' -%}\n            , snapshotted_data.{{ columns.dbt_is_deleted }}\n          {%- endif %}\n        from snapshotted_data\n        left join deletes_source_data as source_data\n            on {{ unique_key_join_on(strategy.unique_key, \"snapshotted_data\", \"source_data\") }}\n            where {{ unique_key_is_null(strategy.unique_key, \"source_data\") }}\n    )\n    {%- endif %}\n\n    {%- if strategy.hard_deletes == 'new_record' %}\n        {% set source_sql_cols = get_column_schema_from_query(source_sql) %}\n    ,\n    deletion_records as (\n\n        select\n            'insert' as dbt_change_type,\n            {%- for col in source_sql_cols -%}\n            snapshotted_data.{{ adapter.quote(col.column) }},\n            {% endfor -%}\n            {%- if strategy.unique_key | is_list -%}\n                {%- for key in strategy.unique_key -%}\n            snapshotted_data.{{ key }} as dbt_unique_key_{{ loop.index }},\n                {% endfor -%}\n            {%- else -%}\n            snapshotted_data.dbt_unique_key as dbt_unique_key,\n            {% endif -%}\n            {{ snapshot_get_time() }} as {{ columns.dbt_valid_from }},\n            {{ snapshot_get_time() }} as {{ columns.dbt_updated_at }},\n            snapshotted_data.{{ columns.dbt_valid_to }} as {{ columns.dbt_valid_to }},\n            {{ new_scd_id }} as {{ columns.dbt_scd_id }},\n            'True' as {{ columns.dbt_is_deleted }}\n        from snapshotted_data\n        left join deletes_source_data as source_data\n            on {{ unique_key_join_on(strategy.unique_key, \"snapshotted_data\", \"source_data\") }}\n        where {{ unique_key_is_null(strategy.unique_key, \"source_data\") }}\n\n    )\n    {%- endif %}\n\n    select * from insertions\n    union all\n    select * from updates\n    {%- if strategy.hard_deletes == 'invalidate' or strategy.hard_deletes == 'new_record' %}\n    union all\n    select * from deletes\n    {%- endif %}\n    {%- if strategy.hard_deletes == 'new_record' %}\n    union all\n    select * from deletion_records\n    {%- endif %}\n\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_snapshot_table_column_names", "macro.dbt.snapshot_hash_arguments", "macro.dbt.snapshot_get_time", "macro.dbt.unique_key_fields", "macro.dbt.equals", "macro.dbt.get_dbt_valid_to_current", "macro.dbt.unique_key_join_on", "macro.dbt.unique_key_is_null", "macro.dbt.unique_key_is_not_null", "macro.dbt.get_column_schema_from_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.228065, "supported_languages": null}, "macro.dbt.build_snapshot_table": {"name": "build_snapshot_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.build_snapshot_table", "macro_sql": "{% macro build_snapshot_table(strategy, sql) -%}\n  {{ adapter.dispatch('build_snapshot_table', 'dbt')(strategy, sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__build_snapshot_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.228179, "supported_languages": null}, "macro.dbt.default__build_snapshot_table": {"name": "default__build_snapshot_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.default__build_snapshot_table", "macro_sql": "{% macro default__build_snapshot_table(strategy, sql) %}\n    {% set columns = config.get('snapshot_table_column_names') or get_snapshot_table_column_names() %}\n\n    select *,\n        {{ strategy.scd_id }} as {{ columns.dbt_scd_id }},\n        {{ strategy.updated_at }} as {{ columns.dbt_updated_at }},\n        {{ strategy.updated_at }} as {{ columns.dbt_valid_from }},\n        {{ get_dbt_valid_to_current(strategy, columns) }}\n      {%- if strategy.hard_deletes == 'new_record' -%}\n        , 'False' as {{ columns.dbt_is_deleted }}\n      {% endif -%}\n    from (\n        {{ sql }}\n    ) sbq\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_snapshot_table_column_names", "macro.dbt.get_dbt_valid_to_current"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.228448, "supported_languages": null}, "macro.dbt.build_snapshot_staging_table": {"name": "build_snapshot_staging_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.build_snapshot_staging_table", "macro_sql": "{% macro build_snapshot_staging_table(strategy, sql, target_relation) %}\n    {% set temp_relation = make_temp_relation(target_relation) %}\n\n    {% set select = snapshot_staging_table(strategy, sql, target_relation) %}\n\n    {% call statement('build_snapshot_staging_relation') %}\n        {{ create_table_as(True, temp_relation, select) }}\n    {% endcall %}\n\n    {% do return(temp_relation) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.make_temp_relation", "macro.dbt.snapshot_staging_table", "macro.dbt.statement", "macro.dbt.create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2286668, "supported_languages": null}, "macro.dbt.get_updated_at_column_data_type": {"name": "get_updated_at_column_data_type", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.get_updated_at_column_data_type", "macro_sql": "{% macro get_updated_at_column_data_type(snapshot_sql) %}\n    {% set snapshot_sql_column_schema = get_column_schema_from_query(snapshot_sql) %}\n    {% set dbt_updated_at_data_type = null %}\n    {% set ns = namespace() -%} {#-- handle for-loop scoping with a namespace --#}\n    {% set ns.dbt_updated_at_data_type = null -%}\n    {% for column in snapshot_sql_column_schema %}\n    {%   if ((column.column == 'dbt_updated_at') or (column.column == 'DBT_UPDATED_AT')) %}\n    {%     set ns.dbt_updated_at_data_type = column.dtype %}\n    {%   endif %}\n    {% endfor %}\n    {{ return(ns.dbt_updated_at_data_type or none)  }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_column_schema_from_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.228988, "supported_languages": null}, "macro.dbt.check_time_data_types": {"name": "check_time_data_types", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.check_time_data_types", "macro_sql": "{% macro check_time_data_types(sql) %}\n  {% set dbt_updated_at_data_type = get_updated_at_column_data_type(sql) %}\n  {% set snapshot_get_time_data_type = get_snapshot_get_time_data_type() %}\n  {% if snapshot_get_time_data_type is not none and dbt_updated_at_data_type is not none and snapshot_get_time_data_type != dbt_updated_at_data_type %}\n  {%   if exceptions.warn_snapshot_timestamp_data_types %}\n  {{     exceptions.warn_snapshot_timestamp_data_types(snapshot_get_time_data_type, dbt_updated_at_data_type) }}\n  {%   endif %}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_updated_at_column_data_type", "macro.dbt.get_snapshot_get_time_data_type"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2292109, "supported_languages": null}, "macro.dbt.get_dbt_valid_to_current": {"name": "get_dbt_valid_to_current", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.get_dbt_valid_to_current", "macro_sql": "{% macro get_dbt_valid_to_current(strategy, columns) %}\n  {% set dbt_valid_to_current = config.get('dbt_valid_to_current') or \"null\" %}\n  coalesce(nullif({{ strategy.updated_at }}, {{ strategy.updated_at }}), {{dbt_valid_to_current}})\n  as {{ columns.dbt_valid_to }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2293582, "supported_languages": null}, "macro.dbt.unique_key_fields": {"name": "unique_key_fields", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.unique_key_fields", "macro_sql": "{% macro unique_key_fields(unique_key) %}\n    {% if unique_key | is_list %}\n        {% for key in unique_key %}\n            {{ key }} as dbt_unique_key_{{ loop.index }}\n            {%- if not loop.last %} , {%- endif %}\n        {% endfor %}\n    {% else %}\n        {{ unique_key }} as dbt_unique_key\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.229532, "supported_languages": null}, "macro.dbt.unique_key_join_on": {"name": "unique_key_join_on", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.unique_key_join_on", "macro_sql": "{% macro unique_key_join_on(unique_key, identifier, from_identifier) %}\n    {% if unique_key | is_list %}\n        {% for key in unique_key %}\n\t    {% set source_unique_key = (identifier ~ \".dbt_unique_key_\" ~ loop.index) | trim %}\n\t    {% set target_unique_key = (from_identifier ~ \".dbt_unique_key_\" ~ loop.index) | trim %}\n\t    {{ equals(source_unique_key, target_unique_key) }}\n            {%- if not loop.last %} and {%- endif %}\n        {% endfor %}\n    {% else %}\n        {{ identifier }}.dbt_unique_key = {{ from_identifier }}.dbt_unique_key\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.equals"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.229826, "supported_languages": null}, "macro.dbt.unique_key_is_null": {"name": "unique_key_is_null", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.unique_key_is_null", "macro_sql": "{% macro unique_key_is_null(unique_key, identifier) %}\n    {% if unique_key | is_list %}\n        {{ identifier }}.dbt_unique_key_1 is null\n    {% else %}\n        {{ identifier }}.dbt_unique_key is null\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2299361, "supported_languages": null}, "macro.dbt.unique_key_is_not_null": {"name": "unique_key_is_not_null", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/helpers.sql", "original_file_path": "macros/materializations/snapshots/helpers.sql", "unique_id": "macro.dbt.unique_key_is_not_null", "macro_sql": "{% macro unique_key_is_not_null(unique_key, identifier) %}\n    {% if unique_key | is_list %}\n        {{ identifier }}.dbt_unique_key_1 is not null\n    {% else %}\n        {{ identifier }}.dbt_unique_key is not null\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.230044, "supported_languages": null}, "macro.dbt.materialization_snapshot_default": {"name": "materialization_snapshot_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/snapshots/snapshot.sql", "original_file_path": "macros/materializations/snapshots/snapshot.sql", "unique_id": "macro.dbt.materialization_snapshot_default", "macro_sql": "{% materialization snapshot, default %}\n\n  {%- set target_table = model.get('alias', model.get('name')) -%}\n\n  {%- set strategy_name = config.get('strategy') -%}\n  {%- set unique_key = config.get('unique_key') %}\n  -- grab current tables grants config for comparision later on\n  {%- set grant_config = config.get('grants') -%}\n\n  {% set target_relation_exists, target_relation = get_or_create_relation(\n          database=model.database,\n          schema=model.schema,\n          identifier=target_table,\n          type='table') -%}\n\n  {%- if not target_relation.is_table -%}\n    {% do exceptions.relation_wrong_type(target_relation, 'table') %}\n  {%- endif -%}\n\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  {% set strategy_macro = strategy_dispatch(strategy_name) %}\n  {# The model['config'] parameter below is no longer used, but passing anyway for compatibility #}\n  {# It was a dictionary of config, instead of the config object from the context #}\n  {% set strategy = strategy_macro(model, \"snapshotted_data\", \"source_data\", model['config'], target_relation_exists) %}\n\n  {% if not target_relation_exists %}\n\n      {% set build_sql = build_snapshot_table(strategy, model['compiled_code']) %}\n      {% set build_or_select_sql = build_sql %}\n      {% set final_sql = create_table_as(False, target_relation, build_sql) %}\n\n  {% else %}\n\n      {% set columns = config.get(\"snapshot_table_column_names\") or get_snapshot_table_column_names() %}\n\n      {{ adapter.assert_valid_snapshot_target_given_strategy(target_relation, columns, strategy) }}\n\n      {% set build_or_select_sql = snapshot_staging_table(strategy, sql, target_relation) %}\n      {% set staging_table = build_snapshot_staging_table(strategy, sql, target_relation) %}\n\n      -- this may no-op if the database does not require column expansion\n      {% do adapter.expand_target_column_types(from_relation=staging_table,\n                                               to_relation=target_relation) %}\n\n      {% set remove_columns = ['dbt_change_type', 'DBT_CHANGE_TYPE', 'dbt_unique_key', 'DBT_UNIQUE_KEY'] %}\n      {% if unique_key | is_list %}\n          {% for key in strategy.unique_key %}\n              {{ remove_columns.append('dbt_unique_key_' + loop.index|string) }}\n              {{ remove_columns.append('DBT_UNIQUE_KEY_' + loop.index|string) }}\n          {% endfor %}\n      {% endif %}\n\n      {% set missing_columns = adapter.get_missing_columns(staging_table, target_relation)\n                                   | rejectattr('name', 'in', remove_columns)\n                                   | list %}\n\n      {% do create_columns(target_relation, missing_columns) %}\n\n      {% set source_columns = adapter.get_columns_in_relation(staging_table)\n                                   | rejectattr('name', 'in', remove_columns)\n                                   | list %}\n\n      {% set quoted_source_columns = [] %}\n      {% for column in source_columns %}\n        {% do quoted_source_columns.append(adapter.quote(column.name)) %}\n      {% endfor %}\n\n      {% set final_sql = snapshot_merge_sql(\n            target = target_relation,\n            source = staging_table,\n            insert_cols = quoted_source_columns\n         )\n      %}\n\n  {% endif %}\n\n\n  {{ check_time_data_types(build_or_select_sql) }}\n\n  {% call statement('main') %}\n      {{ final_sql }}\n  {% endcall %}\n\n  {% set should_revoke = should_revoke(target_relation_exists, full_refresh_mode=False) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {% if not target_relation_exists %}\n    {% do create_indexes(target_relation) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {{ adapter.commit() }}\n\n  {% if staging_table is defined %}\n      {% do post_snapshot(staging_table) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.get_or_create_relation", "macro.dbt.run_hooks", "macro.dbt.strategy_dispatch", "macro.dbt.build_snapshot_table", "macro.dbt.create_table_as", "macro.dbt.get_snapshot_table_column_names", "macro.dbt.snapshot_staging_table", "macro.dbt.build_snapshot_staging_table", "macro.dbt.create_columns", "macro.dbt.snapshot_merge_sql", "macro.dbt.check_time_data_types", "macro.dbt.statement", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs", "macro.dbt.create_indexes", "macro.dbt.post_snapshot"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2320871, "supported_languages": ["sql"]}, "macro.dbt.materialization_test_default": {"name": "materialization_test_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/test.sql", "original_file_path": "macros/materializations/tests/test.sql", "unique_id": "macro.dbt.materialization_test_default", "macro_sql": "{%- materialization test, default -%}\n\n  {% set relations = [] %}\n\n  {% if should_store_failures() %}\n\n    {% set identifier = model['alias'] %}\n    {% set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) %}\n\n    {% set store_failures_as = config.get('store_failures_as') %}\n    -- if `--store-failures` is invoked via command line and `store_failures_as` is not set,\n    -- config.get('store_failures_as', 'table') returns None, not 'table'\n    {% if store_failures_as == none %}{% set store_failures_as = 'table' %}{% endif %}\n    {% if store_failures_as not in ['table', 'view'] %}\n        {{ exceptions.raise_compiler_error(\n            \"'\" ~ store_failures_as ~ \"' is not a valid value for `store_failures_as`. \"\n            \"Accepted values are: ['ephemeral', 'table', 'view']\"\n        ) }}\n    {% endif %}\n\n    {% set target_relation = api.Relation.create(\n        identifier=identifier, schema=schema, database=database, type=store_failures_as) -%} %}\n\n    {% if old_relation %}\n        {% do adapter.drop_relation(old_relation) %}\n    {% endif %}\n\n    {% call statement(auto_begin=True) %}\n        {{ get_create_sql(target_relation, sql) }}\n    {% endcall %}\n\n    {% do relations.append(target_relation) %}\n\n    {% set main_sql %}\n        select *\n        from {{ target_relation }}\n    {% endset %}\n\n    {{ adapter.commit() }}\n\n  {% else %}\n\n      {% set main_sql = sql %}\n\n  {% endif %}\n\n  {% set limit = config.get('limit') %}\n  {% set fail_calc = config.get('fail_calc') %}\n  {% set warn_if = config.get('warn_if') %}\n  {% set error_if = config.get('error_if') %}\n\n  {% call statement('main', fetch_result=True) -%}\n\n    {{ get_test_sql(main_sql, fail_calc, warn_if, error_if, limit)}}\n\n  {%- endcall %}\n\n  {{ return({'relations': relations}) }}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.should_store_failures", "macro.dbt.statement", "macro.dbt.get_create_sql", "macro.dbt.get_test_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2331772, "supported_languages": ["sql"]}, "macro.dbt.get_test_sql": {"name": "get_test_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/helpers.sql", "original_file_path": "macros/materializations/tests/helpers.sql", "unique_id": "macro.dbt.get_test_sql", "macro_sql": "{% macro get_test_sql(main_sql, fail_calc, warn_if, error_if, limit) -%}\n  {{ adapter.dispatch('get_test_sql', 'dbt')(main_sql, fail_calc, warn_if, error_if, limit) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_test_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.233477, "supported_languages": null}, "macro.dbt.default__get_test_sql": {"name": "default__get_test_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/helpers.sql", "original_file_path": "macros/materializations/tests/helpers.sql", "unique_id": "macro.dbt.default__get_test_sql", "macro_sql": "{% macro default__get_test_sql(main_sql, fail_calc, warn_if, error_if, limit) -%}\n    select\n      {{ fail_calc }} as failures,\n      {{ fail_calc }} {{ warn_if }} as should_warn,\n      {{ fail_calc }} {{ error_if }} as should_error\n    from (\n      {{ main_sql }}\n      {{ \"limit \" ~ limit if limit != none }}\n    ) dbt_internal_test\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2336352, "supported_languages": null}, "macro.dbt.get_unit_test_sql": {"name": "get_unit_test_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/helpers.sql", "original_file_path": "macros/materializations/tests/helpers.sql", "unique_id": "macro.dbt.get_unit_test_sql", "macro_sql": "{% macro get_unit_test_sql(main_sql, expected_fixture_sql, expected_column_names) -%}\n  {{ adapter.dispatch('get_unit_test_sql', 'dbt')(main_sql, expected_fixture_sql, expected_column_names) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_unit_test_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.233749, "supported_languages": null}, "macro.dbt.default__get_unit_test_sql": {"name": "default__get_unit_test_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/helpers.sql", "original_file_path": "macros/materializations/tests/helpers.sql", "unique_id": "macro.dbt.default__get_unit_test_sql", "macro_sql": "{% macro default__get_unit_test_sql(main_sql, expected_fixture_sql, expected_column_names) -%}\n-- Build actual result given inputs\nwith dbt_internal_unit_test_actual as (\n  select\n    {% for expected_column_name in expected_column_names %}{{expected_column_name}}{% if not loop.last -%},{% endif %}{%- endfor -%}, {{ dbt.string_literal(\"actual\") }} as {{ adapter.quote(\"actual_or_expected\") }}\n  from (\n    {{ main_sql }}\n  ) _dbt_internal_unit_test_actual\n),\n-- Build expected result\ndbt_internal_unit_test_expected as (\n  select\n    {% for expected_column_name in expected_column_names %}{{expected_column_name}}{% if not loop.last -%}, {% endif %}{%- endfor -%}, {{ dbt.string_literal(\"expected\") }} as {{ adapter.quote(\"actual_or_expected\") }}\n  from (\n    {{ expected_fixture_sql }}\n  ) _dbt_internal_unit_test_expected\n)\n-- Union actual and expected results\nselect * from dbt_internal_unit_test_actual\nunion all\nselect * from dbt_internal_unit_test_expected\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.string_literal"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.234061, "supported_languages": null}, "macro.dbt.get_where_subquery": {"name": "get_where_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/where_subquery.sql", "original_file_path": "macros/materializations/tests/where_subquery.sql", "unique_id": "macro.dbt.get_where_subquery", "macro_sql": "{% macro get_where_subquery(relation) -%}\n    {% do return(adapter.dispatch('get_where_subquery', 'dbt')(relation)) %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_where_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.234234, "supported_languages": null}, "macro.dbt.default__get_where_subquery": {"name": "default__get_where_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/where_subquery.sql", "original_file_path": "macros/materializations/tests/where_subquery.sql", "unique_id": "macro.dbt.default__get_where_subquery", "macro_sql": "{% macro default__get_where_subquery(relation) -%}\n    {% set where = config.get('where', '') %}\n    {% if where %}\n        {%- set filtered -%}\n            (select * from {{ relation }} where {{ where }}) dbt_subquery\n        {%- endset -%}\n        {% do return(filtered) %}\n    {%- else -%}\n        {% do return(relation) %}\n    {%- endif -%}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.234439, "supported_languages": null}, "macro.dbt.materialization_unit_default": {"name": "materialization_unit_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/tests/unit.sql", "original_file_path": "macros/materializations/tests/unit.sql", "unique_id": "macro.dbt.materialization_unit_default", "macro_sql": "{%- materialization unit, default -%}\n\n  {% set relations = [] %}\n\n  {% set expected_rows = config.get('expected_rows') %}\n  {% set expected_sql = config.get('expected_sql') %}\n  {% set tested_expected_column_names = expected_rows[0].keys() if (expected_rows | length ) > 0 else get_columns_in_query(sql) %} %}\n\n  {%- set target_relation = this.incorporate(type='table') -%}\n  {%- set temp_relation = make_temp_relation(target_relation)-%}\n  {% do run_query(get_create_table_as_sql(True, temp_relation, get_empty_subquery_sql(sql))) %}\n  {%- set columns_in_relation = adapter.get_columns_in_relation(temp_relation) -%}\n  {%- set column_name_to_data_types = {} -%}\n  {%- for column in columns_in_relation -%}\n  {%-   do column_name_to_data_types.update({column.name|lower: column.data_type}) -%}\n  {%- endfor -%}\n\n  {% if not expected_sql %}\n  {%   set expected_sql = get_expected_sql(expected_rows, column_name_to_data_types) %}\n  {% endif %}\n  {% set unit_test_sql = get_unit_test_sql(sql, expected_sql, tested_expected_column_names) %}\n\n  {% call statement('main', fetch_result=True) -%}\n\n    {{ unit_test_sql }}\n\n  {%- endcall %}\n\n  {% do adapter.drop_relation(temp_relation) %}\n\n  {{ return({'relations': relations}) }}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.get_columns_in_query", "macro.dbt.make_temp_relation", "macro.dbt.run_query", "macro.dbt.get_create_table_as_sql", "macro.dbt.get_empty_subquery_sql", "macro.dbt.get_expected_sql", "macro.dbt.get_unit_test_sql", "macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.235221, "supported_languages": ["sql"]}, "macro.dbt.materialization_materialized_view_default": {"name": "materialization_materialized_view_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialization_materialized_view_default", "macro_sql": "{% materialization materialized_view, default %}\n    {% set existing_relation = load_cached_relation(this) %}\n    {% set target_relation = this.incorporate(type=this.MaterializedView) %}\n    {% set intermediate_relation = make_intermediate_relation(target_relation) %}\n    {% set backup_relation_type = target_relation.MaterializedView if existing_relation is none else existing_relation.type %}\n    {% set backup_relation = make_backup_relation(target_relation, backup_relation_type) %}\n\n    {{ materialized_view_setup(backup_relation, intermediate_relation, pre_hooks) }}\n\n        {% set build_sql = materialized_view_get_build_sql(existing_relation, target_relation, backup_relation, intermediate_relation) %}\n\n        {% if build_sql == '' %}\n            {{ materialized_view_execute_no_op(target_relation) }}\n        {% else %}\n            {{ materialized_view_execute_build_sql(build_sql, existing_relation, target_relation, post_hooks) }}\n        {% endif %}\n\n    {{ materialized_view_teardown(backup_relation, intermediate_relation, post_hooks) }}\n\n    {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.materialized_view_setup", "macro.dbt.materialized_view_get_build_sql", "macro.dbt.materialized_view_execute_no_op", "macro.dbt.materialized_view_execute_build_sql", "macro.dbt.materialized_view_teardown"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.236066, "supported_languages": ["sql"]}, "macro.dbt.materialized_view_setup": {"name": "materialized_view_setup", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_setup", "macro_sql": "{% macro materialized_view_setup(backup_relation, intermediate_relation, pre_hooks) %}\n\n    -- backup_relation and intermediate_relation should not already exist in the database\n    -- it's possible these exist because of a previous run that exited unexpectedly\n    {% set preexisting_backup_relation = load_cached_relation(backup_relation) %}\n    {% set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) %}\n\n    -- drop the temp relations if they exist already in the database\n    {{ drop_relation_if_exists(preexisting_backup_relation) }}\n    {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n\n    {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2362702, "supported_languages": null}, "macro.dbt.materialized_view_teardown": {"name": "materialized_view_teardown", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_teardown", "macro_sql": "{% macro materialized_view_teardown(backup_relation, intermediate_relation, post_hooks) %}\n\n    -- drop the temp relations if they exist to leave the database clean for the next run\n    {{ drop_relation_if_exists(backup_relation) }}\n    {{ drop_relation_if_exists(intermediate_relation) }}\n\n    {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2364092, "supported_languages": null}, "macro.dbt.materialized_view_get_build_sql": {"name": "materialized_view_get_build_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_get_build_sql", "macro_sql": "{% macro materialized_view_get_build_sql(existing_relation, target_relation, backup_relation, intermediate_relation) %}\n\n    {% set full_refresh_mode = should_full_refresh() %}\n\n    -- determine the scenario we're in: create, full_refresh, alter, refresh data\n    {% if existing_relation is none %}\n        {% set build_sql = get_create_materialized_view_as_sql(target_relation, sql) %}\n    {% elif full_refresh_mode or not existing_relation.is_materialized_view %}\n        {% set build_sql = get_replace_sql(existing_relation, target_relation, sql) %}\n    {% else %}\n\n        -- get config options\n        {% set on_configuration_change = config.get('on_configuration_change') %}\n        {% set configuration_changes = get_materialized_view_configuration_changes(existing_relation, config) %}\n\n        {% if configuration_changes is none %}\n            {% set build_sql = refresh_materialized_view(target_relation) %}\n\n        {% elif on_configuration_change == 'apply' %}\n            {% set build_sql = get_alter_materialized_view_as_sql(target_relation, configuration_changes, sql, existing_relation, backup_relation, intermediate_relation) %}\n        {% elif on_configuration_change == 'continue' %}\n            {% set build_sql = '' %}\n            {{ exceptions.warn(\"Configuration changes were identified and `on_configuration_change` was set to `continue` for `\" ~ target_relation.render() ~ \"`\") }}\n        {% elif on_configuration_change == 'fail' %}\n            {{ exceptions.raise_fail_fast_error(\"Configuration changes were identified and `on_configuration_change` was set to `fail` for `\" ~ target_relation.render() ~ \"`\") }}\n\n        {% else %}\n            -- this only happens if the user provides a value other than `apply`, 'skip', 'fail'\n            {{ exceptions.raise_compiler_error(\"Unexpected configuration scenario\") }}\n\n        {% endif %}\n\n    {% endif %}\n\n    {% do return(build_sql) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh", "macro.dbt.get_create_materialized_view_as_sql", "macro.dbt.get_replace_sql", "macro.dbt.get_materialized_view_configuration_changes", "macro.dbt.refresh_materialized_view", "macro.dbt.get_alter_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2372532, "supported_languages": null}, "macro.dbt.materialized_view_execute_no_op": {"name": "materialized_view_execute_no_op", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_execute_no_op", "macro_sql": "{% macro materialized_view_execute_no_op(target_relation) %}\n    {% do store_raw_result(\n        name=\"main\",\n        message=\"skip \" ~ target_relation,\n        code=\"skip\",\n        rows_affected=\"-1\"\n    ) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.237374, "supported_languages": null}, "macro.dbt.materialized_view_execute_build_sql": {"name": "materialized_view_execute_build_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/materialized_view.sql", "original_file_path": "macros/materializations/models/materialized_view.sql", "unique_id": "macro.dbt.materialized_view_execute_build_sql", "macro_sql": "{% macro materialized_view_execute_build_sql(build_sql, existing_relation, target_relation, post_hooks) %}\n\n    -- `BEGIN` happens here:\n    {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n    {% set grant_config = config.get('grants') %}\n\n    {% call statement(name=\"main\") %}\n        {{ build_sql }}\n    {% endcall %}\n\n    {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n    {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n    {% do persist_docs(target_relation, model) %}\n\n    {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n    {{ adapter.commit() }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.237708, "supported_languages": null}, "macro.dbt.materialization_view_default": {"name": "materialization_view_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/view.sql", "original_file_path": "macros/materializations/models/view.sql", "unique_id": "macro.dbt.materialization_view_default", "macro_sql": "{%- materialization view, default -%}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='view') -%}\n  {%- set intermediate_relation =  make_intermediate_relation(target_relation) -%}\n\n  -- the intermediate_relation should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) -%}\n  /*\n     This relation (probably) doesn't exist yet. If it does exist, it's a leftover from\n     a previous run, and we're going to try to drop it immediately. At the end of this\n     materialization, we're going to rename the \"existing_relation\" to this identifier,\n     and then we're going to drop it. In order to make sure we run the correct one of:\n       - drop view ...\n       - drop table ...\n\n     We need to set the type of this relation to be the type of the existing_relation, if it exists,\n     or else \"view\" as a sane default if it does not. Note that if the existing_relation does not\n     exist, then there is nothing to move out of the way and subsequentally drop. In that case,\n     this relation will be effectively unused.\n  */\n  {%- set backup_relation_type = 'view' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n  -- as above, the backup_relation should not already exist\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n  -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- drop the temp relations if they exist already in the database\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_view_as_sql(intermediate_relation, sql) }}\n  {%- endcall %}\n\n  -- cleanup\n  -- move the existing view out of the way\n  {% if existing_relation is not none %}\n     /* Do the equivalent of rename_if_exists. 'existing_relation' could have been dropped\n        since the variable was first set. */\n    {% set existing_relation = load_cached_relation(existing_relation) %}\n    {% if existing_relation is not none %}\n        {{ adapter.rename_relation(existing_relation, backup_relation) }}\n    {% endif %}\n  {% endif %}\n  {{ adapter.rename_relation(intermediate_relation, target_relation) }}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {{ adapter.commit() }}\n\n  {{ drop_relation_if_exists(backup_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.run_hooks", "macro.dbt.drop_relation_if_exists", "macro.dbt.statement", "macro.dbt.get_create_view_as_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2388108, "supported_languages": ["sql"]}, "macro.dbt.materialization_table_default": {"name": "materialization_table_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/table.sql", "original_file_path": "macros/materializations/models/table.sql", "unique_id": "macro.dbt.materialization_table_default", "macro_sql": "{% materialization table, default %}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='table') %}\n  {%- set intermediate_relation =  make_intermediate_relation(target_relation) -%}\n  -- the intermediate_relation should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation) -%}\n  /*\n      See ../view/view.sql for more information about this relation.\n  */\n  {%- set backup_relation_type = 'table' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n  -- as above, the backup_relation should not already exist\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n  -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n\n  -- drop the temp relations if they exist already in the database\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_table_as_sql(False, intermediate_relation, sql) }}\n  {%- endcall %}\n\n  {% do create_indexes(intermediate_relation) %}\n\n  -- cleanup\n  {% if existing_relation is not none %}\n     /* Do the equivalent of rename_if_exists. 'existing_relation' could have been dropped\n        since the variable was first set. */\n    {% set existing_relation = load_cached_relation(existing_relation) %}\n    {% if existing_relation is not none %}\n        {{ adapter.rename_relation(existing_relation, backup_relation) }}\n    {% endif %}\n  {% endif %}\n\n  {{ adapter.rename_relation(intermediate_relation, target_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  -- `COMMIT` happens here\n  {{ adapter.commit() }}\n\n  -- finally, drop the existing/backup relation after the commit\n  {{ drop_relation_if_exists(backup_relation) }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.get_create_table_as_sql", "macro.dbt.create_indexes", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.239936, "supported_languages": ["sql"]}, "macro.dbt.get_quoted_csv": {"name": "get_quoted_csv", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.get_quoted_csv", "macro_sql": "{% macro get_quoted_csv(column_names) %}\n\n    {% set quoted = [] %}\n    {% for col in column_names -%}\n        {%- do quoted.append(adapter.quote(col)) -%}\n    {%- endfor %}\n\n    {%- set dest_cols_csv = quoted | join(', ') -%}\n    {{ return(dest_cols_csv) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2404108, "supported_languages": null}, "macro.dbt.diff_columns": {"name": "diff_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.diff_columns", "macro_sql": "{% macro diff_columns(source_columns, target_columns) %}\n\n  {% set result = [] %}\n  {% set source_names = source_columns | map(attribute = 'column') | list %}\n  {% set target_names = target_columns | map(attribute = 'column') | list %}\n\n   {# --check whether the name attribute exists in the target - this does not perform a data type check #}\n   {% for sc in source_columns %}\n     {% if sc.name not in target_names %}\n        {{ result.append(sc) }}\n     {% endif %}\n   {% endfor %}\n\n  {{ return(result) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.240714, "supported_languages": null}, "macro.dbt.diff_column_data_types": {"name": "diff_column_data_types", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.diff_column_data_types", "macro_sql": "{% macro diff_column_data_types(source_columns, target_columns) %}\n\n  {% set result = [] %}\n  {% for sc in source_columns %}\n    {% set tc = target_columns | selectattr(\"name\", \"equalto\", sc.name) | list | first %}\n    {% if tc %}\n      {% if sc.data_type != tc.data_type and not sc.can_expand_to(other_column=tc) %}\n        {{ result.append( { 'column_name': tc.name, 'new_type': sc.data_type } ) }}\n      {% endif %}\n    {% endif %}\n  {% endfor %}\n\n  {{ return(result) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2410738, "supported_languages": null}, "macro.dbt.get_merge_update_columns": {"name": "get_merge_update_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.get_merge_update_columns", "macro_sql": "{% macro get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) %}\n  {{ return(adapter.dispatch('get_merge_update_columns', 'dbt')(merge_update_columns, merge_exclude_columns, dest_columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_merge_update_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.241209, "supported_languages": null}, "macro.dbt.default__get_merge_update_columns": {"name": "default__get_merge_update_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/column_helpers.sql", "original_file_path": "macros/materializations/models/incremental/column_helpers.sql", "unique_id": "macro.dbt.default__get_merge_update_columns", "macro_sql": "{% macro default__get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) %}\n  {%- set default_cols = dest_columns | map(attribute=\"quoted\") | list -%}\n\n  {%- if merge_update_columns and merge_exclude_columns -%}\n    {{ exceptions.raise_compiler_error(\n        'Model cannot specify merge_update_columns and merge_exclude_columns. Please update model to use only one config'\n    )}}\n  {%- elif merge_update_columns -%}\n    {%- set update_columns = merge_update_columns -%}\n  {%- elif merge_exclude_columns -%}\n    {%- set update_columns = [] -%}\n    {%- for column in dest_columns -%}\n      {% if column.column | lower not in merge_exclude_columns | map(\"lower\") | list %}\n        {%- do update_columns.append(column.quoted) -%}\n      {% endif %}\n    {%- endfor -%}\n  {%- else -%}\n    {%- set update_columns = default_cols -%}\n  {%- endif -%}\n\n  {{ return(update_columns) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.241601, "supported_languages": null}, "macro.dbt.get_merge_sql": {"name": "get_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.get_merge_sql", "macro_sql": "{% macro get_merge_sql(target, source, unique_key, dest_columns, incremental_predicates=none) -%}\n   -- back compat for old kwarg name\n  {% set incremental_predicates = kwargs.get('predicates', incremental_predicates) %}\n  {{ adapter.dispatch('get_merge_sql', 'dbt')(target, source, unique_key, dest_columns, incremental_predicates) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.242213, "supported_languages": null}, "macro.dbt.default__get_merge_sql": {"name": "default__get_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.default__get_merge_sql", "macro_sql": "{% macro default__get_merge_sql(target, source, unique_key, dest_columns, incremental_predicates=none) -%}\n    {%- set predicates = [] if incremental_predicates is none else [] + incremental_predicates -%}\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n    {%- set merge_update_columns = config.get('merge_update_columns') -%}\n    {%- set merge_exclude_columns = config.get('merge_exclude_columns') -%}\n    {%- set update_columns = get_merge_update_columns(merge_update_columns, merge_exclude_columns, dest_columns) -%}\n    {%- set sql_header = config.get('sql_header', none) -%}\n\n    {% if unique_key %}\n        {% if unique_key is sequence and unique_key is not mapping and unique_key is not string %}\n            {% for key in unique_key %}\n                {% set this_key_match %}\n                    DBT_INTERNAL_SOURCE.{{ key }} = DBT_INTERNAL_DEST.{{ key }}\n                {% endset %}\n                {% do predicates.append(this_key_match) %}\n            {% endfor %}\n        {% else %}\n            {% set source_unique_key = (\"DBT_INTERNAL_SOURCE.\" ~ unique_key) | trim %}\n\t    {% set target_unique_key = (\"DBT_INTERNAL_DEST.\" ~ unique_key) | trim %}\n\t    {% set unique_key_match = equals(source_unique_key, target_unique_key) | trim %}\n            {% do predicates.append(unique_key_match) %}\n        {% endif %}\n    {% else %}\n        {% do predicates.append('FALSE') %}\n    {% endif %}\n\n    {{ sql_header if sql_header is not none }}\n\n    merge into {{ target }} as DBT_INTERNAL_DEST\n        using {{ source }} as DBT_INTERNAL_SOURCE\n        on {{\"(\" ~ predicates | join(\") and (\") ~ \")\"}}\n\n    {% if unique_key %}\n    when matched then update set\n        {% for column_name in update_columns -%}\n            {{ column_name }} = DBT_INTERNAL_SOURCE.{{ column_name }}\n            {%- if not loop.last %}, {%- endif %}\n        {%- endfor %}\n    {% endif %}\n\n    when not matched then insert\n        ({{ dest_cols_csv }})\n    values\n        ({{ dest_cols_csv }})\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv", "macro.dbt.get_merge_update_columns", "macro.dbt.equals"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.243093, "supported_languages": null}, "macro.dbt.get_delete_insert_merge_sql": {"name": "get_delete_insert_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.get_delete_insert_merge_sql", "macro_sql": "{% macro get_delete_insert_merge_sql(target, source, unique_key, dest_columns, incremental_predicates) -%}\n  {{ adapter.dispatch('get_delete_insert_merge_sql', 'dbt')(target, source, unique_key, dest_columns, incremental_predicates) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.default__get_delete_insert_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.243232, "supported_languages": null}, "macro.dbt.default__get_delete_insert_merge_sql": {"name": "default__get_delete_insert_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.default__get_delete_insert_merge_sql", "macro_sql": "{% macro default__get_delete_insert_merge_sql(target, source, unique_key, dest_columns, incremental_predicates) -%}\n\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n\n    {% if unique_key %}\n        {% if unique_key is string %}\n        {% set unique_key = [unique_key] %}\n        {% endif %}\n\n        {%- set unique_key_str = unique_key|join(', ') -%}\n\n        delete from {{ target }} as DBT_INTERNAL_DEST\n        where ({{ unique_key_str }}) in (\n            select distinct {{ unique_key_str }}\n            from {{ source }} as DBT_INTERNAL_SOURCE\n        )\n        {%- if incremental_predicates %}\n            {% for predicate in incremental_predicates %}\n                and {{ predicate }}\n            {% endfor %}\n        {%- endif -%};\n\n    {% endif %}\n\n    insert into {{ target }} ({{ dest_cols_csv }})\n    (\n        select {{ dest_cols_csv }}\n        from {{ source }}\n    )\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2436, "supported_languages": null}, "macro.dbt.get_insert_overwrite_merge_sql": {"name": "get_insert_overwrite_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.get_insert_overwrite_merge_sql", "macro_sql": "{% macro get_insert_overwrite_merge_sql(target, source, dest_columns, predicates, include_sql_header=false) -%}\n  {{ adapter.dispatch('get_insert_overwrite_merge_sql', 'dbt')(target, source, dest_columns, predicates, include_sql_header) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_insert_overwrite_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.243739, "supported_languages": null}, "macro.dbt.default__get_insert_overwrite_merge_sql": {"name": "default__get_insert_overwrite_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/merge.sql", "original_file_path": "macros/materializations/models/incremental/merge.sql", "unique_id": "macro.dbt.default__get_insert_overwrite_merge_sql", "macro_sql": "{% macro default__get_insert_overwrite_merge_sql(target, source, dest_columns, predicates, include_sql_header) -%}\n    {#-- The only time include_sql_header is True: --#}\n    {#-- BigQuery + insert_overwrite strategy + \"static\" partitions config --#}\n    {#-- We should consider including the sql header at the materialization level instead --#}\n\n    {%- set predicates = [] if predicates is none else [] + predicates -%}\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n    {%- set sql_header = config.get('sql_header', none) -%}\n\n    {{ sql_header if sql_header is not none and include_sql_header }}\n\n    merge into {{ target }} as DBT_INTERNAL_DEST\n        using {{ source }} as DBT_INTERNAL_SOURCE\n        on FALSE\n\n    when not matched by source\n        {% if predicates %} and {{ predicates | join(' and ') }} {% endif %}\n        then delete\n\n    when not matched then insert\n        ({{ dest_cols_csv }})\n    values\n        ({{ dest_cols_csv }})\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.244077, "supported_languages": null}, "macro.dbt.is_incremental": {"name": "is_incremental", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/is_incremental.sql", "original_file_path": "macros/materializations/models/incremental/is_incremental.sql", "unique_id": "macro.dbt.is_incremental", "macro_sql": "{% macro is_incremental() %}\n    {#-- do not run introspective queries in parsing #}\n    {% if not execute %}\n        {{ return(False) }}\n    {% else %}\n        {% set relation = adapter.get_relation(this.database, this.schema, this.table) %}\n        {{ return(relation is not none\n                  and relation.type == 'table'\n                  and model.config.materialized == 'incremental'\n                  and not should_full_refresh()) }}\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.244388, "supported_languages": null}, "macro.dbt.get_incremental_append_sql": {"name": "get_incremental_append_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_append_sql", "macro_sql": "{% macro get_incremental_append_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_append_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_append_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.24474, "supported_languages": null}, "macro.dbt.default__get_incremental_append_sql": {"name": "default__get_incremental_append_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_append_sql", "macro_sql": "{% macro default__get_incremental_append_sql(arg_dict) %}\n\n  {% do return(get_insert_into_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"dest_columns\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_insert_into_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.244861, "supported_languages": null}, "macro.dbt.get_incremental_delete_insert_sql": {"name": "get_incremental_delete_insert_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_delete_insert_sql", "macro_sql": "{% macro get_incremental_delete_insert_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_delete_insert_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_delete_insert_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.244958, "supported_languages": null}, "macro.dbt.default__get_incremental_delete_insert_sql": {"name": "default__get_incremental_delete_insert_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_delete_insert_sql", "macro_sql": "{% macro default__get_incremental_delete_insert_sql(arg_dict) %}\n\n  {% do return(get_delete_insert_merge_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"unique_key\"], arg_dict[\"dest_columns\"], arg_dict[\"incremental_predicates\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_delete_insert_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.245108, "supported_languages": null}, "macro.dbt.get_incremental_merge_sql": {"name": "get_incremental_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_merge_sql", "macro_sql": "{% macro get_incremental_merge_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_merge_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.245205, "supported_languages": null}, "macro.dbt.default__get_incremental_merge_sql": {"name": "default__get_incremental_merge_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_merge_sql", "macro_sql": "{% macro default__get_incremental_merge_sql(arg_dict) %}\n\n  {% do return(get_merge_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"unique_key\"], arg_dict[\"dest_columns\"], arg_dict[\"incremental_predicates\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.245354, "supported_languages": null}, "macro.dbt.get_incremental_insert_overwrite_sql": {"name": "get_incremental_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_insert_overwrite_sql", "macro_sql": "{% macro get_incremental_insert_overwrite_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_insert_overwrite_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_incremental_insert_overwrite_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2454531, "supported_languages": null}, "macro.dbt.default__get_incremental_insert_overwrite_sql": {"name": "default__get_incremental_insert_overwrite_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_insert_overwrite_sql", "macro_sql": "{% macro default__get_incremental_insert_overwrite_sql(arg_dict) %}\n\n  {% do return(get_insert_overwrite_merge_sql(arg_dict[\"target_relation\"], arg_dict[\"temp_relation\"], arg_dict[\"dest_columns\"], arg_dict[\"incremental_predicates\"])) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_insert_overwrite_merge_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.245586, "supported_languages": null}, "macro.dbt.get_incremental_default_sql": {"name": "get_incremental_default_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_default_sql", "macro_sql": "{% macro get_incremental_default_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_default_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_incremental_default_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2456808, "supported_languages": null}, "macro.dbt.default__get_incremental_default_sql": {"name": "default__get_incremental_default_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_default_sql", "macro_sql": "{% macro default__get_incremental_default_sql(arg_dict) %}\n\n  {% do return(get_incremental_append_sql(arg_dict)) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_incremental_append_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.245761, "supported_languages": null}, "macro.dbt.get_incremental_microbatch_sql": {"name": "get_incremental_microbatch_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_incremental_microbatch_sql", "macro_sql": "{% macro get_incremental_microbatch_sql(arg_dict) %}\n\n  {{ return(adapter.dispatch('get_incremental_microbatch_sql', 'dbt')(arg_dict)) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_incremental_microbatch_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.24593, "supported_languages": null}, "macro.dbt.default__get_incremental_microbatch_sql": {"name": "default__get_incremental_microbatch_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.default__get_incremental_microbatch_sql", "macro_sql": "{% macro default__get_incremental_microbatch_sql(arg_dict) %}\n\n  {{ exceptions.raise_not_implemented('microbatch materialization strategy not implemented for adapter ' + adapter.type()) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.246026, "supported_languages": null}, "macro.dbt.get_insert_into_sql": {"name": "get_insert_into_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/strategies.sql", "original_file_path": "macros/materializations/models/incremental/strategies.sql", "unique_id": "macro.dbt.get_insert_into_sql", "macro_sql": "{% macro get_insert_into_sql(target_relation, temp_relation, dest_columns) %}\n\n    {%- set dest_cols_csv = get_quoted_csv(dest_columns | map(attribute=\"name\")) -%}\n\n    insert into {{ target_relation }} ({{ dest_cols_csv }})\n    (\n        select {{ dest_cols_csv }}\n        from {{ temp_relation }}\n    )\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_quoted_csv"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.246182, "supported_languages": null}, "macro.dbt.materialization_incremental_default": {"name": "materialization_incremental_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/incremental.sql", "original_file_path": "macros/materializations/models/incremental/incremental.sql", "unique_id": "macro.dbt.materialization_incremental_default", "macro_sql": "{% materialization incremental, default -%}\n\n  -- relations\n  {%- set existing_relation = load_cached_relation(this) -%}\n  {%- set target_relation = this.incorporate(type='table') -%}\n  {%- set temp_relation = make_temp_relation(target_relation)-%}\n  {%- set intermediate_relation = make_intermediate_relation(target_relation)-%}\n  {%- set backup_relation_type = 'table' if existing_relation is none else existing_relation.type -%}\n  {%- set backup_relation = make_backup_relation(target_relation, backup_relation_type) -%}\n\n  -- configs\n  {%- set unique_key = config.get('unique_key') -%}\n  {%- set full_refresh_mode = (should_full_refresh()  or existing_relation.is_view) -%}\n  {%- set on_schema_change = incremental_validate_on_schema_change(config.get('on_schema_change'), default='ignore') -%}\n\n  -- the temp_ and backup_ relations should not already exist in the database; get_relation\n  -- will return None in that case. Otherwise, we get a relation that we can drop\n  -- later, before we try to use this name for the current operation. This has to happen before\n  -- BEGIN, in a separate transaction\n  {%- set preexisting_intermediate_relation = load_cached_relation(intermediate_relation)-%}\n  {%- set preexisting_backup_relation = load_cached_relation(backup_relation) -%}\n   -- grab current tables grants config for comparision later on\n  {% set grant_config = config.get('grants') %}\n  {{ drop_relation_if_exists(preexisting_intermediate_relation) }}\n  {{ drop_relation_if_exists(preexisting_backup_relation) }}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  {% set to_drop = [] %}\n\n  {% set incremental_strategy = config.get('incremental_strategy') or 'default' %}\n  {% set strategy_sql_macro_func = adapter.get_incremental_strategy_macro(context, incremental_strategy) %}\n\n  {% if existing_relation is none %}\n      {% set build_sql = get_create_table_as_sql(False, target_relation, sql) %}\n      {% set relation_for_indexes = target_relation %}\n  {% elif full_refresh_mode %}\n      {% set build_sql = get_create_table_as_sql(False, intermediate_relation, sql) %}\n      {% set relation_for_indexes = intermediate_relation %}\n      {% set need_swap = true %}\n  {% else %}\n    {% do run_query(get_create_table_as_sql(True, temp_relation, sql)) %}\n    {% set relation_for_indexes = temp_relation %}\n    {% set contract_config = config.get('contract') %}\n    {% if not contract_config or not contract_config.enforced %}\n      {% do adapter.expand_target_column_types(\n               from_relation=temp_relation,\n               to_relation=target_relation) %}\n    {% endif %}\n    {#-- Process schema changes. Returns dict of changes if successful. Use source columns for upserting/merging --#}\n    {% set dest_columns = process_schema_changes(on_schema_change, temp_relation, existing_relation) %}\n    {% if not dest_columns %}\n      {% set dest_columns = adapter.get_columns_in_relation(existing_relation) %}\n    {% endif %}\n\n    {#-- Get the incremental_strategy, the macro to use for the strategy, and build the sql --#}\n    {% set incremental_predicates = config.get('predicates', none) or config.get('incremental_predicates', none) %}\n    {% set strategy_arg_dict = ({'target_relation': target_relation, 'temp_relation': temp_relation, 'unique_key': unique_key, 'dest_columns': dest_columns, 'incremental_predicates': incremental_predicates }) %}\n    {% set build_sql = strategy_sql_macro_func(strategy_arg_dict) %}\n\n  {% endif %}\n\n  {% call statement(\"main\") %}\n      {{ build_sql }}\n  {% endcall %}\n\n  {% if existing_relation is none or existing_relation.is_view or should_full_refresh() %}\n    {% do create_indexes(relation_for_indexes) %}\n  {% endif %}\n\n  {% if need_swap %}\n      {% do adapter.rename_relation(target_relation, backup_relation) %}\n      {% do adapter.rename_relation(intermediate_relation, target_relation) %}\n      {% do to_drop.append(backup_relation) %}\n  {% endif %}\n\n  {% set should_revoke = should_revoke(existing_relation, full_refresh_mode) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  -- `COMMIT` happens here\n  {% do adapter.commit() %}\n\n  {% for rel in to_drop %}\n      {% do adapter.drop_relation(rel) %}\n  {% endfor %}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{%- endmaterialization %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.make_temp_relation", "macro.dbt.make_intermediate_relation", "macro.dbt.make_backup_relation", "macro.dbt.should_full_refresh", "macro.dbt.incremental_validate_on_schema_change", "macro.dbt.drop_relation_if_exists", "macro.dbt.run_hooks", "macro.dbt.get_create_table_as_sql", "macro.dbt.run_query", "macro.dbt.process_schema_changes", "macro.dbt.statement", "macro.dbt.create_indexes", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2484741, "supported_languages": ["sql"]}, "macro.dbt.incremental_validate_on_schema_change": {"name": "incremental_validate_on_schema_change", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.incremental_validate_on_schema_change", "macro_sql": "{% macro incremental_validate_on_schema_change(on_schema_change, default='ignore') %}\n\n   {% if on_schema_change not in ['sync_all_columns', 'append_new_columns', 'fail', 'ignore'] %}\n\n     {% set log_message = 'Invalid value for on_schema_change (%s) specified. Setting default value of %s.' % (on_schema_change, default) %}\n     {% do log(log_message) %}\n\n     {{ return(default) }}\n\n   {% else %}\n\n     {{ return(on_schema_change) }}\n\n   {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.24913, "supported_languages": null}, "macro.dbt.check_for_schema_changes": {"name": "check_for_schema_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.check_for_schema_changes", "macro_sql": "{% macro check_for_schema_changes(source_relation, target_relation) %}\n\n  {% set schema_changed = False %}\n\n  {%- set source_columns = adapter.get_columns_in_relation(source_relation) -%}\n  {%- set target_columns = adapter.get_columns_in_relation(target_relation) -%}\n  {%- set source_not_in_target = diff_columns(source_columns, target_columns) -%}\n  {%- set target_not_in_source = diff_columns(target_columns, source_columns) -%}\n\n  {% set new_target_types = diff_column_data_types(source_columns, target_columns) %}\n\n  {% if source_not_in_target != [] %}\n    {% set schema_changed = True %}\n  {% elif target_not_in_source != [] or new_target_types != [] %}\n    {% set schema_changed = True %}\n  {% elif new_target_types != [] %}\n    {% set schema_changed = True %}\n  {% endif %}\n\n  {% set changes_dict = {\n    'schema_changed': schema_changed,\n    'source_not_in_target': source_not_in_target,\n    'target_not_in_source': target_not_in_source,\n    'source_columns': source_columns,\n    'target_columns': target_columns,\n    'new_target_types': new_target_types\n  } %}\n\n  {% set msg %}\n    In {{ target_relation }}:\n        Schema changed: {{ schema_changed }}\n        Source columns not in target: {{ source_not_in_target }}\n        Target columns not in source: {{ target_not_in_source }}\n        New column types: {{ new_target_types }}\n  {% endset %}\n\n  {% do log(msg) %}\n\n  {{ return(changes_dict) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.diff_columns", "macro.dbt.diff_column_data_types"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2497349, "supported_languages": null}, "macro.dbt.sync_column_schemas": {"name": "sync_column_schemas", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.sync_column_schemas", "macro_sql": "{% macro sync_column_schemas(on_schema_change, target_relation, schema_changes_dict) %}\n\n  {%- set add_to_target_arr = schema_changes_dict['source_not_in_target'] -%}\n\n  {%- if on_schema_change == 'append_new_columns'-%}\n     {%- if add_to_target_arr | length > 0 -%}\n       {%- do alter_relation_add_remove_columns(target_relation, add_to_target_arr, none) -%}\n     {%- endif -%}\n\n  {% elif on_schema_change == 'sync_all_columns' %}\n     {%- set remove_from_target_arr = schema_changes_dict['target_not_in_source'] -%}\n     {%- set new_target_types = schema_changes_dict['new_target_types'] -%}\n\n     {% if add_to_target_arr | length > 0 or remove_from_target_arr | length > 0 %}\n       {%- do alter_relation_add_remove_columns(target_relation, add_to_target_arr, remove_from_target_arr) -%}\n     {% endif %}\n\n     {% if new_target_types != [] %}\n       {% for ntt in new_target_types %}\n         {% set column_name = ntt['column_name'] %}\n         {% set new_type = ntt['new_type'] %}\n         {% do alter_column_type(target_relation, column_name, new_type) %}\n       {% endfor %}\n     {% endif %}\n\n  {% endif %}\n\n  {% set schema_change_message %}\n    In {{ target_relation }}:\n        Schema change approach: {{ on_schema_change }}\n        Columns added: {{ add_to_target_arr }}\n        Columns removed: {{ remove_from_target_arr }}\n        Data types changed: {{ new_target_types }}\n  {% endset %}\n\n  {% do log(schema_change_message) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.alter_relation_add_remove_columns", "macro.dbt.alter_column_type"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.250344, "supported_languages": null}, "macro.dbt.process_schema_changes": {"name": "process_schema_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/incremental/on_schema_change.sql", "original_file_path": "macros/materializations/models/incremental/on_schema_change.sql", "unique_id": "macro.dbt.process_schema_changes", "macro_sql": "{% macro process_schema_changes(on_schema_change, source_relation, target_relation) %}\n\n    {% if on_schema_change == 'ignore' %}\n\n     {{ return({}) }}\n\n    {% else %}\n\n      {% set schema_changes_dict = check_for_schema_changes(source_relation, target_relation) %}\n\n      {% if schema_changes_dict['schema_changed'] %}\n\n        {% if on_schema_change == 'fail' %}\n\n          {% set fail_msg %}\n              The source and target schemas on this incremental model are out of sync!\n              They can be reconciled in several ways:\n                - set the `on_schema_change` config to either append_new_columns or sync_all_columns, depending on your situation.\n                - Re-run the incremental model with `full_refresh: True` to update the target schema.\n                - update the schema manually and re-run the process.\n\n              Additional troubleshooting context:\n                 Source columns not in target: {{ schema_changes_dict['source_not_in_target'] }}\n                 Target columns not in source: {{ schema_changes_dict['target_not_in_source'] }}\n                 New column types: {{ schema_changes_dict['new_target_types'] }}\n          {% endset %}\n\n          {% do exceptions.raise_compiler_error(fail_msg) %}\n\n        {# -- unless we ignore, run the sync operation per the config #}\n        {% else %}\n\n          {% do sync_column_schemas(on_schema_change, target_relation, schema_changes_dict) %}\n\n        {% endif %}\n\n      {% endif %}\n\n      {{ return(schema_changes_dict['source_columns']) }}\n\n    {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.check_for_schema_changes", "macro.dbt.sync_column_schemas"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.250777, "supported_languages": null}, "macro.dbt.can_clone_table": {"name": "can_clone_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/can_clone_table.sql", "original_file_path": "macros/materializations/models/clone/can_clone_table.sql", "unique_id": "macro.dbt.can_clone_table", "macro_sql": "{% macro can_clone_table() %}\n    {{ return(adapter.dispatch('can_clone_table', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__can_clone_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.250908, "supported_languages": null}, "macro.dbt.default__can_clone_table": {"name": "default__can_clone_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/can_clone_table.sql", "original_file_path": "macros/materializations/models/clone/can_clone_table.sql", "unique_id": "macro.dbt.default__can_clone_table", "macro_sql": "{% macro default__can_clone_table() %}\n    {{ return(False) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2509708, "supported_languages": null}, "macro.dbt.create_or_replace_clone": {"name": "create_or_replace_clone", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/create_or_replace_clone.sql", "original_file_path": "macros/materializations/models/clone/create_or_replace_clone.sql", "unique_id": "macro.dbt.create_or_replace_clone", "macro_sql": "{% macro create_or_replace_clone(this_relation, defer_relation) %}\n    {{ return(adapter.dispatch('create_or_replace_clone', 'dbt')(this_relation, defer_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__create_or_replace_clone"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.251167, "supported_languages": null}, "macro.dbt.default__create_or_replace_clone": {"name": "default__create_or_replace_clone", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/create_or_replace_clone.sql", "original_file_path": "macros/materializations/models/clone/create_or_replace_clone.sql", "unique_id": "macro.dbt.default__create_or_replace_clone", "macro_sql": "{% macro default__create_or_replace_clone(this_relation, defer_relation) %}\n    create or replace table {{ this_relation.render() }} clone {{ defer_relation.render() }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.251275, "supported_languages": null}, "macro.dbt.materialization_clone_default": {"name": "materialization_clone_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/models/clone/clone.sql", "original_file_path": "macros/materializations/models/clone/clone.sql", "unique_id": "macro.dbt.materialization_clone_default", "macro_sql": "{%- materialization clone, default -%}\n\n  {%- set relations = {'relations': []} -%}\n\n  {%- if not defer_relation -%}\n      -- nothing to do\n      {{ log(\"No relation found in state manifest for \" ~ model.unique_id, info=True) }}\n      {{ return(relations) }}\n  {%- endif -%}\n\n  {%- set existing_relation = load_cached_relation(this) -%}\n\n  {%- if existing_relation and not flags.FULL_REFRESH -%}\n      -- noop!\n      {{ log(\"Relation \" ~ existing_relation ~ \" already exists\", info=True) }}\n      {{ return(relations) }}\n  {%- endif -%}\n\n  {%- set other_existing_relation = load_cached_relation(defer_relation) -%}\n\n  -- If this is a database that can do zero-copy cloning of tables, and the other relation is a table, then this will be a table\n  -- Otherwise, this will be a view\n\n  {% set can_clone_table = can_clone_table() %}\n\n  {%- if other_existing_relation and other_existing_relation.type == 'table' and can_clone_table -%}\n\n      {%- set target_relation = this.incorporate(type='table') -%}\n      {% if existing_relation is not none and not existing_relation.is_table %}\n        {{ log(\"Dropping relation \" ~ existing_relation.render() ~ \" because it is of type \" ~ existing_relation.type) }}\n        {{ drop_relation_if_exists(existing_relation) }}\n      {% endif %}\n\n      -- as a general rule, data platforms that can clone tables can also do atomic 'create or replace'\n      {% call statement('main') %}\n          {% if target_relation and defer_relation and target_relation == defer_relation %}\n              {{ log(\"Target relation and defer relation are the same, skipping clone for relation: \" ~ target_relation.render()) }}\n          {% else %}\n              {{ create_or_replace_clone(target_relation, defer_relation) }}\n          {% endif %}\n\n      {% endcall %}\n\n      {% set should_revoke = should_revoke(existing_relation, full_refresh_mode=True) %}\n      {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n      {% do persist_docs(target_relation, model) %}\n\n      {{ return({'relations': [target_relation]}) }}\n\n  {%- else -%}\n\n      {%- set target_relation = this.incorporate(type='view') -%}\n\n      -- reuse the view materialization\n      -- TODO: support actual dispatch for materialization macros\n      -- Tracking ticket: https://github.com/dbt-labs/dbt-core/issues/7799\n      {% set search_name = \"materialization_view_\" ~ adapter.type() %}\n      {% if not search_name in context %}\n          {% set search_name = \"materialization_view_default\" %}\n      {% endif %}\n      {% set materialization_macro = context[search_name] %}\n      {% set relations = materialization_macro() %}\n      {{ return(relations) }}\n\n  {%- endif -%}\n\n{%- endmaterialization -%}", "depends_on": {"macros": ["macro.dbt.load_cached_relation", "macro.dbt.can_clone_table", "macro.dbt.drop_relation_if_exists", "macro.dbt.statement", "macro.dbt.create_or_replace_clone", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.252605, "supported_languages": ["sql"]}, "macro.dbt.materialization_seed_default": {"name": "materialization_seed_default", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/seed.sql", "original_file_path": "macros/materializations/seeds/seed.sql", "unique_id": "macro.dbt.materialization_seed_default", "macro_sql": "{% materialization seed, default %}\n\n  {%- set identifier = model['alias'] -%}\n  {%- set full_refresh_mode = (should_full_refresh()) -%}\n\n  {%- set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) -%}\n\n  {%- set exists_as_table = (old_relation is not none and old_relation.is_table) -%}\n  {%- set exists_as_view = (old_relation is not none and old_relation.is_view) -%}\n\n  {%- set grant_config = config.get('grants') -%}\n  {%- set agate_table = load_agate_table() -%}\n  -- grab current tables grants config for comparison later on\n\n  {%- do store_result('agate_table', response='OK', agate_table=agate_table) -%}\n\n  {{ run_hooks(pre_hooks, inside_transaction=False) }}\n\n  -- `BEGIN` happens here:\n  {{ run_hooks(pre_hooks, inside_transaction=True) }}\n\n  -- build model\n  {% set create_table_sql = \"\" %}\n  {% if exists_as_view %}\n    {{ exceptions.raise_compiler_error(\"Cannot seed to '{}', it is a view\".format(old_relation.render())) }}\n  {% elif exists_as_table %}\n    {% set create_table_sql = reset_csv_table(model, full_refresh_mode, old_relation, agate_table) %}\n  {% else %}\n    {% set create_table_sql = create_csv_table(model, agate_table) %}\n  {% endif %}\n\n  {% set code = 'CREATE' if full_refresh_mode else 'INSERT' %}\n  {% set rows_affected = (agate_table.rows | length) %}\n  {% set sql = load_csv_rows(model, agate_table) %}\n\n  {% call noop_statement('main', code ~ ' ' ~ rows_affected, code, rows_affected) %}\n    {{ get_csv_sql(create_table_sql, sql) }};\n  {% endcall %}\n\n  {% set target_relation = this.incorporate(type='table') %}\n\n  {% set should_revoke = should_revoke(old_relation, full_refresh_mode) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {% do persist_docs(target_relation, model) %}\n\n  {% if full_refresh_mode or not exists_as_table %}\n    {% do create_indexes(target_relation) %}\n  {% endif %}\n\n  {{ run_hooks(post_hooks, inside_transaction=True) }}\n\n  -- `COMMIT` happens here\n  {{ adapter.commit() }}\n\n  {{ run_hooks(post_hooks, inside_transaction=False) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmaterialization %}", "depends_on": {"macros": ["macro.dbt.should_full_refresh", "macro.dbt.run_hooks", "macro.dbt.reset_csv_table", "macro.dbt.create_csv_table", "macro.dbt.load_csv_rows", "macro.dbt.noop_statement", "macro.dbt.get_csv_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants", "macro.dbt.persist_docs", "macro.dbt.create_indexes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.253908, "supported_languages": ["sql"]}, "macro.dbt.create_csv_table": {"name": "create_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.create_csv_table", "macro_sql": "{% macro create_csv_table(model, agate_table) -%}\n  {{ adapter.dispatch('create_csv_table', 'dbt')(model, agate_table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__create_csv_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.254441, "supported_languages": null}, "macro.dbt.default__create_csv_table": {"name": "default__create_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__create_csv_table", "macro_sql": "{% macro default__create_csv_table(model, agate_table) %}\n  {%- set column_override = model['config'].get('column_types', {}) -%}\n  {%- set quote_seed_column = model['config'].get('quote_columns', None) -%}\n\n  {% set sql %}\n    create table {{ this.render() }} (\n        {%- for col_name in agate_table.column_names -%}\n            {%- set inferred_type = adapter.convert_type(agate_table, loop.index0) -%}\n            {%- set type = column_override.get(col_name, inferred_type) -%}\n            {%- set column_name = (col_name | string) -%}\n            {{ adapter.quote_seed_column(column_name, quote_seed_column) }} {{ type }} {%- if not loop.last -%}, {%- endif -%}\n        {%- endfor -%}\n    )\n  {% endset %}\n\n  {% call statement('_') -%}\n    {{ sql }}\n  {%- endcall %}\n\n  {{ return(sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2548969, "supported_languages": null}, "macro.dbt.reset_csv_table": {"name": "reset_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.reset_csv_table", "macro_sql": "{% macro reset_csv_table(model, full_refresh, old_relation, agate_table) -%}\n  {{ adapter.dispatch('reset_csv_table', 'dbt')(model, full_refresh, old_relation, agate_table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__reset_csv_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.255023, "supported_languages": null}, "macro.dbt.default__reset_csv_table": {"name": "default__reset_csv_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__reset_csv_table", "macro_sql": "{% macro default__reset_csv_table(model, full_refresh, old_relation, agate_table) %}\n    {% set sql = \"\" %}\n    {% if full_refresh %}\n        {{ adapter.drop_relation(old_relation) }}\n        {% set sql = create_csv_table(model, agate_table) %}\n    {% else %}\n        {{ adapter.truncate_relation(old_relation) }}\n        {% set sql = \"truncate table \" ~ old_relation.render() %}\n    {% endif %}\n\n    {{ return(sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.create_csv_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.255278, "supported_languages": null}, "macro.dbt.get_csv_sql": {"name": "get_csv_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_csv_sql", "macro_sql": "{% macro get_csv_sql(create_or_truncate_sql, insert_sql) %}\n    {{ adapter.dispatch('get_csv_sql', 'dbt')(create_or_truncate_sql, insert_sql) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_csv_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.255383, "supported_languages": null}, "macro.dbt.default__get_csv_sql": {"name": "default__get_csv_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__get_csv_sql", "macro_sql": "{% macro default__get_csv_sql(create_or_truncate_sql, insert_sql) %}\n    {{ create_or_truncate_sql }};\n    -- dbt seed --\n    {{ insert_sql }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.255456, "supported_languages": null}, "macro.dbt.get_binding_char": {"name": "get_binding_char", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_binding_char", "macro_sql": "{% macro get_binding_char() -%}\n  {{ adapter.dispatch('get_binding_char', 'dbt')() }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_binding_char"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2555342, "supported_languages": null}, "macro.dbt.default__get_binding_char": {"name": "default__get_binding_char", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__get_binding_char", "macro_sql": "{% macro default__get_binding_char() %}\n  {{ return('%s') }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.255596, "supported_languages": null}, "macro.dbt.get_batch_size": {"name": "get_batch_size", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_batch_size", "macro_sql": "{% macro get_batch_size() -%}\n  {{ return(adapter.dispatch('get_batch_size', 'dbt')()) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_batch_size"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.255682, "supported_languages": null}, "macro.dbt.default__get_batch_size": {"name": "default__get_batch_size", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__get_batch_size", "macro_sql": "{% macro default__get_batch_size() %}\n  {{ return(10000) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.25575, "supported_languages": null}, "macro.dbt.get_seed_column_quoted_csv": {"name": "get_seed_column_quoted_csv", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.get_seed_column_quoted_csv", "macro_sql": "{% macro get_seed_column_quoted_csv(model, column_names) %}\n  {%- set quote_seed_column = model['config'].get('quote_columns', None) -%}\n    {% set quoted = [] %}\n    {% for col in column_names -%}\n        {%- do quoted.append(adapter.quote_seed_column(col, quote_seed_column)) -%}\n    {%- endfor %}\n\n    {%- set dest_cols_csv = quoted | join(', ') -%}\n    {{ return(dest_cols_csv) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.25599, "supported_languages": null}, "macro.dbt.load_csv_rows": {"name": "load_csv_rows", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.load_csv_rows", "macro_sql": "{% macro load_csv_rows(model, agate_table) -%}\n  {{ adapter.dispatch('load_csv_rows', 'dbt')(model, agate_table) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__load_csv_rows"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.25616, "supported_languages": null}, "macro.dbt.default__load_csv_rows": {"name": "default__load_csv_rows", "resource_type": "macro", "package_name": "dbt", "path": "macros/materializations/seeds/helpers.sql", "original_file_path": "macros/materializations/seeds/helpers.sql", "unique_id": "macro.dbt.default__load_csv_rows", "macro_sql": "{% macro default__load_csv_rows(model, agate_table) %}\n\n  {% set batch_size = get_batch_size() %}\n\n  {% set cols_sql = get_seed_column_quoted_csv(model, agate_table.column_names) %}\n  {% set bindings = [] %}\n\n  {% set statements = [] %}\n\n  {% for chunk in agate_table.rows | batch(batch_size) %}\n      {% set bindings = [] %}\n\n      {% for row in chunk %}\n          {% do bindings.extend(row) %}\n      {% endfor %}\n\n      {% set sql %}\n          insert into {{ this.render() }} ({{ cols_sql }}) values\n          {% for row in chunk -%}\n              ({%- for column in agate_table.column_names -%}\n                  {{ get_binding_char() }}\n                  {%- if not loop.last%},{%- endif %}\n              {%- endfor -%})\n              {%- if not loop.last%},{%- endif %}\n          {%- endfor %}\n      {% endset %}\n\n      {% do adapter.add_query(sql, bindings=bindings, abridge_sql_log=True) %}\n\n      {% if loop.index0 == 0 %}\n          {% do statements.append(sql) %}\n      {% endif %}\n  {% endfor %}\n\n  {# Return SQL so we can render it out into the compiled files #}\n  {{ return(statements[0]) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_batch_size", "macro.dbt.get_seed_column_quoted_csv", "macro.dbt.get_binding_char"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.256774, "supported_languages": null}, "macro.dbt.generate_alias_name": {"name": "generate_alias_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_alias.sql", "original_file_path": "macros/get_custom_name/get_custom_alias.sql", "unique_id": "macro.dbt.generate_alias_name", "macro_sql": "{% macro generate_alias_name(custom_alias_name=none, node=none) -%}\n    {% do return(adapter.dispatch('generate_alias_name', 'dbt')(custom_alias_name, node)) %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_alias_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.256984, "supported_languages": null}, "macro.dbt.default__generate_alias_name": {"name": "default__generate_alias_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_alias.sql", "original_file_path": "macros/get_custom_name/get_custom_alias.sql", "unique_id": "macro.dbt.default__generate_alias_name", "macro_sql": "{% macro default__generate_alias_name(custom_alias_name=none, node=none) -%}\n\n    {%- if custom_alias_name -%}\n\n        {{ custom_alias_name | trim }}\n\n    {%- elif node.version -%}\n\n        {{ return(node.name ~ \"_v\" ~ (node.version | replace(\".\", \"_\"))) }}\n\n    {%- else -%}\n\n        {{ node.name }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.25718, "supported_languages": null}, "macro.dbt.generate_schema_name": {"name": "generate_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_schema.sql", "original_file_path": "macros/get_custom_name/get_custom_schema.sql", "unique_id": "macro.dbt.generate_schema_name", "macro_sql": "{% macro generate_schema_name(custom_schema_name=none, node=none) -%}\n    {{ return(adapter.dispatch('generate_schema_name', 'dbt')(custom_schema_name, node)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_schema_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2574248, "supported_languages": null}, "macro.dbt.default__generate_schema_name": {"name": "default__generate_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_schema.sql", "original_file_path": "macros/get_custom_name/get_custom_schema.sql", "unique_id": "macro.dbt.default__generate_schema_name", "macro_sql": "{% macro default__generate_schema_name(custom_schema_name, node) -%}\n\n    {%- set default_schema = target.schema -%}\n    {%- if custom_schema_name is none -%}\n\n        {{ default_schema }}\n\n    {%- else -%}\n\n        {{ default_schema }}_{{ custom_schema_name | trim }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2575638, "supported_languages": null}, "macro.dbt.generate_schema_name_for_env": {"name": "generate_schema_name_for_env", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_schema.sql", "original_file_path": "macros/get_custom_name/get_custom_schema.sql", "unique_id": "macro.dbt.generate_schema_name_for_env", "macro_sql": "{% macro generate_schema_name_for_env(custom_schema_name, node) -%}\n\n    {%- set default_schema = target.schema -%}\n    {%- if target.name == 'prod' and custom_schema_name is not none -%}\n\n        {{ custom_schema_name | trim }}\n\n    {%- else -%}\n\n        {{ default_schema }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2577128, "supported_languages": null}, "macro.dbt.generate_database_name": {"name": "generate_database_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_database.sql", "original_file_path": "macros/get_custom_name/get_custom_database.sql", "unique_id": "macro.dbt.generate_database_name", "macro_sql": "{% macro generate_database_name(custom_database_name=none, node=none) -%}\n    {% do return(adapter.dispatch('generate_database_name', 'dbt')(custom_database_name, node)) %}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_database_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.257914, "supported_languages": null}, "macro.dbt.default__generate_database_name": {"name": "default__generate_database_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/get_custom_name/get_custom_database.sql", "original_file_path": "macros/get_custom_name/get_custom_database.sql", "unique_id": "macro.dbt.default__generate_database_name", "macro_sql": "{% macro default__generate_database_name(custom_database_name=none, node=none) -%}\n    {%- set default_database = target.database -%}\n    {%- if custom_database_name is none -%}\n\n        {{ default_database }}\n\n    {%- else -%}\n\n        {{ custom_database_name }}\n\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2580469, "supported_languages": null}, "macro.dbt.get_drop_sql": {"name": "get_drop_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.get_drop_sql", "macro_sql": "{%- macro get_drop_sql(relation) -%}\n    {{- log('Applying DROP to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_drop_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_drop_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2582982, "supported_languages": null}, "macro.dbt.default__get_drop_sql": {"name": "default__get_drop_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.default__get_drop_sql", "macro_sql": "{%- macro default__get_drop_sql(relation) -%}\n\n    {%- if relation.is_view -%}\n        {{ drop_view(relation) }}\n\n    {%- elif relation.is_table -%}\n        {{ drop_table(relation) }}\n\n    {%- elif relation.is_materialized_view -%}\n        {{ drop_materialized_view(relation) }}\n\n    {%- else -%}\n        drop {{ relation.type }} if exists {{ relation.render() }} cascade\n\n    {%- endif -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.drop_view", "macro.dbt.drop_table", "macro.dbt.drop_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.258493, "supported_languages": null}, "macro.dbt.drop_relation": {"name": "drop_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.drop_relation", "macro_sql": "{% macro drop_relation(relation) -%}\n    {{ return(adapter.dispatch('drop_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__drop_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.258591, "supported_languages": null}, "macro.dbt.default__drop_relation": {"name": "default__drop_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.default__drop_relation", "macro_sql": "{% macro default__drop_relation(relation) -%}\n    {% call statement('drop_relation', auto_begin=False) -%}\n        {{ get_drop_sql(relation) }}\n    {%- endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.get_drop_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.258694, "supported_languages": null}, "macro.dbt.drop_relation_if_exists": {"name": "drop_relation_if_exists", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop.sql", "original_file_path": "macros/relations/drop.sql", "unique_id": "macro.dbt.drop_relation_if_exists", "macro_sql": "{% macro drop_relation_if_exists(relation) %}\n  {% if relation is not none %}\n    {{ adapter.drop_relation(relation) }}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2587972, "supported_languages": null}, "macro.dbt.get_replace_sql": {"name": "get_replace_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/replace.sql", "original_file_path": "macros/relations/replace.sql", "unique_id": "macro.dbt.get_replace_sql", "macro_sql": "{% macro get_replace_sql(existing_relation, target_relation, sql) %}\n    {{- log('Applying REPLACE to: ' ~ existing_relation) -}}\n    {{- adapter.dispatch('get_replace_sql', 'dbt')(existing_relation, target_relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_replace_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.259111, "supported_languages": null}, "macro.dbt.default__get_replace_sql": {"name": "default__get_replace_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/replace.sql", "original_file_path": "macros/relations/replace.sql", "unique_id": "macro.dbt.default__get_replace_sql", "macro_sql": "{% macro default__get_replace_sql(existing_relation, target_relation, sql) %}\n\n    {# /* use a create or replace statement if possible */ #}\n\n    {% set is_replaceable = existing_relation.type == target_relation.type and existing_relation.can_be_replaced %}\n\n    {% if is_replaceable and existing_relation.is_view %}\n        {{ get_replace_view_sql(target_relation, sql) }}\n\n    {% elif is_replaceable and existing_relation.is_table %}\n        {{ get_replace_table_sql(target_relation, sql) }}\n\n    {% elif is_replaceable and existing_relation.is_materialized_view %}\n        {{ get_replace_materialized_view_sql(target_relation, sql) }}\n\n    {# /* a create or replace statement is not possible, so try to stage and/or backup to be safe */ #}\n\n    {# /* create target_relation as an intermediate relation, then swap it out with the existing one using a backup */ #}\n    {%- elif target_relation.can_be_renamed and existing_relation.can_be_renamed -%}\n        {{ get_create_intermediate_sql(target_relation, sql) }};\n        {{ get_create_backup_sql(existing_relation) }};\n        {{ get_rename_intermediate_sql(target_relation) }};\n        {{ get_drop_backup_sql(existing_relation) }}\n\n    {# /* create target_relation as an intermediate relation, then swap it out with the existing one without using a backup */ #}\n    {%- elif target_relation.can_be_renamed -%}\n        {{ get_create_intermediate_sql(target_relation, sql) }};\n        {{ get_drop_sql(existing_relation) }};\n        {{ get_rename_intermediate_sql(target_relation) }}\n\n    {# /* create target_relation in place by first backing up the existing relation */ #}\n    {%- elif existing_relation.can_be_renamed -%}\n        {{ get_create_backup_sql(existing_relation) }};\n        {{ get_create_sql(target_relation, sql) }};\n        {{ get_drop_backup_sql(existing_relation) }}\n\n    {# /* no renaming is allowed, so just drop and create */ #}\n    {%- else -%}\n        {{ get_drop_sql(existing_relation) }};\n        {{ get_create_sql(target_relation, sql) }}\n\n    {%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_replace_view_sql", "macro.dbt.get_replace_table_sql", "macro.dbt.get_replace_materialized_view_sql", "macro.dbt.get_create_intermediate_sql", "macro.dbt.get_create_backup_sql", "macro.dbt.get_rename_intermediate_sql", "macro.dbt.get_drop_backup_sql", "macro.dbt.get_drop_sql", "macro.dbt.get_create_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2597098, "supported_languages": null}, "macro.dbt.get_create_intermediate_sql": {"name": "get_create_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_intermediate.sql", "original_file_path": "macros/relations/create_intermediate.sql", "unique_id": "macro.dbt.get_create_intermediate_sql", "macro_sql": "{%- macro get_create_intermediate_sql(relation, sql) -%}\n    {{- log('Applying CREATE INTERMEDIATE to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_create_intermediate_sql', 'dbt')(relation, sql) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_create_intermediate_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.259904, "supported_languages": null}, "macro.dbt.default__get_create_intermediate_sql": {"name": "default__get_create_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_intermediate.sql", "original_file_path": "macros/relations/create_intermediate.sql", "unique_id": "macro.dbt.default__get_create_intermediate_sql", "macro_sql": "{%- macro default__get_create_intermediate_sql(relation, sql) -%}\n\n    -- get the standard intermediate name\n    {% set intermediate_relation = make_intermediate_relation(relation) %}\n\n    -- drop any pre-existing intermediate\n    {{ get_drop_sql(intermediate_relation) }};\n\n    {{ get_create_sql(intermediate_relation, sql) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_intermediate_relation", "macro.dbt.get_drop_sql", "macro.dbt.get_create_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.260045, "supported_languages": null}, "macro.dbt.drop_schema_named": {"name": "drop_schema_named", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/schema.sql", "original_file_path": "macros/relations/schema.sql", "unique_id": "macro.dbt.drop_schema_named", "macro_sql": "{% macro drop_schema_named(schema_name) %}\n    {{ return(adapter.dispatch('drop_schema_named', 'dbt') (schema_name)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__drop_schema_named"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26019, "supported_languages": null}, "macro.dbt.default__drop_schema_named": {"name": "default__drop_schema_named", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/schema.sql", "original_file_path": "macros/relations/schema.sql", "unique_id": "macro.dbt.default__drop_schema_named", "macro_sql": "{% macro default__drop_schema_named(schema_name) %}\n  {% set schema_relation = api.Relation.create(schema=schema_name) %}\n  {{ adapter.drop_schema(schema_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26031, "supported_languages": null}, "macro.dbt.get_drop_backup_sql": {"name": "get_drop_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop_backup.sql", "original_file_path": "macros/relations/drop_backup.sql", "unique_id": "macro.dbt.get_drop_backup_sql", "macro_sql": "{%- macro get_drop_backup_sql(relation) -%}\n    {{- log('Applying DROP BACKUP to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_drop_backup_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_drop_backup_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.260475, "supported_languages": null}, "macro.dbt.default__get_drop_backup_sql": {"name": "default__get_drop_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/drop_backup.sql", "original_file_path": "macros/relations/drop_backup.sql", "unique_id": "macro.dbt.default__get_drop_backup_sql", "macro_sql": "{%- macro default__get_drop_backup_sql(relation) -%}\n\n    -- get the standard backup name\n    {% set backup_relation = make_backup_relation(relation, relation.type) %}\n\n    {{ get_drop_sql(backup_relation) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_backup_relation", "macro.dbt.get_drop_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.260583, "supported_languages": null}, "macro.dbt.get_rename_sql": {"name": "get_rename_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.get_rename_sql", "macro_sql": "{%- macro get_rename_sql(relation, new_name) -%}\n    {{- log('Applying RENAME to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_rename_sql', 'dbt')(relation, new_name) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_rename_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2608352, "supported_languages": null}, "macro.dbt.default__get_rename_sql": {"name": "default__get_rename_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.default__get_rename_sql", "macro_sql": "{%- macro default__get_rename_sql(relation, new_name) -%}\n\n    {%- if relation.is_view -%}\n        {{ get_rename_view_sql(relation, new_name) }}\n\n    {%- elif relation.is_table -%}\n        {{ get_rename_table_sql(relation, new_name) }}\n\n    {%- elif relation.is_materialized_view -%}\n        {{ get_rename_materialized_view_sql(relation, new_name) }}\n\n    {%- else -%}\n        {{- exceptions.raise_compiler_error(\"`get_rename_sql` has not been implemented for: \" ~ relation.type ) -}}\n\n    {%- endif -%}\n\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.get_rename_view_sql", "macro.dbt.get_rename_table_sql", "macro.dbt.get_rename_materialized_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.261055, "supported_languages": null}, "macro.dbt.rename_relation": {"name": "rename_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.rename_relation", "macro_sql": "{% macro rename_relation(from_relation, to_relation) -%}\n  {{ return(adapter.dispatch('rename_relation', 'dbt')(from_relation, to_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__rename_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26117, "supported_languages": null}, "macro.dbt.default__rename_relation": {"name": "default__rename_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename.sql", "original_file_path": "macros/relations/rename.sql", "unique_id": "macro.dbt.default__rename_relation", "macro_sql": "{% macro default__rename_relation(from_relation, to_relation) -%}\n  {% set target_name = adapter.quote_as_configured(to_relation.identifier, 'identifier') %}\n  {% call statement('rename_relation') -%}\n    alter table {{ from_relation.render() }} rename to {{ target_name }}\n  {%- endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.261329, "supported_languages": null}, "macro.dbt.get_create_backup_sql": {"name": "get_create_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_backup.sql", "original_file_path": "macros/relations/create_backup.sql", "unique_id": "macro.dbt.get_create_backup_sql", "macro_sql": "{%- macro get_create_backup_sql(relation) -%}\n    {{- log('Applying CREATE BACKUP to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_create_backup_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_create_backup_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2614982, "supported_languages": null}, "macro.dbt.default__get_create_backup_sql": {"name": "default__get_create_backup_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create_backup.sql", "original_file_path": "macros/relations/create_backup.sql", "unique_id": "macro.dbt.default__get_create_backup_sql", "macro_sql": "{%- macro default__get_create_backup_sql(relation) -%}\n\n    -- get the standard backup name\n    {% set backup_relation = make_backup_relation(relation, relation.type) %}\n\n    -- drop any pre-existing backup\n    {{ get_drop_sql(backup_relation) }};\n\n    {{ get_rename_sql(relation, backup_relation.identifier) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_backup_relation", "macro.dbt.get_drop_sql", "macro.dbt.get_rename_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2617102, "supported_languages": null}, "macro.dbt.get_create_sql": {"name": "get_create_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create.sql", "original_file_path": "macros/relations/create.sql", "unique_id": "macro.dbt.get_create_sql", "macro_sql": "{%- macro get_create_sql(relation, sql) -%}\n    {{- log('Applying CREATE to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_create_sql', 'dbt')(relation, sql) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_create_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.261913, "supported_languages": null}, "macro.dbt.default__get_create_sql": {"name": "default__get_create_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/create.sql", "original_file_path": "macros/relations/create.sql", "unique_id": "macro.dbt.default__get_create_sql", "macro_sql": "{%- macro default__get_create_sql(relation, sql) -%}\n\n    {%- if relation.is_view -%}\n        {{ get_create_view_as_sql(relation, sql) }}\n\n    {%- elif relation.is_table -%}\n        {{ get_create_table_as_sql(False, relation, sql) }}\n\n    {%- elif relation.is_materialized_view -%}\n        {{ get_create_materialized_view_as_sql(relation, sql) }}\n\n    {%- else -%}\n        {{- exceptions.raise_compiler_error(\"`get_create_sql` has not been implemented for: \" ~ relation.type ) -}}\n\n    {%- endif -%}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.get_create_view_as_sql", "macro.dbt.get_create_table_as_sql", "macro.dbt.get_create_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.262141, "supported_languages": null}, "macro.dbt.get_rename_intermediate_sql": {"name": "get_rename_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename_intermediate.sql", "original_file_path": "macros/relations/rename_intermediate.sql", "unique_id": "macro.dbt.get_rename_intermediate_sql", "macro_sql": "{%- macro get_rename_intermediate_sql(relation) -%}\n    {{- log('Applying RENAME INTERMEDIATE to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_rename_intermediate_sql', 'dbt')(relation) -}}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": ["macro.dbt.default__get_rename_intermediate_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2623072, "supported_languages": null}, "macro.dbt.default__get_rename_intermediate_sql": {"name": "default__get_rename_intermediate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/rename_intermediate.sql", "original_file_path": "macros/relations/rename_intermediate.sql", "unique_id": "macro.dbt.default__get_rename_intermediate_sql", "macro_sql": "{%- macro default__get_rename_intermediate_sql(relation) -%}\n\n    -- get the standard intermediate name\n    {% set intermediate_relation = make_intermediate_relation(relation) %}\n\n    {{ get_rename_sql(intermediate_relation, relation.identifier) }}\n\n{%- endmacro -%}", "depends_on": {"macros": ["macro.dbt.make_intermediate_relation", "macro.dbt.get_rename_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2624168, "supported_languages": null}, "macro.dbt.drop_materialized_view": {"name": "drop_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt.drop_materialized_view", "macro_sql": "{% macro drop_materialized_view(relation) -%}\n    {{- adapter.dispatch('drop_materialized_view', 'dbt')(relation) -}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__drop_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2625542, "supported_languages": null}, "macro.dbt.default__drop_materialized_view": {"name": "default__drop_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/drop.sql", "original_file_path": "macros/relations/materialized_view/drop.sql", "unique_id": "macro.dbt.default__drop_materialized_view", "macro_sql": "{% macro default__drop_materialized_view(relation) -%}\n    drop materialized view if exists {{ relation.render() }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2626219, "supported_languages": null}, "macro.dbt.get_replace_materialized_view_sql": {"name": "get_replace_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/replace.sql", "original_file_path": "macros/relations/materialized_view/replace.sql", "unique_id": "macro.dbt.get_replace_materialized_view_sql", "macro_sql": "{% macro get_replace_materialized_view_sql(relation, sql) %}\n    {{- adapter.dispatch('get_replace_materialized_view_sql', 'dbt')(relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_replace_materialized_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.262767, "supported_languages": null}, "macro.dbt.default__get_replace_materialized_view_sql": {"name": "default__get_replace_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/replace.sql", "original_file_path": "macros/relations/materialized_view/replace.sql", "unique_id": "macro.dbt.default__get_replace_materialized_view_sql", "macro_sql": "{% macro default__get_replace_materialized_view_sql(relation, sql) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_replace_materialized_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.262847, "supported_languages": null}, "macro.dbt.refresh_materialized_view": {"name": "refresh_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt.refresh_materialized_view", "macro_sql": "{% macro refresh_materialized_view(relation) %}\n    {{- log('Applying REFRESH to: ' ~ relation) -}}\n    {{- adapter.dispatch('refresh_materialized_view', 'dbt')(relation) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__refresh_materialized_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.263007, "supported_languages": null}, "macro.dbt.default__refresh_materialized_view": {"name": "default__refresh_materialized_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/refresh.sql", "original_file_path": "macros/relations/materialized_view/refresh.sql", "unique_id": "macro.dbt.default__refresh_materialized_view", "macro_sql": "{% macro default__refresh_materialized_view(relation) %}\n    {{ exceptions.raise_compiler_error(\"`refresh_materialized_view` has not been implemented for this adapter.\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.263079, "supported_languages": null}, "macro.dbt.get_rename_materialized_view_sql": {"name": "get_rename_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/rename.sql", "original_file_path": "macros/relations/materialized_view/rename.sql", "unique_id": "macro.dbt.get_rename_materialized_view_sql", "macro_sql": "{% macro get_rename_materialized_view_sql(relation, new_name) %}\n    {{- adapter.dispatch('get_rename_materialized_view_sql', 'dbt')(relation, new_name) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_rename_materialized_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.263225, "supported_languages": null}, "macro.dbt.default__get_rename_materialized_view_sql": {"name": "default__get_rename_materialized_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/rename.sql", "original_file_path": "macros/relations/materialized_view/rename.sql", "unique_id": "macro.dbt.default__get_rename_materialized_view_sql", "macro_sql": "{% macro default__get_rename_materialized_view_sql(relation, new_name) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_rename_materialized_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.263304, "supported_languages": null}, "macro.dbt.get_alter_materialized_view_as_sql": {"name": "get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.get_alter_materialized_view_as_sql", "macro_sql": "{% macro get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n    {{- log('Applying ALTER to: ' ~ relation) -}}\n    {{- adapter.dispatch('get_alter_materialized_view_as_sql', 'dbt')(\n        relation,\n        configuration_changes,\n        sql,\n        existing_relation,\n        backup_relation,\n        intermediate_relation\n    ) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_alter_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2635992, "supported_languages": null}, "macro.dbt.default__get_alter_materialized_view_as_sql": {"name": "default__get_alter_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.default__get_alter_materialized_view_as_sql", "macro_sql": "{% macro default__get_alter_materialized_view_as_sql(\n    relation,\n    configuration_changes,\n    sql,\n    existing_relation,\n    backup_relation,\n    intermediate_relation\n) %}\n    {{ exceptions.raise_compiler_error(\"Materialized views have not been implemented for this adapter.\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.263703, "supported_languages": null}, "macro.dbt.get_materialized_view_configuration_changes": {"name": "get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.get_materialized_view_configuration_changes", "macro_sql": "{% macro get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    /* {#\n    It's recommended that configuration changes be formatted as follows:\n    {\"<change_category>\": [{\"action\": \"<name>\", \"context\": ...}]}\n\n    For example:\n    {\n        \"indexes\": [\n            {\"action\": \"drop\", \"context\": \"index_abc\"},\n            {\"action\": \"create\", \"context\": {\"columns\": [\"column_1\", \"column_2\"], \"type\": \"hash\", \"unique\": True}},\n        ],\n    }\n\n    Either way, `get_materialized_view_configuration_changes` needs to align with `get_alter_materialized_view_as_sql`.\n    #} */\n    {{- log('Determining configuration changes on: ' ~ existing_relation) -}}\n    {%- do return(adapter.dispatch('get_materialized_view_configuration_changes', 'dbt')(existing_relation, new_config)) -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_materialized_view_configuration_changes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26385, "supported_languages": null}, "macro.dbt.default__get_materialized_view_configuration_changes": {"name": "default__get_materialized_view_configuration_changes", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/alter.sql", "original_file_path": "macros/relations/materialized_view/alter.sql", "unique_id": "macro.dbt.default__get_materialized_view_configuration_changes", "macro_sql": "{% macro default__get_materialized_view_configuration_changes(existing_relation, new_config) %}\n    {{ exceptions.raise_compiler_error(\"Materialized views have not been implemented for this adapter.\") }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2639291, "supported_languages": null}, "macro.dbt.get_create_materialized_view_as_sql": {"name": "get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt.get_create_materialized_view_as_sql", "macro_sql": "{% macro get_create_materialized_view_as_sql(relation, sql) -%}\n    {{- adapter.dispatch('get_create_materialized_view_as_sql', 'dbt')(relation, sql) -}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_create_materialized_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.264074, "supported_languages": null}, "macro.dbt.default__get_create_materialized_view_as_sql": {"name": "default__get_create_materialized_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/materialized_view/create.sql", "original_file_path": "macros/relations/materialized_view/create.sql", "unique_id": "macro.dbt.default__get_create_materialized_view_as_sql", "macro_sql": "{% macro default__get_create_materialized_view_as_sql(relation, sql) -%}\n    {{ exceptions.raise_compiler_error(\n        \"`get_create_materialized_view_as_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26415, "supported_languages": null}, "macro.dbt.get_table_columns_and_constraints": {"name": "get_table_columns_and_constraints", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.get_table_columns_and_constraints", "macro_sql": "{%- macro get_table_columns_and_constraints() -%}\n  {{ adapter.dispatch('get_table_columns_and_constraints', 'dbt')() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__get_table_columns_and_constraints"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2645571, "supported_languages": null}, "macro.dbt.default__get_table_columns_and_constraints": {"name": "default__get_table_columns_and_constraints", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.default__get_table_columns_and_constraints", "macro_sql": "{% macro default__get_table_columns_and_constraints() -%}\n  {{ return(table_columns_and_constraints()) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.table_columns_and_constraints"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.264622, "supported_languages": null}, "macro.dbt.table_columns_and_constraints": {"name": "table_columns_and_constraints", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.table_columns_and_constraints", "macro_sql": "{% macro table_columns_and_constraints() %}\n  {# loop through user_provided_columns to create DDL with data types and constraints #}\n    {%- set raw_column_constraints = adapter.render_raw_columns_constraints(raw_columns=model['columns']) -%}\n    {%- set raw_model_constraints = adapter.render_raw_model_constraints(raw_constraints=model['constraints']) -%}\n    (\n    {% for c in raw_column_constraints -%}\n      {{ c }}{{ \",\" if not loop.last or raw_model_constraints }}\n    {% endfor %}\n    {% for c in raw_model_constraints -%}\n        {{ c }}{{ \",\" if not loop.last }}\n    {% endfor -%}\n    )\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2648928, "supported_languages": null}, "macro.dbt.get_assert_columns_equivalent": {"name": "get_assert_columns_equivalent", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.get_assert_columns_equivalent", "macro_sql": "\n\n{%- macro get_assert_columns_equivalent(sql) -%}\n  {{ adapter.dispatch('get_assert_columns_equivalent', 'dbt')(sql) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2649841, "supported_languages": null}, "macro.dbt.default__get_assert_columns_equivalent": {"name": "default__get_assert_columns_equivalent", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.default__get_assert_columns_equivalent", "macro_sql": "{% macro default__get_assert_columns_equivalent(sql) -%}\n  {{ return(assert_columns_equivalent(sql)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.265055, "supported_languages": null}, "macro.dbt.assert_columns_equivalent": {"name": "assert_columns_equivalent", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.assert_columns_equivalent", "macro_sql": "{% macro assert_columns_equivalent(sql) %}\n\n  {#-- First ensure the user has defined 'columns' in yaml specification --#}\n  {%- set user_defined_columns = model['columns'] -%}\n  {%- if not user_defined_columns -%}\n      {{ exceptions.raise_contract_error([], []) }}\n  {%- endif -%}\n\n  {#-- Obtain the column schema provided by sql file. #}\n  {%- set sql_file_provided_columns = get_column_schema_from_query(sql, config.get('sql_header', none)) -%}\n  {#--Obtain the column schema provided by the schema file by generating an 'empty schema' query from the model's columns. #}\n  {%- set schema_file_provided_columns = get_column_schema_from_query(get_empty_schema_sql(user_defined_columns)) -%}\n\n  {#-- create dictionaries with name and formatted data type and strings for exception #}\n  {%- set sql_columns = format_columns(sql_file_provided_columns) -%}\n  {%- set yaml_columns = format_columns(schema_file_provided_columns)  -%}\n\n  {%- if sql_columns|length != yaml_columns|length -%}\n    {%- do exceptions.raise_contract_error(yaml_columns, sql_columns) -%}\n  {%- endif -%}\n\n  {%- for sql_col in sql_columns -%}\n    {%- set yaml_col = [] -%}\n    {%- for this_col in yaml_columns -%}\n      {%- if this_col['name'] == sql_col['name'] -%}\n        {%- do yaml_col.append(this_col) -%}\n        {%- break -%}\n      {%- endif -%}\n    {%- endfor -%}\n    {%- if not yaml_col -%}\n      {#-- Column with name not found in yaml #}\n      {%- do exceptions.raise_contract_error(yaml_columns, sql_columns) -%}\n    {%- endif -%}\n    {%- if sql_col['formatted'] != yaml_col[0]['formatted'] -%}\n      {#-- Column data types don't match #}\n      {%- do exceptions.raise_contract_error(yaml_columns, sql_columns) -%}\n    {%- endif -%}\n  {%- endfor -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_column_schema_from_query", "macro.dbt.get_empty_schema_sql", "macro.dbt.format_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.265795, "supported_languages": null}, "macro.dbt.format_columns": {"name": "format_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.format_columns", "macro_sql": "{% macro format_columns(columns) %}\n  {% set formatted_columns = [] %}\n  {% for column in columns %}\n    {%- set formatted_column = adapter.dispatch('format_column', 'dbt')(column) -%}\n    {%- do formatted_columns.append(formatted_column) -%}\n  {% endfor %}\n  {{ return(formatted_columns) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__format_column"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.266013, "supported_languages": null}, "macro.dbt.default__format_column": {"name": "default__format_column", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/column/columns_spec_ddl.sql", "original_file_path": "macros/relations/column/columns_spec_ddl.sql", "unique_id": "macro.dbt.default__format_column", "macro_sql": "{% macro default__format_column(column) -%}\n  {% set data_type = column.dtype %}\n  {% set formatted = column.column.lower() ~ \" \" ~ data_type %}\n  {{ return({'name': column.name, 'data_type': data_type, 'formatted': formatted}) }}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2662022, "supported_languages": null}, "macro.dbt.drop_table": {"name": "drop_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt.drop_table", "macro_sql": "{% macro drop_table(relation) -%}\n    {{- adapter.dispatch('drop_table', 'dbt')(relation) -}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__drop_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2663538, "supported_languages": null}, "macro.dbt.default__drop_table": {"name": "default__drop_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/drop.sql", "original_file_path": "macros/relations/table/drop.sql", "unique_id": "macro.dbt.default__drop_table", "macro_sql": "{% macro default__drop_table(relation) -%}\n    drop table if exists {{ relation.render() }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.266426, "supported_languages": null}, "macro.dbt.get_replace_table_sql": {"name": "get_replace_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/replace.sql", "original_file_path": "macros/relations/table/replace.sql", "unique_id": "macro.dbt.get_replace_table_sql", "macro_sql": "{% macro get_replace_table_sql(relation, sql) %}\n    {{- adapter.dispatch('get_replace_table_sql', 'dbt')(relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_replace_table_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2665758, "supported_languages": null}, "macro.dbt.default__get_replace_table_sql": {"name": "default__get_replace_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/replace.sql", "original_file_path": "macros/relations/table/replace.sql", "unique_id": "macro.dbt.default__get_replace_table_sql", "macro_sql": "{% macro default__get_replace_table_sql(relation, sql) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_replace_table_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2666612, "supported_languages": null}, "macro.dbt.get_rename_table_sql": {"name": "get_rename_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt.get_rename_table_sql", "macro_sql": "{% macro get_rename_table_sql(relation, new_name) %}\n    {{- adapter.dispatch('get_rename_table_sql', 'dbt')(relation, new_name) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_rename_table_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2668118, "supported_languages": null}, "macro.dbt.default__get_rename_table_sql": {"name": "default__get_rename_table_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/rename.sql", "original_file_path": "macros/relations/table/rename.sql", "unique_id": "macro.dbt.default__get_rename_table_sql", "macro_sql": "{% macro default__get_rename_table_sql(relation, new_name) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_rename_table_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.266895, "supported_languages": null}, "macro.dbt.get_create_table_as_sql": {"name": "get_create_table_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.get_create_table_as_sql", "macro_sql": "{% macro get_create_table_as_sql(temporary, relation, sql) -%}\n  {{ adapter.dispatch('get_create_table_as_sql', 'dbt')(temporary, relation, sql) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_create_table_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2672482, "supported_languages": null}, "macro.dbt.default__get_create_table_as_sql": {"name": "default__get_create_table_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__get_create_table_as_sql", "macro_sql": "{% macro default__get_create_table_as_sql(temporary, relation, sql) -%}\n  {{ return(create_table_as(temporary, relation, sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.267348, "supported_languages": null}, "macro.dbt.create_table_as": {"name": "create_table_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.create_table_as", "macro_sql": "{% macro create_table_as(temporary, relation, compiled_code, language='sql') -%}\n  {# backward compatibility for create_table_as that does not support language #}\n  {% if language == \"sql\" %}\n    {{ adapter.dispatch('create_table_as', 'dbt')(temporary, relation, compiled_code)}}\n  {% else %}\n    {{ adapter.dispatch('create_table_as', 'dbt')(temporary, relation, compiled_code, language) }}\n  {% endif %}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__create_table_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2675688, "supported_languages": null}, "macro.dbt.default__create_table_as": {"name": "default__create_table_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__create_table_as", "macro_sql": "{% macro default__create_table_as(temporary, relation, sql) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n\n  create {% if temporary: -%}temporary{%- endif %} table\n    {{ relation.include(database=(not temporary), schema=(not temporary)) }}\n  {% set contract_config = config.get('contract') %}\n  {% if contract_config.enforced and (not temporary) %}\n    {{ get_assert_columns_equivalent(sql) }}\n    {{ get_table_columns_and_constraints() }}\n    {%- set sql = get_select_subquery(sql) %}\n  {% endif %}\n  as (\n    {{ sql }}\n  );\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent", "macro.dbt.get_table_columns_and_constraints", "macro.dbt.get_select_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2679338, "supported_languages": null}, "macro.dbt.default__get_column_names": {"name": "default__get_column_names", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__get_column_names", "macro_sql": "{% macro default__get_column_names() %}\n  {#- loop through user_provided_columns to get column names -#}\n    {%- set user_provided_columns = model['columns'] -%}\n    {%- for i in user_provided_columns %}\n      {%- set col = user_provided_columns[i] -%}\n      {%- set col_name = adapter.quote(col['name']) if col.get('quote') else col['name'] -%}\n      {{ col_name }}{{ \", \" if not loop.last }}\n    {%- endfor -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.268172, "supported_languages": null}, "macro.dbt.get_select_subquery": {"name": "get_select_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.get_select_subquery", "macro_sql": "{% macro get_select_subquery(sql) %}\n  {{ return(adapter.dispatch('get_select_subquery', 'dbt')(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_select_subquery"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26827, "supported_languages": null}, "macro.dbt.default__get_select_subquery": {"name": "default__get_select_subquery", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/table/create.sql", "original_file_path": "macros/relations/table/create.sql", "unique_id": "macro.dbt.default__get_select_subquery", "macro_sql": "{% macro default__get_select_subquery(sql) %}\n    select {{ adapter.dispatch('get_column_names', 'dbt')() }}\n    from (\n        {{ sql }}\n    ) as model_subq\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_column_names"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.268364, "supported_languages": null}, "macro.dbt.drop_view": {"name": "drop_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt.drop_view", "macro_sql": "{% macro drop_view(relation) -%}\n    {{- adapter.dispatch('drop_view', 'dbt')(relation) -}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__drop_view"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2684999, "supported_languages": null}, "macro.dbt.default__drop_view": {"name": "default__drop_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/drop.sql", "original_file_path": "macros/relations/view/drop.sql", "unique_id": "macro.dbt.default__drop_view", "macro_sql": "{% macro default__drop_view(relation) -%}\n    drop view if exists {{ relation.render() }} cascade\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.268568, "supported_languages": null}, "macro.dbt.get_replace_view_sql": {"name": "get_replace_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.get_replace_view_sql", "macro_sql": "{% macro get_replace_view_sql(relation, sql) %}\n    {{- adapter.dispatch('get_replace_view_sql', 'dbt')(relation, sql) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_replace_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.268854, "supported_languages": null}, "macro.dbt.default__get_replace_view_sql": {"name": "default__get_replace_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.default__get_replace_view_sql", "macro_sql": "{% macro default__get_replace_view_sql(relation, sql) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_replace_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2689369, "supported_languages": null}, "macro.dbt.create_or_replace_view": {"name": "create_or_replace_view", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.create_or_replace_view", "macro_sql": "{% macro create_or_replace_view() %}\n  {%- set identifier = model['alias'] -%}\n\n  {%- set old_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) -%}\n  {%- set exists_as_view = (old_relation is not none and old_relation.is_view) -%}\n\n  {%- set target_relation = api.Relation.create(\n      identifier=identifier, schema=schema, database=database,\n      type='view') -%}\n  {% set grant_config = config.get('grants') %}\n\n  {{ run_hooks(pre_hooks) }}\n\n  -- If there's a table with the same name and we weren't told to full refresh,\n  -- that's an error. If we were told to full refresh, drop it. This behavior differs\n  -- for Snowflake and BigQuery, so multiple dispatch is used.\n  {%- if old_relation is not none and old_relation.is_table -%}\n    {{ handle_existing_table(should_full_refresh(), old_relation) }}\n  {%- endif -%}\n\n  -- build model\n  {% call statement('main') -%}\n    {{ get_create_view_as_sql(target_relation, sql) }}\n  {%- endcall %}\n\n  {% set should_revoke = should_revoke(exists_as_view, full_refresh_mode=True) %}\n  {% do apply_grants(target_relation, grant_config, should_revoke=should_revoke) %}\n\n  {{ run_hooks(post_hooks) }}\n\n  {{ return({'relations': [target_relation]}) }}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_hooks", "macro.dbt.handle_existing_table", "macro.dbt.should_full_refresh", "macro.dbt.statement", "macro.dbt.get_create_view_as_sql", "macro.dbt.should_revoke", "macro.dbt.apply_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.269517, "supported_languages": null}, "macro.dbt.handle_existing_table": {"name": "handle_existing_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.handle_existing_table", "macro_sql": "{% macro handle_existing_table(full_refresh, old_relation) %}\n    {{ adapter.dispatch('handle_existing_table', 'dbt')(full_refresh, old_relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__handle_existing_table"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.269631, "supported_languages": null}, "macro.dbt.default__handle_existing_table": {"name": "default__handle_existing_table", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/replace.sql", "original_file_path": "macros/relations/view/replace.sql", "unique_id": "macro.dbt.default__handle_existing_table", "macro_sql": "{% macro default__handle_existing_table(full_refresh, old_relation) %}\n    {{ log(\"Dropping relation \" ~ old_relation.render() ~ \" because it is of type \" ~ old_relation.type) }}\n    {{ adapter.drop_relation(old_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2697659, "supported_languages": null}, "macro.dbt.get_rename_view_sql": {"name": "get_rename_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt.get_rename_view_sql", "macro_sql": "{% macro get_rename_view_sql(relation, new_name) %}\n    {{- adapter.dispatch('get_rename_view_sql', 'dbt')(relation, new_name) -}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_rename_view_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.26992, "supported_languages": null}, "macro.dbt.default__get_rename_view_sql": {"name": "default__get_rename_view_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/rename.sql", "original_file_path": "macros/relations/view/rename.sql", "unique_id": "macro.dbt.default__get_rename_view_sql", "macro_sql": "{% macro default__get_rename_view_sql(relation, new_name) %}\n    {{ exceptions.raise_compiler_error(\n        \"`get_rename_view_sql` has not been implemented for this adapter.\"\n    ) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.270005, "supported_languages": null}, "macro.dbt.get_create_view_as_sql": {"name": "get_create_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.get_create_view_as_sql", "macro_sql": "{% macro get_create_view_as_sql(relation, sql) -%}\n  {{ adapter.dispatch('get_create_view_as_sql', 'dbt')(relation, sql) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_create_view_as_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.270219, "supported_languages": null}, "macro.dbt.default__get_create_view_as_sql": {"name": "default__get_create_view_as_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.default__get_create_view_as_sql", "macro_sql": "{% macro default__get_create_view_as_sql(relation, sql) -%}\n  {{ return(create_view_as(relation, sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.create_view_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2703109, "supported_languages": null}, "macro.dbt.create_view_as": {"name": "create_view_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.create_view_as", "macro_sql": "{% macro create_view_as(relation, sql) -%}\n  {{ adapter.dispatch('create_view_as', 'dbt')(relation, sql) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__create_view_as"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2704158, "supported_languages": null}, "macro.dbt.default__create_view_as": {"name": "default__create_view_as", "resource_type": "macro", "package_name": "dbt", "path": "macros/relations/view/create.sql", "original_file_path": "macros/relations/view/create.sql", "unique_id": "macro.dbt.default__create_view_as", "macro_sql": "{% macro default__create_view_as(relation, sql) -%}\n  {%- set sql_header = config.get('sql_header', none) -%}\n\n  {{ sql_header if sql_header is not none }}\n  create view {{ relation.render() }}\n    {% set contract_config = config.get('contract') %}\n    {% if contract_config.enforced %}\n      {{ get_assert_columns_equivalent(sql) }}\n    {%- endif %}\n  as (\n    {{ sql }}\n  );\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.get_assert_columns_equivalent"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.270726, "supported_languages": null}, "macro.dbt.default__test_relationships": {"name": "default__test_relationships", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/relationships.sql", "original_file_path": "macros/generic_test_sql/relationships.sql", "unique_id": "macro.dbt.default__test_relationships", "macro_sql": "{% macro default__test_relationships(model, column_name, to, field) %}\n\nwith child as (\n    select {{ column_name }} as from_field\n    from {{ model }}\n    where {{ column_name }} is not null\n),\n\nparent as (\n    select {{ field }} as to_field\n    from {{ to }}\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.270903, "supported_languages": null}, "macro.dbt.default__test_not_null": {"name": "default__test_not_null", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/not_null.sql", "original_file_path": "macros/generic_test_sql/not_null.sql", "unique_id": "macro.dbt.default__test_not_null", "macro_sql": "{% macro default__test_not_null(model, column_name) %}\n\n{% set column_list = '*' if should_store_failures() else column_name %}\n\nselect {{ column_list }}\nfrom {{ model }}\nwhere {{ column_name }} is null\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.should_store_failures"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.27107, "supported_languages": null}, "macro.dbt.default__test_unique": {"name": "default__test_unique", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/unique.sql", "original_file_path": "macros/generic_test_sql/unique.sql", "unique_id": "macro.dbt.default__test_unique", "macro_sql": "{% macro default__test_unique(model, column_name) %}\n\nselect\n    {{ column_name }} as unique_field,\n    count(*) as n_records\n\nfrom {{ model }}\nwhere {{ column_name }} is not null\ngroup by {{ column_name }}\nhaving count(*) > 1\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.271212, "supported_languages": null}, "macro.dbt.default__test_accepted_values": {"name": "default__test_accepted_values", "resource_type": "macro", "package_name": "dbt", "path": "macros/generic_test_sql/accepted_values.sql", "original_file_path": "macros/generic_test_sql/accepted_values.sql", "unique_id": "macro.dbt.default__test_accepted_values", "macro_sql": "{% macro default__test_accepted_values(model, column_name, values, quote=True) %}\n\nwith all_values as (\n\n    select\n        {{ column_name }} as value_field,\n        count(*) as n_records\n\n    from {{ model }}\n    group by {{ column_name }}\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    {% for value in values -%}\n        {% if quote -%}\n        '{{ value }}'\n        {%- else -%}\n        {{ value }}\n        {%- endif -%}\n        {%- if not loop.last -%},{%- endif %}\n    {%- endfor %}\n)\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.271489, "supported_languages": null}, "macro.dbt.statement": {"name": "statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/statement.sql", "original_file_path": "macros/etc/statement.sql", "unique_id": "macro.dbt.statement", "macro_sql": "\n{%- macro statement(name=None, fetch_result=False, auto_begin=True, language='sql') -%}\n  {%- if execute: -%}\n    {%- set compiled_code = caller() -%}\n\n    {%- if name == 'main' -%}\n      {{ log('Writing runtime {} for node \"{}\"'.format(language, model['unique_id'])) }}\n      {{ write(compiled_code) }}\n    {%- endif -%}\n    {%- if language == 'sql'-%}\n      {%- set res, table = adapter.execute(compiled_code, auto_begin=auto_begin, fetch=fetch_result) -%}\n    {%- elif language == 'python' -%}\n      {%- set res = submit_python_job(model, compiled_code) -%}\n      {#-- TODO: What should table be for python models? --#}\n      {%- set table = None -%}\n    {%- else -%}\n      {% do exceptions.raise_compiler_error(\"statement macro didn't get supported language\") %}\n    {%- endif -%}\n\n    {%- if name is not none -%}\n      {{ store_result(name, response=res, agate_table=table) }}\n    {%- endif -%}\n\n  {%- endif -%}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.272161, "supported_languages": null}, "macro.dbt.noop_statement": {"name": "noop_statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/statement.sql", "original_file_path": "macros/etc/statement.sql", "unique_id": "macro.dbt.noop_statement", "macro_sql": "{% macro noop_statement(name=None, message=None, code=None, rows_affected=None, res=None) -%}\n  {%- set sql = caller() -%}\n\n  {%- if name == 'main' -%}\n    {{ log('Writing runtime SQL for node \"{}\"'.format(model['unique_id'])) }}\n    {{ write(sql) }}\n  {%- endif -%}\n\n  {%- if name is not none -%}\n    {{ store_raw_result(name, message=message, code=code, rows_affected=rows_affected, agate_table=res) }}\n  {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2724621, "supported_languages": null}, "macro.dbt.run_query": {"name": "run_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/statement.sql", "original_file_path": "macros/etc/statement.sql", "unique_id": "macro.dbt.run_query", "macro_sql": "{% macro run_query(sql) %}\n  {% call statement(\"run_query_statement\", fetch_result=true, auto_begin=false) %}\n    {{ sql }}\n  {% endcall %}\n\n  {% do return(load_result(\"run_query_statement\").table) %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.272612, "supported_languages": null}, "macro.dbt.convert_datetime": {"name": "convert_datetime", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.convert_datetime", "macro_sql": "{% macro convert_datetime(date_str, date_fmt) %}\n\n  {% set error_msg -%}\n      The provided partition date '{{ date_str }}' does not match the expected format '{{ date_fmt }}'\n  {%- endset %}\n\n  {% set res = try_or_compiler_error(error_msg, modules.datetime.datetime.strptime, date_str.strip(), date_fmt) %}\n  {{ return(res) }}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.27301, "supported_languages": null}, "macro.dbt.dates_in_range": {"name": "dates_in_range", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.dates_in_range", "macro_sql": "{% macro dates_in_range(start_date_str, end_date_str=none, in_fmt=\"%Y%m%d\", out_fmt=\"%Y%m%d\") %}\n    {% set end_date_str = start_date_str if end_date_str is none else end_date_str %}\n\n    {% set start_date = convert_datetime(start_date_str, in_fmt) %}\n    {% set end_date = convert_datetime(end_date_str, in_fmt) %}\n\n    {% set day_count = (end_date - start_date).days %}\n    {% if day_count < 0 %}\n        {% set msg -%}\n            Partition start date is after the end date ({{ start_date }}, {{ end_date }})\n        {%- endset %}\n\n        {{ exceptions.raise_compiler_error(msg, model) }}\n    {% endif %}\n\n    {% set date_list = [] %}\n    {% for i in range(0, day_count + 1) %}\n        {% set the_date = (modules.datetime.timedelta(days=i) + start_date) %}\n        {% if not out_fmt %}\n            {% set _ = date_list.append(the_date) %}\n        {% else %}\n            {% set _ = date_list.append(the_date.strftime(out_fmt)) %}\n        {% endif %}\n    {% endfor %}\n\n    {{ return(date_list) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.convert_datetime"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.273626, "supported_languages": null}, "macro.dbt.partition_range": {"name": "partition_range", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.partition_range", "macro_sql": "{% macro partition_range(raw_partition_date, date_fmt='%Y%m%d') %}\n    {% set partition_range = (raw_partition_date | string).split(\",\") %}\n\n    {% if (partition_range | length) == 1 %}\n      {% set start_date = partition_range[0] %}\n      {% set end_date = none %}\n    {% elif (partition_range | length) == 2 %}\n      {% set start_date = partition_range[0] %}\n      {% set end_date = partition_range[1] %}\n    {% else %}\n      {{ exceptions.raise_compiler_error(\"Invalid partition time. Expected format: {Start Date}[,{End Date}]. Got: \" ~ raw_partition_date) }}\n    {% endif %}\n\n    {{ return(dates_in_range(start_date, end_date, in_fmt=date_fmt)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.dates_in_range"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.274034, "supported_languages": null}, "macro.dbt.py_current_timestring": {"name": "py_current_timestring", "resource_type": "macro", "package_name": "dbt", "path": "macros/etc/datetime.sql", "original_file_path": "macros/etc/datetime.sql", "unique_id": "macro.dbt.py_current_timestring", "macro_sql": "{% macro py_current_timestring() %}\n    {% set dt = modules.datetime.datetime.now() %}\n    {% do return(dt.strftime(\"%Y%m%d%H%M%S%f\")) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.274164, "supported_languages": null}, "macro.dbt.except": {"name": "except", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/except.sql", "original_file_path": "macros/utils/except.sql", "unique_id": "macro.dbt.except", "macro_sql": "{% macro except() %}\n  {{ return(adapter.dispatch('except', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__except"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.274297, "supported_languages": null}, "macro.dbt.default__except": {"name": "default__except", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/except.sql", "original_file_path": "macros/utils/except.sql", "unique_id": "macro.dbt.default__except", "macro_sql": "{% macro default__except() %}\n\n    except\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.274344, "supported_languages": null}, "macro.dbt.get_intervals_between": {"name": "get_intervals_between", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.get_intervals_between", "macro_sql": "{% macro get_intervals_between(start_date, end_date, datepart) -%}\n    {{ return(adapter.dispatch('get_intervals_between', 'dbt')(start_date, end_date, datepart)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_intervals_between"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2746408, "supported_languages": null}, "macro.dbt.default__get_intervals_between": {"name": "default__get_intervals_between", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.default__get_intervals_between", "macro_sql": "{% macro default__get_intervals_between(start_date, end_date, datepart) -%}\n    {%- call statement('get_intervals_between', fetch_result=True) %}\n\n        select {{ dbt.datediff(start_date, end_date, datepart) }}\n\n    {%- endcall -%}\n\n    {%- set value_list = load_result('get_intervals_between') -%}\n\n    {%- if value_list and value_list['data'] -%}\n        {%- set values = value_list['data'] | map(attribute=0) | list %}\n        {{ return(values[0]) }}\n    {%- else -%}\n        {{ return(1) }}\n    {%- endif -%}\n\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.274959, "supported_languages": null}, "macro.dbt.date_spine": {"name": "date_spine", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.date_spine", "macro_sql": "{% macro date_spine(datepart, start_date, end_date) %}\n    {{ return(adapter.dispatch('date_spine', 'dbt')(datepart, start_date, end_date)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__date_spine"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2750888, "supported_languages": null}, "macro.dbt.default__date_spine": {"name": "default__date_spine", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_spine.sql", "original_file_path": "macros/utils/date_spine.sql", "unique_id": "macro.dbt.default__date_spine", "macro_sql": "{% macro default__date_spine(datepart, start_date, end_date) %}\n\n\n    {# call as follows:\n\n    date_spine(\n        \"day\",\n        \"to_date('01/01/2016', 'mm/dd/yyyy')\",\n        \"dbt.dateadd(week, 1, current_date)\"\n    ) #}\n\n\n    with rawdata as (\n\n        {{dbt.generate_series(\n            dbt.get_intervals_between(start_date, end_date, datepart)\n        )}}\n\n    ),\n\n    all_periods as (\n\n        select (\n            {{\n                dbt.dateadd(\n                    datepart,\n                    \"row_number() over (order by 1) - 1\",\n                    start_date\n                )\n            }}\n        ) as date_{{datepart}}\n        from rawdata\n\n    ),\n\n    filtered as (\n\n        select *\n        from all_periods\n        where date_{{datepart}} <= {{ end_date }}\n\n    )\n\n    select * from filtered\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.generate_series", "macro.dbt.get_intervals_between", "macro.dbt.dateadd"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.275303, "supported_languages": null}, "macro.dbt.date": {"name": "date", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date.sql", "original_file_path": "macros/utils/date.sql", "unique_id": "macro.dbt.date", "macro_sql": "{% macro date(year, month, day) %}\n  {{ return(adapter.dispatch('date', 'dbt') (year, month, day)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__date"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.275475, "supported_languages": null}, "macro.dbt.default__date": {"name": "default__date", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date.sql", "original_file_path": "macros/utils/date.sql", "unique_id": "macro.dbt.default__date", "macro_sql": "{% macro default__date(year, month, day) -%}\n    {%- set dt = modules.datetime.date(year, month, day) -%}\n    {%- set iso_8601_formatted_date = dt.strftime('%Y-%m-%d') -%}\n    to_date('{{ iso_8601_formatted_date }}', 'YYYY-MM-DD')\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.275625, "supported_languages": null}, "macro.dbt.replace": {"name": "replace", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/replace.sql", "original_file_path": "macros/utils/replace.sql", "unique_id": "macro.dbt.replace", "macro_sql": "{% macro replace(field, old_chars, new_chars) -%}\n    {{ return(adapter.dispatch('replace', 'dbt') (field, old_chars, new_chars)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__replace"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2757912, "supported_languages": null}, "macro.dbt.default__replace": {"name": "default__replace", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/replace.sql", "original_file_path": "macros/utils/replace.sql", "unique_id": "macro.dbt.default__replace", "macro_sql": "{% macro default__replace(field, old_chars, new_chars) %}\n\n    replace(\n        {{ field }},\n        {{ old_chars }},\n        {{ new_chars }}\n    )\n\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.275879, "supported_languages": null}, "macro.dbt.concat": {"name": "concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/concat.sql", "original_file_path": "macros/utils/concat.sql", "unique_id": "macro.dbt.concat", "macro_sql": "{% macro concat(fields) -%}\n  {{ return(adapter.dispatch('concat', 'dbt')(fields)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.276012, "supported_languages": null}, "macro.dbt.default__concat": {"name": "default__concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/concat.sql", "original_file_path": "macros/utils/concat.sql", "unique_id": "macro.dbt.default__concat", "macro_sql": "{% macro default__concat(fields) -%}\n    {{ fields|join(' || ') }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2760792, "supported_languages": null}, "macro.dbt.get_powers_of_two": {"name": "get_powers_of_two", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.get_powers_of_two", "macro_sql": "{% macro get_powers_of_two(upper_bound) %}\n    {{ return(adapter.dispatch('get_powers_of_two', 'dbt')(upper_bound)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_powers_of_two"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.276317, "supported_languages": null}, "macro.dbt.default__get_powers_of_two": {"name": "default__get_powers_of_two", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.default__get_powers_of_two", "macro_sql": "{% macro default__get_powers_of_two(upper_bound) %}\n\n    {% if upper_bound <= 0 %}\n    {{ exceptions.raise_compiler_error(\"upper bound must be positive\") }}\n    {% endif %}\n\n    {% for _ in range(1, 100) %}\n       {% if upper_bound <= 2 ** loop.index %}{{ return(loop.index) }}{% endif %}\n    {% endfor %}\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2766132, "supported_languages": null}, "macro.dbt.generate_series": {"name": "generate_series", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.generate_series", "macro_sql": "{% macro generate_series(upper_bound) %}\n    {{ return(adapter.dispatch('generate_series', 'dbt')(upper_bound)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__generate_series"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.276713, "supported_languages": null}, "macro.dbt.default__generate_series": {"name": "default__generate_series", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/generate_series.sql", "original_file_path": "macros/utils/generate_series.sql", "unique_id": "macro.dbt.default__generate_series", "macro_sql": "{% macro default__generate_series(upper_bound) %}\n\n    {% set n = dbt.get_powers_of_two(upper_bound) %}\n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    {% for i in range(n) %}\n    p{{i}}.generated_number * power(2, {{i}})\n    {% if not loop.last %} + {% endif %}\n    {% endfor %}\n    + 1\n    as generated_number\n\n    from\n\n    {% for i in range(n) %}\n    p as p{{i}}\n    {% if not loop.last %} cross join {% endif %}\n    {% endfor %}\n\n    )\n\n    select *\n    from unioned\n    where generated_number <= {{upper_bound}}\n    order by generated_number\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_powers_of_two"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2769878, "supported_languages": null}, "macro.dbt.length": {"name": "length", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/length.sql", "original_file_path": "macros/utils/length.sql", "unique_id": "macro.dbt.length", "macro_sql": "{% macro length(expression) -%}\n    {{ return(adapter.dispatch('length', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__length"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2771242, "supported_languages": null}, "macro.dbt.default__length": {"name": "default__length", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/length.sql", "original_file_path": "macros/utils/length.sql", "unique_id": "macro.dbt.default__length", "macro_sql": "{% macro default__length(expression) %}\n\n    length(\n        {{ expression }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.277183, "supported_languages": null}, "macro.dbt.dateadd": {"name": "dateadd", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt.dateadd", "macro_sql": "{% macro dateadd(datepart, interval, from_date_or_timestamp) %}\n  {{ return(adapter.dispatch('dateadd', 'dbt')(datepart, interval, from_date_or_timestamp)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__dateadd"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.277351, "supported_languages": null}, "macro.dbt.default__dateadd": {"name": "default__dateadd", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/dateadd.sql", "original_file_path": "macros/utils/dateadd.sql", "unique_id": "macro.dbt.default__dateadd", "macro_sql": "{% macro default__dateadd(datepart, interval, from_date_or_timestamp) %}\n\n    dateadd(\n        {{ datepart }},\n        {{ interval }},\n        {{ from_date_or_timestamp }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2774389, "supported_languages": null}, "macro.dbt.intersect": {"name": "intersect", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/intersect.sql", "original_file_path": "macros/utils/intersect.sql", "unique_id": "macro.dbt.intersect", "macro_sql": "{% macro intersect() %}\n  {{ return(adapter.dispatch('intersect', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__intersect"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.27756, "supported_languages": null}, "macro.dbt.default__intersect": {"name": "default__intersect", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/intersect.sql", "original_file_path": "macros/utils/intersect.sql", "unique_id": "macro.dbt.default__intersect", "macro_sql": "{% macro default__intersect() %}\n\n    intersect\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.277604, "supported_languages": null}, "macro.dbt.escape_single_quotes": {"name": "escape_single_quotes", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/escape_single_quotes.sql", "original_file_path": "macros/utils/escape_single_quotes.sql", "unique_id": "macro.dbt.escape_single_quotes", "macro_sql": "{% macro escape_single_quotes(expression) %}\n      {{ return(adapter.dispatch('escape_single_quotes', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__escape_single_quotes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2777479, "supported_languages": null}, "macro.dbt.default__escape_single_quotes": {"name": "default__escape_single_quotes", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/escape_single_quotes.sql", "original_file_path": "macros/utils/escape_single_quotes.sql", "unique_id": "macro.dbt.default__escape_single_quotes", "macro_sql": "{% macro default__escape_single_quotes(expression) -%}\n{{ expression | replace(\"'\",\"''\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.27783, "supported_languages": null}, "macro.dbt.right": {"name": "right", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/right.sql", "original_file_path": "macros/utils/right.sql", "unique_id": "macro.dbt.right", "macro_sql": "{% macro right(string_text, length_expression) -%}\n    {{ return(adapter.dispatch('right', 'dbt') (string_text, length_expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__right"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.277993, "supported_languages": null}, "macro.dbt.default__right": {"name": "default__right", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/right.sql", "original_file_path": "macros/utils/right.sql", "unique_id": "macro.dbt.default__right", "macro_sql": "{% macro default__right(string_text, length_expression) %}\n\n    right(\n        {{ string_text }},\n        {{ length_expression }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.278073, "supported_languages": null}, "macro.dbt.listagg": {"name": "listagg", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt.listagg", "macro_sql": "{% macro listagg(measure, delimiter_text=\"','\", order_by_clause=none, limit_num=none) -%}\n    {{ return(adapter.dispatch('listagg', 'dbt') (measure, delimiter_text, order_by_clause, limit_num)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__listagg"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.278335, "supported_languages": null}, "macro.dbt.default__listagg": {"name": "default__listagg", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/listagg.sql", "original_file_path": "macros/utils/listagg.sql", "unique_id": "macro.dbt.default__listagg", "macro_sql": "{% macro default__listagg(measure, delimiter_text, order_by_clause, limit_num) -%}\n\n    {% if limit_num -%}\n    array_to_string(\n        array_slice(\n            array_agg(\n                {{ measure }}\n            ){% if order_by_clause -%}\n            within group ({{ order_by_clause }})\n            {%- endif %}\n            ,0\n            ,{{ limit_num }}\n        ),\n        {{ delimiter_text }}\n        )\n    {%- else %}\n    listagg(\n        {{ measure }},\n        {{ delimiter_text }}\n        )\n        {% if order_by_clause -%}\n        within group ({{ order_by_clause }})\n        {%- endif %}\n    {%- endif %}\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.278563, "supported_languages": null}, "macro.dbt.datediff": {"name": "datediff", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt.datediff", "macro_sql": "{% macro datediff(first_date, second_date, datepart) %}\n  {{ return(adapter.dispatch('datediff', 'dbt')(first_date, second_date, datepart)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__datediff"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.278742, "supported_languages": null}, "macro.dbt.default__datediff": {"name": "default__datediff", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/datediff.sql", "original_file_path": "macros/utils/datediff.sql", "unique_id": "macro.dbt.default__datediff", "macro_sql": "{% macro default__datediff(first_date, second_date, datepart) -%}\n\n    datediff(\n        {{ datepart }},\n        {{ first_date }},\n        {{ second_date }}\n        )\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.278836, "supported_languages": null}, "macro.dbt.safe_cast": {"name": "safe_cast", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/safe_cast.sql", "original_file_path": "macros/utils/safe_cast.sql", "unique_id": "macro.dbt.safe_cast", "macro_sql": "{% macro safe_cast(field, type) %}\n  {{ return(adapter.dispatch('safe_cast', 'dbt') (field, type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__safe_cast"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.279001, "supported_languages": null}, "macro.dbt.default__safe_cast": {"name": "default__safe_cast", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/safe_cast.sql", "original_file_path": "macros/utils/safe_cast.sql", "unique_id": "macro.dbt.default__safe_cast", "macro_sql": "{% macro default__safe_cast(field, type) %}\n    {# most databases don't support this function yet\n    so we just need to use cast #}\n    cast({{field}} as {{type}})\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2790809, "supported_languages": null}, "macro.dbt.equals": {"name": "equals", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/equals.sql", "original_file_path": "macros/utils/equals.sql", "unique_id": "macro.dbt.equals", "macro_sql": "{% macro equals(expr1, expr2) %}\n    {{ return(adapter.dispatch('equals', 'dbt') (expr1, expr2)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__equals"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.27926, "supported_languages": null}, "macro.dbt.default__equals": {"name": "default__equals", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/equals.sql", "original_file_path": "macros/utils/equals.sql", "unique_id": "macro.dbt.default__equals", "macro_sql": "{% macro default__equals(expr1, expr2) -%}\n{%- if adapter.behavior.enable_truthy_nulls_equals_macro.no_warn %}\n    case when (({{ expr1 }} = {{ expr2 }}) or ({{ expr1 }} is null and {{ expr2 }} is null))\n        then 0\n        else 1\n    end = 0\n{%- else -%}\n    ({{ expr1 }} = {{ expr2 }})\n{%- endif %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.279425, "supported_languages": null}, "macro.dbt.hash": {"name": "hash", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/hash.sql", "original_file_path": "macros/utils/hash.sql", "unique_id": "macro.dbt.hash", "macro_sql": "{% macro hash(field) -%}\n  {{ return(adapter.dispatch('hash', 'dbt') (field)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__hash"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.279571, "supported_languages": null}, "macro.dbt.default__hash": {"name": "default__hash", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/hash.sql", "original_file_path": "macros/utils/hash.sql", "unique_id": "macro.dbt.default__hash", "macro_sql": "{% macro default__hash(field) -%}\n    md5(cast({{ field }} as {{ api.Column.translate_type('string') }}))\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2796621, "supported_languages": null}, "macro.dbt.cast_bool_to_text": {"name": "cast_bool_to_text", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/cast_bool_to_text.sql", "original_file_path": "macros/utils/cast_bool_to_text.sql", "unique_id": "macro.dbt.cast_bool_to_text", "macro_sql": "{% macro cast_bool_to_text(field) %}\n  {{ adapter.dispatch('cast_bool_to_text', 'dbt') (field) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__cast_bool_to_text"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2798002, "supported_languages": null}, "macro.dbt.default__cast_bool_to_text": {"name": "default__cast_bool_to_text", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/cast_bool_to_text.sql", "original_file_path": "macros/utils/cast_bool_to_text.sql", "unique_id": "macro.dbt.default__cast_bool_to_text", "macro_sql": "{% macro default__cast_bool_to_text(field) %}\n    cast({{ field }} as {{ api.Column.translate_type('string') }})\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.279884, "supported_languages": null}, "macro.dbt.cast": {"name": "cast", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/cast.sql", "original_file_path": "macros/utils/cast.sql", "unique_id": "macro.dbt.cast", "macro_sql": "{% macro cast(field, type) %}\n  {{ return(adapter.dispatch('cast', 'dbt') (field, type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__cast"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.280032, "supported_languages": null}, "macro.dbt.default__cast": {"name": "default__cast", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/cast.sql", "original_file_path": "macros/utils/cast.sql", "unique_id": "macro.dbt.default__cast", "macro_sql": "{% macro default__cast(field, type) %}\n    cast({{field}} as {{type}})\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.280103, "supported_languages": null}, "macro.dbt.any_value": {"name": "any_value", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/any_value.sql", "original_file_path": "macros/utils/any_value.sql", "unique_id": "macro.dbt.any_value", "macro_sql": "{% macro any_value(expression) -%}\n    {{ return(adapter.dispatch('any_value', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__any_value"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.280232, "supported_languages": null}, "macro.dbt.default__any_value": {"name": "default__any_value", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/any_value.sql", "original_file_path": "macros/utils/any_value.sql", "unique_id": "macro.dbt.default__any_value", "macro_sql": "{% macro default__any_value(expression) -%}\n\n    any_value({{ expression }})\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2803469, "supported_languages": null}, "macro.dbt.position": {"name": "position", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/position.sql", "original_file_path": "macros/utils/position.sql", "unique_id": "macro.dbt.position", "macro_sql": "{% macro position(substring_text, string_text) -%}\n    {{ return(adapter.dispatch('position', 'dbt') (substring_text, string_text)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__position"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2804968, "supported_languages": null}, "macro.dbt.default__position": {"name": "default__position", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/position.sql", "original_file_path": "macros/utils/position.sql", "unique_id": "macro.dbt.default__position", "macro_sql": "{% macro default__position(substring_text, string_text) %}\n\n    position(\n        {{ substring_text }} in {{ string_text }}\n    )\n\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.280569, "supported_languages": null}, "macro.dbt.string_literal": {"name": "string_literal", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/literal.sql", "original_file_path": "macros/utils/literal.sql", "unique_id": "macro.dbt.string_literal", "macro_sql": "{%- macro string_literal(value) -%}\n  {{ return(adapter.dispatch('string_literal', 'dbt') (value)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__string_literal"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.280698, "supported_languages": null}, "macro.dbt.default__string_literal": {"name": "default__string_literal", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/literal.sql", "original_file_path": "macros/utils/literal.sql", "unique_id": "macro.dbt.default__string_literal", "macro_sql": "{% macro default__string_literal(value) -%}\n    '{{ value }}'\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2807539, "supported_languages": null}, "macro.dbt.type_string": {"name": "type_string", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_string", "macro_sql": "\n\n{%- macro type_string() -%}\n  {{ return(adapter.dispatch('type_string', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_string"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.28117, "supported_languages": null}, "macro.dbt.default__type_string": {"name": "default__type_string", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_string", "macro_sql": "{% macro default__type_string() %}\n    {{ return(api.Column.translate_type(\"string\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281249, "supported_languages": null}, "macro.dbt.type_timestamp": {"name": "type_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_timestamp", "macro_sql": "\n\n{%- macro type_timestamp() -%}\n  {{ return(adapter.dispatch('type_timestamp', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281336, "supported_languages": null}, "macro.dbt.default__type_timestamp": {"name": "default__type_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_timestamp", "macro_sql": "{% macro default__type_timestamp() %}\n    {{ return(api.Column.translate_type(\"timestamp\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281415, "supported_languages": null}, "macro.dbt.type_float": {"name": "type_float", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_float", "macro_sql": "\n\n{%- macro type_float() -%}\n  {{ return(adapter.dispatch('type_float', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_float"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2814982, "supported_languages": null}, "macro.dbt.default__type_float": {"name": "default__type_float", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_float", "macro_sql": "{% macro default__type_float() %}\n    {{ return(api.Column.translate_type(\"float\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281579, "supported_languages": null}, "macro.dbt.type_numeric": {"name": "type_numeric", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_numeric", "macro_sql": "\n\n{%- macro type_numeric() -%}\n  {{ return(adapter.dispatch('type_numeric', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_numeric"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281664, "supported_languages": null}, "macro.dbt.default__type_numeric": {"name": "default__type_numeric", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_numeric", "macro_sql": "{% macro default__type_numeric() %}\n    {{ return(api.Column.numeric_type(\"numeric\", 28, 6)) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281755, "supported_languages": null}, "macro.dbt.type_bigint": {"name": "type_bigint", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_bigint", "macro_sql": "\n\n{%- macro type_bigint() -%}\n  {{ return(adapter.dispatch('type_bigint', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_bigint"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281842, "supported_languages": null}, "macro.dbt.default__type_bigint": {"name": "default__type_bigint", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_bigint", "macro_sql": "{% macro default__type_bigint() %}\n    {{ return(api.Column.translate_type(\"bigint\")) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.281922, "supported_languages": null}, "macro.dbt.type_int": {"name": "type_int", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_int", "macro_sql": "\n\n{%- macro type_int() -%}\n  {{ return(adapter.dispatch('type_int', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_int"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.282005, "supported_languages": null}, "macro.dbt.default__type_int": {"name": "default__type_int", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_int", "macro_sql": "{%- macro default__type_int() -%}\n  {{ return(api.Column.translate_type(\"integer\")) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2820811, "supported_languages": null}, "macro.dbt.type_boolean": {"name": "type_boolean", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.type_boolean", "macro_sql": "\n\n{%- macro type_boolean() -%}\n  {{ return(adapter.dispatch('type_boolean', 'dbt')()) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__type_boolean"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.282166, "supported_languages": null}, "macro.dbt.default__type_boolean": {"name": "default__type_boolean", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/data_types.sql", "original_file_path": "macros/utils/data_types.sql", "unique_id": "macro.dbt.default__type_boolean", "macro_sql": "{%- macro default__type_boolean() -%}\n  {{ return(api.Column.translate_type(\"boolean\")) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.282242, "supported_languages": null}, "macro.dbt.array_concat": {"name": "array_concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_concat.sql", "original_file_path": "macros/utils/array_concat.sql", "unique_id": "macro.dbt.array_concat", "macro_sql": "{% macro array_concat(array_1, array_2) -%}\n  {{ return(adapter.dispatch('array_concat', 'dbt')(array_1, array_2)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__array_concat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.282388, "supported_languages": null}, "macro.dbt.default__array_concat": {"name": "default__array_concat", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_concat.sql", "original_file_path": "macros/utils/array_concat.sql", "unique_id": "macro.dbt.default__array_concat", "macro_sql": "{% macro default__array_concat(array_1, array_2) -%}\n    array_cat({{ array_1 }}, {{ array_2 }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.28246, "supported_languages": null}, "macro.dbt.bool_or": {"name": "bool_or", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/bool_or.sql", "original_file_path": "macros/utils/bool_or.sql", "unique_id": "macro.dbt.bool_or", "macro_sql": "{% macro bool_or(expression) -%}\n    {{ return(adapter.dispatch('bool_or', 'dbt') (expression)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__bool_or"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.28259, "supported_languages": null}, "macro.dbt.default__bool_or": {"name": "default__bool_or", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/bool_or.sql", "original_file_path": "macros/utils/bool_or.sql", "unique_id": "macro.dbt.default__bool_or", "macro_sql": "{% macro default__bool_or(expression) -%}\n\n    bool_or({{ expression }})\n\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.282652, "supported_languages": null}, "macro.dbt.last_day": {"name": "last_day", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt.last_day", "macro_sql": "{% macro last_day(date, datepart) %}\n  {{ return(adapter.dispatch('last_day', 'dbt') (date, datepart)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__last_day"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2828228, "supported_languages": null}, "macro.dbt.default_last_day": {"name": "default_last_day", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt.default_last_day", "macro_sql": "\n\n{%- macro default_last_day(date, datepart) -%}\n    cast(\n        {{dbt.dateadd('day', '-1',\n        dbt.dateadd(datepart, '1', dbt.date_trunc(datepart, date))\n        )}}\n        as date)\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.dateadd", "macro.dbt.date_trunc"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.282967, "supported_languages": null}, "macro.dbt.default__last_day": {"name": "default__last_day", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/last_day.sql", "original_file_path": "macros/utils/last_day.sql", "unique_id": "macro.dbt.default__last_day", "macro_sql": "{% macro default__last_day(date, datepart) -%}\n    {{dbt.default_last_day(date, datepart)}}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default_last_day"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2830489, "supported_languages": null}, "macro.dbt.split_part": {"name": "split_part", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt.split_part", "macro_sql": "{% macro split_part(string_text, delimiter_text, part_number) %}\n  {{ return(adapter.dispatch('split_part', 'dbt') (string_text, delimiter_text, part_number)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__split_part"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2832608, "supported_languages": null}, "macro.dbt.default__split_part": {"name": "default__split_part", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt.default__split_part", "macro_sql": "{% macro default__split_part(string_text, delimiter_text, part_number) %}\n\n    split_part(\n        {{ string_text }},\n        {{ delimiter_text }},\n        {{ part_number }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.283417, "supported_languages": null}, "macro.dbt._split_part_negative": {"name": "_split_part_negative", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/split_part.sql", "original_file_path": "macros/utils/split_part.sql", "unique_id": "macro.dbt._split_part_negative", "macro_sql": "{% macro _split_part_negative(string_text, delimiter_text, part_number) %}\n\n    split_part(\n        {{ string_text }},\n        {{ delimiter_text }},\n          length({{ string_text }})\n          - length(\n              replace({{ string_text }},  {{ delimiter_text }}, '')\n          ) + 2 + {{ part_number }}\n        )\n\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.283544, "supported_languages": null}, "macro.dbt.date_trunc": {"name": "date_trunc", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_trunc.sql", "original_file_path": "macros/utils/date_trunc.sql", "unique_id": "macro.dbt.date_trunc", "macro_sql": "{% macro date_trunc(datepart, date) -%}\n  {{ return(adapter.dispatch('date_trunc', 'dbt') (datepart, date)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__date_trunc"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.283703, "supported_languages": null}, "macro.dbt.default__date_trunc": {"name": "default__date_trunc", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/date_trunc.sql", "original_file_path": "macros/utils/date_trunc.sql", "unique_id": "macro.dbt.default__date_trunc", "macro_sql": "{% macro default__date_trunc(datepart, date) -%}\n    date_trunc('{{datepart}}', {{date}})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.283778, "supported_languages": null}, "macro.dbt.array_construct": {"name": "array_construct", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_construct.sql", "original_file_path": "macros/utils/array_construct.sql", "unique_id": "macro.dbt.array_construct", "macro_sql": "{% macro array_construct(inputs=[], data_type=api.Column.translate_type('integer')) -%}\n  {{ return(adapter.dispatch('array_construct', 'dbt')(inputs, data_type)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__array_construct"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2839859, "supported_languages": null}, "macro.dbt.default__array_construct": {"name": "default__array_construct", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_construct.sql", "original_file_path": "macros/utils/array_construct.sql", "unique_id": "macro.dbt.default__array_construct", "macro_sql": "{% macro default__array_construct(inputs, data_type) -%}\n    {% if inputs|length > 0 %}\n    array[ {{ inputs|join(' , ') }} ]\n    {% else %}\n    array[]::{{data_type}}[]\n    {% endif %}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2841222, "supported_languages": null}, "macro.dbt.array_append": {"name": "array_append", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_append.sql", "original_file_path": "macros/utils/array_append.sql", "unique_id": "macro.dbt.array_append", "macro_sql": "{% macro array_append(array, new_element) -%}\n  {{ return(adapter.dispatch('array_append', 'dbt')(array, new_element)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__array_append"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2842848, "supported_languages": null}, "macro.dbt.default__array_append": {"name": "default__array_append", "resource_type": "macro", "package_name": "dbt", "path": "macros/utils/array_append.sql", "original_file_path": "macros/utils/array_append.sql", "unique_id": "macro.dbt.default__array_append", "macro_sql": "{% macro default__array_append(array, new_element) -%}\n    array_append({{ array }}, {{ new_element }})\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.284363, "supported_languages": null}, "macro.dbt.create_schema": {"name": "create_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.create_schema", "macro_sql": "{% macro create_schema(relation) -%}\n  {{ adapter.dispatch('create_schema', 'dbt')(relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__create_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2845519, "supported_languages": null}, "macro.dbt.default__create_schema": {"name": "default__create_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.default__create_schema", "macro_sql": "{% macro default__create_schema(relation) -%}\n  {%- call statement('create_schema') -%}\n    create schema if not exists {{ relation.without_identifier() }}\n  {% endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.284659, "supported_languages": null}, "macro.dbt.drop_schema": {"name": "drop_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.drop_schema", "macro_sql": "{% macro drop_schema(relation) -%}\n  {{ adapter.dispatch('drop_schema', 'dbt')(relation) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__drop_schema"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.284752, "supported_languages": null}, "macro.dbt.default__drop_schema": {"name": "default__drop_schema", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/schema.sql", "original_file_path": "macros/adapters/schema.sql", "unique_id": "macro.dbt.default__drop_schema", "macro_sql": "{% macro default__drop_schema(relation) -%}\n  {%- call statement('drop_schema') -%}\n    drop schema if exists {{ relation.without_identifier() }} cascade\n  {% endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.28485, "supported_languages": null}, "macro.dbt.current_timestamp": {"name": "current_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.current_timestamp", "macro_sql": "{%- macro current_timestamp() -%}\n    {{ adapter.dispatch('current_timestamp', 'dbt')() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_redshift.redshift__current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285105, "supported_languages": null}, "macro.dbt.default__current_timestamp": {"name": "default__current_timestamp", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__current_timestamp", "macro_sql": "{% macro default__current_timestamp() -%}\n  {{ exceptions.raise_not_implemented(\n    'current_timestamp macro not implemented for adapter ' + adapter.type()) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285185, "supported_languages": null}, "macro.dbt.snapshot_get_time": {"name": "snapshot_get_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.snapshot_get_time", "macro_sql": "\n\n{%- macro snapshot_get_time() -%}\n    {{ adapter.dispatch('snapshot_get_time', 'dbt')() }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_redshift.redshift__snapshot_get_time"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285258, "supported_languages": null}, "macro.dbt.default__snapshot_get_time": {"name": "default__snapshot_get_time", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__snapshot_get_time", "macro_sql": "{% macro default__snapshot_get_time() %}\n    {{ current_timestamp() }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285314, "supported_languages": null}, "macro.dbt.get_snapshot_get_time_data_type": {"name": "get_snapshot_get_time_data_type", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.get_snapshot_get_time_data_type", "macro_sql": "{% macro get_snapshot_get_time_data_type() %}\n    {% set snapshot_time = adapter.dispatch('snapshot_get_time', 'dbt')() %}\n    {% set time_data_type_sql = 'select ' ~ snapshot_time ~ ' as dbt_snapshot_time' %}\n    {% set snapshot_time_column_schema = get_column_schema_from_query(time_data_type_sql) %}\n    {% set time_data_type = snapshot_time_column_schema[0].dtype %}\n    {{ return(time_data_type or none) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.snapshot_get_time", "macro.dbt_redshift.redshift__snapshot_get_time", "macro.dbt.get_column_schema_from_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285525, "supported_languages": null}, "macro.dbt.current_timestamp_backcompat": {"name": "current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.current_timestamp_backcompat", "macro_sql": "{% macro current_timestamp_backcompat() %}\n    {{ return(adapter.dispatch('current_timestamp_backcompat', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__current_timestamp_backcompat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285612, "supported_languages": null}, "macro.dbt.default__current_timestamp_backcompat": {"name": "default__current_timestamp_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__current_timestamp_backcompat", "macro_sql": "{% macro default__current_timestamp_backcompat() %}\n    current_timestamp::timestamp\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285656, "supported_languages": null}, "macro.dbt.current_timestamp_in_utc_backcompat": {"name": "current_timestamp_in_utc_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.current_timestamp_in_utc_backcompat", "macro_sql": "{% macro current_timestamp_in_utc_backcompat() %}\n    {{ return(adapter.dispatch('current_timestamp_in_utc_backcompat', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__current_timestamp_in_utc_backcompat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.285742, "supported_languages": null}, "macro.dbt.default__current_timestamp_in_utc_backcompat": {"name": "default__current_timestamp_in_utc_backcompat", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/timestamps.sql", "original_file_path": "macros/adapters/timestamps.sql", "unique_id": "macro.dbt.default__current_timestamp_in_utc_backcompat", "macro_sql": "{% macro default__current_timestamp_in_utc_backcompat() %}\n    {{ return(adapter.dispatch('current_timestamp_backcompat', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.current_timestamp_backcompat", "macro.dbt_redshift.redshift__current_timestamp_backcompat"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2858272, "supported_languages": null}, "macro.dbt.get_create_index_sql": {"name": "get_create_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.get_create_index_sql", "macro_sql": "{% macro get_create_index_sql(relation, index_dict) -%}\n  {{ return(adapter.dispatch('get_create_index_sql', 'dbt')(relation, index_dict)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_create_index_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.286083, "supported_languages": null}, "macro.dbt.default__get_create_index_sql": {"name": "default__get_create_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__get_create_index_sql", "macro_sql": "{% macro default__get_create_index_sql(relation, index_dict) -%}\n  {% do return(None) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.286159, "supported_languages": null}, "macro.dbt.create_indexes": {"name": "create_indexes", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.create_indexes", "macro_sql": "{% macro create_indexes(relation) -%}\n  {{ adapter.dispatch('create_indexes', 'dbt')(relation) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.default__create_indexes"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.286242, "supported_languages": null}, "macro.dbt.default__create_indexes": {"name": "default__create_indexes", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__create_indexes", "macro_sql": "{% macro default__create_indexes(relation) -%}\n  {%- set _indexes = config.get('indexes', default=[]) -%}\n\n  {% for _index_dict in _indexes %}\n    {% set create_index_sql = get_create_index_sql(relation, _index_dict) %}\n    {% if create_index_sql %}\n      {% do run_query(create_index_sql) %}\n    {% endif %}\n  {% endfor %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_create_index_sql", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.286444, "supported_languages": null}, "macro.dbt.get_drop_index_sql": {"name": "get_drop_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.get_drop_index_sql", "macro_sql": "{% macro get_drop_index_sql(relation, index_name) -%}\n    {{ adapter.dispatch('get_drop_index_sql', 'dbt')(relation, index_name) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_drop_index_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2865999, "supported_languages": null}, "macro.dbt.default__get_drop_index_sql": {"name": "default__get_drop_index_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__get_drop_index_sql", "macro_sql": "{% macro default__get_drop_index_sql(relation, index_name) -%}\n    {{ exceptions.raise_compiler_error(\"`get_drop_index_sql has not been implemented for this adapter.\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.286675, "supported_languages": null}, "macro.dbt.get_show_indexes_sql": {"name": "get_show_indexes_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.get_show_indexes_sql", "macro_sql": "{% macro get_show_indexes_sql(relation) -%}\n    {{ adapter.dispatch('get_show_indexes_sql', 'dbt')(relation) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__get_show_indexes_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2867572, "supported_languages": null}, "macro.dbt.default__get_show_indexes_sql": {"name": "default__get_show_indexes_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/indexes.sql", "original_file_path": "macros/adapters/indexes.sql", "unique_id": "macro.dbt.default__get_show_indexes_sql", "macro_sql": "{% macro default__get_show_indexes_sql(relation) -%}\n    {{ exceptions.raise_compiler_error(\"`get_show_indexes_sql has not been implemented for this adapter.\") }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.286824, "supported_languages": null}, "macro.dbt.make_intermediate_relation": {"name": "make_intermediate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.make_intermediate_relation", "macro_sql": "{% macro make_intermediate_relation(base_relation, suffix='__dbt_tmp') %}\n  {{ return(adapter.dispatch('make_intermediate_relation', 'dbt')(base_relation, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__make_intermediate_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.287193, "supported_languages": null}, "macro.dbt.default__make_intermediate_relation": {"name": "default__make_intermediate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__make_intermediate_relation", "macro_sql": "{% macro default__make_intermediate_relation(base_relation, suffix) %}\n    {{ return(default__make_temp_relation(base_relation, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__make_temp_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2872808, "supported_languages": null}, "macro.dbt.make_temp_relation": {"name": "make_temp_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.make_temp_relation", "macro_sql": "{% macro make_temp_relation(base_relation, suffix='__dbt_tmp') %}\n  {#-- This ensures microbatch batches get unique temp relations to avoid clobbering --#}\n  {% if suffix == '__dbt_tmp' and model.batch %}\n    {% set suffix = suffix ~ '_' ~ model.batch.id %}\n  {% endif %}\n\n  {{ return(adapter.dispatch('make_temp_relation', 'dbt')(base_relation, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__make_temp_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.287494, "supported_languages": null}, "macro.dbt.default__make_temp_relation": {"name": "default__make_temp_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__make_temp_relation", "macro_sql": "{% macro default__make_temp_relation(base_relation, suffix) %}\n    {%- set temp_identifier = base_relation.identifier ~ suffix -%}\n    {%- set temp_relation = base_relation.incorporate(\n                                path={\"identifier\": temp_identifier}) -%}\n\n    {{ return(temp_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.287658, "supported_languages": null}, "macro.dbt.make_backup_relation": {"name": "make_backup_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.make_backup_relation", "macro_sql": "{% macro make_backup_relation(base_relation, backup_relation_type, suffix='__dbt_backup') %}\n    {{ return(adapter.dispatch('make_backup_relation', 'dbt')(base_relation, backup_relation_type, suffix)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__make_backup_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.287793, "supported_languages": null}, "macro.dbt.default__make_backup_relation": {"name": "default__make_backup_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__make_backup_relation", "macro_sql": "{% macro default__make_backup_relation(base_relation, backup_relation_type, suffix) %}\n    {%- set backup_identifier = base_relation.identifier ~ suffix -%}\n    {%- set backup_relation = base_relation.incorporate(\n                                  path={\"identifier\": backup_identifier},\n                                  type=backup_relation_type\n    ) -%}\n    {{ return(backup_relation) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.28797, "supported_languages": null}, "macro.dbt.truncate_relation": {"name": "truncate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.truncate_relation", "macro_sql": "{% macro truncate_relation(relation) -%}\n  {{ return(adapter.dispatch('truncate_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__truncate_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2880719, "supported_languages": null}, "macro.dbt.default__truncate_relation": {"name": "default__truncate_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__truncate_relation", "macro_sql": "{% macro default__truncate_relation(relation) -%}\n  {% call statement('truncate_relation') -%}\n    truncate table {{ relation.render() }}\n  {%- endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.288173, "supported_languages": null}, "macro.dbt.get_or_create_relation": {"name": "get_or_create_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.get_or_create_relation", "macro_sql": "{% macro get_or_create_relation(database, schema, identifier, type) -%}\n  {{ return(adapter.dispatch('get_or_create_relation', 'dbt')(database, schema, identifier, type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_or_create_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.288312, "supported_languages": null}, "macro.dbt.default__get_or_create_relation": {"name": "default__get_or_create_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.default__get_or_create_relation", "macro_sql": "{% macro default__get_or_create_relation(database, schema, identifier, type) %}\n  {%- set target_relation = adapter.get_relation(database=database, schema=schema, identifier=identifier) %}\n\n  {% if target_relation %}\n    {% do return([true, target_relation]) %}\n  {% endif %}\n\n  {%- set new_relation = api.Relation.create(\n      database=database,\n      schema=schema,\n      identifier=identifier,\n      type=type\n  ) -%}\n  {% do return([false, new_relation]) %}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2886112, "supported_languages": null}, "macro.dbt.load_cached_relation": {"name": "load_cached_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.load_cached_relation", "macro_sql": "{% macro load_cached_relation(relation) %}\n  {% do return(adapter.get_relation(\n    database=relation.database,\n    schema=relation.schema,\n    identifier=relation.identifier\n  )) -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2887418, "supported_languages": null}, "macro.dbt.load_relation": {"name": "load_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/relation.sql", "original_file_path": "macros/adapters/relation.sql", "unique_id": "macro.dbt.load_relation", "macro_sql": "{% macro load_relation(relation) %}\n    {{ return(load_cached_relation(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.load_cached_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2888231, "supported_languages": null}, "macro.dbt.collect_freshness": {"name": "collect_freshness", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/freshness.sql", "original_file_path": "macros/adapters/freshness.sql", "unique_id": "macro.dbt.collect_freshness", "macro_sql": "{% macro collect_freshness(source, loaded_at_field, filter) %}\n  {{ return(adapter.dispatch('collect_freshness', 'dbt')(source, loaded_at_field, filter))}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__collect_freshness"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2890801, "supported_languages": null}, "macro.dbt.default__collect_freshness": {"name": "default__collect_freshness", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/freshness.sql", "original_file_path": "macros/adapters/freshness.sql", "unique_id": "macro.dbt.default__collect_freshness", "macro_sql": "{% macro default__collect_freshness(source, loaded_at_field, filter) %}\n  {% call statement('collect_freshness', fetch_result=True, auto_begin=False) -%}\n    select\n      max({{ loaded_at_field }}) as max_loaded_at,\n      {{ current_timestamp() }} as snapshotted_at\n    from {{ source }}\n    {% if filter %}\n    where {{ filter }}\n    {% endif %}\n  {% endcall %}\n  {{ return(load_result('collect_freshness')) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.289301, "supported_languages": null}, "macro.dbt.collect_freshness_custom_sql": {"name": "collect_freshness_custom_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/freshness.sql", "original_file_path": "macros/adapters/freshness.sql", "unique_id": "macro.dbt.collect_freshness_custom_sql", "macro_sql": "{% macro collect_freshness_custom_sql(source, loaded_at_query) %}\n  {{ return(adapter.dispatch('collect_freshness_custom_sql', 'dbt')(source, loaded_at_query))}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__collect_freshness_custom_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2894201, "supported_languages": null}, "macro.dbt.default__collect_freshness_custom_sql": {"name": "default__collect_freshness_custom_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/freshness.sql", "original_file_path": "macros/adapters/freshness.sql", "unique_id": "macro.dbt.default__collect_freshness_custom_sql", "macro_sql": "{% macro default__collect_freshness_custom_sql(source, loaded_at_query) %}\n  {% call statement('collect_freshness_custom_sql', fetch_result=True, auto_begin=False) -%}\n  with source_query as (\n    {{ loaded_at_query }}\n  )\n  select\n    (select * from source_query) as max_loaded_at,\n    {{ current_timestamp() }} as snapshotted_at\n  {% endcall %}\n  {{ return(load_result('collect_freshness_custom_sql')) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.current_timestamp"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.289597, "supported_languages": null}, "macro.dbt.validate_sql": {"name": "validate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/validate_sql.sql", "original_file_path": "macros/adapters/validate_sql.sql", "unique_id": "macro.dbt.validate_sql", "macro_sql": "{% macro validate_sql(sql) -%}\n  {{ return(adapter.dispatch('validate_sql', 'dbt')(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__validate_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2897558, "supported_languages": null}, "macro.dbt.default__validate_sql": {"name": "default__validate_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/validate_sql.sql", "original_file_path": "macros/adapters/validate_sql.sql", "unique_id": "macro.dbt.default__validate_sql", "macro_sql": "{% macro default__validate_sql(sql) -%}\n  {% call statement('validate_sql') -%}\n    explain {{ sql }}\n  {% endcall %}\n  {{ return(load_result('validate_sql')) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.28988, "supported_languages": null}, "macro.dbt.copy_grants": {"name": "copy_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.copy_grants", "macro_sql": "{% macro copy_grants() %}\n    {{ return(adapter.dispatch('copy_grants', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_postgres.postgres__copy_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2905579, "supported_languages": null}, "macro.dbt.default__copy_grants": {"name": "default__copy_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__copy_grants", "macro_sql": "{% macro default__copy_grants() %}\n    {{ return(True) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2906291, "supported_languages": null}, "macro.dbt.support_multiple_grantees_per_dcl_statement": {"name": "support_multiple_grantees_per_dcl_statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.support_multiple_grantees_per_dcl_statement", "macro_sql": "{% macro support_multiple_grantees_per_dcl_statement() %}\n    {{ return(adapter.dispatch('support_multiple_grantees_per_dcl_statement', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__support_multiple_grantees_per_dcl_statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2907252, "supported_languages": null}, "macro.dbt.default__support_multiple_grantees_per_dcl_statement": {"name": "default__support_multiple_grantees_per_dcl_statement", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__support_multiple_grantees_per_dcl_statement", "macro_sql": "\n\n{%- macro default__support_multiple_grantees_per_dcl_statement() -%}\n    {{ return(True) }}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.290792, "supported_languages": null}, "macro.dbt.should_revoke": {"name": "should_revoke", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.should_revoke", "macro_sql": "{% macro should_revoke(existing_relation, full_refresh_mode=True) %}\n\n    {% if not existing_relation %}\n        {#-- The table doesn't already exist, so no grants to copy over --#}\n        {{ return(False) }}\n    {% elif full_refresh_mode %}\n        {#-- The object is being REPLACED -- whether grants are copied over depends on the value of user config --#}\n        {{ return(copy_grants()) }}\n    {% else %}\n        {#-- The table is being merged/upserted/inserted -- grants will be carried over --#}\n        {{ return(True) }}\n    {% endif %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.copy_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291028, "supported_languages": null}, "macro.dbt.get_show_grant_sql": {"name": "get_show_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_show_grant_sql", "macro_sql": "{% macro get_show_grant_sql(relation) %}\n    {{ return(adapter.dispatch(\"get_show_grant_sql\", \"dbt\")(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_show_grant_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291127, "supported_languages": null}, "macro.dbt.default__get_show_grant_sql": {"name": "default__get_show_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_show_grant_sql", "macro_sql": "{% macro default__get_show_grant_sql(relation) %}\n    show grants on {{ relation.render() }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291191, "supported_languages": null}, "macro.dbt.get_grant_sql": {"name": "get_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_grant_sql", "macro_sql": "{% macro get_grant_sql(relation, privilege, grantees) %}\n    {{ return(adapter.dispatch('get_grant_sql', 'dbt')(relation, privilege, grantees)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_grant_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291307, "supported_languages": null}, "macro.dbt.default__get_grant_sql": {"name": "default__get_grant_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_grant_sql", "macro_sql": "\n\n{%- macro default__get_grant_sql(relation, privilege, grantees) -%}\n    grant {{ privilege }} on {{ relation.render() }} to {{ grantees | join(', ') }}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.29142, "supported_languages": null}, "macro.dbt.get_revoke_sql": {"name": "get_revoke_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_revoke_sql", "macro_sql": "{% macro get_revoke_sql(relation, privilege, grantees) %}\n    {{ return(adapter.dispatch('get_revoke_sql', 'dbt')(relation, privilege, grantees)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_revoke_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291538, "supported_languages": null}, "macro.dbt.default__get_revoke_sql": {"name": "default__get_revoke_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_revoke_sql", "macro_sql": "\n\n{%- macro default__get_revoke_sql(relation, privilege, grantees) -%}\n    revoke {{ privilege }} on {{ relation.render() }} from {{ grantees | join(', ') }}\n{%- endmacro -%}\n\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291646, "supported_languages": null}, "macro.dbt.get_dcl_statement_list": {"name": "get_dcl_statement_list", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.get_dcl_statement_list", "macro_sql": "{% macro get_dcl_statement_list(relation, grant_config, get_dcl_macro) %}\n    {{ return(adapter.dispatch('get_dcl_statement_list', 'dbt')(relation, grant_config, get_dcl_macro)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_dcl_statement_list"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.291765, "supported_languages": null}, "macro.dbt.default__get_dcl_statement_list": {"name": "default__get_dcl_statement_list", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__get_dcl_statement_list", "macro_sql": "\n\n{%- macro default__get_dcl_statement_list(relation, grant_config, get_dcl_macro) -%}\n    {#\n      -- Unpack grant_config into specific privileges and the set of users who need them granted/revoked.\n      -- Depending on whether this database supports multiple grantees per statement, pass in the list of\n      -- all grantees per privilege, or (if not) template one statement per privilege-grantee pair.\n      -- `get_dcl_macro` will be either `get_grant_sql` or `get_revoke_sql`\n    #}\n    {%- set dcl_statements = [] -%}\n    {%- for privilege, grantees in grant_config.items() %}\n        {%- if support_multiple_grantees_per_dcl_statement() and grantees -%}\n          {%- set dcl = get_dcl_macro(relation, privilege, grantees) -%}\n          {%- do dcl_statements.append(dcl) -%}\n        {%- else -%}\n          {%- for grantee in grantees -%}\n              {% set dcl = get_dcl_macro(relation, privilege, [grantee]) %}\n              {%- do dcl_statements.append(dcl) -%}\n          {% endfor -%}\n        {%- endif -%}\n    {%- endfor -%}\n    {{ return(dcl_statements) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt.support_multiple_grantees_per_dcl_statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.292115, "supported_languages": null}, "macro.dbt.call_dcl_statements": {"name": "call_dcl_statements", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.call_dcl_statements", "macro_sql": "{% macro call_dcl_statements(dcl_statement_list) %}\n    {{ return(adapter.dispatch(\"call_dcl_statements\", \"dbt\")(dcl_statement_list)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__call_dcl_statements"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.292217, "supported_languages": null}, "macro.dbt.default__call_dcl_statements": {"name": "default__call_dcl_statements", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__call_dcl_statements", "macro_sql": "{% macro default__call_dcl_statements(dcl_statement_list) %}\n    {#\n      -- By default, supply all grant + revoke statements in a single semicolon-separated block,\n      -- so that they're all processed together.\n\n      -- Some databases do not support this. Those adapters will need to override this macro\n      -- to run each statement individually.\n    #}\n    {% call statement('grants') %}\n        {% for dcl_statement in dcl_statement_list %}\n            {{ dcl_statement }};\n        {% endfor %}\n    {% endcall %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.292347, "supported_languages": null}, "macro.dbt.apply_grants": {"name": "apply_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.apply_grants", "macro_sql": "{% macro apply_grants(relation, grant_config, should_revoke) %}\n    {{ return(adapter.dispatch(\"apply_grants\", \"dbt\")(relation, grant_config, should_revoke)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__apply_grants"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.292466, "supported_languages": null}, "macro.dbt.default__apply_grants": {"name": "default__apply_grants", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/apply_grants.sql", "original_file_path": "macros/adapters/apply_grants.sql", "unique_id": "macro.dbt.default__apply_grants", "macro_sql": "{% macro default__apply_grants(relation, grant_config, should_revoke=True) %}\n    {#-- If grant_config is {} or None, this is a no-op --#}\n    {% if grant_config %}\n        {% if should_revoke %}\n            {#-- We think previous grants may have carried over --#}\n            {#-- Show current grants and calculate diffs --#}\n            {% set current_grants_table = run_query(get_show_grant_sql(relation)) %}\n            {% set current_grants_dict = adapter.standardize_grants_dict(current_grants_table) %}\n            {% set needs_granting = diff_of_two_dicts(grant_config, current_grants_dict) %}\n            {% set needs_revoking = diff_of_two_dicts(current_grants_dict, grant_config) %}\n            {% if not (needs_granting or needs_revoking) %}\n                {{ log('On ' ~ relation.render() ~': All grants are in place, no revocation or granting needed.')}}\n            {% endif %}\n        {% else %}\n            {#-- We don't think there's any chance of previous grants having carried over. --#}\n            {#-- Jump straight to granting what the user has configured. --#}\n            {% set needs_revoking = {} %}\n            {% set needs_granting = grant_config %}\n        {% endif %}\n        {% if needs_granting or needs_revoking %}\n            {% set revoke_statement_list = get_dcl_statement_list(relation, needs_revoking, get_revoke_sql) %}\n            {% set grant_statement_list = get_dcl_statement_list(relation, needs_granting, get_grant_sql) %}\n            {% set dcl_statement_list = revoke_statement_list + grant_statement_list %}\n            {% if dcl_statement_list %}\n                {{ call_dcl_statements(dcl_statement_list) }}\n            {% endif %}\n        {% endif %}\n    {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query", "macro.dbt.get_show_grant_sql", "macro.dbt.get_dcl_statement_list", "macro.dbt.call_dcl_statements"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.29308, "supported_languages": null}, "macro.dbt.get_show_sql": {"name": "get_show_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/show.sql", "original_file_path": "macros/adapters/show.sql", "unique_id": "macro.dbt.get_show_sql", "macro_sql": "{% macro get_show_sql(compiled_code, sql_header, limit) -%}\n  {%- if sql_header is not none -%}\n  {{ sql_header }}\n  {%- endif %}\n  {{ get_limit_subquery_sql(compiled_code, limit) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_limit_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2933178, "supported_languages": null}, "macro.dbt.get_limit_subquery_sql": {"name": "get_limit_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/show.sql", "original_file_path": "macros/adapters/show.sql", "unique_id": "macro.dbt.get_limit_subquery_sql", "macro_sql": "\n{%- macro get_limit_subquery_sql(sql, limit) -%}\n  {{ adapter.dispatch('get_limit_sql', 'dbt')(sql, limit) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.default__get_limit_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.293422, "supported_languages": null}, "macro.dbt.default__get_limit_sql": {"name": "default__get_limit_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/show.sql", "original_file_path": "macros/adapters/show.sql", "unique_id": "macro.dbt.default__get_limit_sql", "macro_sql": "{% macro default__get_limit_sql(sql, limit) %}\n  {{ sql }}\n  {% if limit is not none %}\n  limit {{ limit }}\n  {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.293528, "supported_languages": null}, "macro.dbt.alter_column_comment": {"name": "alter_column_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.alter_column_comment", "macro_sql": "{% macro alter_column_comment(relation, column_dict) -%}\n  {{ return(adapter.dispatch('alter_column_comment', 'dbt')(relation, column_dict)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.293777, "supported_languages": null}, "macro.dbt.default__alter_column_comment": {"name": "default__alter_column_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.default__alter_column_comment", "macro_sql": "{% macro default__alter_column_comment(relation, column_dict) -%}\n  {{ exceptions.raise_not_implemented(\n    'alter_column_comment macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.293874, "supported_languages": null}, "macro.dbt.alter_relation_comment": {"name": "alter_relation_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.alter_relation_comment", "macro_sql": "{% macro alter_relation_comment(relation, relation_comment) -%}\n  {{ return(adapter.dispatch('alter_relation_comment', 'dbt')(relation, relation_comment)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__alter_relation_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.293987, "supported_languages": null}, "macro.dbt.default__alter_relation_comment": {"name": "default__alter_relation_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.default__alter_relation_comment", "macro_sql": "{% macro default__alter_relation_comment(relation, relation_comment) -%}\n  {{ exceptions.raise_not_implemented(\n    'alter_relation_comment macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2940822, "supported_languages": null}, "macro.dbt.persist_docs": {"name": "persist_docs", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.persist_docs", "macro_sql": "{% macro persist_docs(relation, model, for_relation=true, for_columns=true) -%}\n  {{ return(adapter.dispatch('persist_docs', 'dbt')(relation, model, for_relation, for_columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__persist_docs"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.294227, "supported_languages": null}, "macro.dbt.default__persist_docs": {"name": "default__persist_docs", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/persist_docs.sql", "original_file_path": "macros/adapters/persist_docs.sql", "unique_id": "macro.dbt.default__persist_docs", "macro_sql": "{% macro default__persist_docs(relation, model, for_relation, for_columns) -%}\n  {% if for_relation and config.persist_relation_docs() and model.description %}\n    {% do run_query(alter_relation_comment(relation, model.description)) %}\n  {% endif %}\n\n  {% if for_columns and config.persist_column_docs() and model.columns %}\n    {% do run_query(alter_column_comment(relation, model.columns)) %}\n  {% endif %}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query", "macro.dbt.alter_relation_comment", "macro.dbt.alter_column_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.294488, "supported_languages": null}, "macro.dbt.get_catalog_relations": {"name": "get_catalog_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_catalog_relations", "macro_sql": "{% macro get_catalog_relations(information_schema, relations) -%}\n  {{ return(adapter.dispatch('get_catalog_relations', 'dbt')(information_schema, relations)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_catalog_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2949739, "supported_languages": null}, "macro.dbt.default__get_catalog_relations": {"name": "default__get_catalog_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_catalog_relations", "macro_sql": "{% macro default__get_catalog_relations(information_schema, relations) -%}\n  {% set typename = adapter.type() %}\n  {% set msg -%}\n    get_catalog_relations not implemented for {{ typename }}\n  {%- endset %}\n\n  {{ exceptions.raise_compiler_error(msg) }}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.295118, "supported_languages": null}, "macro.dbt.get_catalog": {"name": "get_catalog", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_catalog", "macro_sql": "{% macro get_catalog(information_schema, schemas) -%}\n  {{ return(adapter.dispatch('get_catalog', 'dbt')(information_schema, schemas)) }}\n{%- endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_catalog"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.295236, "supported_languages": null}, "macro.dbt.default__get_catalog": {"name": "default__get_catalog", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_catalog", "macro_sql": "{% macro default__get_catalog(information_schema, schemas) -%}\n\n  {% set typename = adapter.type() %}\n  {% set msg -%}\n    get_catalog not implemented for {{ typename }}\n  {%- endset %}\n\n  {{ exceptions.raise_compiler_error(msg) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.295375, "supported_languages": null}, "macro.dbt.information_schema_name": {"name": "information_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.information_schema_name", "macro_sql": "{% macro information_schema_name(database) %}\n  {{ return(adapter.dispatch('information_schema_name', 'dbt')(database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__information_schema_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.295525, "supported_languages": null}, "macro.dbt.default__information_schema_name": {"name": "default__information_schema_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__information_schema_name", "macro_sql": "{% macro default__information_schema_name(database) -%}\n  {%- if database -%}\n    {{ database }}.INFORMATION_SCHEMA\n  {%- else -%}\n    INFORMATION_SCHEMA\n  {%- endif -%}\n{%- endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2956102, "supported_languages": null}, "macro.dbt.list_schemas": {"name": "list_schemas", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.list_schemas", "macro_sql": "{% macro list_schemas(database) -%}\n  {{ return(adapter.dispatch('list_schemas', 'dbt')(database)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__list_schemas"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2957041, "supported_languages": null}, "macro.dbt.default__list_schemas": {"name": "default__list_schemas", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__list_schemas", "macro_sql": "{% macro default__list_schemas(database) -%}\n  {% set sql %}\n    select distinct schema_name\n    from {{ information_schema_name(database) }}.SCHEMATA\n    where catalog_name ilike '{{ database }}'\n  {% endset %}\n  {{ return(run_query(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.information_schema_name", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.29583, "supported_languages": null}, "macro.dbt.check_schema_exists": {"name": "check_schema_exists", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.check_schema_exists", "macro_sql": "{% macro check_schema_exists(information_schema, schema) -%}\n  {{ return(adapter.dispatch('check_schema_exists', 'dbt')(information_schema, schema)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__check_schema_exists"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.295937, "supported_languages": null}, "macro.dbt.default__check_schema_exists": {"name": "default__check_schema_exists", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__check_schema_exists", "macro_sql": "{% macro default__check_schema_exists(information_schema, schema) -%}\n  {% set sql -%}\n        select count(*)\n        from {{ information_schema.replace(information_schema_view='SCHEMATA') }}\n        where catalog_name='{{ information_schema.database }}'\n          and schema_name='{{ schema }}'\n  {%- endset %}\n  {{ return(run_query(sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.replace", "macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296101, "supported_languages": null}, "macro.dbt.list_relations_without_caching": {"name": "list_relations_without_caching", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.list_relations_without_caching", "macro_sql": "{% macro list_relations_without_caching(schema_relation) %}\n  {{ return(adapter.dispatch('list_relations_without_caching', 'dbt')(schema_relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__list_relations_without_caching"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296195, "supported_languages": null}, "macro.dbt.default__list_relations_without_caching": {"name": "default__list_relations_without_caching", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__list_relations_without_caching", "macro_sql": "{% macro default__list_relations_without_caching(schema_relation) %}\n  {{ exceptions.raise_not_implemented(\n    'list_relations_without_caching macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296279, "supported_languages": null}, "macro.dbt.get_catalog_for_single_relation": {"name": "get_catalog_for_single_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_catalog_for_single_relation", "macro_sql": "{% macro get_catalog_for_single_relation(relation) %}\n  {{ return(adapter.dispatch('get_catalog_for_single_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_catalog_for_single_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296373, "supported_languages": null}, "macro.dbt.default__get_catalog_for_single_relation": {"name": "default__get_catalog_for_single_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_catalog_for_single_relation", "macro_sql": "{% macro default__get_catalog_for_single_relation(relation) %}\n  {{ exceptions.raise_not_implemented(\n    'get_catalog_for_single_relation macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296457, "supported_languages": null}, "macro.dbt.get_relations": {"name": "get_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_relations", "macro_sql": "{% macro get_relations() %}\n  {{ return(adapter.dispatch('get_relations', 'dbt')()) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_relations"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296545, "supported_languages": null}, "macro.dbt.default__get_relations": {"name": "default__get_relations", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_relations", "macro_sql": "{% macro default__get_relations() %}\n  {{ exceptions.raise_not_implemented(\n    'get_relations macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296628, "supported_languages": null}, "macro.dbt.get_relation_last_modified": {"name": "get_relation_last_modified", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.get_relation_last_modified", "macro_sql": "{% macro get_relation_last_modified(information_schema, relations) %}\n  {{ return(adapter.dispatch('get_relation_last_modified', 'dbt')(information_schema, relations)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_relation_last_modified"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296732, "supported_languages": null}, "macro.dbt.default__get_relation_last_modified": {"name": "default__get_relation_last_modified", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/metadata.sql", "original_file_path": "macros/adapters/metadata.sql", "unique_id": "macro.dbt.default__get_relation_last_modified", "macro_sql": "{% macro default__get_relation_last_modified(information_schema, relations) %}\n  {{ exceptions.raise_not_implemented(\n    'get_relation_last_modified macro not implemented for adapter ' + adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.296823, "supported_languages": null}, "macro.dbt.get_columns_in_relation": {"name": "get_columns_in_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_columns_in_relation", "macro_sql": "{% macro get_columns_in_relation(relation) -%}\n  {{ return(adapter.dispatch('get_columns_in_relation', 'dbt')(relation)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__get_columns_in_relation"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.297441, "supported_languages": null}, "macro.dbt.default__get_columns_in_relation": {"name": "default__get_columns_in_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_columns_in_relation", "macro_sql": "{% macro default__get_columns_in_relation(relation) -%}\n  {{ exceptions.raise_not_implemented(\n    'get_columns_in_relation macro not implemented for adapter '+adapter.type()) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2975318, "supported_languages": null}, "macro.dbt.sql_convert_columns_in_relation": {"name": "sql_convert_columns_in_relation", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.sql_convert_columns_in_relation", "macro_sql": "{% macro sql_convert_columns_in_relation(table) -%}\n  {% set columns = [] %}\n  {% for row in table %}\n    {% do columns.append(api.Column(*row)) %}\n  {% endfor %}\n  {{ return(columns) }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.297705, "supported_languages": null}, "macro.dbt.get_empty_subquery_sql": {"name": "get_empty_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_empty_subquery_sql", "macro_sql": "{% macro get_empty_subquery_sql(select_sql, select_sql_header=none) -%}\n  {{ return(adapter.dispatch('get_empty_subquery_sql', 'dbt')(select_sql, select_sql_header)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_empty_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.297825, "supported_languages": null}, "macro.dbt.default__get_empty_subquery_sql": {"name": "default__get_empty_subquery_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_empty_subquery_sql", "macro_sql": "{% macro default__get_empty_subquery_sql(select_sql, select_sql_header=none) %}\n    {%- if select_sql_header is not none -%}\n    {{ select_sql_header }}\n    {%- endif -%}\n    select * from (\n        {{ select_sql }}\n    ) as __dbt_sbq\n    where false\n    limit 0\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.297945, "supported_languages": null}, "macro.dbt.get_empty_schema_sql": {"name": "get_empty_schema_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_empty_schema_sql", "macro_sql": "{% macro get_empty_schema_sql(columns) -%}\n  {{ return(adapter.dispatch('get_empty_schema_sql', 'dbt')(columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_empty_schema_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2980459, "supported_languages": null}, "macro.dbt.default__get_empty_schema_sql": {"name": "default__get_empty_schema_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_empty_schema_sql", "macro_sql": "{% macro default__get_empty_schema_sql(columns) %}\n    {%- set col_err = [] -%}\n    {%- set col_naked_numeric = [] -%}\n    select\n    {% for i in columns %}\n      {%- set col = columns[i] -%}\n      {%- if col['data_type'] is not defined -%}\n        {%- do col_err.append(col['name']) -%}\n      {#-- If this column's type is just 'numeric' then it is missing precision/scale, raise a warning --#}\n      {%- elif col['data_type'].strip().lower() in ('numeric', 'decimal', 'number') -%}\n        {%- do col_naked_numeric.append(col['name']) -%}\n      {%- endif -%}\n      {% set col_name = adapter.quote(col['name']) if col.get('quote') else col['name'] %}\n      {{ cast('null', col['data_type']) }} as {{ col_name }}{{ \", \" if not loop.last }}\n    {%- endfor -%}\n    {%- if (col_err | length) > 0 -%}\n      {{ exceptions.column_type_missing(column_names=col_err) }}\n    {%- elif (col_naked_numeric | length) > 0 -%}\n      {{ exceptions.warn(\"Detected columns with numeric type and unspecified precision/scale, this can lead to unintended rounding: \" ~ col_naked_numeric ~ \"`\") }}\n    {%- endif -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.cast"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.298676, "supported_languages": null}, "macro.dbt.get_column_schema_from_query": {"name": "get_column_schema_from_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_column_schema_from_query", "macro_sql": "{% macro get_column_schema_from_query(select_sql, select_sql_header=none) -%}\n    {% set columns = [] %}\n    {# -- Using an 'empty subquery' here to get the same schema as the given select_sql statement, without necessitating a data scan.#}\n    {% set sql = get_empty_subquery_sql(select_sql, select_sql_header) %}\n    {% set column_schema = adapter.get_column_schema_from_query(sql) %}\n    {{ return(column_schema) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.get_empty_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.29887, "supported_languages": null}, "macro.dbt.get_columns_in_query": {"name": "get_columns_in_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.get_columns_in_query", "macro_sql": "{% macro get_columns_in_query(select_sql) -%}\n  {{ return(adapter.dispatch('get_columns_in_query', 'dbt')(select_sql)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__get_columns_in_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.298975, "supported_languages": null}, "macro.dbt.default__get_columns_in_query": {"name": "default__get_columns_in_query", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__get_columns_in_query", "macro_sql": "{% macro default__get_columns_in_query(select_sql) %}\n    {% call statement('get_columns_in_query', fetch_result=True, auto_begin=False) -%}\n        {{ get_empty_subquery_sql(select_sql) }}\n    {% endcall %}\n    {{ return(load_result('get_columns_in_query').table.columns | map(attribute='name') | list) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement", "macro.dbt.get_empty_subquery_sql"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2991638, "supported_languages": null}, "macro.dbt.alter_column_type": {"name": "alter_column_type", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.alter_column_type", "macro_sql": "{% macro alter_column_type(relation, column_name, new_column_type) -%}\n  {{ return(adapter.dispatch('alter_column_type', 'dbt')(relation, column_name, new_column_type)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__alter_column_type"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.299291, "supported_languages": null}, "macro.dbt.default__alter_column_type": {"name": "default__alter_column_type", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__alter_column_type", "macro_sql": "{% macro default__alter_column_type(relation, column_name, new_column_type) -%}\n  {#\n    1. Create a new column (w/ temp name and correct type)\n    2. Copy data over to it\n    3. Drop the existing column (cascade!)\n    4. Rename the new column to existing column\n  #}\n  {%- set tmp_column = column_name + \"__dbt_alter\" -%}\n\n  {% call statement('alter_column_type') %}\n    alter table {{ relation.render() }} add column {{ adapter.quote(tmp_column) }} {{ new_column_type }};\n    update {{ relation.render() }} set {{ adapter.quote(tmp_column) }} = {{ adapter.quote(column_name) }};\n    alter table {{ relation.render() }} drop column {{ adapter.quote(column_name) }} cascade;\n    alter table {{ relation.render() }} rename column {{ adapter.quote(tmp_column) }} to {{ adapter.quote(column_name) }}\n  {% endcall %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.statement"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.2998211, "supported_languages": null}, "macro.dbt.alter_relation_add_remove_columns": {"name": "alter_relation_add_remove_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.alter_relation_add_remove_columns", "macro_sql": "{% macro alter_relation_add_remove_columns(relation, add_columns = none, remove_columns = none) -%}\n  {{ return(adapter.dispatch('alter_relation_add_remove_columns', 'dbt')(relation, add_columns, remove_columns)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt_redshift.redshift__alter_relation_add_remove_columns"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.299955, "supported_languages": null}, "macro.dbt.default__alter_relation_add_remove_columns": {"name": "default__alter_relation_add_remove_columns", "resource_type": "macro", "package_name": "dbt", "path": "macros/adapters/columns.sql", "original_file_path": "macros/adapters/columns.sql", "unique_id": "macro.dbt.default__alter_relation_add_remove_columns", "macro_sql": "{% macro default__alter_relation_add_remove_columns(relation, add_columns, remove_columns) %}\n\n  {% if add_columns is none %}\n    {% set add_columns = [] %}\n  {% endif %}\n  {% if remove_columns is none %}\n    {% set remove_columns = [] %}\n  {% endif %}\n\n  {% set sql -%}\n\n     alter {{ relation.type }} {{ relation.render() }}\n\n            {% for column in add_columns %}\n               add column {{ column.name }} {{ column.data_type }}{{ ',' if not loop.last }}\n            {% endfor %}{{ ',' if add_columns and remove_columns }}\n\n            {% for column in remove_columns %}\n                drop column {{ column.name }}{{ ',' if not loop.last }}\n            {% endfor %}\n\n  {%- endset -%}\n\n  {% do run_query(sql) %}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.run_query"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.300352, "supported_languages": null}, "macro.dbt.get_fixture_sql": {"name": "get_fixture_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/unit_test_sql/get_fixture_sql.sql", "original_file_path": "macros/unit_test_sql/get_fixture_sql.sql", "unique_id": "macro.dbt.get_fixture_sql", "macro_sql": "{% macro get_fixture_sql(rows, column_name_to_data_types) %}\n-- Fixture for {{ model.name }}\n{% set default_row = {} %}\n\n{%- if not column_name_to_data_types -%}\n{#-- Use defer_relation IFF it is available in the manifest and 'this' is missing from the database --#}\n{%-   set this_or_defer_relation = defer_relation if (defer_relation and not load_relation(this)) else this -%}\n{%-   set columns_in_relation = adapter.get_columns_in_relation(this_or_defer_relation) -%}\n\n{%-   set column_name_to_data_types = {} -%}\n{%-   for column in columns_in_relation -%}\n{#-- This needs to be a case-insensitive comparison --#}\n{%-     do column_name_to_data_types.update({column.name|lower: column.data_type}) -%}\n{%-   endfor -%}\n{%- endif -%}\n\n{%- if not column_name_to_data_types -%}\n    {{ exceptions.raise_compiler_error(\"Not able to get columns for unit test '\" ~ model.name ~ \"' from relation \" ~ this ~ \" because the relation doesn't exist\") }}\n{%- endif -%}\n\n{%- for column_name, column_type in column_name_to_data_types.items() -%}\n    {%- do default_row.update({column_name: (safe_cast(\"null\", column_type) | trim )}) -%}\n{%- endfor -%}\n\n{{ validate_fixture_rows(rows, row_number) }}\n\n{%- for row in rows -%}\n{%-   set formatted_row = format_row(row, column_name_to_data_types) -%}\n{%-   set default_row_copy = default_row.copy() -%}\n{%-   do default_row_copy.update(formatted_row) -%}\nselect\n{%-   for column_name, column_value in default_row_copy.items() %} {{ column_value }} as {{ column_name }}{% if not loop.last -%}, {%- endif %}\n{%-   endfor %}\n{%-   if not loop.last %}\nunion all\n{%    endif %}\n{%- endfor -%}\n\n{%- if (rows | length) == 0 -%}\n    select\n    {%- for column_name, column_value in default_row.items() %} {{ column_value }} as {{ column_name }}{% if not loop.last -%},{%- endif %}\n    {%- endfor %}\n    limit 0\n{%- endif -%}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.load_relation", "macro.dbt.safe_cast", "macro.dbt.validate_fixture_rows", "macro.dbt.format_row"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.301635, "supported_languages": null}, "macro.dbt.get_expected_sql": {"name": "get_expected_sql", "resource_type": "macro", "package_name": "dbt", "path": "macros/unit_test_sql/get_fixture_sql.sql", "original_file_path": "macros/unit_test_sql/get_fixture_sql.sql", "unique_id": "macro.dbt.get_expected_sql", "macro_sql": "{% macro get_expected_sql(rows, column_name_to_data_types) %}\n\n{%- if (rows | length) == 0 -%}\n    select * from dbt_internal_unit_test_actual\n    limit 0\n{%- else -%}\n{%- for row in rows -%}\n{%- set formatted_row = format_row(row, column_name_to_data_types) -%}\nselect\n{%- for column_name, column_value in formatted_row.items() %} {{ column_value }} as {{ column_name }}{% if not loop.last -%}, {%- endif %}\n{%- endfor %}\n{%- if not loop.last %}\nunion all\n{% endif %}\n{%- endfor -%}\n{%- endif -%}\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.format_row"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.301944, "supported_languages": null}, "macro.dbt.format_row": {"name": "format_row", "resource_type": "macro", "package_name": "dbt", "path": "macros/unit_test_sql/get_fixture_sql.sql", "original_file_path": "macros/unit_test_sql/get_fixture_sql.sql", "unique_id": "macro.dbt.format_row", "macro_sql": "\n\n{%- macro format_row(row, column_name_to_data_types) -%}\n    {#-- generate case-insensitive formatted row --#}\n    {% set formatted_row = {} %}\n    {%- for column_name, column_value in row.items() -%}\n        {% set column_name = column_name|lower %}\n\n        {%- if column_name not in column_name_to_data_types %}\n            {#-- if user-provided row contains column name that relation does not contain, raise an error --#}\n            {% set fixture_name = \"expected output\" if model.resource_type == 'unit_test' else (\"'\" ~ model.name ~ \"'\") %}\n            {{ exceptions.raise_compiler_error(\n                \"Invalid column name: '\" ~ column_name ~ \"' in unit test fixture for \" ~ fixture_name ~ \".\"\n                \"\\nAccepted columns for \" ~ fixture_name ~ \" are: \" ~ (column_name_to_data_types.keys()|list)\n            ) }}\n        {%- endif -%}\n\n        {%- set column_type = column_name_to_data_types[column_name] %}\n\n        {#-- sanitize column_value: wrap yaml strings in quotes, apply cast --#}\n        {%- set column_value_clean = column_value -%}\n        {%- if column_value is string -%}\n            {%- set column_value_clean = dbt.string_literal(dbt.escape_single_quotes(column_value)) -%}\n        {%- elif column_value is none -%}\n            {%- set column_value_clean = 'null' -%}\n        {%- endif -%}\n\n        {%- set row_update = {column_name: safe_cast(column_value_clean, column_type) } -%}\n        {%- do formatted_row.update(row_update) -%}\n    {%- endfor -%}\n    {{ return(formatted_row) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt.string_literal", "macro.dbt.escape_single_quotes", "macro.dbt.safe_cast"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.30252, "supported_languages": null}, "macro.dbt.validate_fixture_rows": {"name": "validate_fixture_rows", "resource_type": "macro", "package_name": "dbt", "path": "macros/unit_test_sql/get_fixture_sql.sql", "original_file_path": "macros/unit_test_sql/get_fixture_sql.sql", "unique_id": "macro.dbt.validate_fixture_rows", "macro_sql": "{%- macro validate_fixture_rows(rows, row_number) -%}\n  {{ return(adapter.dispatch('validate_fixture_rows', 'dbt')(rows, row_number)) }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": ["macro.dbt_redshift.redshift__validate_fixture_rows"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.302637, "supported_languages": null}, "macro.dbt.default__validate_fixture_rows": {"name": "default__validate_fixture_rows", "resource_type": "macro", "package_name": "dbt", "path": "macros/unit_test_sql/get_fixture_sql.sql", "original_file_path": "macros/unit_test_sql/get_fixture_sql.sql", "unique_id": "macro.dbt.default__validate_fixture_rows", "macro_sql": "{%- macro default__validate_fixture_rows(rows, row_number) -%}\n  {# This is an abstract method for adapter overrides as needed #}\n{%- endmacro -%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.30269, "supported_languages": null}, "macro.dbt.resolve_model_name": {"name": "resolve_model_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.resolve_model_name", "macro_sql": "{% macro resolve_model_name(input_model_name) %}\n    {{ return(adapter.dispatch('resolve_model_name', 'dbt')(input_model_name)) }}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.default__resolve_model_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.3030982, "supported_languages": null}, "macro.dbt.default__resolve_model_name": {"name": "default__resolve_model_name", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.default__resolve_model_name", "macro_sql": "\n\n{%- macro default__resolve_model_name(input_model_name) -%}\n    {{  input_model_name | string | replace('\"', '\\\"') }}\n{%- endmacro -%}\n\n", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.30318, "supported_languages": null}, "macro.dbt.build_ref_function": {"name": "build_ref_function", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.build_ref_function", "macro_sql": "{% macro build_ref_function(model) %}\n\n    {%- set ref_dict = {} -%}\n    {%- for _ref in model.refs -%}\n        {% set _ref_args = [_ref.get('package'), _ref['name']] if _ref.get('package') else [_ref['name'],] %}\n        {%- set resolved = ref(*_ref_args, v=_ref.get('version')) -%}\n\n        {#\n            We want to get the string of the returned relation by calling .render() in order to skip sample/empty\n            mode rendering logic. However, people override the default ref macro, and often return a string instead\n            of a relation (like the ref macro does by default). Thus, to make sure we dont blow things up, we have\n            to ensure the resolved relation has a .render() method.\n        #}\n        {%- if resolved.render is defined and resolved.render is callable -%}\n            {%- set resolved = resolved.render() -%}\n        {%- endif -%}\n\n        {%- if _ref.get('version') -%}\n            {% do _ref_args.extend([\"v\" ~ _ref['version']]) %}\n        {%- endif -%}\n       {%- do ref_dict.update({_ref_args | join('.'): resolve_model_name(resolved)}) -%}\n    {%- endfor -%}\n\ndef ref(*args, **kwargs):\n    refs = {{ ref_dict | tojson }}\n    key = '.'.join(args)\n    version = kwargs.get(\"v\") or kwargs.get(\"version\")\n    if version:\n        key += f\".v{version}\"\n    dbt_load_df_function = kwargs.get(\"dbt_load_df_function\")\n    return dbt_load_df_function(refs[key])\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.resolve_model_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.303679, "supported_languages": null}, "macro.dbt.build_source_function": {"name": "build_source_function", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.build_source_function", "macro_sql": "{% macro build_source_function(model) %}\n\n    {%- set source_dict = {} -%}\n    {%- for _source in model.sources -%}\n        {%- set resolved = source(*_source) -%}\n        {%- do source_dict.update({_source | join('.'): resolve_model_name(resolved)}) -%}\n    {%- endfor -%}\n\ndef source(*args, dbt_load_df_function):\n    sources = {{ source_dict | tojson }}\n    key = '.'.join(args)\n    return dbt_load_df_function(sources[key])\n\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.resolve_model_name"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.303894, "supported_languages": null}, "macro.dbt.build_config_dict": {"name": "build_config_dict", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.build_config_dict", "macro_sql": "{% macro build_config_dict(model) %}\n    {%- set config_dict = {} -%}\n    {% set config_dbt_used = zip(model.config.config_keys_used, model.config.config_keys_defaults) | list %}\n    {%- for key, default in config_dbt_used -%}\n        {# weird type testing with enum, would be much easier to write this logic in Python! #}\n        {%- if key == \"language\" -%}\n          {%- set value = \"python\" -%}\n        {%- endif -%}\n        {%- set value = model.config.get(key, default) -%}\n        {%- do config_dict.update({key: value}) -%}\n    {%- endfor -%}\nconfig_dict = {{ config_dict }}\n{% endmacro %}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.304192, "supported_languages": null}, "macro.dbt.py_script_postfix": {"name": "py_script_postfix", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.py_script_postfix", "macro_sql": "{% macro py_script_postfix(model) %}\n# This part is user provided model code\n# you will need to copy the next section to run the code\n# COMMAND ----------\n# this part is dbt logic for get ref work, do not modify\n\n{{ build_ref_function(model ) }}\n{{ build_source_function(model ) }}\n{{ build_config_dict(model) }}\n\nclass config:\n    def __init__(self, *args, **kwargs):\n        pass\n\n    @staticmethod\n    def get(key, default=None):\n        return config_dict.get(key, default)\n\nclass this:\n    \"\"\"dbt.this() or dbt.this.identifier\"\"\"\n    database = \"{{ this.database }}\"\n    schema = \"{{ this.schema }}\"\n    identifier = \"{{ this.identifier }}\"\n    {% set this_relation_name = resolve_model_name(this) %}\n    def __repr__(self):\n        return '{{ this_relation_name  }}'\n\n\nclass dbtObj:\n    def __init__(self, load_df_function) -> None:\n        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)\n        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)\n        self.config = config\n        self.this = this()\n        self.is_incremental = {{ is_incremental() }}\n\n# COMMAND ----------\n{{py_script_comment()}}\n{% endmacro %}", "depends_on": {"macros": ["macro.dbt.build_ref_function", "macro.dbt.build_source_function", "macro.dbt.build_config_dict", "macro.dbt.resolve_model_name", "macro.dbt.is_incremental", "macro.dbt.py_script_comment"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.3044422, "supported_languages": null}, "macro.dbt.py_script_comment": {"name": "py_script_comment", "resource_type": "macro", "package_name": "dbt", "path": "macros/python_model/python.sql", "original_file_path": "macros/python_model/python.sql", "unique_id": "macro.dbt.py_script_comment", "macro_sql": "{%macro py_script_comment()%}\n{%endmacro%}", "depends_on": {"macros": []}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.304487, "supported_languages": null}, "macro.dbt.test_unique": {"name": "test_unique", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_unique", "macro_sql": "{% test unique(model, column_name) %}\n    {% set macro = adapter.dispatch('test_unique', 'dbt') %}\n    {{ macro(model, column_name) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_unique"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.304734, "supported_languages": null}, "macro.dbt.test_not_null": {"name": "test_not_null", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_not_null", "macro_sql": "{% test not_null(model, column_name) %}\n    {% set macro = adapter.dispatch('test_not_null', 'dbt') %}\n    {{ macro(model, column_name) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_not_null"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.304866, "supported_languages": null}, "macro.dbt.test_accepted_values": {"name": "test_accepted_values", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_accepted_values", "macro_sql": "{% test accepted_values(model, column_name, values, quote=True) %}\n    {% set macro = adapter.dispatch('test_accepted_values', 'dbt') %}\n    {{ macro(model, column_name, values, quote) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_accepted_values"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.3050308, "supported_languages": null}, "macro.dbt.test_relationships": {"name": "test_relationships", "resource_type": "macro", "package_name": "dbt", "path": "tests/generic/builtin.sql", "original_file_path": "tests/generic/builtin.sql", "unique_id": "macro.dbt.test_relationships", "macro_sql": "{% test relationships(model, column_name, to, field) %}\n    {% set macro = adapter.dispatch('test_relationships', 'dbt') %}\n    {{ macro(model, column_name, to, field) }}\n{% endtest %}", "depends_on": {"macros": ["macro.dbt.default__test_relationships"]}, "description": "", "meta": {}, "docs": {"show": true, "node_color": null}, "patch_path": null, "arguments": [], "created_at": 1745942717.305186, "supported_languages": null}}, "docs": {"doc.dbt.__overview__": {"name": "__overview__", "resource_type": "doc", "package_name": "dbt", "path": "overview.md", "original_file_path": "docs/overview.md", "unique_id": "doc.dbt.__overview__", "block_contents": "### Welcome!\n\nWelcome to the auto-generated documentation for your dbt project!\n\n### Navigation\n\nYou can use the `Project` and `Database` navigation tabs on the left side of the window to explore the models\nin your project.\n\n#### Project Tab\nThe `Project` tab mirrors the directory structure of your dbt project. In this tab, you can see all of the\nmodels defined in your dbt project, as well as models imported from dbt packages.\n\n#### Database Tab\nThe `Database` tab also exposes your models, but in a format that looks more like a database explorer. This view\nshows relations (tables and views) grouped into database schemas. Note that ephemeral models are _not_ shown\nin this interface, as they do not exist in the database.\n\n### Graph Exploration\nYou can click the blue icon on the bottom-right corner of the page to view the lineage graph of your models.\n\nOn model pages, you'll see the immediate parents and children of the model you're exploring. By clicking the `Expand`\nbutton at the top-right of this lineage pane, you'll be able to see all of the models that are used to build,\nor are built from, the model you're exploring.\n\nOnce expanded, you'll be able to use the `--select` and `--exclude` model selection syntax to filter the\nmodels in the graph. For more information on model selection, check out the [dbt docs](https://docs.getdbt.com/docs/model-selection-syntax).\n\nNote that you can also right-click on models to interactively filter and explore the graph.\n\n---\n\n### More information\n\n- [What is dbt](https://docs.getdbt.com/docs/introduction)?\n- Read the [dbt viewpoint](https://docs.getdbt.com/docs/viewpoint)\n- [Installation](https://docs.getdbt.com/docs/installation)\n- Join the [dbt Community](https://www.getdbt.com/community/) for questions and discussion"}}, "exposures": {}, "metrics": {}, "groups": {}, "selectors": {}, "disabled": {}, "parent_map": {"model.credit_risk_playground.my_first_dbt_model": [], "model.credit_risk_playground.my_second_dbt_model": ["model.credit_risk_playground.my_first_dbt_model"], "test.credit_risk_playground.unique_my_first_dbt_model_id.16e066b321": ["model.credit_risk_playground.my_first_dbt_model"], "test.credit_risk_playground.not_null_my_first_dbt_model_id.5fb22c2710": ["model.credit_risk_playground.my_first_dbt_model"], "test.credit_risk_playground.unique_my_second_dbt_model_id.57a0f8c493": ["model.credit_risk_playground.my_second_dbt_model"], "test.credit_risk_playground.not_null_my_second_dbt_model_id.151b76d778": ["model.credit_risk_playground.my_second_dbt_model"], "model.credit_risk_playground.bp_overdue_amt_aud_m_v2": [], "model.credit_risk_playground.bp_arrears_reg_aud_v2": ["model.credit_risk_playground.bp_overdue_amt_aud_m_v2"], "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2"], "model.credit_risk_playground.bp_overdraft_split_m_v2": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "source.credit_risk_playground.dbt.bp_overdraft_users"], "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2": [], "model.credit_risk_playground.bp_default_dunning_m_v2": [], "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2": ["source.credit_risk_playground.public.nd_participant", "source.credit_risk_playground.public.neodymium_insolvency"], "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2": [], "model.credit_risk_playground.bp_loan_contract_information_m_v2": [], "model.credit_risk_playground.bp_hrc_m_v2": [], "model.credit_risk_playground.bp_social_benefits_v2_m_v2": [], "model.credit_risk_playground.bp_application_pd_supermodel_m_v2": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2"], "model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2"], "model.credit_risk_playground.bp_credit_bureau_rating_m_v2": ["source.credit_risk_playground.dbt.zrh_users"], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2": ["source.credit_risk_playground.public.dwh_cohort_dates"], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_rmd_v2": [], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_me_v2": [], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_max_date_v2": [], "model.credit_risk_playground.bp_p_accounts_v2": ["source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.etl_reporting.pa_paccount"], "model.credit_risk_playground.bp_monitoring_pd_supermodel_v3_m_v2": [], "analysis.credit_risk_playground.Social_benefits": [], "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2": ["model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "model.credit_risk_playground.bp_default_dunning_m_v2", "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "model.credit_risk_playground.bp_loan_contract_information_m_v2", "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2", "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.public.mmbr_repayment", "source.credit_risk_playground.public.mmbr_savings_account"], "model.credit_risk_playground.bp_retail_provisions_m": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2"], "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2": ["source.credit_risk_playground.dbt.mmbr_user_match", "source.credit_risk_playground.public.mmbr_gl_account", "source.credit_risk_playground.public.mmbr_gl_journal_entry", "source.credit_risk_playground.public.mmbr_loan_account", "source.credit_risk_playground.public.mmbr_savings_account"], "model.credit_risk_playground.bp_garnishment_m_v2": [], "model.credit_risk_playground.bp_overdraft_limit_periods_v2": ["source.credit_risk_playground.dbt.mmbr_user_match", "source.credit_risk_playground.etl_reporting.cmd_users", "source.credit_risk_playground.public.ddb_overdraft_settings_aud", "source.credit_risk_playground.public.mmbr_savings_account", "source.credit_risk_playground.public.pu_overdraft_history"], "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2": ["model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "model.credit_risk_playground.bp_default_dunning_m_v2", "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "model.credit_risk_playground.bp_forbearance_m_v2_v2", "model.credit_risk_playground.bp_garnishment_m_v2", "model.credit_risk_playground.bp_hrc_m_v2", "model.credit_risk_playground.bp_loan_contract_information_m_v2", "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_p_accounts_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_social_benefits_v2_m_v2", "source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.public.mmbr_repayment", "source.credit_risk_playground.public.mmbr_savings_account"], "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test": ["model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2", "model.credit_risk_playground.bp_default_dunning_m_v2", "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2", "model.credit_risk_playground.bp_forbearance_m_v2_v2", "model.credit_risk_playground.bp_garnishment_m_v2", "model.credit_risk_playground.bp_hrc_m_v2", "model.credit_risk_playground.bp_loan_contract_information_m_v2", "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2", "model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_p_accounts_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_social_benefits_v2_m_v2", "source.credit_risk_playground.dbt.zrh_users", "source.credit_risk_playground.public.mmbr_repayment", "source.credit_risk_playground.public.mmbr_savings_account"], "model.credit_risk_playground.bp_forbearance_m_v2_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2"], "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs": [], "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs_v2": [], "source.credit_risk_playground.credit_risk_playground.bp_retail_provisions_stg_v5_pre": [], "source.credit_risk_playground.private.ca_credit_report_aud": [], "source.credit_risk_playground.private.ca_credit_score_record_request_aud": [], "source.credit_risk_playground.private.ca_credit_score_record_request_merkmal_aud": [], "source.credit_risk_playground.private.californium_customer_attribute": [], "source.credit_risk_playground.private.einsteinium_repayment_capacity_audit_log": [], "source.credit_risk_playground.private.es_requested_repayment_capacity": [], "source.credit_risk_playground.private.einsteinium_internal_credit_score_audit_log": [], "source.credit_risk_playground.private.es_requested_credit_score": [], "source.credit_risk_playground.private.es_internal_credit_score": [], "source.credit_risk_playground.private.einsteinium_n26_credit_score_audit_log": [], "source.credit_risk_playground.private.einsteinium_credit_score_audit_log": [], "source.credit_risk_playground.private.miracle_days_past_due": [], "source.credit_risk_playground.private.miracle_unlikeliness_to_pay": [], "source.credit_risk_playground.dbt.bp_overdraft_users": [], "source.credit_risk_playground.dbt.bank_products_users": [], "source.credit_risk_playground.dbt.stg_user_detail": [], "source.credit_risk_playground.dbt.zrh_users": [], "source.credit_risk_playground.dbt.zrh_txn_day": [], "source.credit_risk_playground.dbt.mmb_weekly_balance_aud": [], "source.credit_risk_playground.dbt.write_off": [], "source.credit_risk_playground.dbt.ucm_overdraft": [], "source.credit_risk_playground.dbt.mmbr_user_match": [], "source.credit_risk_playground.dbt.mmbr_repayment_aud": [], "source.credit_risk_playground.dbt.mmbr_loan_account_aud": [], "source.credit_risk_playground.dbt.card_transactions_pt": [], "source.credit_risk_playground.dbt.zr_transaction_user": [], "source.credit_risk_playground.dbt.device_tokens": [], "source.credit_risk_playground.dbt.login_attempts": [], "source.credit_risk_playground.dbt.bp_overdue_amounts_loans": [], "source.credit_risk_playground.public.dwh_cohort_months": [], "source.credit_risk_playground.public.cmd_users": [], "source.credit_risk_playground.public.cmd_n26_tnc_address": [], "source.credit_risk_playground.public.dwh_sneaky_transaction": [], "source.credit_risk_playground.public.mmbr_loan_transaction": [], "source.credit_risk_playground.public.mmbr_loan_account": [], "source.credit_risk_playground.public.mmb_loan_account_semi_aud": [], "source.credit_risk_playground.public.mcv_infocard_template": [], "source.credit_risk_playground.public.mmbr_n26_repayment_aud": [], "source.credit_risk_playground.public.mmbr_repayment": [], "source.credit_risk_playground.public.dwh_portfolio_status_aud": [], "source.credit_risk_playground.public.la_action_log": [], "source.credit_risk_playground.public.neodymium_insolvency": [], "source.credit_risk_playground.public.nd_participant": [], "source.credit_risk_playground.public.nh_transaction_instalment_loan": [], "source.credit_risk_playground.public.nihonium_eligibility_decision_audit": [], "source.credit_risk_playground.public.strontium_loan": [], "source.credit_risk_playground.public.cc_credit_draft": [], "source.credit_risk_playground.public.cc_credit_offer": [], "source.credit_risk_playground.public.miracle_customer_default": [], "source.credit_risk_playground.public.amh_categories": [], "source.credit_risk_playground.public.madrid_categorization": [], "source.credit_risk_playground.public.pu_overdraft_history": [], "source.credit_risk_playground.public.mmbr_gl_account": [], "source.credit_risk_playground.public.mmbr_gl_journal_entry": [], "source.credit_risk_playground.public.mmbr_savings_account": [], "source.credit_risk_playground.public.ddb_overdraft_settings_aud": [], "source.credit_risk_playground.public.dwh_cohort_dates": [], "source.credit_risk_playground.public.plutonium_repayment_plan": [], "source.credit_risk_playground.etl_reporting.lisbon_model_inputs": [], "source.credit_risk_playground.etl_reporting.lisbon_model_outputs": [], "source.credit_risk_playground.etl_reporting.lisbon_score_audit_log": [], "source.credit_risk_playground.etl_reporting.zr_transaction": [], "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity": [], "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity_calculation_categories": [], "source.credit_risk_playground.etl_reporting.pa_paccount": [], "source.credit_risk_playground.etl_reporting.dw_audit_log": [], "source.credit_risk_playground.etl_reporting.cmd_users": []}, "child_map": {"model.credit_risk_playground.my_first_dbt_model": ["model.credit_risk_playground.my_second_dbt_model", "test.credit_risk_playground.not_null_my_first_dbt_model_id.5fb22c2710", "test.credit_risk_playground.unique_my_first_dbt_model_id.16e066b321"], "model.credit_risk_playground.my_second_dbt_model": ["test.credit_risk_playground.not_null_my_second_dbt_model_id.151b76d778", "test.credit_risk_playground.unique_my_second_dbt_model_id.57a0f8c493"], "test.credit_risk_playground.unique_my_first_dbt_model_id.16e066b321": [], "test.credit_risk_playground.not_null_my_first_dbt_model_id.5fb22c2710": [], "test.credit_risk_playground.unique_my_second_dbt_model_id.57a0f8c493": [], "test.credit_risk_playground.not_null_my_second_dbt_model_id.151b76d778": [], "model.credit_risk_playground.bp_overdue_amt_aud_m_v2": ["model.credit_risk_playground.bp_arrears_reg_aud_v2"], "model.credit_risk_playground.bp_arrears_reg_aud_v2": [], "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2": ["model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2"], "model.credit_risk_playground.bp_overdraft_split_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_monitoring_pd_supermodel_v2_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_default_dunning_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_repayment_plan_ph1_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_loan_contract_information_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_hrc_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_social_benefits_v2_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_application_pd_supermodel_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_credit_bureau_rating_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_rmd_v2": [], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_me_v2": [], "model.credit_risk_playground.bp_default_credit_bureau_insolvency_max_date_v2": [], "model.credit_risk_playground.bp_p_accounts_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_monitoring_pd_supermodel_v3_m_v2": [], "analysis.credit_risk_playground.Social_benefits": [], "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2": ["model.credit_risk_playground.bp_forbearance_m_v2_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_retail_provisions_m": [], "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2": ["model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_garnishment_m_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_overdraft_limit_periods_v2": ["model.credit_risk_playground.bp_application_pd_supermodel_m_ad_v2", "model.credit_risk_playground.bp_application_pd_supermodel_m_v2", "model.credit_risk_playground.bp_overdraft_split_m_v2", "model.credit_risk_playground.bp_portfolio_customers_aud_m_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2": ["model.credit_risk_playground.bp_retail_provisions_m"], "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test": [], "model.credit_risk_playground.bp_forbearance_m_v2_v2": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs": [], "source.credit_risk_playground.credit_risk_playground.macroeconomic_inputs_v2": [], "source.credit_risk_playground.credit_risk_playground.bp_retail_provisions_stg_v5_pre": [], "source.credit_risk_playground.private.ca_credit_report_aud": [], "source.credit_risk_playground.private.ca_credit_score_record_request_aud": [], "source.credit_risk_playground.private.ca_credit_score_record_request_merkmal_aud": [], "source.credit_risk_playground.private.californium_customer_attribute": [], "source.credit_risk_playground.private.einsteinium_repayment_capacity_audit_log": [], "source.credit_risk_playground.private.es_requested_repayment_capacity": [], "source.credit_risk_playground.private.einsteinium_internal_credit_score_audit_log": [], "source.credit_risk_playground.private.es_requested_credit_score": [], "source.credit_risk_playground.private.es_internal_credit_score": [], "source.credit_risk_playground.private.einsteinium_n26_credit_score_audit_log": [], "source.credit_risk_playground.private.einsteinium_credit_score_audit_log": [], "source.credit_risk_playground.private.miracle_days_past_due": [], "source.credit_risk_playground.private.miracle_unlikeliness_to_pay": [], "source.credit_risk_playground.dbt.bp_overdraft_users": ["model.credit_risk_playground.bp_overdraft_split_m_v2"], "source.credit_risk_playground.dbt.bank_products_users": [], "source.credit_risk_playground.dbt.stg_user_detail": [], "source.credit_risk_playground.dbt.zrh_users": ["model.credit_risk_playground.bp_credit_bureau_rating_m_v2", "model.credit_risk_playground.bp_p_accounts_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "source.credit_risk_playground.dbt.zrh_txn_day": [], "source.credit_risk_playground.dbt.mmb_weekly_balance_aud": [], "source.credit_risk_playground.dbt.write_off": [], "source.credit_risk_playground.dbt.ucm_overdraft": [], "source.credit_risk_playground.dbt.mmbr_user_match": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2"], "source.credit_risk_playground.dbt.mmbr_repayment_aud": [], "source.credit_risk_playground.dbt.mmbr_loan_account_aud": [], "source.credit_risk_playground.dbt.card_transactions_pt": [], "source.credit_risk_playground.dbt.zr_transaction_user": [], "source.credit_risk_playground.dbt.device_tokens": [], "source.credit_risk_playground.dbt.login_attempts": [], "source.credit_risk_playground.dbt.bp_overdue_amounts_loans": [], "source.credit_risk_playground.public.dwh_cohort_months": [], "source.credit_risk_playground.public.cmd_users": [], "source.credit_risk_playground.public.cmd_n26_tnc_address": [], "source.credit_risk_playground.public.dwh_sneaky_transaction": [], "source.credit_risk_playground.public.mmbr_loan_transaction": [], "source.credit_risk_playground.public.mmbr_loan_account": ["model.credit_risk_playground.bp_portfolio_balance_aud_m_v2"], "source.credit_risk_playground.public.mmb_loan_account_semi_aud": [], "source.credit_risk_playground.public.mcv_infocard_template": [], "source.credit_risk_playground.public.mmbr_n26_repayment_aud": [], "source.credit_risk_playground.public.mmbr_repayment": ["model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "source.credit_risk_playground.public.dwh_portfolio_status_aud": [], "source.credit_risk_playground.public.la_action_log": [], "source.credit_risk_playground.public.neodymium_insolvency": ["model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2"], "source.credit_risk_playground.public.nd_participant": ["model.credit_risk_playground.bp_default_internal_insolvency_v2_m_v2"], "source.credit_risk_playground.public.nh_transaction_instalment_loan": [], "source.credit_risk_playground.public.nihonium_eligibility_decision_audit": [], "source.credit_risk_playground.public.strontium_loan": [], "source.credit_risk_playground.public.cc_credit_draft": [], "source.credit_risk_playground.public.cc_credit_offer": [], "source.credit_risk_playground.public.miracle_customer_default": [], "source.credit_risk_playground.public.amh_categories": [], "source.credit_risk_playground.public.madrid_categorization": [], "source.credit_risk_playground.public.pu_overdraft_history": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2"], "source.credit_risk_playground.public.mmbr_gl_account": ["model.credit_risk_playground.bp_portfolio_balance_aud_m_v2"], "source.credit_risk_playground.public.mmbr_gl_journal_entry": ["model.credit_risk_playground.bp_portfolio_balance_aud_m_v2"], "source.credit_risk_playground.public.mmbr_savings_account": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2", "model.credit_risk_playground.bp_portfolio_balance_aud_m_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_pre_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2", "model.credit_risk_playground.bp_retail_provisions_stg_v5_v4_updated_v2_test"], "source.credit_risk_playground.public.ddb_overdraft_settings_aud": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2"], "source.credit_risk_playground.public.dwh_cohort_dates": ["model.credit_risk_playground.bp_default_credit_bureau_insolvency_v3_m_v2"], "source.credit_risk_playground.public.plutonium_repayment_plan": [], "source.credit_risk_playground.etl_reporting.lisbon_model_inputs": [], "source.credit_risk_playground.etl_reporting.lisbon_model_outputs": [], "source.credit_risk_playground.etl_reporting.lisbon_score_audit_log": [], "source.credit_risk_playground.etl_reporting.zr_transaction": [], "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity": [], "source.credit_risk_playground.etl_reporting.cortisol_repayment_capacity_calculation_categories": [], "source.credit_risk_playground.etl_reporting.pa_paccount": ["model.credit_risk_playground.bp_p_accounts_v2"], "source.credit_risk_playground.etl_reporting.dw_audit_log": [], "source.credit_risk_playground.etl_reporting.cmd_users": ["model.credit_risk_playground.bp_overdraft_limit_periods_v2"]}, "group_map": {}, "saved_queries": {}, "semantic_models": {}, "unit_tests": {}}